Directory structure:
└── zeronsh-chat/
    ├── README.md
    ├── components.json
    ├── docker-compose.yml
    ├── drizzle-zero.config.ts
    ├── drizzle.config.ts
    ├── LICENSE
    ├── package.json
    ├── pnpm-workspace.yaml
    ├── tsconfig.json
    ├── vercel.json
    ├── vite.config.ts
    ├── .env.production
    ├── .prettierrc
    ├── drizzle/
    │   ├── 0000_violet_wolverine.sql
    │   ├── 0001_seed-models.sql
    │   ├── 0002_boring_owl.sql
    │   ├── 0003_complex_mesmero.sql
    │   ├── 0004_seed-zai-models.sql
    │   ├── 0005_seed-claude.sql
    │   ├── 0006_daffy_serpent_society.sql
    │   ├── 0007_seed-qwen3-coder.sql
    │   ├── 0008_seed-gpt-oss.sql
    │   ├── 0009_oval_chamber.sql
    │   ├── 0010_add-gpt-5-models.sql
    │   ├── 0011_add-deepseek-models.sql
    │   ├── 0012_add-glm-45v.sql
    │   ├── 0013_add-deepseek-3.1.sql
    │   ├── 0014_seed_models-sep-6-2025.sql
    │   ├── 0015_aberrant_giant_man.sql
    │   ├── 0016_seed-claude-4.5.sql
    │   ├── 0017_seed-new-models.sql
    │   ├── 0018_seed_models-nov-8-2025.sql
    │   └── meta/
    │       ├── 0000_snapshot.json
    │       ├── 0001_snapshot.json
    │       ├── 0002_snapshot.json
    │       ├── 0003_snapshot.json
    │       ├── 0004_snapshot.json
    │       ├── 0005_snapshot.json
    │       ├── 0006_snapshot.json
    │       ├── 0007_snapshot.json
    │       ├── 0008_snapshot.json
    │       ├── 0009_snapshot.json
    │       ├── 0010_snapshot.json
    │       ├── 0011_snapshot.json
    │       ├── 0012_snapshot.json
    │       ├── 0013_snapshot.json
    │       ├── 0014_snapshot.json
    │       ├── 0015_snapshot.json
    │       ├── 0016_snapshot.json
    │       ├── 0017_snapshot.json
    │       ├── 0018_snapshot.json
    │       └── _journal.json
    ├── public/
    │   └── manifest.json
    ├── src/
    │   ├── global.css
    │   ├── router.tsx
    │   ├── routeTree.gen.ts
    │   ├── ai/
    │   │   ├── prompt.ts
    │   │   ├── service.ts
    │   │   ├── stream.ts
    │   │   ├── types.ts
    │   │   └── tools/
    │   │       ├── deep-search-tool.ts
    │   │       ├── index.ts
    │   │       ├── research-tool.ts
    │   │       └── search-tool.ts
    │   ├── components/
    │   │   ├── ai-elements/
    │   │   │   ├── chain-of-thought.tsx
    │   │   │   ├── reasoning.tsx
    │   │   │   └── response.tsx
    │   │   ├── app/
    │   │   │   ├── account-dialog.tsx
    │   │   │   ├── auth.tsx
    │   │   │   ├── insufficient-dialog.tsx
    │   │   │   ├── model-selector.tsx
    │   │   │   ├── pro-dialog.tsx
    │   │   │   ├── single-field-form.tsx
    │   │   │   ├── theme-selector.tsx
    │   │   │   └── user-menu.tsx
    │   │   ├── icons/
    │   │   │   ├── anthropic.tsx
    │   │   │   ├── claude.tsx
    │   │   │   ├── deepseek.tsx
    │   │   │   ├── gemini.tsx
    │   │   │   ├── google.tsx
    │   │   │   ├── grok.tsx
    │   │   │   ├── meta.tsx
    │   │   │   ├── mistral.tsx
    │   │   │   ├── moonshot.tsx
    │   │   │   ├── ollama.tsx
    │   │   │   ├── openai.tsx
    │   │   │   ├── openrouter.tsx
    │   │   │   ├── qwen.tsx
    │   │   │   ├── x.tsx
    │   │   │   ├── xai.tsx
    │   │   │   ├── zai.tsx
    │   │   │   └── zeron.tsx
    │   │   ├── layout/
    │   │   │   ├── app-sidebar.tsx
    │   │   │   ├── header.tsx
    │   │   │   └── tool-sidebar.tsx
    │   │   ├── meta/
    │   │   │   └── title.tsx
    │   │   ├── thread/
    │   │   │   ├── file-attachment.tsx
    │   │   │   ├── file-drop-area.tsx
    │   │   │   ├── model-icon.tsx
    │   │   │   ├── multi-modal-input.tsx
    │   │   │   ├── scroll-to-bottom-button.tsx
    │   │   │   ├── thread-container.tsx
    │   │   │   └── message/
    │   │   │       ├── assistant-message.tsx
    │   │   │       ├── message-container.tsx
    │   │   │       ├── message-item.tsx
    │   │   │       ├── message-list.tsx
    │   │   │       ├── pending-message.tsx
    │   │   │       ├── ui-message.tsx
    │   │   │       ├── url-result-button.tsx
    │   │   │       ├── user-message.tsx
    │   │   │       └── part/
    │   │   │           ├── deep-search-part.tsx
    │   │   │           ├── error-part.tsx
    │   │   │           ├── index.tsx
    │   │   │           ├── reasoning-part.tsx
    │   │   │           ├── research-part.tsx
    │   │   │           ├── search-part.tsx
    │   │   │           └── text-part.tsx
    │   │   └── ui/
    │   │       ├── alert.tsx
    │   │       ├── avatar.tsx
    │   │       ├── badge.tsx
    │   │       ├── button.tsx
    │   │       ├── capability-badges.tsx
    │   │       ├── checkbox.tsx
    │   │       ├── code-block.tsx
    │   │       ├── collapsible.tsx
    │   │       ├── command.tsx
    │   │       ├── dialog.tsx
    │   │       ├── dropdown-menu.tsx
    │   │       ├── input.tsx
    │   │       ├── label.tsx
    │   │       ├── loader.tsx
    │   │       ├── markdown.tsx
    │   │       ├── message.tsx
    │   │       ├── popover.tsx
    │   │       ├── prompt-input.tsx
    │   │       ├── section.tsx
    │   │       ├── select.tsx
    │   │       ├── separator.tsx
    │   │       ├── sheet.tsx
    │   │       ├── sidebar.tsx
    │   │       ├── skeleton.tsx
    │   │       ├── sonner.tsx
    │   │       ├── stars.tsx
    │   │       ├── switch.tsx
    │   │       ├── table.tsx
    │   │       ├── textarea.tsx
    │   │       └── tooltip.tsx
    │   ├── context/
    │   │   ├── database.tsx
    │   │   └── thread.tsx
    │   ├── database/
    │   │   ├── app-schema.ts
    │   │   ├── auth-schema.ts
    │   │   ├── effect.ts
    │   │   ├── index.ts
    │   │   ├── queries.ts
    │   │   ├── schema.ts
    │   │   └── types.ts
    │   ├── emails/
    │   │   └── magic-link.tsx
    │   ├── hooks/
    │   │   ├── use-access.ts
    │   │   ├── use-auto-resume.ts
    │   │   ├── use-chats-by-time-range.ts
    │   │   ├── use-code-highlighter.ts
    │   │   ├── use-database.ts
    │   │   ├── use-mobile.ts
    │   │   ├── use-params-thread-id.ts
    │   │   └── use-session.ts
    │   ├── lib/
    │   │   ├── auth-client.ts
    │   │   ├── auth.ts
    │   │   ├── constants.ts
    │   │   ├── env.ts
    │   │   ├── error.ts
    │   │   ├── exa.ts
    │   │   ├── redis.ts
    │   │   ├── resend.ts
    │   │   ├── stripe.ts
    │   │   ├── uploadthing.ts
    │   │   ├── usernames.ts
    │   │   └── utils.ts
    │   ├── routes/
    │   │   ├── __root.tsx
    │   │   ├── _account.account.appearance.tsx
    │   │   ├── _account.account.index.tsx
    │   │   ├── _account.account.models.tsx
    │   │   ├── _account.account.preferences.tsx
    │   │   ├── _account.account.subscription.tsx
    │   │   ├── _account.account.tsx
    │   │   ├── _account.logged-out.tsx
    │   │   ├── _account.login.index.tsx
    │   │   ├── _account.magic-link.tsx
    │   │   ├── _account.tsx
    │   │   ├── _app._thread.$threadId.tsx
    │   │   ├── _app._thread.index.tsx
    │   │   ├── _app._thread.tsx
    │   │   ├── _app.tsx
    │   │   ├── _team.tsx
    │   │   ├── api.auth.$.ts
    │   │   ├── api.checkout.success.ts
    │   │   ├── api.checkout.ts
    │   │   ├── api.customer-portal.ts
    │   │   ├── api.reset.ts
    │   │   ├── api.thread.$threadId.stop.ts
    │   │   ├── api.thread.$threadId.stream.ts
    │   │   ├── api.thread.ts
    │   │   ├── api.uploadthing.ts
    │   │   └── api.webhook.stripe.ts
    │   ├── stores/
    │   │   └── dialogs.ts
    │   ├── thread/
    │   │   ├── index.ts
    │   │   ├── state.ts
    │   │   └── store.ts
    │   └── zero/
    │       ├── index.ts
    │       ├── permissions.ts
    │       ├── schema.ts
    │       └── types.ts
    └── .claude/
        └── settings.local.json

================================================
FILE: README.md
================================================
<div align="center">
  <a href="https://github.com/zeronsh/chat">
    <img src="public/bg.png" alt="Logo">
  </a>

  <h3 align="center">Zeron Chat</h3>

  <p align="center">
    A unified AI chat app with models from Claude, OpenAI, Gemini, and more.
    <br />
    <a href="https://github.com/zeronsh/chat/issues">Report Bug</a>
    ·
    <a href="https://github.com/zeronsh/chat/issues">Request Feature</a>
  </p>
</div>

[![MIT License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://github.com/zeronsh/chat/blob/main/LICENSE)

---

## About The Project

Zeron Chat is a sleek, modern, and unified AI chat application. It allows you to interact with large language models from Anthropic (Claude), OpenAI (GPT), and Google (Gemini) all in one place.

<div align="center">
  <img src="public/screenshot.png" alt="Screenshot" width="100%">
</div>

## Key Features

-   **Resumable Streams**: Continue generating responses even after a page refresh.
-   **Fast Navigation**: Quickly switch between different chat sessions.
-   **Search Tool**: Integrated search functionality. Using [Exa](https://www.exa.ai/)
-   **Research Tool**: Perform research within the chat interface.
-   **Theming**: Multiple themes to customize the look and feel.

## Built With

This project is built with:

-   [TanStack Start](https://tanstack.com/start/latest)
-   [Zero](https://zero.rocicorp.dev/)
-   [Vercel AI SDK](https://sdk.vercel.ai/)
-   [React](https://react.dev/)
-   [TypeScript](https://www.typescriptlang.org/)
-   [Shadcn/UI](https://ui.shadcn.com/)

## License

Distributed under the MIT License. See `LICENSE` for more information.



================================================
FILE: components.json
================================================
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/global.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}


================================================
FILE: docker-compose.yml
================================================
services:
    zeron_redis:
        image: redis:7.4-alpine
        restart: always
        ports:
            - 50001:6379
        volumes:
            - zeron_redis_data:/data
    zeron_postgres:
        image: postgres:16.2-alpine
        shm_size: 1g
        user: postgres
        restart: always
        healthcheck:
            test: 'pg_isready -U user --dbname=postgres'
            interval: 10s
            timeout: 5s
            retries: 5
        ports:
            - 50000:5432
        environment:
            POSTGRES_USER: user
            POSTGRES_DB: postgres
            POSTGRES_PASSWORD: password
        command: |
            postgres
            -c wal_level=logical
            -c max_wal_senders=10
            -c max_replication_slots=5
            -c hot_standby=on
            -c hot_standby_feedback=on
        volumes:
            - zeron_pgdata:/var/lib/postgresql/data

volumes:
    zeron_redis_data:
        driver: local
    zeron_pgdata:
        driver: local



================================================
FILE: drizzle-zero.config.ts
================================================
import { schema } from '@/database/schema';
import { drizzleZeroConfig } from 'drizzle-zero';

export default drizzleZeroConfig(schema, {
    tables: {
        message: {
            id: true,
            message: true,
            threadId: true,
            userId: true,
            createdAt: true,
            updatedAt: true,
        },
        thread: {
            id: true,
            title: true,
            userId: true,
            streamId: true,
            status: true,
            createdAt: true,
            updatedAt: true,
        },
        model: {
            id: true,
            name: true,
            model: true,
            description: true,
            capabilities: true,
            icon: true,
            access: true,
            credits: true,
            createdAt: true,
            updatedAt: true,
        },
        setting: {
            id: true,
            mode: true,
            theme: true,
            userId: true,
            nickname: true,
            biography: true,
            instructions: true,
            modelId: true,
            pinnedModels: true,
        },
        user: {
            id: true,
            name: true,
            email: true,
            emailVerified: true,
            image: true,
            createdAt: true,
            updatedAt: true,
            isAnonymous: true,
        },
        session: {
            id: true,
            expiresAt: true,
            token: true,
            createdAt: true,
            updatedAt: true,
            ipAddress: true,
            userAgent: true,
            userId: true,
            activeOrganizationId: true,
        },
        organization: {
            id: true,
            name: true,
            slug: true,
            logo: true,
            createdAt: true,
            metadata: true,
        },
        member: {
            id: true,
            organizationId: true,
            userId: true,
            role: true,
            createdAt: true,
        },
        userCustomer: {
            id: true,
            userId: true,
            subscription: true,
        },
        organizationCustomer: {
            id: true,
            organizationId: true,
            subscription: true,
        },
        userSubscription: {
            id: true,
            customerId: true,
            data: true,
            userId: true,
        },
        usage: {
            id: true,
            userId: true,
            credits: true,
            search: true,
            research: true,
        },
        organizationSubscription: {
            id: true,
            customerId: true,
            data: true,
            organizationId: true,
        },
        invitation: false,
        account: false,
        verification: false,
        jwks: false,
    },
});



================================================
FILE: drizzle.config.ts
================================================
import { env } from '@/lib/env';
import { defineConfig } from 'drizzle-kit';

export default defineConfig({
    out: './drizzle',
    schema: './src/database/schema.ts',
    dialect: 'postgresql',
    dbCredentials: {
        url: env.ZERO_UPSTREAM_DB,
    },
});



================================================
FILE: LICENSE
================================================
MIT License

Copyright (c) 2025 Winglee

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.



================================================
FILE: package.json
================================================
{
    "name": "chat",
    "version": "0.1.0",
    "private": true,
    "type": "module",
    "scripts": {
        "dev": "dotenvx run -- vite",
        "build": "pnpm run database:migrate:prod && pnpm run zero:deploy && dotenvx run -f .env.production -- vite build",
        "serve": "dotenvx run -f .env.production -- vite preview",
        "scan": "npx react-scan@latest localhost:5173",
        "auth:generate": "dotenvx run -- npx @better-auth/cli generate --output ./src/database/auth-schema.ts",
        "database:push": "dotenvx run -- npx drizzle-kit push",
        "database:generate": "dotenvx run -- npx drizzle-kit generate",
        "database:migrate": "dotenvx run -- npx drizzle-kit migrate",
        "database:migrate:prod": "dotenvx run -f .env.production -- npx drizzle-kit migrate",
        "database:studio": "dotenvx run -- npx drizzle-kit studio",
        "database:studio:prod": "dotenvx run -f .env.production -- npx drizzle-kit studio",
        "zero:deploy": "dotenvx run -f .env.production -- npx zero-deploy-permissions -p ./src/zero/index.ts",
        "zero:generate": "dotenvx run -- drizzle-zero generate --format --output ./src/zero/schema.ts",
        "zero:dev": "dotenvx run -- npx zero-cache-dev -p src/zero/index.ts ",
        "stripe:webhook": "stripe listen --forward-to localhost:5173/api/webhook/stripe"
    },
    "dependencies": {
        "@ai-sdk/anthropic": "^2.0.1",
        "@ai-sdk/gateway": "^1.0.21",
        "@ai-sdk/google": "^2.0.3",
        "@ai-sdk/openai": "^2.0.7",
        "@base-ui-components/react": "1.0.0-beta.2",
        "@radix-ui/react-avatar": "^1.1.10",
        "@radix-ui/react-checkbox": "^1.3.2",
        "@radix-ui/react-collapsible": "^1.1.12",
        "@radix-ui/react-dialog": "^1.1.14",
        "@radix-ui/react-dropdown-menu": "^2.1.15",
        "@radix-ui/react-label": "^2.1.7",
        "@radix-ui/react-popover": "^1.1.14",
        "@radix-ui/react-select": "^2.2.5",
        "@radix-ui/react-separator": "^1.1.7",
        "@radix-ui/react-slot": "^1.2.3",
        "@radix-ui/react-switch": "^1.2.5",
        "@radix-ui/react-tooltip": "^1.2.7",
        "@radix-ui/react-use-controllable-state": "^1.2.2",
        "@react-email/components": "^0.3.2",
        "@rocicorp/zero": "^0.23.2025090100",
        "@t3-oss/env-core": "^0.13.8",
        "@tanstack/react-form": "^1.14.1",
        "@tanstack/react-router": "^1.129.5",
        "@tanstack/react-start": "^1.129.5",
        "@tanstack/react-store": "^0.7.3",
        "@tanstack/react-table": "^8.21.3",
        "@tanstack/zod-adapter": "^1.131.8",
        "@uidotdev/usehooks": "^2.4.1",
        "@uploadthing/react": "^7.3.2",
        "@vercel/functions": "^3.1.0",
        "ai": "5.0.13",
        "better-auth": "^1.2.12",
        "class-variance-authority": "^0.7.1",
        "clsx": "^2.1.1",
        "cmdk": "^1.1.1",
        "drizzle-orm": "^0.44.6",
        "effect": "^3.16.12",
        "effect-redis": "^0.0.11",
        "exa-js": "^1.8.23",
        "framer-motion": "^12.23.1",
        "ioredis": "^5.7.0",
        "lucide-react": "^0.525.0",
        "marked": "^16.0.0",
        "motion": "^12.23.1",
        "nanoid": "^5.1.5",
        "next-themes": "^0.4.6",
        "pg": "^8.16.3",
        "react": "^19.1.0",
        "react-dom": "^19.1.0",
        "react-dropzone": "^14.3.8",
        "react-icons": "^5.5.0",
        "react-markdown": "^10.1.0",
        "redis": "^5.8.2",
        "remark-breaks": "^4.0.0",
        "remark-gfm": "^4.0.1",
        "resend": "^4.7.0",
        "resumable-stream": "^2.2.4",
        "shiki": "^3.7.0",
        "sonner": "^2.0.6",
        "streamdown": "^1.3.0",
        "stripe": "^18.3.0",
        "tailwind-merge": "^3.3.1",
        "throttleit": "^2.1.0",
        "ts-pattern": "^5.7.1",
        "ua-parser-js": "^2.0.4",
        "uploadthing": "^7.7.3",
        "use-stick-to-bottom": "^1.1.1",
        "usehooks-ts": "^3.1.1",
        "virtua": "^0.41.5",
        "zod": "4.0.11",
        "zustand": "^5.0.6"
    },
    "devDependencies": {
        "@dotenvx/dotenvx": "^1.46.0",
        "@tailwindcss/typography": "^0.5.16",
        "@tailwindcss/vite": "^4.1.11",
        "@tanstack/router-plugin": "^1.125.6",
        "@types/bun": "latest",
        "@types/pg": "^8.15.4",
        "@types/react": "^19",
        "@types/react-dom": "^19",
        "@vitejs/plugin-react": "^4.7.0",
        "drizzle-kit": "^0.31.5",
        "drizzle-zero": "^0.13.3",
        "tailwindcss": "^4.0.6",
        "tailwindcss-animate": "^1.0.7",
        "tsx": "^4.20.3",
        "tw-animate-css": "^1.3.5",
        "typescript": "^5.9.2",
        "vite": "^7.0.5",
        "vite-bundle-analyzer": "^1.2.1",
        "vite-tsconfig-paths": "^5.1.4"
    }
}



================================================
FILE: pnpm-workspace.yaml
================================================
onlyBuiltDependencies:
  - '@parcel/watcher'
  - '@rocicorp/zero-sqlite3'
  - '@tailwindcss/oxide'
  - esbuild
  - msgpackr-extract
  - protobufjs



================================================
FILE: tsconfig.json
================================================
{
    "compilerOptions": {
        "target": "ESNext",
        "module": "Preserve",
        "moduleResolution": "bundler",
        "jsx": "react-jsx",
        "allowJs": true,
        "strict": true,
        "skipLibCheck": true,
        "forceConsistentCasingInFileNames": true,
        "baseUrl": ".",
        "paths": {
            "@/*": ["./src/*"]
        },
        "types": ["vite/client"]
    },
    "exclude": ["dist", "node_modules"]
}



================================================
FILE: vercel.json
================================================
{
    "$schema": "https://openapi.vercel.sh/vercel.json",
    "crons": [
        {
            "path": "/api/reset",
            "schedule": "0 0 * * *"
        }
    ]
}



================================================
FILE: vite.config.ts
================================================
import { defineConfig } from 'vite';
import tsConfigPaths from 'vite-tsconfig-paths';
import { tanstackStart } from '@tanstack/react-start/plugin/vite';
import tailwindcss from '@tailwindcss/vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
    plugins: [
        tsConfigPaths({
            projects: ['./tsconfig.json'],
        }),
        tailwindcss(),
        tanstackStart({
            customViteReactPlugin: true,
        }),
        react(),
    ],
});



================================================
FILE: .env.production
================================================
#/-------------------[DOTENV_PUBLIC_KEY]--------------------/
#/            public-key encryption for .env files          /
#/       [how it works](https://dotenvx.com/encryption)     /
#/----------------------------------------------------------/
DOTENV_PUBLIC_KEY_PRODUCTION="037be804c74bb6eaadda6b900a4a45398d69d569cf8db5c4b471656477e601c9e4"

# .env.production
#/-------------------[DOTENV_PUBLIC_KEY]--------------------/
#/            public-key encryption for .env files          /
#/       [how it works](https://dotenvx.com/encryption)     /
#/----------------------------------------------------------/
DOTENV_PUBLIC_KEY="037be804c74bb6eaadda6b900a4a45398d69d569cf8db5c4b471656477e601c9e4"

# .env
AI_GATEWAY_API_KEY=encrypted:BBEiVpVAvPDa1kjOKyzpMyc2P5Hz318tUo2PuBFKm7HW+ESU+P4ohlNza+K36F75OBUPRcZOosSMCou4sTllTdVjpwHCtNCo+HJ8iNmYkZnH0avE4BBFB1Kz/cafa8MdB7flVIytPL4aE8S44vKytIff0rWEChmWAA==
BETTER_AUTH_SECRET="encrypted:BORzqm6qLjkT4ZUHcSoDcuB6vZnt5UoJFuhnpDjORYHxSVbfCFSuwuGTAp54idWDrViuYVluq+JISFUQtIlkH6dlAkNRkl3wXtUtFIuzA+bRmy86yQqZcy0/P6RHlajyMmNlo0BU6idQz60L9Au2ejzudErxG0eMNpAkLBCkC3dA"
BETTER_AUTH_URL="encrypted:BOE2zAaCP1VvOKtSuwNpAWaWf/rN24CW9Si1fzCaxJMlxL7JyH8XS3mhCog0lFLzihP8uNUaLO5ozSIUxX2jyrCHU3Fj4CTVEovGXCBcD9Ocsf7e8q3IxJD+xxzHsqpE3SLmzMMszAGs7Nky2ZyWUzM="
VITE_PUBLIC_API_URL="encrypted:BAFUYiSenDYNvJYVDEcAg3cmonAqfTdF5zQwbIz62NAy4sVC3TNorToSeELvdL2j716wixwnhTO6duF1lXjhRwBOjsqz5Ny+/4YYidNWqmCnN2lrkaOyydc6yHv1rIU/fzVQpUG9m+k6cHXJg9c7+sM="
VITE_PUBLIC_ZERO_URL="encrypted:BImmoF4dhrXql2weP2tQbQVtN7siGoDjKi56C03MgIxS/MVSFGiIHFXkymir7ULFn9ncaXUJzzlJcwXysn8HTL1RB9PvpEHAhqAuG8ObYkEm+qzaFQUhF6mCDk3onz5mqT4slqTAWbXMhtdHXQseC12AfHfoYSEdq01u6mPUVg=="
ZERO_UPSTREAM_DB="encrypted:BEKfnvYh2i3dAvRb9Xu5j7HsXPe+5CEoVOGpnOBfbu8TKW3R8MaNNSzFQ4pY8fVy0udU5KWAAzUSRXEDhLCbaa6CcFw17WtoNBvr8dj5pyP8OrZpM829HorphpUMfi3Q3cfTgxbg5noa5O3b1ykdACFqcgABa8hoT1Ymb4+8tQErcfvQfM2ssZj/4TWtQcGR9l6cvoGl6FyJkdvO0vpSPcYtxCkrOeJpyie0dU+EOF2C98JPNAycz1EIg8e36yWQ6Vt8PAaw/MU2ZsG16VPfjXY="
REDIS_URL="encrypted:BLxUvTxEw/teD6/jI1cTqz0gdZIZ25guugpccRuy6G0d8quzNoK356szxK+qRA7PGmQlZciUuE0L54iDd577xdmLXweuBQjH6ttK5MLKddEVonzXYlzHofRjoIyektNngvIQbsA0QkUSpaoOFhsaeeTUovRQQanT6VVve3Dxs8dZ7YGHiCkzdSqnCjD5T1MzcgVpBWEstn7gnjfa2HSARDlmiIXJ2/Ljm2BbxvUibjtGjhjzKTiORF3unOQT9nHzsAFirsn0"
UPLOADTHING_TOKEN="encrypted:BMZESjmXZcOV5GrzmlxZKhiMUbOnEsr3YHF4LtAstJSd+xmWefbpupaV5naNQ+COLIo44rk4cepa2KyDDjAELnjgUQGpYqudbpicGUoPB0Igo777mcvrDe9QoOLsFvbU1eW9Trv04L4kBX+NnfoK+jSyWYkGlQoKmC7LmBPR6OG7jyYOEAGE3JsHDqwcKj5+ftwhML8dPN2XgNLPpqgYFyW7G3hDtbT0uu8R3C0D5aBYabtEdkK1bSb2M9UfvA0t7HfBCHIKtPyKWsKKZhnEeBeBgviWWftwb+UHh3tpPf//LH/M4WwfHTuWkXYNX65Ce7yuwdUTTJar2MLYqmuW8NYknOTpNB7qyA=="
EXA_API_KEY="encrypted:BJNYj3op8h/+KwP5lhVd1cQKIC/GgKEttEUkffi3nbOJKo/DSlcUjcavnl8kNlc9990SFtCz12iGkG1L8ugEd07uxwDuVpfl8sm4kgVAbj36qQEA401YsDH0UAFD1kjXhjXyELGMfieys7a39dfWoghpNS3Kg2awDZGFoMM3Rz7vJLzNJg=="
STRIPE_SECRET_KEY=encrypted:BCgwQTpS0MrnYBqXMk4n8/dY+S1hcYXVshos8hdHw/5TrBW1yuAwoOpSull2y2G4tcf7Z07ZPmbdu9j138JqIrEUwqMV6991yBrFlogqBSB51QcZLkLaD4eGWZKAo8Sj84QsPraM3IO/hNMeKjcgNkgpTJRCM3L/Zk7uP1r6Ema6z87nC3jaNn+7dKbdhxW84KRwbDT7orhoDjxppIxAYh7R/5jVYhyU++Rqba5IqyKnn9HxEB5tCY4q9CPz+uKzEQMpJK80M6VHSEGV
STRIPE_WEBHOOK_SECRET=encrypted:BGyDxFVh2Atj0VScGUMkZyjIJfGL/GYqYni1cdLQ4vuQcwlLCuepbluINJ8cqOrp5C7Gs6+SRfs+l3RWWAgav6jHH0fvrP1TMpqO4UFydzI/ilCND4mta4+F2vVAYLxEV2s33WjDzkhSFHvKROB/Ca3toTIlgWkvlRgP+lRnGmeXDlBahX81ClW+XgC7Yqc73eWS2QLLfALECG0u/voJ4vsMuAR1ckauoznF+73EJ77jQPY34r954jIhUS2Nmf/WcVnHs/iZNZqb7bJI
PRO_MONTHLY_PRICE_ID="encrypted:BB7ytBk9l28FUPx/Yu/Ig14PXgw8HNERQIPqWYzit/dGYCt04qQCXK4kfs1qct0080XPCzPj9ty8Myv+zXj3pvMtXEN5lzWkyTO0zWDNTkksYy8xRWEGW02ZY31Avi/TczflOSvJTGqwU+PztNkTX+Kf2keeH7ImZlpm174GPQ=="
CRON_SECRET="encrypted:BFm2uoon3KcskHLP20uVTOl5w3Jzd5HGXFWUYYACeFy3nuT8H48fKSYqFmsxm4mtz3IZi49FLjZzJFeQNTbMwudAYg3e/6ii2o1QQVsUefwyDdN70Hd2/+UWMfLaUM/0eqR5rUE6kPexhshuLum5nVU="


================================================
FILE: .prettierrc
================================================
{
  "printWidth": 100,
  "tabWidth": 4,
  "useTabs": false,
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",
  "bracketSpacing": true,
  "arrowParens": "avoid"
}



================================================
FILE: drizzle/0000_violet_wolverine.sql
================================================
CREATE TYPE "public"."mode" AS ENUM('light', 'dark');--> statement-breakpoint
CREATE TYPE "public"."access" AS ENUM('public', 'account_required', 'premium_required');--> statement-breakpoint
CREATE TYPE "public"."icon" AS ENUM('anthropic', 'claude', 'deepseek', 'gemini', 'google', 'grok', 'meta', 'mistral', 'ollama', 'openai', 'openrouter', 'x', 'xai');--> statement-breakpoint
CREATE TYPE "public"."status" AS ENUM('ready', 'streaming', 'submitted');--> statement-breakpoint
CREATE TABLE "account" (
	"id" text PRIMARY KEY NOT NULL,
	"account_id" text NOT NULL,
	"provider_id" text NOT NULL,
	"user_id" text NOT NULL,
	"access_token" text,
	"refresh_token" text,
	"id_token" text,
	"access_token_expires_at" timestamp,
	"refresh_token_expires_at" timestamp,
	"scope" text,
	"password" text,
	"created_at" timestamp NOT NULL,
	"updated_at" timestamp NOT NULL
);
--> statement-breakpoint
CREATE TABLE "invitation" (
	"id" text PRIMARY KEY NOT NULL,
	"organization_id" text NOT NULL,
	"email" text NOT NULL,
	"role" text,
	"status" text DEFAULT 'pending' NOT NULL,
	"expires_at" timestamp NOT NULL,
	"inviter_id" text NOT NULL
);
--> statement-breakpoint
CREATE TABLE "jwks" (
	"id" text PRIMARY KEY NOT NULL,
	"public_key" text NOT NULL,
	"private_key" text NOT NULL,
	"created_at" timestamp NOT NULL
);
--> statement-breakpoint
CREATE TABLE "member" (
	"id" text PRIMARY KEY NOT NULL,
	"organization_id" text NOT NULL,
	"user_id" text NOT NULL,
	"role" text DEFAULT 'member' NOT NULL,
	"created_at" timestamp NOT NULL
);
--> statement-breakpoint
CREATE TABLE "organization" (
	"id" text PRIMARY KEY NOT NULL,
	"name" text NOT NULL,
	"slug" text,
	"logo" text,
	"created_at" timestamp NOT NULL,
	"metadata" text,
	CONSTRAINT "organization_slug_unique" UNIQUE("slug")
);
--> statement-breakpoint
CREATE TABLE "session" (
	"id" text PRIMARY KEY NOT NULL,
	"expires_at" timestamp NOT NULL,
	"token" text NOT NULL,
	"created_at" timestamp NOT NULL,
	"updated_at" timestamp NOT NULL,
	"ip_address" text,
	"user_agent" text,
	"user_id" text NOT NULL,
	"active_organization_id" text,
	CONSTRAINT "session_token_unique" UNIQUE("token")
);
--> statement-breakpoint
CREATE TABLE "user" (
	"id" text PRIMARY KEY NOT NULL,
	"name" text NOT NULL,
	"email" text NOT NULL,
	"email_verified" boolean NOT NULL,
	"image" text,
	"created_at" timestamp NOT NULL,
	"updated_at" timestamp NOT NULL,
	"is_anonymous" boolean,
	CONSTRAINT "user_email_unique" UNIQUE("email")
);
--> statement-breakpoint
CREATE TABLE "verification" (
	"id" text PRIMARY KEY NOT NULL,
	"identifier" text NOT NULL,
	"value" text NOT NULL,
	"expires_at" timestamp NOT NULL,
	"created_at" timestamp,
	"updated_at" timestamp
);
--> statement-breakpoint
CREATE TABLE "message" (
	"id" text PRIMARY KEY NOT NULL,
	"message" jsonb NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp DEFAULT now() NOT NULL,
	"thread_id" text NOT NULL,
	"user_id" text NOT NULL
);
--> statement-breakpoint
CREATE TABLE "model" (
	"id" text PRIMARY KEY NOT NULL,
	"name" text NOT NULL,
	"model" text NOT NULL,
	"description" text NOT NULL,
	"capabilities" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"icon" "icon" NOT NULL,
	"credits" integer DEFAULT 0 NOT NULL,
	"access" "access" DEFAULT 'public' NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "organization_customer" (
	"id" text PRIMARY KEY NOT NULL,
	"organization_id" text NOT NULL,
	"subscription" jsonb,
	CONSTRAINT "organization_customer_id_unique" UNIQUE("id"),
	CONSTRAINT "organization_customer_organization_id_unique" UNIQUE("organization_id")
);
--> statement-breakpoint
CREATE TABLE "setting" (
	"id" text PRIMARY KEY NOT NULL,
	"mode" "mode" DEFAULT 'dark' NOT NULL,
	"theme" text,
	"user_id" text NOT NULL,
	"nickname" text,
	"biography" text,
	"instructions" text,
	"model_id" text DEFAULT 'gpt-4o-mini' NOT NULL
);
--> statement-breakpoint
CREATE TABLE "thread" (
	"id" text PRIMARY KEY NOT NULL,
	"title" text,
	"status" "status" DEFAULT 'ready' NOT NULL,
	"stream_id" text,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp DEFAULT now() NOT NULL,
	"user_id" text NOT NULL
);
--> statement-breakpoint
CREATE TABLE "usage" (
	"id" text PRIMARY KEY NOT NULL,
	"user_id" text NOT NULL,
	"credits" integer DEFAULT 0 NOT NULL,
	"search" integer DEFAULT 0 NOT NULL,
	"research" integer DEFAULT 0 NOT NULL
);
--> statement-breakpoint
CREATE TABLE "user_customer" (
	"id" text PRIMARY KEY NOT NULL,
	"user_id" text NOT NULL,
	"subscription" jsonb,
	CONSTRAINT "user_customer_id_unique" UNIQUE("id"),
	CONSTRAINT "user_customer_user_id_unique" UNIQUE("user_id")
);
--> statement-breakpoint
ALTER TABLE "account" ADD CONSTRAINT "account_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invitation" ADD CONSTRAINT "invitation_organization_id_organization_id_fk" FOREIGN KEY ("organization_id") REFERENCES "public"."organization"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invitation" ADD CONSTRAINT "invitation_inviter_id_user_id_fk" FOREIGN KEY ("inviter_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "member" ADD CONSTRAINT "member_organization_id_organization_id_fk" FOREIGN KEY ("organization_id") REFERENCES "public"."organization"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "member" ADD CONSTRAINT "member_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "session" ADD CONSTRAINT "session_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "message" ADD CONSTRAINT "message_thread_id_thread_id_fk" FOREIGN KEY ("thread_id") REFERENCES "public"."thread"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "message" ADD CONSTRAINT "message_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_customer" ADD CONSTRAINT "organization_customer_organization_id_organization_id_fk" FOREIGN KEY ("organization_id") REFERENCES "public"."organization"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "setting" ADD CONSTRAINT "setting_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "thread" ADD CONSTRAINT "thread_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "usage" ADD CONSTRAINT "usage_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_customer" ADD CONSTRAINT "user_customer_user_id_user_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
CREATE INDEX "stream_id_index" ON "thread" USING btree ("stream_id");


================================================
FILE: drizzle/0001_seed-models.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'gpt-4o', -- id
    'GPT 4o', -- name
    'openai/gpt-4o', -- model
    'GPT-4o from OpenAI has broad general knowledge and domain expertise allowing it to follow complex instructions in natural language and solve difficult problems accurately. It matches GPT-4 Turbo performance with a faster and cheaper API.', -- description
    '["tools", "vision", "documents"]', -- capabilities
    'openai', -- icon
    'account_required', -- access
    2, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
), 
(
    'gpt-4o-mini', -- id
    'GPT 4o Mini', -- name
    'openai/gpt-4o-mini', -- model
    'GPT-4o mini from OpenAI is their most advanced and cost-efficient small model. It is multi-modal (accepting text or image inputs and outputting text) and has higher intelligence than gpt-3.5-turbo but is just as fast.', -- description
    '["tools", "vision", "documents"]', -- capabilities
    'openai', -- icon
    'public', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'gemini-2.0-flash', -- id
    'Gemini 2.0 Flash', -- name
    'google/gemini-2.0-flash', -- model
    'Gemini 2.0 Flash delivers next-gen features and improved capabilities, including superior speed, built-in tool use, multimodal generation, and a 1M token context window.', -- description
    '["vision", "tools", "documents"]', -- capabilities
    'gemini', -- icon
    'public', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'gemini-2.5-flash', -- id
    'Gemini 2.5 Flash', -- name
    'google/gemini-2.5-flash', -- model
    'Gemini 2.5 Flash is a thinking model that offers great, well-rounded capabilities. It is designed to offer a balance between price and performance with multimodal support and a 1M token context window.', -- description
    '["vision", "tools", "reasoning", "documents"]', -- capabilities
    'gemini', -- icon
    'public', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'gemini-2.5-pro', -- id
    'Gemini 2.5 Pro', -- name
    'google/gemini-2.5-pro', -- model
    'Gemini 2.5 Pro is our most advanced reasoning Gemini model, capable of solving complex problems. It features a 2M token context window and supports multimodal inputs including text, images, audio, video, and PDF documents.', -- description
    '["vision", "tools", "reasoning", "documents"]', -- capabilities
    'gemini', -- icon
    'premium_required', -- access
    5, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'grok-4', -- id
    'Grok 4', -- name
    'xai/grok-4', -- model
    'xAI''s latest and greatest flagship model, offering unparalleled performance in natural language, math and reasoning - the perfect jack of all trades.', -- description
    '["reasoning", "tools"]', -- capabilities
    'xai', -- icon
    'premium_required', -- access
    5, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'grok-3', -- id
    'Grok 3', -- name
    'xai/grok-3', -- model
    'xAI''s flagship model that excels at enterprise use cases like data extraction, coding, and text summarization. Possesses deep domain knowledge in finance, healthcare, law, and science.', -- description
    '["tools"]', -- capabilities
    'xai', -- icon
    'premium_required', -- access
    5, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'grok-3-mini', -- id
    'Grok 3 Mini', -- name
    'xai/grok-3-mini', -- model
    'xAI''s lightweight model that thinks before responding. Great for simple or logic-based tasks that do not require deep domain knowledge. The raw thinking traces are accessible.', -- description
    '["tools", "reasoning"]', -- capabilities
    'xai', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'kimi-k2', -- id
    'Kimi K2', -- name
    'moonshotai/kimi-k2', -- model
    'Kimi K2 is a model with a context length of 128k, featuring powerful code and Agent capabilities based on MoE architecture. It has 1T total parameters with 32B activated parameters. In benchmark performance tests across major categories including general knowledge reasoning, programming, mathematics, and Agent capabilities, the K2 model outperforms other mainstream open-source models.', -- description
    '["tools"]', -- capabilities
    'openrouter', -- icon
    'public', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0002_boring_owl.sql
================================================
ALTER TYPE "public"."icon" ADD VALUE 'moonshot';

COMMIT;

UPDATE "public"."model" SET "icon" = 'moonshot' WHERE "id" = 'kimi-k2';



================================================
FILE: drizzle/0003_complex_mesmero.sql
================================================
ALTER TYPE "public"."icon" ADD VALUE 'zai';
COMMIT;


================================================
FILE: drizzle/0004_seed-zai-models.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'glm-4.5-air', -- id
    'GLM 4.5 Air', -- name
    'zai/glm-4.5-air', -- model
    'GLM-4.5 and GLM-4.5-Air are our latest flagship models, purpose-built as foundational models for agent-oriented applications. Both leverage a Mixture-of-Experts (MoE) architecture. GLM-4.5 has a total parameter count of 355B with 32B active parameters per forward pass, while GLM-4.5-Air adopts a more streamlined design with 106B total parameters and 12B active parameters.', -- description
    '["tools"]', -- capabilities
    'zai', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
), 
(
    'glm-4.5', -- id
    'GLM 4.5', -- name
    'zai/glm-4.5', -- model
    'GLM-4.5 and GLM-4.5-Air are our latest flagship models, purpose-built as foundational models for agent-oriented applications. Both leverage a Mixture-of-Experts (MoE) architecture. GLM-4.5 has a total parameter count of 355B with 32B active parameters per forward pass, while GLM-4.5-Air adopts a more streamlined design with 106B total parameters and 12B active parameters.', -- description
    '["tools", "reasoning"]', -- capabilities
    'zai', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0005_seed-claude.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'claude-4-sonnet', -- id
    'Claude 4 Sonnet', -- name
    'anthropic/claude-4-sonnet', -- model
    'Claude Sonnet 4 significantly improves on Sonnet 3.7''s industry-leading capabilities, excelling in coding with a state-of-the-art 72.7% on SWE-bench. The model balances performance and efficiency for internal and external use cases, with enhanced steerability for greater control over implementations. While not matching Opus 4 in most domains, it delivers an optimal mix of capability and practicality.', -- description
    '["tools", "reasoning", "documents", "vision"]', -- capabilities
    'anthropic', -- icon
    'premium_required', -- access
    5, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0006_daffy_serpent_society.sql
================================================
ALTER TYPE "public"."icon" ADD VALUE 'qwen';
COMMIT;


================================================
FILE: drizzle/0007_seed-qwen3-coder.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'qwen3-coder', -- id
    'Qwen3 Coder', -- name
    'alibaba/qwen3-coder', -- model
    'Qwen3-Coder-480B-A35B-Instruct is Qwen''s most agentic code model, featuring significant performance on Agentic Coding, Agentic Browser-Use and other foundational coding tasks, achieving results comparable to Claude Sonnet.', -- description
    '["tools"]', -- capabilities
    'qwen', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0008_seed-gpt-oss.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'gpt-oss-120b', -- id
    'GPT OSS 120B', -- name
    'openai/gpt-oss-120b', -- model
    'gpt-oss-120b is an open-weight, 117B-parameter Mixture-of-Experts (MoE) language model from OpenAI designed for high-reasoning, agentic, and general-purpose production use cases. It activates 5.1B parameters per forward pass and is optimized to run on a single H100 GPU with native MXFP4 quantization. The model supports configurable reasoning depth, full chain-of-thought access, and native tool use, including function calling, browsing, and structured output generation.', -- description
    '["tools", "reasoning"]', -- capabilities
    'openai', -- icon
    'public', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'gpt-oss-20b', -- id
    'GPT OSS 20B', -- name
    'openai/gpt-oss-20b', -- model
    'gpt-oss-20b is an open-weight 21B parameter model released by OpenAI under the Apache 2.0 license. It uses a Mixture-of-Experts (MoE) architecture with 3.6B active parameters per forward pass, optimized for lower-latency inference and deployability on consumer or single-GPU hardware. The model is trained in OpenAI''s Harmony response format and supports reasoning level configuration, fine-tuning, and agentic capabilities including function calling, tool use, and structured outputs.', -- description
    '["tools", "reasoning"]', -- capabilities
    'openai', -- icon
    'public', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0009_oval_chamber.sql
================================================
ALTER TABLE "setting" ADD COLUMN "pinned_models" jsonb DEFAULT '["claude-4-sonnet", "gemini-2.0-flash", "gpt-4o", "gpt-4o-mini", "gemini-2.5-flash", "gemini-2.5-pro", "kimi-k2"]'::jsonb NOT NULL;


================================================
FILE: drizzle/0010_add-gpt-5-models.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'gpt-5', -- id
    'GPT 5', -- name
    'openai/gpt-5', -- model
    'GPT-5 is OpenAI''s flagship language model that excels at complex reasoning, broad real-world knowledge, code-intensive, and multi-step agentic tasks.', -- description
    '["tools", "reasoning", "vision"]', -- capabilities
    'openai', -- icon
    'premium_required', -- access
    2, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'gpt-5-mini', -- id
    'GPT 5 Mini', -- name
    'openai/gpt-5-mini', -- model
    'GPT-5 mini is a cost optimized model that excels at reasoning/chat tasks. It offers an optimal balance between speed, cost, and capability.', -- description
    '["tools", "reasoning", "vision"]', -- capabilities
    'openai', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'gpt-5-nano', -- id
    'GPT 5 Nano', -- name
    'openai/gpt-5-nano', -- model
    'GPT-5 nano is a high throughput model that excels at simple instruction or classification tasks.', -- description
    '["tools", "reasoning", "vision"]', -- capabilities
    'openai', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;

-- Update default pinned models to include new GPT-5 models
ALTER TABLE "setting" ALTER COLUMN "pinned_models" SET DEFAULT '["claude-4-sonnet", "gemini-2.0-flash", "gpt-5", "gpt-5-mini", "gemini-2.5-flash", "gemini-2.5-pro", "kimi-k2"]';




================================================
FILE: drizzle/0011_add-deepseek-models.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'deepseek-r1-distill-llama-70b', -- id
    'DeepSeek R1 Distill Llama 70B', -- name
    'deepseek/deepseek-r1-distill-llama-70b', -- model
    'DeepSeek-R1 is a state-of-the-art reasoning model trained with reinforcement learning and cold-start data, delivering strong performance across math, code, and complex reasoning tasks. It offers improved stability, readability, and multilingual handling compared to earlier versions, and is available alongside several high-quality distilled variants.', -- description
    '["reasoning"]', -- capabilities
    'deepseek', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
), 
(
    'deepseek-r1', -- id
    'DeepSeek R1', -- name
    'deepseek/deepseek-r1', -- model
    'DeepSeek Reasoner is a specialized model developed by DeepSeek that uses Chain of Thought (CoT) reasoning to improve response accuracy. Before providing a final answer, it generates detailed reasoning steps that are accessible through the API, allowing users to examine and leverage the model''s thought process, served by Fireworks AI.', -- description
    '["reasoning"]', -- capabilities
    'deepseek', -- icon
    'account_required', -- access
    3, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
), 
(
    'deepseek-v3', -- id
    'DeepSeek V3', -- name
    'deepseek/deepseek-v3', -- model
    'Fast general-purpose LLM with enhanced reasoning capabilities', -- description
    '[]', -- capabilities
    'deepseek', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0012_add-glm-45v.sql
================================================
-- Custom SQL migration file, put your code below! ---- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'glm-4.5v', -- id
    'GLM 4.5V', -- name
    'zai/glm-4.5v', -- model
    'Built on the GLM-4.5-Air base model, GLM-4.5V inherits proven techniques from GLM-4.1V-Thinking while achieving effective scaling through a powerful 106B-parameter MoE architecture.', -- description
    '["tools", "reasoning", "vision"]', -- capabilities
    'zai', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0013_add-deepseek-3.1.sql
================================================
-- Custom SQL migration file, put your code below! ---- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'deepseek-v3.1', -- id
    'DeepSeek V3.1', -- name
    'deepseek/deepseek-v3.1', -- model
    'DeepSeek-V3.1 is post-trained on the top of DeepSeek-V3.1-Base, which is built upon the original V3 base checkpoint through a two-phase long context extension approach, following the methodology outlined in the original DeepSeek-V3 report. DeepSeek has expanded their dataset by collecting additional long documents and substantially extending both training phases.', -- description
    '["tools"]', -- capabilities
    'deepseek', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0014_seed_models-sep-6-2025.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id",
    "name",
    "model",
    "description",
    "capabilities",
    "icon",
    "access",
    "credits",
    "created_at",
    "updated_at"
)
VALUES
(
    'kimi-k2-0905', -- id
    'Kimi K2 0905', -- name
    'moonshotai/kimi-k2-0905', -- model
    'Kimi K2 0905 is the September update of Kimi K2. It is a large-scale Mixture-of-Experts (MoE) language model developed by Moonshot AI, featuring 1 trillion total parameters with 32 billion active per forward pass. It supports long-context inference up to 256k tokens, extended from the previous 128k.', -- description
    '["tools"]', -- capabilities
    'moonshot', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'qwen3-max', -- id
    'Qwen3 Max', -- name
    'alibaba/qwen3-max', -- model
    'Qwen3-Max is an updated release built on the Qwen3 series, offering major improvements in reasoning, instruction following, multilingual support, and long-tail knowledge coverage compared to the January 2025 version.', -- description
    '["tools"]', -- capabilities
    'qwen', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'grok-code-fast-1', -- id
    'Grok Code Fast 1', -- name
    'xai/grok-code-fast-1', -- model
    'Grok Code Fast 1 is a speedy and economical reasoning model that excels at agentic coding. With reasoning traces visible in the response, developers can steer Grok Code for high-quality work flows.', -- description
    '["tools"]', -- capabilities
    'xai', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0015_aberrant_giant_man.sql
================================================
ALTER TABLE "setting" ALTER COLUMN "pinned_models" SET DEFAULT '["claude-4-sonnet","gpt-4o","gpt-4o-mini","gemini-2.5-flash","gemini-2.5-pro","gemini-2.0-flash","kimi-k2"]'::jsonb;--> statement-breakpoint
CREATE INDEX "message_thread_id_index" ON "message" USING btree ("thread_id");--> statement-breakpoint
CREATE INDEX "message_user_id_index" ON "message" USING btree ("user_id");--> statement-breakpoint
CREATE INDEX "setting_user_id_index" ON "setting" USING btree ("user_id");--> statement-breakpoint
CREATE INDEX "thread_user_id_index" ON "thread" USING btree ("user_id");--> statement-breakpoint
CREATE INDEX "usage_user_id_index" ON "usage" USING btree ("user_id");--> statement-breakpoint
CREATE INDEX "user_customer_user_id_index" ON "user_customer" USING btree ("user_id");


================================================
FILE: drizzle/0016_seed-claude-4.5.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'claude-4.5-sonnet', -- id
    'Claude 4.5 Sonnet', -- name
    'anthropic/claude-sonnet-4.5', -- model
    'Claude Sonnet 4.5 is the newest model in the Sonnet series, offering improvements and updates over Sonnet 4.', -- description
    '["tools", "reasoning", "documents", "vision"]', -- capabilities
    'anthropic', -- icon
    'premium_required', -- access
    5, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0017_seed-new-models.sql
================================================
-- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id", 
    "name", 
    "model", 
    "description", 
    "capabilities", 
    "icon", 
    "access", 
    "credits",
    "created_at", 
    "updated_at"
) 
VALUES 
(
    'claude-4.5-haiku', -- id
    'Claude 4.5 Haiku', -- name
    'anthropic/claude-haiku-4.5', -- model
    'Claude Haiku 4.5 matches Sonnet 4''s performance on coding, computer use, and agent tasks at substantially lower cost and faster speeds. It delivers near-frontier performance and Claude''s unique character at a price point that works for scaled sub-agent deployments, free tier products, and intelligence-sensitive applications with budget constraints.', -- description
    '["tools", "reasoning", "documents", "vision"]', -- capabilities
    'anthropic', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'glm-4.6', -- id
    'GLM 4.6', -- name
    'zai/glm-4.6', -- model
    'As the latest iteration in the GLM series, GLM-4.6 achieves comprehensive enhancements across multiple domains, including real-world coding, long-context processing, reasoning, searching, writing, and agentic applications.', -- description
    '["tools", "reasoning", "vision"]', -- capabilities
    'zai', -- icon
    'account_required', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
),
(
    'grok-4-fast', -- id
    'Grok 4 Fast', -- name
    'xai/grok-4-fast-non-reasoning', -- model
    'Grok 4 Fast is xAI''s latest multimodal model with SOTA cost-efficiency and a 2M token context window. It comes in two flavors: non-reasoning and reasoning.', -- description
    '["tools"]', -- capabilities
    'xai', -- icon
    'public', -- access
    1, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/0018_seed_models-nov-8-2025.sql
================================================
-- Custom SQL migration file, put your code below! ---- Custom SQL migration file, put your code below! --
INSERT INTO "model" (
    "id",
    "name",
    "model",
    "description",
    "capabilities",
    "icon",
    "access",
    "credits",
    "created_at",
    "updated_at"
)
VALUES
(
    'kimi-k2-thinking', -- id
    'Kimi K2 Thinking', -- name
    'moonshotai/kimi-k2-thinking', -- model
    'Kimi K2 Thinking is an advanced open-source thinking model by Moonshot AI. It can execute up to 200 – 300 sequential tool calls without human interference, reasoning coherently across hundreds of steps to solve complex problems. Built as a thinking agent, it reasons step by step while using tools, achieving state-of-the-art performance on Humanity''s Last Exam (HLE), BrowseComp, and other benchmarks, with major gains in reasoning, agentic search, coding, writing, and general capabilities.', -- description
    '["tools", "reasoning"]', -- capabilities
    'moonshot', -- icon
    'premium_required', -- access
    3, -- credits
    NOW(), -- created_at
    NOW() -- updated_at
)
ON CONFLICT ("id") DO NOTHING;



================================================
FILE: drizzle/meta/0000_snapshot.json
================================================
{
  "id": "e13b2f12-8e0f-4809-b912-ca5476461f82",
  "prevId": "00000000-0000-0000-0000-000000000000",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "tableTo": "user",
          "columnsFrom": [
            "inviter_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "nullsNotDistinct": false,
          "columns": [
            "slug"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "nullsNotDistinct": false,
          "columns": [
            "token"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "tableTo": "thread",
          "columnsFrom": [
            "thread_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "organization_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "user_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0001_snapshot.json
================================================
{
  "id": "1128e455-72be-492f-bf25-832434676d8c",
  "prevId": "e13b2f12-8e0f-4809-b912-ca5476461f82",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0002_snapshot.json
================================================
{
  "id": "03e22b2a-4f94-46b3-b646-85e834449818",
  "prevId": "1128e455-72be-492f-bf25-832434676d8c",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "tableTo": "user",
          "columnsFrom": [
            "inviter_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "nullsNotDistinct": false,
          "columns": [
            "slug"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "nullsNotDistinct": false,
          "columns": [
            "token"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "tableTo": "thread",
          "columnsFrom": [
            "thread_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "organization_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "user_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0003_snapshot.json
================================================
{
  "id": "b967cebf-f58c-404a-ae8e-a9d1daccba47",
  "prevId": "03e22b2a-4f94-46b3-b646-85e834449818",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "tableTo": "user",
          "columnsFrom": [
            "inviter_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "nullsNotDistinct": false,
          "columns": [
            "slug"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "nullsNotDistinct": false,
          "columns": [
            "token"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "tableTo": "thread",
          "columnsFrom": [
            "thread_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "organization_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "user_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0004_snapshot.json
================================================
{
  "id": "27d5de02-f342-4c61-8964-94b6767cfeeb",
  "prevId": "b967cebf-f58c-404a-ae8e-a9d1daccba47",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0005_snapshot.json
================================================
{
  "id": "dac923b6-be13-44c6-99ae-a2f20ae615a4",
  "prevId": "27d5de02-f342-4c61-8964-94b6767cfeeb",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0006_snapshot.json
================================================
{
  "id": "693f104f-20a9-4492-a626-ccf16ab8f1d8",
  "prevId": "dac923b6-be13-44c6-99ae-a2f20ae615a4",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "tableTo": "user",
          "columnsFrom": [
            "inviter_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "nullsNotDistinct": false,
          "columns": [
            "slug"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "nullsNotDistinct": false,
          "columns": [
            "token"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "tableTo": "thread",
          "columnsFrom": [
            "thread_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "organization_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "user_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0007_snapshot.json
================================================
{
  "id": "c0a7cef2-76c4-467f-b3a3-55e6dc7d1e5d",
  "prevId": "693f104f-20a9-4492-a626-ccf16ab8f1d8",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0008_snapshot.json
================================================
{
  "id": "af625849-8bb1-4ad2-a066-fa870300303d",
  "prevId": "c0a7cef2-76c4-467f-b3a3-55e6dc7d1e5d",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0009_snapshot.json
================================================
{
  "id": "331d5d5f-602c-45b0-99d9-94aa45d87a68",
  "prevId": "af625849-8bb1-4ad2-a066-fa870300303d",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "tableTo": "user",
          "columnsFrom": [
            "inviter_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "nullsNotDistinct": false,
          "columns": [
            "slug"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "nullsNotDistinct": false,
          "columns": [
            "token"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "tableTo": "thread",
          "columnsFrom": [
            "thread_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "organization_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "user_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0010_snapshot.json
================================================
{
  "id": "a9c3cf56-0969-4d2d-9dd9-655704d5f37a",
  "prevId": "331d5d5f-602c-45b0-99d9-94aa45d87a68",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0011_snapshot.json
================================================
{
  "id": "fd82ec5e-31a0-48a7-b346-3de1be4014f2",
  "prevId": "a9c3cf56-0969-4d2d-9dd9-655704d5f37a",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0012_snapshot.json
================================================
{
  "id": "318e728b-5722-4a5a-a363-492e80d94b2b",
  "prevId": "fd82ec5e-31a0-48a7-b346-3de1be4014f2",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0013_snapshot.json
================================================
{
  "id": "3dac0a94-a83f-4756-9e7c-f53737d630c6",
  "prevId": "318e728b-5722-4a5a-a363-492e80d94b2b",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0014_snapshot.json
================================================
{
  "id": "5f87d4d4-7d94-4fb1-b6aa-fb0ceb45c11e",
  "prevId": "3dac0a94-a83f-4756-9e7c-f53737d630c6",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {},
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0015_snapshot.json
================================================
{
  "id": "5b109650-f49b-4375-8182-262ed69d8813",
  "prevId": "5f87d4d4-7d94-4fb1-b6aa-fb0ceb45c11e",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "tableTo": "user",
          "columnsFrom": [
            "inviter_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "nullsNotDistinct": false,
          "columns": [
            "slug"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "nullsNotDistinct": false,
          "columns": [
            "token"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "message_thread_id_index": {
          "name": "message_thread_id_index",
          "columns": [
            {
              "expression": "thread_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "message_user_id_index": {
          "name": "message_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "tableTo": "thread",
          "columnsFrom": [
            "thread_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "tableTo": "organization",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "organization_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[\"claude-4-sonnet\",\"gpt-4o\",\"gpt-4o-mini\",\"gemini-2.5-flash\",\"gemini-2.5-pro\",\"gemini-2.0-flash\",\"kimi-k2\"]'::jsonb"
        }
      },
      "indexes": {
        "setting_user_id_index": {
          "name": "setting_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "thread_user_id_index": {
          "name": "thread_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {
        "usage_user_id_index": {
          "name": "usage_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "user_customer_user_id_index": {
          "name": "user_customer_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "tableTo": "user",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "user_id"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0016_snapshot.json
================================================
{
  "id": "dddc561f-0bf8-4387-af5f-fade9f662a07",
  "prevId": "5b109650-f49b-4375-8182-262ed69d8813",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "message_thread_id_index": {
          "name": "message_thread_id_index",
          "columns": [
            {
              "expression": "thread_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        },
        "message_user_id_index": {
          "name": "message_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[\"claude-4-sonnet\",\"gpt-4o\",\"gpt-4o-mini\",\"gemini-2.5-flash\",\"gemini-2.5-pro\",\"gemini-2.0-flash\",\"kimi-k2\"]'::jsonb"
        }
      },
      "indexes": {
        "setting_user_id_index": {
          "name": "setting_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        },
        "thread_user_id_index": {
          "name": "thread_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {
        "usage_user_id_index": {
          "name": "usage_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "user_customer_user_id_index": {
          "name": "user_customer_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0017_snapshot.json
================================================
{
  "id": "650ffef1-ea93-41d3-9473-d4bb36003d09",
  "prevId": "dddc561f-0bf8-4387-af5f-fade9f662a07",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "message_thread_id_index": {
          "name": "message_thread_id_index",
          "columns": [
            {
              "expression": "thread_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        },
        "message_user_id_index": {
          "name": "message_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[\"claude-4-sonnet\",\"gpt-4o\",\"gpt-4o-mini\",\"gemini-2.5-flash\",\"gemini-2.5-pro\",\"gemini-2.0-flash\",\"kimi-k2\"]'::jsonb"
        }
      },
      "indexes": {
        "setting_user_id_index": {
          "name": "setting_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        },
        "thread_user_id_index": {
          "name": "thread_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {
        "usage_user_id_index": {
          "name": "usage_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "user_customer_user_id_index": {
          "name": "user_customer_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/0018_snapshot.json
================================================
{
  "id": "d282f417-e552-443c-bcd7-230d5785f8d6",
  "prevId": "650ffef1-ea93-41d3-9473-d4bb36003d09",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "account_id": {
          "name": "account_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "provider_id": {
          "name": "provider_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "access_token": {
          "name": "access_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token": {
          "name": "refresh_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "id_token": {
          "name": "id_token",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "access_token_expires_at": {
          "name": "access_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refresh_token_expires_at": {
          "name": "refresh_token_expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_user_id_user_id_fk": {
          "name": "account_user_id_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.invitation": {
      "name": "invitation",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "inviter_id": {
          "name": "inviter_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "invitation_organization_id_organization_id_fk": {
          "name": "invitation_organization_id_organization_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "invitation_inviter_id_user_id_fk": {
          "name": "invitation_inviter_id_user_id_fk",
          "tableFrom": "invitation",
          "columnsFrom": [
            "inviter_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.jwks": {
      "name": "jwks",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "public_key": {
          "name": "public_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "private_key": {
          "name": "private_key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.member": {
      "name": "member",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "member_organization_id_organization_id_fk": {
          "name": "member_organization_id_organization_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "member_user_id_user_id_fk": {
          "name": "member_user_id_user_id_fk",
          "tableFrom": "member",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization": {
      "name": "organization",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "logo": {
          "name": "logo",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_slug_unique": {
          "name": "organization_slug_unique",
          "columns": [
            "slug"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "active_organization_id": {
          "name": "active_organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_user_id_user_id_fk": {
          "name": "session_user_id_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": [
            "token"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "email_verified": {
          "name": "email_verified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "is_anonymous": {
          "name": "is_anonymous",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": [
            "email"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expires_at": {
          "name": "expires_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.message": {
      "name": "message",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "message": {
          "name": "message",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "thread_id": {
          "name": "thread_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "message_thread_id_index": {
          "name": "message_thread_id_index",
          "columns": [
            {
              "expression": "thread_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        },
        "message_user_id_index": {
          "name": "message_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "message_thread_id_thread_id_fk": {
          "name": "message_thread_id_thread_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "thread_id"
          ],
          "tableTo": "thread",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "message_user_id_user_id_fk": {
          "name": "message_user_id_user_id_fk",
          "tableFrom": "message",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.model": {
      "name": "model",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "model": {
          "name": "model",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "capabilities": {
          "name": "capabilities",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[]'::jsonb"
        },
        "icon": {
          "name": "icon",
          "type": "icon",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "access": {
          "name": "access",
          "type": "access",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'public'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_customer": {
      "name": "organization_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_customer_organization_id_organization_id_fk": {
          "name": "organization_customer_organization_id_organization_id_fk",
          "tableFrom": "organization_customer",
          "columnsFrom": [
            "organization_id"
          ],
          "tableTo": "organization",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organization_customer_id_unique": {
          "name": "organization_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "organization_customer_organization_id_unique": {
          "name": "organization_customer_organization_id_unique",
          "columns": [
            "organization_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.setting": {
      "name": "setting",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "mode": {
          "name": "mode",
          "type": "mode",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'dark'"
        },
        "theme": {
          "name": "theme",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "nickname": {
          "name": "nickname",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "biography": {
          "name": "biography",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "instructions": {
          "name": "instructions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_id": {
          "name": "model_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'gpt-4o-mini'"
        },
        "pinned_models": {
          "name": "pinned_models",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true,
          "default": "'[\"claude-4-sonnet\",\"gpt-4o\",\"gpt-4o-mini\",\"gemini-2.5-flash\",\"gemini-2.5-pro\",\"gemini-2.0-flash\",\"kimi-k2\"]'::jsonb"
        }
      },
      "indexes": {
        "setting_user_id_index": {
          "name": "setting_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "setting_user_id_user_id_fk": {
          "name": "setting_user_id_user_id_fk",
          "tableFrom": "setting",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.thread": {
      "name": "thread",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ready'"
        },
        "stream_id": {
          "name": "stream_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {
        "stream_id_index": {
          "name": "stream_id_index",
          "columns": [
            {
              "expression": "stream_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        },
        "thread_user_id_index": {
          "name": "thread_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "thread_user_id_user_id_fk": {
          "name": "thread_user_id_user_id_fk",
          "tableFrom": "thread",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.usage": {
      "name": "usage",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "credits": {
          "name": "credits",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "search": {
          "name": "search",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "research": {
          "name": "research",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "indexes": {
        "usage_user_id_index": {
          "name": "usage_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "usage_user_id_user_id_fk": {
          "name": "usage_user_id_user_id_fk",
          "tableFrom": "usage",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_customer": {
      "name": "user_customer",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "subscription": {
          "name": "subscription",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "user_customer_user_id_index": {
          "name": "user_customer_user_id_index",
          "columns": [
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "user_customer_user_id_user_id_fk": {
          "name": "user_customer_user_id_user_id_fk",
          "tableFrom": "user_customer",
          "columnsFrom": [
            "user_id"
          ],
          "tableTo": "user",
          "columnsTo": [
            "id"
          ],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_customer_id_unique": {
          "name": "user_customer_id_unique",
          "columns": [
            "id"
          ],
          "nullsNotDistinct": false
        },
        "user_customer_user_id_unique": {
          "name": "user_customer_user_id_unique",
          "columns": [
            "user_id"
          ],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {
    "public.mode": {
      "name": "mode",
      "schema": "public",
      "values": [
        "light",
        "dark"
      ]
    },
    "public.access": {
      "name": "access",
      "schema": "public",
      "values": [
        "public",
        "account_required",
        "premium_required"
      ]
    },
    "public.icon": {
      "name": "icon",
      "schema": "public",
      "values": [
        "anthropic",
        "claude",
        "deepseek",
        "gemini",
        "google",
        "grok",
        "meta",
        "mistral",
        "ollama",
        "openai",
        "openrouter",
        "x",
        "xai",
        "moonshot",
        "zai",
        "qwen"
      ]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": [
        "ready",
        "streaming",
        "submitted"
      ]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}


================================================
FILE: drizzle/meta/_journal.json
================================================
{
  "version": "7",
  "dialect": "postgresql",
  "entries": [
    {
      "idx": 0,
      "version": "7",
      "when": 1753484529332,
      "tag": "0000_violet_wolverine",
      "breakpoints": true
    },
    {
      "idx": 1,
      "version": "7",
      "when": 1753484536104,
      "tag": "0001_seed-models",
      "breakpoints": true
    },
    {
      "idx": 2,
      "version": "7",
      "when": 1753493394519,
      "tag": "0002_boring_owl",
      "breakpoints": true
    },
    {
      "idx": 3,
      "version": "7",
      "when": 1753809895047,
      "tag": "0003_complex_mesmero",
      "breakpoints": true
    },
    {
      "idx": 4,
      "version": "7",
      "when": 1753809902590,
      "tag": "0004_seed-zai-models",
      "breakpoints": true
    },
    {
      "idx": 5,
      "version": "7",
      "when": 1753977272433,
      "tag": "0005_seed-claude",
      "breakpoints": true
    },
    {
      "idx": 6,
      "version": "7",
      "when": 1754091395173,
      "tag": "0006_daffy_serpent_society",
      "breakpoints": true
    },
    {
      "idx": 7,
      "version": "7",
      "when": 1754091417402,
      "tag": "0007_seed-qwen3-coder",
      "breakpoints": true
    },
    {
      "idx": 8,
      "version": "7",
      "when": 1754416850394,
      "tag": "0008_seed-gpt-oss",
      "breakpoints": true
    },
    {
      "idx": 9,
      "version": "7",
      "when": 1754541440182,
      "tag": "0009_oval_chamber",
      "breakpoints": true
    },
    {
      "idx": 10,
      "version": "7",
      "when": 1754588698380,
      "tag": "0010_add-gpt-5-models",
      "breakpoints": true
    },
    {
      "idx": 11,
      "version": "7",
      "when": 1754769921078,
      "tag": "0011_add-deepseek-models",
      "breakpoints": true
    },
    {
      "idx": 12,
      "version": "7",
      "when": 1754965897403,
      "tag": "0012_add-glm-45v",
      "breakpoints": true
    },
    {
      "idx": 13,
      "version": "7",
      "when": 1755817652752,
      "tag": "0013_add-deepseek-3.1",
      "breakpoints": true
    },
    {
      "idx": 14,
      "version": "7",
      "when": 1757182621919,
      "tag": "0014_seed_models-sep-6-2025",
      "breakpoints": true
    },
    {
      "idx": 15,
      "version": "7",
      "when": 1757959895162,
      "tag": "0015_aberrant_giant_man",
      "breakpoints": true
    },
    {
      "idx": 16,
      "version": "7",
      "when": 1759208078434,
      "tag": "0016_seed-claude-4.5",
      "breakpoints": true
    },
    {
      "idx": 17,
      "version": "7",
      "when": 1760635548854,
      "tag": "0017_seed-new-models",
      "breakpoints": true
    },
    {
      "idx": 18,
      "version": "7",
      "when": 1762632024470,
      "tag": "0018_seed_models-nov-8-2025",
      "breakpoints": true
    }
  ]
}


================================================
FILE: public/manifest.json
================================================
{
  "short_name": "TanStack App",
  "name": "Create TanStack App Sample",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}



================================================
FILE: src/global.css
================================================
@import 'tailwindcss';
@import './themes.css';

@plugin "tailwindcss-animate";
@plugin "@tailwindcss/typography";

@custom-variant dark (&:is(.dark *));

body {
    font-family: 'Geist', sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

code {
    font-family: 'Geist Mono', monospace;
}

@layer base {
    * {
        @apply border-border outline-ring/50;
    }
    body {
        @apply bg-background text-foreground;
    }
}

@keyframes typing {
    0%,
    100% {
        transform: translateY(0);
        opacity: 0.5;
    }
    50% {
        transform: translateY(-2px);
        opacity: 1;
    }
}

@keyframes loading-dots {
    0%,
    100% {
        opacity: 0;
    }
    50% {
        opacity: 1;
    }
}

@keyframes wave {
    0%,
    100% {
        transform: scaleY(1);
    }
    50% {
        transform: scaleY(0.6);
    }
}

@keyframes blink {
    0%,
    100% {
        opacity: 1;
    }
    50% {
        opacity: 0;
    }
}

@keyframes text-blink {
    0%,
    100% {
        color: var(--primary);
    }
    50% {
        color: var(--muted-foreground);
    }
}

@keyframes bounce-dots {
    0%,
    100% {
        transform: scale(0.8);
        opacity: 0.5;
    }
    50% {
        transform: scale(1.2);
        opacity: 1;
    }
}

@keyframes thin-pulse {
    0%,
    100% {
        transform: scale(0.95);
        opacity: 0.8;
    }
    50% {
        transform: scale(1.05);
        opacity: 0.4;
    }
}

@keyframes pulse-dot {
    0%,
    100% {
        transform: scale(1);
        opacity: 0.8;
    }
    50% {
        transform: scale(1.5);
        opacity: 1;
    }
}

@keyframes shimmer-text {
    0% {
        background-position: 150% center;
    }
    100% {
        background-position: -150% center;
    }
}

@keyframes wave-bars {
    0%,
    100% {
        transform: scaleY(1);
        opacity: 0.5;
    }
    50% {
        transform: scaleY(0.6);
        opacity: 1;
    }
}

@keyframes shimmer {
    0% {
        background-position: 200% 50%;
    }
    100% {
        background-position: -200% 50%;
    }
}

@keyframes spinner-fade {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}

/* Scrollbar styling */
::-webkit-scrollbar {
    width: 4px;
    height: 4px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: var(--muted);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--muted-foreground);
}

/* Firefox */
* {
    scrollbar-width: thin;
    scrollbar-color: var(--muted) transparent;
}

.moon {
    width: max(190%, 1200px);
    height: max(190%, 1200px);
    border-radius: 50%;
    opacity: 0.3;
    background: radial-gradient(circle, var(--background) 0%, var(--primary) 80%);
    box-shadow:
        0 0 60px 20px var(--primary),
        0 0 80px 20px var(--primary) inset;
    position: absolute;
    bottom: -130%;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from {
        opacity: 0;
        filter: blur(2px);
    }
    to {
        opacity: 1;
        filter: blur(0px);
    }
}

.fade-segment {
    display: inline;
    opacity: 0;
    animation: fadeIn 300ms ease-out forwards;
}

.fade-segment-space {
    white-space: pre;
}

/* no static class needed once we use display: contents */



================================================
FILE: src/router.tsx
================================================
import { createRouter as createTanstackRouter } from '@tanstack/react-router';

import { routeTree } from '@/routeTree.gen';

export const createRouter = () => {
    const router = createTanstackRouter({
        routeTree,
        scrollRestoration: true,
        defaultStaleTime: Infinity,
        defaultPreloadStaleTime: Infinity,
    });

    return router;
};

declare module '@tanstack/react-router' {
    interface Register {
        router: ReturnType<typeof createRouter>;
    }
}



================================================
FILE: src/routeTree.gen.ts
================================================
/* eslint-disable */

// @ts-nocheck

// noinspection JSUnusedGlobalSymbols

// This file was automatically generated by TanStack Router.
// You should NOT make any changes in this file as it will be overwritten.
// Additionally, you should also exclude this file from your linter and/or formatter to prevent it from being checked or modified.

import { createServerRootRoute } from '@tanstack/react-start/server'

import { Route as rootRouteImport } from './routes/__root'
import { Route as TeamRouteImport } from './routes/_team'
import { Route as AppRouteImport } from './routes/_app'
import { Route as AccountRouteImport } from './routes/_account'
import { Route as AppThreadRouteImport } from './routes/_app._thread'
import { Route as AccountMagicLinkRouteImport } from './routes/_account.magic-link'
import { Route as AccountLoggedOutRouteImport } from './routes/_account.logged-out'
import { Route as AccountAccountRouteImport } from './routes/_account.account'
import { Route as AppThreadIndexRouteImport } from './routes/_app._thread.index'
import { Route as AccountLoginIndexRouteImport } from './routes/_account.login.index'
import { Route as AccountAccountIndexRouteImport } from './routes/_account.account.index'
import { Route as AppThreadThreadIdRouteImport } from './routes/_app._thread.$threadId'
import { Route as AccountAccountSubscriptionRouteImport } from './routes/_account.account.subscription'
import { Route as AccountAccountPreferencesRouteImport } from './routes/_account.account.preferences'
import { Route as AccountAccountModelsRouteImport } from './routes/_account.account.models'
import { Route as AccountAccountAppearanceRouteImport } from './routes/_account.account.appearance'
import { ServerRoute as ApiUploadthingServerRouteImport } from './routes/api.uploadthing'
import { ServerRoute as ApiThreadServerRouteImport } from './routes/api.thread'
import { ServerRoute as ApiResetServerRouteImport } from './routes/api.reset'
import { ServerRoute as ApiCustomerPortalServerRouteImport } from './routes/api.customer-portal'
import { ServerRoute as ApiCheckoutServerRouteImport } from './routes/api.checkout'
import { ServerRoute as ApiWebhookStripeServerRouteImport } from './routes/api.webhook.stripe'
import { ServerRoute as ApiCheckoutSuccessServerRouteImport } from './routes/api.checkout.success'
import { ServerRoute as ApiAuthSplatServerRouteImport } from './routes/api.auth.$'
import { ServerRoute as ApiThreadThreadIdStreamServerRouteImport } from './routes/api.thread.$threadId.stream'
import { ServerRoute as ApiThreadThreadIdStopServerRouteImport } from './routes/api.thread.$threadId.stop'

const rootServerRouteImport = createServerRootRoute()

const TeamRoute = TeamRouteImport.update({
  id: '/_team',
  getParentRoute: () => rootRouteImport,
} as any)
const AppRoute = AppRouteImport.update({
  id: '/_app',
  getParentRoute: () => rootRouteImport,
} as any)
const AccountRoute = AccountRouteImport.update({
  id: '/_account',
  getParentRoute: () => rootRouteImport,
} as any)
const AppThreadRoute = AppThreadRouteImport.update({
  id: '/_thread',
  getParentRoute: () => AppRoute,
} as any)
const AccountMagicLinkRoute = AccountMagicLinkRouteImport.update({
  id: '/magic-link',
  path: '/magic-link',
  getParentRoute: () => AccountRoute,
} as any)
const AccountLoggedOutRoute = AccountLoggedOutRouteImport.update({
  id: '/logged-out',
  path: '/logged-out',
  getParentRoute: () => AccountRoute,
} as any)
const AccountAccountRoute = AccountAccountRouteImport.update({
  id: '/account',
  path: '/account',
  getParentRoute: () => AccountRoute,
} as any)
const AppThreadIndexRoute = AppThreadIndexRouteImport.update({
  id: '/',
  path: '/',
  getParentRoute: () => AppThreadRoute,
} as any)
const AccountLoginIndexRoute = AccountLoginIndexRouteImport.update({
  id: '/login/',
  path: '/login/',
  getParentRoute: () => AccountRoute,
} as any)
const AccountAccountIndexRoute = AccountAccountIndexRouteImport.update({
  id: '/',
  path: '/',
  getParentRoute: () => AccountAccountRoute,
} as any)
const AppThreadThreadIdRoute = AppThreadThreadIdRouteImport.update({
  id: '/$threadId',
  path: '/$threadId',
  getParentRoute: () => AppThreadRoute,
} as any)
const AccountAccountSubscriptionRoute =
  AccountAccountSubscriptionRouteImport.update({
    id: '/subscription',
    path: '/subscription',
    getParentRoute: () => AccountAccountRoute,
  } as any)
const AccountAccountPreferencesRoute =
  AccountAccountPreferencesRouteImport.update({
    id: '/preferences',
    path: '/preferences',
    getParentRoute: () => AccountAccountRoute,
  } as any)
const AccountAccountModelsRoute = AccountAccountModelsRouteImport.update({
  id: '/models',
  path: '/models',
  getParentRoute: () => AccountAccountRoute,
} as any)
const AccountAccountAppearanceRoute =
  AccountAccountAppearanceRouteImport.update({
    id: '/appearance',
    path: '/appearance',
    getParentRoute: () => AccountAccountRoute,
  } as any)
const ApiUploadthingServerRoute = ApiUploadthingServerRouteImport.update({
  id: '/api/uploadthing',
  path: '/api/uploadthing',
  getParentRoute: () => rootServerRouteImport,
} as any)
const ApiThreadServerRoute = ApiThreadServerRouteImport.update({
  id: '/api/thread',
  path: '/api/thread',
  getParentRoute: () => rootServerRouteImport,
} as any)
const ApiResetServerRoute = ApiResetServerRouteImport.update({
  id: '/api/reset',
  path: '/api/reset',
  getParentRoute: () => rootServerRouteImport,
} as any)
const ApiCustomerPortalServerRoute = ApiCustomerPortalServerRouteImport.update({
  id: '/api/customer-portal',
  path: '/api/customer-portal',
  getParentRoute: () => rootServerRouteImport,
} as any)
const ApiCheckoutServerRoute = ApiCheckoutServerRouteImport.update({
  id: '/api/checkout',
  path: '/api/checkout',
  getParentRoute: () => rootServerRouteImport,
} as any)
const ApiWebhookStripeServerRoute = ApiWebhookStripeServerRouteImport.update({
  id: '/api/webhook/stripe',
  path: '/api/webhook/stripe',
  getParentRoute: () => rootServerRouteImport,
} as any)
const ApiCheckoutSuccessServerRoute =
  ApiCheckoutSuccessServerRouteImport.update({
    id: '/success',
    path: '/success',
    getParentRoute: () => ApiCheckoutServerRoute,
  } as any)
const ApiAuthSplatServerRoute = ApiAuthSplatServerRouteImport.update({
  id: '/api/auth/$',
  path: '/api/auth/$',
  getParentRoute: () => rootServerRouteImport,
} as any)
const ApiThreadThreadIdStreamServerRoute =
  ApiThreadThreadIdStreamServerRouteImport.update({
    id: '/$threadId/stream',
    path: '/$threadId/stream',
    getParentRoute: () => ApiThreadServerRoute,
  } as any)
const ApiThreadThreadIdStopServerRoute =
  ApiThreadThreadIdStopServerRouteImport.update({
    id: '/$threadId/stop',
    path: '/$threadId/stop',
    getParentRoute: () => ApiThreadServerRoute,
  } as any)

export interface FileRoutesByFullPath {
  '/account': typeof AccountAccountRouteWithChildren
  '/logged-out': typeof AccountLoggedOutRoute
  '/magic-link': typeof AccountMagicLinkRoute
  '/account/appearance': typeof AccountAccountAppearanceRoute
  '/account/models': typeof AccountAccountModelsRoute
  '/account/preferences': typeof AccountAccountPreferencesRoute
  '/account/subscription': typeof AccountAccountSubscriptionRoute
  '/$threadId': typeof AppThreadThreadIdRoute
  '/account/': typeof AccountAccountIndexRoute
  '/login': typeof AccountLoginIndexRoute
  '/': typeof AppThreadIndexRoute
}
export interface FileRoutesByTo {
  '/logged-out': typeof AccountLoggedOutRoute
  '/magic-link': typeof AccountMagicLinkRoute
  '/account/appearance': typeof AccountAccountAppearanceRoute
  '/account/models': typeof AccountAccountModelsRoute
  '/account/preferences': typeof AccountAccountPreferencesRoute
  '/account/subscription': typeof AccountAccountSubscriptionRoute
  '/$threadId': typeof AppThreadThreadIdRoute
  '/account': typeof AccountAccountIndexRoute
  '/login': typeof AccountLoginIndexRoute
  '/': typeof AppThreadIndexRoute
}
export interface FileRoutesById {
  __root__: typeof rootRouteImport
  '/_account': typeof AccountRouteWithChildren
  '/_app': typeof AppRouteWithChildren
  '/_team': typeof TeamRoute
  '/_account/account': typeof AccountAccountRouteWithChildren
  '/_account/logged-out': typeof AccountLoggedOutRoute
  '/_account/magic-link': typeof AccountMagicLinkRoute
  '/_app/_thread': typeof AppThreadRouteWithChildren
  '/_account/account/appearance': typeof AccountAccountAppearanceRoute
  '/_account/account/models': typeof AccountAccountModelsRoute
  '/_account/account/preferences': typeof AccountAccountPreferencesRoute
  '/_account/account/subscription': typeof AccountAccountSubscriptionRoute
  '/_app/_thread/$threadId': typeof AppThreadThreadIdRoute
  '/_account/account/': typeof AccountAccountIndexRoute
  '/_account/login/': typeof AccountLoginIndexRoute
  '/_app/_thread/': typeof AppThreadIndexRoute
}
export interface FileRouteTypes {
  fileRoutesByFullPath: FileRoutesByFullPath
  fullPaths:
    | '/account'
    | '/logged-out'
    | '/magic-link'
    | '/account/appearance'
    | '/account/models'
    | '/account/preferences'
    | '/account/subscription'
    | '/$threadId'
    | '/account/'
    | '/login'
    | '/'
  fileRoutesByTo: FileRoutesByTo
  to:
    | '/logged-out'
    | '/magic-link'
    | '/account/appearance'
    | '/account/models'
    | '/account/preferences'
    | '/account/subscription'
    | '/$threadId'
    | '/account'
    | '/login'
    | '/'
  id:
    | '__root__'
    | '/_account'
    | '/_app'
    | '/_team'
    | '/_account/account'
    | '/_account/logged-out'
    | '/_account/magic-link'
    | '/_app/_thread'
    | '/_account/account/appearance'
    | '/_account/account/models'
    | '/_account/account/preferences'
    | '/_account/account/subscription'
    | '/_app/_thread/$threadId'
    | '/_account/account/'
    | '/_account/login/'
    | '/_app/_thread/'
  fileRoutesById: FileRoutesById
}
export interface RootRouteChildren {
  AccountRoute: typeof AccountRouteWithChildren
  AppRoute: typeof AppRouteWithChildren
  TeamRoute: typeof TeamRoute
}
export interface FileServerRoutesByFullPath {
  '/api/checkout': typeof ApiCheckoutServerRouteWithChildren
  '/api/customer-portal': typeof ApiCustomerPortalServerRoute
  '/api/reset': typeof ApiResetServerRoute
  '/api/thread': typeof ApiThreadServerRouteWithChildren
  '/api/uploadthing': typeof ApiUploadthingServerRoute
  '/api/auth/$': typeof ApiAuthSplatServerRoute
  '/api/checkout/success': typeof ApiCheckoutSuccessServerRoute
  '/api/webhook/stripe': typeof ApiWebhookStripeServerRoute
  '/api/thread/$threadId/stop': typeof ApiThreadThreadIdStopServerRoute
  '/api/thread/$threadId/stream': typeof ApiThreadThreadIdStreamServerRoute
}
export interface FileServerRoutesByTo {
  '/api/checkout': typeof ApiCheckoutServerRouteWithChildren
  '/api/customer-portal': typeof ApiCustomerPortalServerRoute
  '/api/reset': typeof ApiResetServerRoute
  '/api/thread': typeof ApiThreadServerRouteWithChildren
  '/api/uploadthing': typeof ApiUploadthingServerRoute
  '/api/auth/$': typeof ApiAuthSplatServerRoute
  '/api/checkout/success': typeof ApiCheckoutSuccessServerRoute
  '/api/webhook/stripe': typeof ApiWebhookStripeServerRoute
  '/api/thread/$threadId/stop': typeof ApiThreadThreadIdStopServerRoute
  '/api/thread/$threadId/stream': typeof ApiThreadThreadIdStreamServerRoute
}
export interface FileServerRoutesById {
  __root__: typeof rootServerRouteImport
  '/api/checkout': typeof ApiCheckoutServerRouteWithChildren
  '/api/customer-portal': typeof ApiCustomerPortalServerRoute
  '/api/reset': typeof ApiResetServerRoute
  '/api/thread': typeof ApiThreadServerRouteWithChildren
  '/api/uploadthing': typeof ApiUploadthingServerRoute
  '/api/auth/$': typeof ApiAuthSplatServerRoute
  '/api/checkout/success': typeof ApiCheckoutSuccessServerRoute
  '/api/webhook/stripe': typeof ApiWebhookStripeServerRoute
  '/api/thread/$threadId/stop': typeof ApiThreadThreadIdStopServerRoute
  '/api/thread/$threadId/stream': typeof ApiThreadThreadIdStreamServerRoute
}
export interface FileServerRouteTypes {
  fileServerRoutesByFullPath: FileServerRoutesByFullPath
  fullPaths:
    | '/api/checkout'
    | '/api/customer-portal'
    | '/api/reset'
    | '/api/thread'
    | '/api/uploadthing'
    | '/api/auth/$'
    | '/api/checkout/success'
    | '/api/webhook/stripe'
    | '/api/thread/$threadId/stop'
    | '/api/thread/$threadId/stream'
  fileServerRoutesByTo: FileServerRoutesByTo
  to:
    | '/api/checkout'
    | '/api/customer-portal'
    | '/api/reset'
    | '/api/thread'
    | '/api/uploadthing'
    | '/api/auth/$'
    | '/api/checkout/success'
    | '/api/webhook/stripe'
    | '/api/thread/$threadId/stop'
    | '/api/thread/$threadId/stream'
  id:
    | '__root__'
    | '/api/checkout'
    | '/api/customer-portal'
    | '/api/reset'
    | '/api/thread'
    | '/api/uploadthing'
    | '/api/auth/$'
    | '/api/checkout/success'
    | '/api/webhook/stripe'
    | '/api/thread/$threadId/stop'
    | '/api/thread/$threadId/stream'
  fileServerRoutesById: FileServerRoutesById
}
export interface RootServerRouteChildren {
  ApiCheckoutServerRoute: typeof ApiCheckoutServerRouteWithChildren
  ApiCustomerPortalServerRoute: typeof ApiCustomerPortalServerRoute
  ApiResetServerRoute: typeof ApiResetServerRoute
  ApiThreadServerRoute: typeof ApiThreadServerRouteWithChildren
  ApiUploadthingServerRoute: typeof ApiUploadthingServerRoute
  ApiAuthSplatServerRoute: typeof ApiAuthSplatServerRoute
  ApiWebhookStripeServerRoute: typeof ApiWebhookStripeServerRoute
}

declare module '@tanstack/react-router' {
  interface FileRoutesByPath {
    '/_team': {
      id: '/_team'
      path: ''
      fullPath: ''
      preLoaderRoute: typeof TeamRouteImport
      parentRoute: typeof rootRouteImport
    }
    '/_app': {
      id: '/_app'
      path: ''
      fullPath: ''
      preLoaderRoute: typeof AppRouteImport
      parentRoute: typeof rootRouteImport
    }
    '/_account': {
      id: '/_account'
      path: ''
      fullPath: ''
      preLoaderRoute: typeof AccountRouteImport
      parentRoute: typeof rootRouteImport
    }
    '/_app/_thread': {
      id: '/_app/_thread'
      path: ''
      fullPath: ''
      preLoaderRoute: typeof AppThreadRouteImport
      parentRoute: typeof AppRoute
    }
    '/_account/magic-link': {
      id: '/_account/magic-link'
      path: '/magic-link'
      fullPath: '/magic-link'
      preLoaderRoute: typeof AccountMagicLinkRouteImport
      parentRoute: typeof AccountRoute
    }
    '/_account/logged-out': {
      id: '/_account/logged-out'
      path: '/logged-out'
      fullPath: '/logged-out'
      preLoaderRoute: typeof AccountLoggedOutRouteImport
      parentRoute: typeof AccountRoute
    }
    '/_account/account': {
      id: '/_account/account'
      path: '/account'
      fullPath: '/account'
      preLoaderRoute: typeof AccountAccountRouteImport
      parentRoute: typeof AccountRoute
    }
    '/_app/_thread/': {
      id: '/_app/_thread/'
      path: '/'
      fullPath: '/'
      preLoaderRoute: typeof AppThreadIndexRouteImport
      parentRoute: typeof AppThreadRoute
    }
    '/_account/login/': {
      id: '/_account/login/'
      path: '/login'
      fullPath: '/login'
      preLoaderRoute: typeof AccountLoginIndexRouteImport
      parentRoute: typeof AccountRoute
    }
    '/_account/account/': {
      id: '/_account/account/'
      path: '/'
      fullPath: '/account/'
      preLoaderRoute: typeof AccountAccountIndexRouteImport
      parentRoute: typeof AccountAccountRoute
    }
    '/_app/_thread/$threadId': {
      id: '/_app/_thread/$threadId'
      path: '/$threadId'
      fullPath: '/$threadId'
      preLoaderRoute: typeof AppThreadThreadIdRouteImport
      parentRoute: typeof AppThreadRoute
    }
    '/_account/account/subscription': {
      id: '/_account/account/subscription'
      path: '/subscription'
      fullPath: '/account/subscription'
      preLoaderRoute: typeof AccountAccountSubscriptionRouteImport
      parentRoute: typeof AccountAccountRoute
    }
    '/_account/account/preferences': {
      id: '/_account/account/preferences'
      path: '/preferences'
      fullPath: '/account/preferences'
      preLoaderRoute: typeof AccountAccountPreferencesRouteImport
      parentRoute: typeof AccountAccountRoute
    }
    '/_account/account/models': {
      id: '/_account/account/models'
      path: '/models'
      fullPath: '/account/models'
      preLoaderRoute: typeof AccountAccountModelsRouteImport
      parentRoute: typeof AccountAccountRoute
    }
    '/_account/account/appearance': {
      id: '/_account/account/appearance'
      path: '/appearance'
      fullPath: '/account/appearance'
      preLoaderRoute: typeof AccountAccountAppearanceRouteImport
      parentRoute: typeof AccountAccountRoute
    }
  }
}
declare module '@tanstack/react-start/server' {
  interface ServerFileRoutesByPath {
    '/api/uploadthing': {
      id: '/api/uploadthing'
      path: '/api/uploadthing'
      fullPath: '/api/uploadthing'
      preLoaderRoute: typeof ApiUploadthingServerRouteImport
      parentRoute: typeof rootServerRouteImport
    }
    '/api/thread': {
      id: '/api/thread'
      path: '/api/thread'
      fullPath: '/api/thread'
      preLoaderRoute: typeof ApiThreadServerRouteImport
      parentRoute: typeof rootServerRouteImport
    }
    '/api/reset': {
      id: '/api/reset'
      path: '/api/reset'
      fullPath: '/api/reset'
      preLoaderRoute: typeof ApiResetServerRouteImport
      parentRoute: typeof rootServerRouteImport
    }
    '/api/customer-portal': {
      id: '/api/customer-portal'
      path: '/api/customer-portal'
      fullPath: '/api/customer-portal'
      preLoaderRoute: typeof ApiCustomerPortalServerRouteImport
      parentRoute: typeof rootServerRouteImport
    }
    '/api/checkout': {
      id: '/api/checkout'
      path: '/api/checkout'
      fullPath: '/api/checkout'
      preLoaderRoute: typeof ApiCheckoutServerRouteImport
      parentRoute: typeof rootServerRouteImport
    }
    '/api/webhook/stripe': {
      id: '/api/webhook/stripe'
      path: '/api/webhook/stripe'
      fullPath: '/api/webhook/stripe'
      preLoaderRoute: typeof ApiWebhookStripeServerRouteImport
      parentRoute: typeof rootServerRouteImport
    }
    '/api/checkout/success': {
      id: '/api/checkout/success'
      path: '/success'
      fullPath: '/api/checkout/success'
      preLoaderRoute: typeof ApiCheckoutSuccessServerRouteImport
      parentRoute: typeof ApiCheckoutServerRoute
    }
    '/api/auth/$': {
      id: '/api/auth/$'
      path: '/api/auth/$'
      fullPath: '/api/auth/$'
      preLoaderRoute: typeof ApiAuthSplatServerRouteImport
      parentRoute: typeof rootServerRouteImport
    }
    '/api/thread/$threadId/stream': {
      id: '/api/thread/$threadId/stream'
      path: '/$threadId/stream'
      fullPath: '/api/thread/$threadId/stream'
      preLoaderRoute: typeof ApiThreadThreadIdStreamServerRouteImport
      parentRoute: typeof ApiThreadServerRoute
    }
    '/api/thread/$threadId/stop': {
      id: '/api/thread/$threadId/stop'
      path: '/$threadId/stop'
      fullPath: '/api/thread/$threadId/stop'
      preLoaderRoute: typeof ApiThreadThreadIdStopServerRouteImport
      parentRoute: typeof ApiThreadServerRoute
    }
  }
}

interface AccountAccountRouteChildren {
  AccountAccountAppearanceRoute: typeof AccountAccountAppearanceRoute
  AccountAccountModelsRoute: typeof AccountAccountModelsRoute
  AccountAccountPreferencesRoute: typeof AccountAccountPreferencesRoute
  AccountAccountSubscriptionRoute: typeof AccountAccountSubscriptionRoute
  AccountAccountIndexRoute: typeof AccountAccountIndexRoute
}

const AccountAccountRouteChildren: AccountAccountRouteChildren = {
  AccountAccountAppearanceRoute: AccountAccountAppearanceRoute,
  AccountAccountModelsRoute: AccountAccountModelsRoute,
  AccountAccountPreferencesRoute: AccountAccountPreferencesRoute,
  AccountAccountSubscriptionRoute: AccountAccountSubscriptionRoute,
  AccountAccountIndexRoute: AccountAccountIndexRoute,
}

const AccountAccountRouteWithChildren = AccountAccountRoute._addFileChildren(
  AccountAccountRouteChildren,
)

interface AccountRouteChildren {
  AccountAccountRoute: typeof AccountAccountRouteWithChildren
  AccountLoggedOutRoute: typeof AccountLoggedOutRoute
  AccountMagicLinkRoute: typeof AccountMagicLinkRoute
  AccountLoginIndexRoute: typeof AccountLoginIndexRoute
}

const AccountRouteChildren: AccountRouteChildren = {
  AccountAccountRoute: AccountAccountRouteWithChildren,
  AccountLoggedOutRoute: AccountLoggedOutRoute,
  AccountMagicLinkRoute: AccountMagicLinkRoute,
  AccountLoginIndexRoute: AccountLoginIndexRoute,
}

const AccountRouteWithChildren =
  AccountRoute._addFileChildren(AccountRouteChildren)

interface AppThreadRouteChildren {
  AppThreadThreadIdRoute: typeof AppThreadThreadIdRoute
  AppThreadIndexRoute: typeof AppThreadIndexRoute
}

const AppThreadRouteChildren: AppThreadRouteChildren = {
  AppThreadThreadIdRoute: AppThreadThreadIdRoute,
  AppThreadIndexRoute: AppThreadIndexRoute,
}

const AppThreadRouteWithChildren = AppThreadRoute._addFileChildren(
  AppThreadRouteChildren,
)

interface AppRouteChildren {
  AppThreadRoute: typeof AppThreadRouteWithChildren
}

const AppRouteChildren: AppRouteChildren = {
  AppThreadRoute: AppThreadRouteWithChildren,
}

const AppRouteWithChildren = AppRoute._addFileChildren(AppRouteChildren)

interface ApiCheckoutServerRouteChildren {
  ApiCheckoutSuccessServerRoute: typeof ApiCheckoutSuccessServerRoute
}

const ApiCheckoutServerRouteChildren: ApiCheckoutServerRouteChildren = {
  ApiCheckoutSuccessServerRoute: ApiCheckoutSuccessServerRoute,
}

const ApiCheckoutServerRouteWithChildren =
  ApiCheckoutServerRoute._addFileChildren(ApiCheckoutServerRouteChildren)

interface ApiThreadServerRouteChildren {
  ApiThreadThreadIdStopServerRoute: typeof ApiThreadThreadIdStopServerRoute
  ApiThreadThreadIdStreamServerRoute: typeof ApiThreadThreadIdStreamServerRoute
}

const ApiThreadServerRouteChildren: ApiThreadServerRouteChildren = {
  ApiThreadThreadIdStopServerRoute: ApiThreadThreadIdStopServerRoute,
  ApiThreadThreadIdStreamServerRoute: ApiThreadThreadIdStreamServerRoute,
}

const ApiThreadServerRouteWithChildren = ApiThreadServerRoute._addFileChildren(
  ApiThreadServerRouteChildren,
)

const rootRouteChildren: RootRouteChildren = {
  AccountRoute: AccountRouteWithChildren,
  AppRoute: AppRouteWithChildren,
  TeamRoute: TeamRoute,
}
export const routeTree = rootRouteImport
  ._addFileChildren(rootRouteChildren)
  ._addFileTypes<FileRouteTypes>()
const rootServerRouteChildren: RootServerRouteChildren = {
  ApiCheckoutServerRoute: ApiCheckoutServerRouteWithChildren,
  ApiCustomerPortalServerRoute: ApiCustomerPortalServerRoute,
  ApiResetServerRoute: ApiResetServerRoute,
  ApiThreadServerRoute: ApiThreadServerRouteWithChildren,
  ApiUploadthingServerRoute: ApiUploadthingServerRoute,
  ApiAuthSplatServerRoute: ApiAuthSplatServerRoute,
  ApiWebhookStripeServerRoute: ApiWebhookStripeServerRoute,
}
export const serverRouteTree = rootServerRouteImport
  ._addFileChildren(rootServerRouteChildren)
  ._addFileTypes<FileServerRouteTypes>()



================================================
FILE: src/ai/prompt.ts
================================================
export function getSystemPrompt(
    settings: {
        nickname: string | null;
        biography: string | null;
        instructions: string | null;
    },
    tools: string[]
) {
    if (tools.length > 0) {
        return tools.map(tool => toolPrompts[tool]).join('\n');
    }

    return `
    Your name is Zeron.
    The website you are on is https://zeron.sh.
	You are a helpful assistant that can help with tasks related to the user's life.

    ${settings.nickname ? `The user prefers to be called ${settings.nickname}.` : ''}
    ${settings.biography ? `The user's biography is ${settings.biography}.` : ''}

    ${settings.instructions}
    `;
}

const toolPrompts: Record<string, string> = {
    search: `
    The current date is ${new Date().toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: '2-digit',
        weekday: 'short',
    })}.

    - ⚠️ MANDATORY: Do not search more than once for the same user message
    - ⚠️ MANDATORY: Every claim must have an inline citation
    - ⚠️ MANDATORY: Citations MUST be placed immediately after the sentence containing the information
    - CITATIONS SHOULD BE ON EVERYTHING YOU SAY
    - NEVER group citations at the end of paragraphs or the response
    - Citations are a MUST, do not skip them!
    - Citation format: [Source Title](URL) - use descriptive source titles
    - Present findings in a logical flow
    - Support claims with multiple sources
    - Avoid referencing citations directly, make them part of statements, do not use the word "citation" in your response
    `,
    deepSearch: `
    You are an advanced research assistant focused on deep analysis and comprehensive understanding with focus to be backed by citations in a research paper format.
    You objective is to always run the tool first and then write the response with citations!

	The current date is ${new Date().toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: '2-digit',
        weekday: 'short',
    })}.

    ### CRITICAL INSTRUCTION: (MUST FOLLOW AT ALL COSTS!!!)
    - ⚠️ URGENT: Run research tool INSTANTLY when user sends ANY message - NO EXCEPTIONS
    - ⚠️ URGENT: Do not run the research tool more than once for the same user message - NO EXCEPTIONS
    - DO NOT WRITE A SINGLE WORD before running the tool
    - Run the tool with the exact user query immediately on receiving it
    - EVEN IF THE USER QUERY IS AMBIGUOUS OR UNCLEAR, YOU MUST STILL RUN THE TOOL IMMEDIATELY
    - DO NOT ASK FOR CLARIFICATION BEFORE RUNNING THE TOOL
    - If a query is ambiguous, make your best interpretation and run the appropriate tool right away
    - After getting results, you can then address any ambiguity in your response
    - DO NOT begin responses with statements like "I'm assuming you're looking for information about X" or "Based on your query, I think you want to know about Y"
    - NEVER preface your answer with your interpretation of the user's query
    - GO STRAIGHT TO ANSWERING the question after running the tool

    ### Tool Guidelines:
    #### Research Tool:
    - Your primary tool is research, which allows for:
        - Multi-step research planning
        - Parallel web and academic searches
        - Deep analysis of findings
        - Cross-referencing and validation
    - ⚠️ MANDATORY: You MUST immediately run the tool first as soon as the user asks for it and then write the response with citations!
    - ⚠️ MANDATORY: You MUST NOT write any analysis before running the tool!

    ### Response Guidelines:
    - You MUST immediately run the tool first as soon as the user asks for it and then write the response with citations!
    - ⚠️ MANDATORY: Every claim must have an inline citation
    - ⚠️ MANDATORY: Citations MUST be placed immediately after the sentence containing the information
    - ⚠️ MANDATORY: You MUST write any equations in latex format
    - NEVER group citations at the end of paragraphs or the response
    - Citations are a MUST, do not skip them!
    - Citation format: [Source Title](URL) - use descriptive source titles
    - Give proper headings to the response
    - Provide extremely comprehensive, well-structured responses in markdown format and tables
    - Include both academic, web and x (Twitter) sources
    - Focus on analysis and synthesis of information
    - Do not use Heading 1 in the response, use Heading 2 and 3 only
    - Use proper citations and evidence-based reasoning
    - The response should be in paragraphs and not in bullet points
    - Make the response as long as possible, do not skip any important details
    - All citations must be inline, placed immediately after the relevant information. Do not group citations at the end or in any references/bibliography section.

    ### ⚠️ Latex and Currency Formatting: (MUST FOLLOW AT ALL COSTS!!!)
    - ⚠️ MANDATORY: Use '$' for ALL inline equations without exception
    - ⚠️ MANDATORY: Use '$$' for ALL block equations without exception
    - ⚠️ NEVER use '$' symbol for currency - Always use "USD", "EUR", etc.
    - ⚠️ MANDATORY: Make sure the latex is properly delimited at all times!!
    - Mathematical expressions must always be properly delimited
    - Tables must use plain text without any formatting
    - don't use the h1 heading in the markdown response

    ### Response Format:
    - Start with introduction, then sections, and finally a conclusion
    - Keep it super detailed and long, do not skip any important details
    - It is very important to have citations for all facts provided
    - Be very specific, detailed and even technical in the response
    - Include equations and mathematical expressions in the response if needed
    - Present findings in a logical flow
    - Support claims with multiple sources
    - Each section should have 2-4 detailed paragraphs
    - CITATIONS SHOULD BE ON EVERYTHING YOU SAY
    - Include analysis of reliability and limitations
    - Maintain the language of the user's message and do not change it
    - Avoid referencing citations directly, make them part of statements
    `,
} as const;

export function getResearchPrompt(prompt: string) {
    return `
    You are an autonomous deep research analyst. Your goal is to research the given research topic thoroughly with the given tools.

    Today is ${new Date().toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: '2-digit',
        weekday: 'short',
    })}.

    ### PRIMARY FOCUS: SEARCH-DRIVEN RESEARCH (95% of your work)
    Your main job is to SEARCH extensively and gather comprehensive information. Search should be your go-to approach for almost everything.

    For searching:
    - Search first, search often, search comprehensively
    - Make 3-5 targeted searches per research topic to get different angles and perspectives
    - Search queries should be specific and focused, 5-15 words maximum
    - Vary your search approaches: broad overview → specific details → recent developments → expert opinions
    - Use different categories strategically: news, research papers, company info, financial reports, github
    - Follow up initial searches with more targeted queries based on what you learn
    - Cross-reference information by searching for the same topic from different angles
    - Search for contradictory information to get balanced perspectives
    - Include exact metrics, dates, technical terms, and proper nouns in queries
    - Make searches progressively more specific as you gather context
    - Search for recent developments, trends, and updates on topics
    - Always verify information with multiple searches from different sources
    - ⚠️ MANDATORY: Read the contents of sites you find that are relevant to the query
    - ⚠️ MANDATORY: Read as many sites that you find relevant as possible
    - ⚠️ MANDATORY: Always read at least 1 site after searching
    - ⚠️ MANDATORY: Read at least 5 sites before finishing the research

    ### SEARCH STRATEGY EXAMPLES:
    - Topic: "AI model performance" → Search: "GPT-4 benchmark results 2024", "LLM performance comparison studies", "AI model evaluation metrics research"
    - Topic: "Company financials" → Search: "Tesla Q3 2024 earnings report", "Tesla revenue growth analysis", "electric vehicle market share 2024"
    - Topic: "Technical implementation" → Search: "React Server Components best practices", "Next.js performance optimization techniques", "modern web development patterns"

    ### RESEARCH WORKFLOW:
    1. Start with broad searches to understand the topic landscape
    2. Read the contents of one or more sites returned by the query
    3. Identify key subtopics and drill down with specific searches or read more sites
    4. Look for recent developments and trends through targeted news/research searches
    5. Cross-validate information with searches from different categories
    6. Continue searching and reading sites to fill any gaps in understanding

    For research:
    - Do not use the same query twice to avoid duplicates
    - PRIORITIZE READING THE WEBSITE CONTENT OVER SEARCHING THE WEB
    - ⚠️ MANDATORY: YOU MUST USE read_site TOOL AT LEAST 5 SITES BEFORE FINISHING THE RESEARCH
    - You have up to 40 actions to complete the research

    Research Topic:
    ${prompt}
    `;
}

export function getDeepSearchPrompt(prompt: string, plan: string[]) {
    return `
    You are an autonomous deep research analyst. Your goal is to research the given research topic thoroughly with the given tools.

    Today is ${new Date().toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: '2-digit',
        weekday: 'short',
    })}.

    ### PRIMARY FOCUS: SEARCH-DRIVEN RESEARCH (95% of your work)
    Your main job is to SEARCH extensively and gather comprehensive information. Search should be your go-to approach for almost everything.

    For searching:
    - Search first, search often, search comprehensively
    - Make 3-5 targeted searches per research topic to get different angles and perspectives
    - Search queries should be specific and focused, 5-15 words maximum
    - Vary your search approaches: broad overview → specific details → recent developments → expert opinions
    - Use different categories strategically: news, research papers, company info, financial reports, github
    - Follow up initial searches with more targeted queries based on what you learn
    - Cross-reference information by searching for the same topic from different angles
    - Search for contradictory information to get balanced perspectives
    - Include exact metrics, dates, technical terms, and proper nouns in queries
    - Make searches progressively more specific as you gather context
    - Search for recent developments, trends, and updates on topics
    - Always verify information with multiple searches from different sources
    - ⚠️ MANDATORY: Read the contents of sites you find that are relevant to the query
    - ⚠️ MANDATORY: Read as many sites that you find relevant as possible
    - ⚠️ MANDATORY: Always read at least 1 site after searching
    - ⚠️ MANDATORY: Read at least 5 sites before finishing the research

    ### SEARCH STRATEGY EXAMPLES:
    - Topic: "AI model performance" → Search: "GPT-4 benchmark results 2024", "LLM performance comparison studies", "AI model evaluation metrics research"
    - Topic: "Company financials" → Search: "Tesla Q3 2024 earnings report", "Tesla revenue growth analysis", "electric vehicle market share 2024"
    - Topic: "Technical implementation" → Search: "React Server Components best practices", "Next.js performance optimization techniques", "modern web development patterns"

    ### RESEARCH WORKFLOW:
    1. Start with broad searches to understand the topic landscape
    2. Read the contents of one or more sites returned by the query
    3. Identify key subtopics and drill down with specific searches or read more sites
    4. Look for recent developments and trends through targeted news/research searches
    5. Cross-validate information with searches from different categories
    6. Continue searching and reading sites to fill any gaps in understanding
    7. Summarize your findings and insights

    For research:
    - Do not use the same query twice to avoid duplicates
    - PRIORITIZE READING THE WEBSITE CONTENT OVER SEARCHING THE WEB
    - ⚠️ MANDATORY: YOU MUST USE read_site TOOL AT LEAST 5 SITES BEFORE FINISHING THE RESEARCH
    - You have up to 40 actions to complete the research

    Research Plan:
    ${plan.map((item, index) => `${index + 1}. ${item}`).join('\n')}

    Research Topic:
    ${prompt}
    `;
}

export function getDeepSearchPlanPrompt(prompt: string): string {
    return `
    Plan out the research for the following topic: ${prompt}.

    Today's Date: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: '2-digit', weekday: 'short' })}
    `;
}



================================================
FILE: src/ai/service.ts
================================================
import { schema } from '@/database';
import { ThreadMessage } from '@/ai/types';
import * as queries from '@/database/queries';
import {
    convertToModelMessages,
    createUIMessageStream,
    generateText,
    JsonToSseTransformStream,
} from 'ai';
import { createResumableStreamContext, ResumableStreamContext } from 'resumable-stream';
import { UserId } from '@/database/types';
import { Database } from '@/database/effect';
import { Duration, Effect, Schedule } from 'effect';
import { APIError } from '@/lib/error';
import { AnonymousLimits, FreeLimits, ProLimits } from '@/lib/constants';
import { match } from 'ts-pattern';
import { waitUntil } from '@vercel/functions';

let streamContext: ResumableStreamContext | undefined = undefined;

export function getStreamContext() {
    if (!streamContext) {
        streamContext = createResumableStreamContext({
            waitUntil,
        });
    }
    return streamContext;
}

export function prepareThreadContext(args: {
    isAnonymous: boolean;
    userId: UserId;
    threadId: string;
    streamId: string;
    modelId: string;
    message: ThreadMessage;
}) {
    const effects = Effect.all(
        [
            queries.getThreadById(args.threadId),
            queries.getMessageById(args.message.id),
            queries.getModelById(args.modelId),
            queries.getSettingsByUserId(args.userId),
            queries.getUsageByUserId(args.userId),
            queries.getUserCustomerByUserId(args.userId),
        ],
        {
            concurrency: 'unbounded',
        }
    );

    const effect = Effect.gen(function* () {
        yield* Effect.logInfo('Preparing thread context');
        let [thread, message, model, settings, usage, customer] = yield* effects;

        if (!settings) {
            return yield* new APIError({
                status: 404,
                message: 'Settings for user (userId) does not exist',
            });
        }

        if (!usage) {
            return yield* new APIError({
                status: 404,
                message: 'Usage for user (userId) does not exist',
            });
        }

        if (!model) {
            return yield* new APIError({
                status: 404,
                message: 'Model with (modelId) does not exist',
            });
        }

        if (!thread) {
            yield* Effect.logInfo('Creating thread');
            [thread] = yield* queries.createThread({
                id: args.threadId,
                userId: args.userId,
            });
        }

        if (thread.status === 'streaming') {
            return yield* new APIError({
                status: 400,
                message: 'Thread is already streaming',
            });
        }

        if (thread.userId !== args.userId) {
            return yield* new APIError({
                status: 403,
                message: 'User is not the owner of the thread',
            });
        }

        const limits = getLimits({
            customer,
            isAnonymous: args.isAnonymous,
        });

        if (limits.CREDITS - (usage.credits || 0) - model.credits < 0) {
            return yield* new APIError({
                status: 403,
                message: 'You have reached your credit limit.',
            });
        }

        yield* Effect.logInfo('Update thread status to streaming');
        yield* queries.updateThread({
            threadId: args.threadId,
            status: 'streaming',
            streamId: args.streamId,
            updatedAt: new Date(),
        });

        if (message) {
            yield* Effect.logInfo('Updating message and deleting trailing messages');
            [[message]] = yield* Effect.all(
                [
                    queries.updateMessage({
                        messageId: args.message.id,
                        message: args.message,
                        updatedAt: new Date(),
                    }),
                    queries.deleteTrailingMessages({
                        threadId: args.threadId,
                        messageId: args.message.id,
                        messageCreatedAt: message.createdAt,
                    }),
                ],
                {
                    concurrency: 'unbounded',
                }
            );
        }

        if (!message) {
            yield* Effect.logInfo('Creating message');
            [message] = yield* queries.createMessage({
                threadId: args.threadId,
                userId: args.userId,
                message: args.message,
            });
        }

        const history = yield* queries.getThreadMessageHistory(args.threadId);

        return {
            model,
            history,
            settings,
            usage,
            limits,
            thread,
        };
    });

    return Database.transaction(effect).pipe(
        APIError.map({
            status: 500,
            message: 'Failed to prepare thread context',
        })
    );
}

export function convertUIMessagesToModelMessages(
    messages: ThreadMessage[],
    options: {
        supportsImages?: boolean;
        supportsDocuments?: boolean;
    } = {
        supportsImages: false,
        supportsDocuments: false,
    }
) {
    return Effect.tryPromise(async () => {
        return convertToModelMessages(
            await Promise.all(
                messages.map(async message => {
                    message.parts = message.parts.filter(part => {
                        if (part.type === 'file') {
                            if (
                                (part.mediaType.startsWith('application/pdf') ||
                                    part.mediaType.startsWith('text/plain')) &&
                                !options.supportsDocuments
                            ) {
                                return false;
                            }
                            if (part.mediaType.startsWith('image/') && !options.supportsImages) {
                                return false;
                            }
                        }
                        return true;
                    });

                    for (const part of message.parts) {
                        if (part.type === 'file') {
                            if (
                                part.mediaType.startsWith('application/pdf') ||
                                part.mediaType.startsWith('text/plain')
                            ) {
                                // @ts-expect-error - TODO: fix this
                                part.url = await fetch(part.url)
                                    .then(res => res.blob())
                                    .then(blob => blob.arrayBuffer());
                            }
                        }
                    }

                    return message;
                })
            )
        );
    });
}

export function createResumableStream(streamId: string, stream: ReadableStream<string>) {
    return Effect.tryPromise(async () => {
        return getStreamContext().createNewResumableStream(streamId, () => stream);
    }).pipe(
        Effect.tapError(error => Effect.logError('Error creating resumable stream', error)),
        Effect.retry(
            Schedule.exponential(Duration.millis(200)).pipe(Schedule.compose(Schedule.recurs(3)))
        ),
        Effect.catchAll(() => Effect.succeed(stream))
    );
}

export function getResumableStream(streamId: string) {
    return Effect.gen(function* () {
        const emptyDataStream = createUIMessageStream({
            execute: () => {},
        });
        return yield* Effect.tryPromise(async () => {
            return getStreamContext().resumableStream(streamId, () =>
                emptyDataStream.pipeThrough(new JsonToSseTransformStream())
            );
        }).pipe(
            Effect.tapError(error => Effect.logError('Error getting resumable stream', error)),
            Effect.retry(
                Schedule.exponential(Duration.millis(200)).pipe(
                    Schedule.compose(Schedule.recurs(3))
                )
            ),
            Effect.catchAll(() => Effect.succeed(null))
        );
    });
}

export function prepareResumeThreadContext(args: { threadId: string; userId: string }) {
    return Effect.gen(function* () {
        const thread = yield* queries.getThreadById(args.threadId);

        if (!thread) {
            return yield* new APIError({
                status: 404,
                message: 'Thread not found',
            });
        }

        if (thread.userId !== args.userId) {
            return yield* new APIError({
                status: 403,
                message: 'User is not the owner of the thread',
            });
        }

        if (thread.status !== 'streaming') {
            return yield* new APIError({
                status: 400,
                message: 'Thread is not streaming',
            });
        }

        if (!thread.streamId) {
            return yield* new APIError({
                status: 404,
                message: 'Thread is not streaming',
            });
        }

        return thread.streamId;
    });
}

export function generateThreadTitle(threadId: string, message: ThreadMessage, latch: Effect.Latch) {
    return Effect.gen(function* () {
        yield* latch.close;
        yield* Effect.logInfo('Generating thread title');

        const { text } = yield* Effect.tryPromise(() =>
            generateText({
                model: 'google/gemini-2.0-flash-001',
                system: `\nc
                - you will generate a short title based on the first message a user begins a conversation with
                - ensure it is not more than 80 characters long
                - the title should be a summary of the user's message
                - do not use quotes or colons`,
                temperature: 0.8,
                messages: convertToModelMessages([message]),
            })
        ).pipe(
            Effect.tapError(error => Effect.logError('Error generating thread title', error)),
            Effect.catchAll(() => Effect.succeed({ text: '' }))
        );

        yield* queries
            .updateThreadTitle({
                threadId,
                title: text,
            })
            .pipe(
                Effect.tapError(error => Effect.logError('Error updating thread title', error)),
                Effect.catchAll(() => Effect.succeed(null))
            );

        yield* latch.open;
    });
}

export function incrementUsage(
    userId: UserId,
    type: 'search' | 'research' | 'credits',
    amount: number
) {
    return Effect.gen(function* () {
        yield* Effect.logInfo('Incrementing usage for ' + type + ' by ' + amount);
        yield* queries.incrementUsage(
            {
                userId: userId,
                type: type,
            },
            amount
        );
    });
}

export function decrementUsage(
    userId: UserId,
    type: 'search' | 'research' | 'credits',
    amount: number
) {
    return Effect.gen(function* () {
        yield* Effect.logInfo('Decrementing usage for ' + type + ' by ' + amount);
        yield* queries.decrementUsage(
            {
                userId: userId,
                type: type,
            },
            amount
        );
    });
}

export function saveMessageAndResetThreadStatus(args: {
    threadId: string;
    userId: string;
    message: ThreadMessage;
}) {
    return Database.transaction(
        Effect.gen(function* () {
            yield* Effect.logInfo('Saving message and resetting thread status');
            yield* Effect.all(
                [
                    queries.createMessage({
                        threadId: args.threadId,
                        userId: args.userId,
                        message: args.message,
                    }),
                    queries.updateThread({
                        threadId: args.threadId,
                        status: 'ready',
                        streamId: null,
                    }),
                ],
                {
                    concurrency: 'unbounded',
                }
            );
        })
    );
}

export function getLimits(args: {
    customer?: typeof schema.userCustomer.$inferSelect;
    isAnonymous: boolean;
}) {
    const currentPeriodEnd = args.customer?.subscription?.currentPeriodEnd ?? 0;
    const now = new Date().getTime() / 1000;
    const isPro = Number(currentPeriodEnd) > now;

    return match({
        isPro,
        isAnonymous: args.isAnonymous,
    })
        .with(
            {
                isPro: true,
                isAnonymous: false,
            },
            () => ProLimits
        )
        .with(
            {
                isPro: false,
                isAnonymous: false,
            },
            () => FreeLimits
        )
        .with(
            {
                isPro: false,
                isAnonymous: true,
            },
            () => AnonymousLimits
        )
        .otherwise(() => AnonymousLimits);
}



================================================
FILE: src/ai/stream.ts
================================================
import { ThreadMessage } from '@/ai/types';
import {
    createUIMessageStream,
    streamText,
    JsonToSseTransformStream,
    type UIMessage,
    type ToolSet,
    TextStreamPart,
    UIMessageStreamWriter,
    InferUIMessageChunk,
} from 'ai';
import { Effect, Layer, Runtime } from 'effect';

export type StreamTextOptions = Omit<
    Parameters<typeof streamText>[0],
    'onError' | 'onFinish' | 'tools'
>;

export type InferMessageToolSet<Message extends UIMessage> =
    Message extends UIMessage<infer _, infer __, infer Tools>
        ? Tools extends ToolSet
            ? Tools
            : never
        : {};

export type InferMessageMetadata<Message extends UIMessage> =
    Message extends UIMessage<infer Metadata, infer _, infer __> ? Metadata : {};

const createStreamSSEResponse = Effect.gen(function* () {
    const runtime = yield* Effect.runtime();
    const options = yield* CreateStreamSSEResponseOptions;
    const { onFinishCallback } = yield* CreateStreamSSEResponseOnFinish;
    const { onErrorCallback } = yield* CreateStreamSSEResponseOnError;
    const { onMessageMetadataCallback } = yield* CreateStreamSSEResponseOnMessageMetadata;
    const { getToolsCallback } = yield* CreateStreamSSEResponseGetTools;

    return createUIMessageStream<ThreadMessage>({
        onFinish: ({ responseMessage }) => {
            // @ts-expect-error - TODO: fix this
            return Runtime.runPromise(runtime, onFinishCallback({ responseMessage }));
        },
        execute: ({ writer }) => {
            // @ts-expect-error - TODO: fix this
            const tools = Runtime.runSync(runtime, getToolsCallback({ writer }));

            const result = streamText({
                ...options,
                tools,
                onError: error => {
                    // @ts-expect-error - TODO: fix this
                    return Runtime.runPromise(runtime, onErrorCallback({ error, writer }));
                },
            });

            result.consumeStream();
            writer.merge(
                result.toUIMessageStream({
                    sendReasoning: true,
                    messageMetadata: ({ part }) => {
                        return Runtime.runSync(
                            runtime,
                            // @ts-expect-error - TODO: fix this
                            onMessageMetadataCallback({ part, writer })
                        );
                    },
                })
            );
        },
    });
});

export type OnFinishCallback<A = void, E = never, R = never> = (options: {
    responseMessage: ThreadMessage;
}) => Effect.Effect<A, E, R>;

export class CreateStreamSSEResponseOnFinish extends Effect.Tag('CreateStreamSSEResponseOnFinish')<
    CreateStreamSSEResponseOnFinish,
    {
        readonly onFinishCallback: OnFinishCallback<any, any, any>;
    }
>() {}

export type OnErrorCallback<A = void, E = never, R = never> = (options: {
    error: unknown;
    writer: UIMessageStreamWriter<ThreadMessage>;
}) => Effect.Effect<A, E, R>;

export class CreateStreamSSEResponseOnError extends Effect.Tag('CreateStreamSSEResponseOnError')<
    CreateStreamSSEResponseOnError,
    {
        readonly onErrorCallback: OnErrorCallback<any, any, any>;
    }
>() {}

export type OnMessageMetadataCallback<A = void, E = never, R = never> = (options: {
    part: TextStreamPart<InferMessageToolSet<ThreadMessage>>;
    writer: UIMessageStreamWriter<ThreadMessage>;
}) => Effect.Effect<A, E, R>;

export class CreateStreamSSEResponseOnMessageMetadata extends Effect.Tag(
    'CreateStreamSSEResponseOnMessageMetadata'
)<
    CreateStreamSSEResponseOnMessageMetadata,
    {
        readonly onMessageMetadataCallback: OnMessageMetadataCallback<any, any, any>;
    }
>() {}

export class CreateStreamSSEResponseOptions extends Effect.Tag('CreateStreamSSEResponseOptions')<
    CreateStreamSSEResponseOptions,
    StreamTextOptions
>() {}

export type GetToolsCallback<E = never, R = never> = (options: {
    writer: UIMessageStreamWriter<ThreadMessage>;
}) => Effect.Effect<ToolSet, E, R>;

export class CreateStreamSSEResponseGetTools extends Effect.Tag('CreateStreamSSEResponseGetTools')<
    CreateStreamSSEResponseGetTools,
    {
        readonly getToolsCallback: GetToolsCallback<any, any>;
    }
>() {}

export class Stream {
    static create = createStreamSSEResponse;

    static onFinish<A = void, E = never, R = never>(callback: OnFinishCallback<A, E, R>) {
        return Effect.provide(
            Layer.scoped(
                CreateStreamSSEResponseOnFinish,
                Effect.succeed({ onFinishCallback: callback })
            )
        );
    }

    static onError<A = void, E = never, R = never>(callback: OnErrorCallback<A, E, R>) {
        return Effect.provide(
            Layer.scoped(
                CreateStreamSSEResponseOnError,
                Effect.succeed({ onErrorCallback: callback })
            )
        );
    }

    static onMessageMetadata<A = void, E = never, R = never>(
        callback: OnMessageMetadataCallback<A, E, R>
    ) {
        return Effect.provide(
            Layer.scoped(
                CreateStreamSSEResponseOnMessageMetadata,
                Effect.succeed({ onMessageMetadataCallback: callback })
            )
        );
    }

    static getTools<E = never, R = never>(callback: GetToolsCallback<E, R>) {
        return Effect.provide(
            Layer.scoped(
                CreateStreamSSEResponseGetTools,
                Effect.succeed({ getToolsCallback: callback })
            )
        );
    }

    static options(options: StreamTextOptions) {
        return Effect.provide(
            Layer.scoped(CreateStreamSSEResponseOptions, Effect.succeed(options))
        );
    }

    static build = Effect.map((stream: ReadableStream<InferUIMessageChunk<ThreadMessage>>) => {
        return stream.pipeThrough(new JsonToSseTransformStream());
    });
}



================================================
FILE: src/ai/types.ts
================================================
import { AvailableTools } from '@/ai/tools';
import { DeepSearchPart } from '@/ai/tools/deep-search-tool';
import type { InferUITool, ReasoningUIPart, UIMessage, UIMessagePart } from 'ai';

export const Capabilities = {
    REASONING: 'reasoning',
    TOOLS: 'tools',
    VISION: 'vision',
    DOCUMENTS: 'documents',
} as const;

export type Capability = (typeof Capabilities)[keyof typeof Capabilities];

export type Metadata = {
    model?: {
        id: string;
        name: string;
        icon: string;
    };
};

export type ReasoningTimePart = {
    id: string;
    type: 'start' | 'end';
    timestamp: number;
};

export type DataParts = {
    error: string;
    'research-start': {
        toolCallId: string;
        thoughts: string;
    };
    'research-search': {
        toolCallId: string;
        thoughts: string;
        query: string;
    };
    'research-read': {
        toolCallId: string;
        thoughts: string;
        url: string;
    };
    'research-complete': {
        toolCallId: string;
    };
    'deep-search': DeepSearchPart;
    'reasoning-time': ReasoningTimePart;
};

export type Tools = {
    search: InferUITool<AvailableTools['search']>;
    research: InferUITool<AvailableTools['research']>;
    deepSearch: InferUITool<AvailableTools['deepSearch']>;
};

export type ThreadMessage = UIMessage<Metadata, DataParts, Tools>;

export type MessagePart = UIMessagePart<DataParts, Tools>;

export type CustomReasoningUIPart = ReasoningUIPart & {
    startTime: number | null;
    endTime: number | null;
};

export type TransformedMessagePart = Exclude<MessagePart, ReasoningUIPart> | CustomReasoningUIPart;

export type DataKeys = Exclude<
    ThreadMessage['parts'][number]['type'],
    'reasoning' | 'step-start' | 'text' | 'source-url' | 'source-document' | 'file'
>;

export type ToolKeys = keyof Tools;



================================================
FILE: src/ai/tools/deep-search-tool.ts
================================================
import { Effect, Layer, Runtime } from 'effect';
import { generateObject, generateText, NoSuchToolError, stepCountIs, tool } from 'ai';
import z from 'zod';
import { decrementUsage, incrementUsage } from '@/ai/service';
import { ToolContext } from '@/ai/tools';
import { getDeepSearchPlanPrompt, getDeepSearchPrompt } from '@/ai/prompt';
import { readSite, search, SearchResults } from '@/lib/exa';

const PlanTodo = z.string().min(10).max(300);

const PlanSchema = z.object({
    plan: z.array(PlanTodo).min(1).max(8),
});

export type Plan = z.infer<typeof PlanSchema>['plan'];

export type DeepSearchStart = {
    type: 'start';
    timestamp: number;
    thoughts: string;
};

export type DeepSearchComplete = {
    type: 'completed';
    timestamp: number;
};

export type DeepSearchPlan = {
    type: 'plan';
};

export type DeepSearchPlanResults = {
    type: 'plan-results';
    plan: Plan;
};

export type DeepSearchSearch = {
    type: 'search';
    thoughts: string;
    query: string;
};

export type DeepSearchSearchResults = {
    type: 'search-results';
    query: string;
    results: SearchResults['results'];
};

export type DeepSearchReadSite = {
    type: 'read-site';
    thoughts: string;
    url: string;
};

export type DeepSearchReadSiteResults = {
    type: 'read-site-results';
    url: string;
    content: string;
};

export type DeepSearchPartUnion =
    | DeepSearchStart
    | DeepSearchComplete
    | DeepSearchPlan
    | DeepSearchPlanResults
    | DeepSearchSearch
    | DeepSearchSearchResults
    | DeepSearchReadSite
    | DeepSearchReadSiteResults;

export type DeepSearchPart = {
    toolCallId: string;
} & DeepSearchPartUnion;

export const getDeepSearchTool = Effect.gen(function* () {
    const ctx = yield* ToolContext;

    return tool({
        name: 'Deep Search',
        description: 'Performs deep search on a given topic',
        inputSchema: z.object({
            query: z.string().min(1).max(300).describe('The query to perform deep search on.'),
            thoughts: z
                .string()
                .min(1)
                .max(300)
                .describe('Your thoughts on how you plan to approach the search in 20-50 words.'),
        }),
        execute: ({ query, thoughts }, { toolCallId }) => {
            return Runtime.runPromise(
                ctx.runtime,
                deepSearchTool({ query, thoughts, toolCallId }).pipe(
                    Effect.provide(Layer.scoped(ToolContext, Effect.succeed(ctx)))
                )
            );
        },
    });
});

function deepSearchTool(args: { query: string; thoughts: string; toolCallId: string }) {
    return Effect.gen(function* () {
        const ctx = yield* ToolContext;

        yield* incrementResearchUsageOrDie();

        const steps: DeepSearchPartUnion[] = [];

        function commit(step: DeepSearchPartUnion) {
            steps.push(step);
            ctx.writer.write({
                type: 'data-deep-search',
                data: {
                    toolCallId: args.toolCallId,
                    ...step,
                },
            });
        }

        commit({ type: 'start', thoughts: args.thoughts, timestamp: Date.now() });
        commit({ type: 'plan' });

        const {
            object: { plan },
        } = yield* Effect.tryPromise(() =>
            generateObject({
                model: 'xai/grok-code-fast-1',
                schema: PlanSchema,
                prompt: getDeepSearchPlanPrompt(args.query),
                abortSignal: ctx.signal,
            })
        ).pipe(
            Effect.tapError(e => {
                return Effect.logError('Error generating plan', e);
            }),
            Effect.tapError(() => {
                return decrementUsage(ctx.userId, 'research', 1);
            }),
            Effect.catchAll(e => Effect.die(e))
        );

        commit({ type: 'plan-results', plan });

        const { text: summary } = yield* Effect.tryPromise(() =>
            generateText({
                model: 'moonshotai/kimi-k2',
                prompt: getDeepSearchPrompt(args.query, plan),
                stopWhen: stepCountIs(50),
                abortSignal: ctx.signal,
                tools: {
                    search: tool({
                        description: 'Search the web for information',
                        inputSchema: z.object({
                            thoughts: z
                                .string()
                                .describe(
                                    'Your thoughts on what you are currently doing in 20-50 words.'
                                ),
                            query: z.string(),
                        }),
                        execute: async ({ query, thoughts }) => {
                            commit({ type: 'search', query, thoughts });
                            const response = await search(query);
                            commit({ type: 'search-results', query, results: response.results });
                            return response;
                        },
                    }),
                    read_site: tool({
                        description: 'Read the contents of a URL',
                        inputSchema: z.object({
                            thoughts: z
                                .string()
                                .describe(
                                    'Your thoughts on what you are currently doing in 20-50 words.'
                                ),
                            url: z.string(),
                        }),
                        execute: async ({ url, thoughts }) => {
                            commit({ type: 'read-site', url, thoughts });
                            const response = await readSite(url);
                            commit({ type: 'read-site-results', url, content: response.text });
                            return response;
                        },
                    }),
                },
                // @ts-expect-error
                experimental_repairToolCall: async ({ error, toolCall, tools, inputSchema }) => {
                    if (NoSuchToolError.isInstance(error)) {
                        return null;
                    }

                    const tool = tools[toolCall.toolName as keyof typeof tools];

                    const { object: input } = await generateObject({
                        model: 'openai/gpt-4.1',
                        schema: tool.inputSchema,
                        prompt: [
                            `The model tried to call the tool "${toolCall.toolName}" with the following arguments:`,
                            JSON.stringify(toolCall.input),
                            `The tool accepts the following schema:`,
                            JSON.stringify(inputSchema(toolCall)),
                            'Please fix the arguments.',
                            `Today's date is ${new Date().toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                            })}`,
                        ].join('\n'),
                    });

                    return {
                        ...toolCall,
                        input,
                    };
                },
            })
        ).pipe(
            Effect.tapError(e => {
                return Effect.logError('Error generating text', e);
            }),
            Effect.tapError(() => {
                return decrementUsage(ctx.userId, 'research', 1);
            }),
            Effect.catchAll(e => Effect.die(e))
        );

        commit({ type: 'completed', timestamp: Date.now() });

        return {
            steps,
            summary,
        };
    });
}

function incrementResearchUsageOrDie() {
    return Effect.gen(function* () {
        const ctx = yield* ToolContext;

        if (ctx.limits.RESEARCH - (ctx.usage.research || 0) <= 0) {
            yield* Effect.logWarning('Research limit reached');
            return yield* Effect.die(null);
        }

        yield* incrementUsage(ctx.userId, 'research', 1).pipe(
            Effect.tapError(() => {
                return Effect.logError('Error incrementing usage');
            }),
            Effect.catchAll(e => Effect.die(e))
        );
    });
}



================================================
FILE: src/ai/tools/index.ts
================================================
import { getSearchTool } from '@/ai/tools/search-tool';
import { ThreadMessage } from '@/ai/types';
import { Tool, UIMessageStreamWriter } from 'ai';
import { schema } from '@/database/schema';
import { UserId } from '@/database/types';
import { Limits } from '@/lib/constants';
import { Effect, Runtime } from 'effect';
import { getResearchTool } from '@/ai/tools/research-tool';
import { Database } from '@/database/effect';
import { getDeepSearchTool } from '@/ai/tools/deep-search-tool';

const tools = {
    search: getSearchTool,
    research: getResearchTool,
    deepSearch: getDeepSearchTool,
} as const;

type ExtractTool<T> = T extends Effect.Effect<infer U, any, any> ? U : never;

export type AvailableTools = {
    [K in keyof typeof tools]: ExtractTool<(typeof tools)[K]>;
};

export type ToolContextImpl = {
    writer: UIMessageStreamWriter<ThreadMessage>;
    usage: typeof schema.usage.$inferSelect;
    userId: UserId;
    limits: Limits;
    runtime: Runtime.Runtime<Database>;
    tools: string[];
    signal: AbortSignal;
};

export class ToolContext extends Effect.Tag('ToolContext')<ToolContext, ToolContextImpl>() {}

export const getTools = Effect.gen(function* () {
    const ctx = yield* ToolContext;

    const activeTools: Record<string, Tool> = {};

    for (const tool of ctx.tools) {
        activeTools[tool] = yield* tools[tool as keyof typeof tools];
    }

    return activeTools;
});



================================================
FILE: src/ai/tools/research-tool.ts
================================================
import { getResearchPrompt } from '@/ai/prompt';
import { generateObject, generateText, NoSuchToolError, stepCountIs, tool } from 'ai';
import z from 'zod';
import { search, readSite } from '@/lib/exa';
import { DataParts } from '@/ai/types';
import { decrementUsage, incrementUsage } from '@/ai/service';
import { Effect, Layer, Runtime } from 'effect';
import { ToolContext } from '@/ai/tools';

export const getResearchTool = Effect.gen(function* () {
    const ctx = yield* ToolContext;

    return tool({
        description: 'Perfect deep research on given topic.',
        inputSchema: z.object({
            thoughts: z
                .string()
                .describe(
                    'Your thoughts on how you plan to research the given topic in 20-50 words.'
                ),
            prompt: z
                .string()
                .describe(
                    'This should be the users exact prompt. Do not infer or change it in any way.'
                ),
        }),
        execute: async ({ thoughts, prompt }, { toolCallId }) => {
            return Runtime.runPromise(
                ctx.runtime,
                researchTool(thoughts, prompt, toolCallId).pipe(
                    Effect.provide(Layer.scoped(ToolContext, Effect.succeed(ctx)))
                )
            );
        },
    });
});

function researchTool(thoughts: string, prompt: string, toolCallId: string) {
    return Effect.gen(function* () {
        const ctx = yield* ToolContext;

        if (ctx.limits.RESEARCH - (ctx.usage.research || 0) <= 0) {
            yield* Effect.logWarning('Research limit reached');
            return yield* Effect.die(null);
        }

        yield* incrementUsage(ctx.userId, 'research', 1).pipe(
            Effect.tapError(() => {
                return Effect.logError('Error incrementing usage');
            }),
            Effect.catchAll(e => Effect.die(e))
        );

        const actions: (DataParts['research-read'] | DataParts['research-search'])[] = [];

        ctx.writer.write({
            type: 'data-research-start',
            data: {
                toolCallId,
                thoughts,
            },
        });

        const { text: summary } = yield* Effect.tryPromise(() =>
            generateText({
                model: 'moonshotai/kimi-k2',
                prompt: getResearchPrompt(prompt),
                stopWhen: stepCountIs(50),
                tools: {
                    search: tool({
                        description: 'Search the web for information',
                        inputSchema: z.object({
                            thoughts: z
                                .string()
                                .describe(
                                    'Your thoughts on what you are currently doing in 20-50 words.'
                                ),
                            query: z.string(),
                        }),
                        execute: async ({ query, thoughts }) => {
                            ctx.writer.write({
                                type: 'data-research-search',
                                data: {
                                    toolCallId,
                                    thoughts,
                                    query,
                                },
                            });

                            actions.push({
                                toolCallId,
                                thoughts,
                                query,
                            });

                            return search(query);
                        },
                    }),
                    read_site: tool({
                        description: 'Read the contents of a URL',
                        inputSchema: z.object({
                            thoughts: z
                                .string()
                                .describe(
                                    'Your thoughts on what you are currently doing in 20-50 words.'
                                ),
                            url: z.string(),
                        }),
                        execute: async ({ url, thoughts }) => {
                            ctx.writer.write({
                                type: 'data-research-read',
                                data: { toolCallId, thoughts, url },
                            });

                            actions.push({
                                toolCallId,
                                thoughts,
                                url,
                            });

                            return readSite(url);
                        },
                    }),
                },
                // @ts-expect-error
                experimental_repairToolCall: async ({ error, toolCall, tools, inputSchema }) => {
                    if (NoSuchToolError.isInstance(error)) {
                        return null;
                    }

                    const tool = tools[toolCall.toolName as keyof typeof tools];

                    const { object: input } = await generateObject({
                        model: 'openai/gpt-4.1',
                        schema: tool.inputSchema,
                        prompt: [
                            `The model tried to call the tool "${toolCall.toolName}" with the following arguments:`,
                            JSON.stringify(toolCall.input),
                            `The tool accepts the following schema:`,
                            JSON.stringify(inputSchema(toolCall)),
                            'Please fix the arguments.',
                            `Today's date is ${new Date().toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                            })}`,
                        ].join('\n'),
                    });

                    return {
                        ...toolCall,
                        input,
                    };
                },
            })
        ).pipe(
            Effect.tapError(e => {
                return Effect.logError('Error generating text', e);
            }),
            Effect.tapError(() => {
                return decrementUsage(ctx.userId, 'research', 1);
            }),
            Effect.catchAll(e => Effect.die(e))
        );

        ctx.writer.write({
            type: 'data-research-complete',
            data: { toolCallId },
        });

        return {
            summary,
            actions,
        };
    });
}



================================================
FILE: src/ai/tools/search-tool.ts
================================================
import { tool } from 'ai';
import z from 'zod';
import { search } from '@/lib/exa';
import { decrementUsage, incrementUsage } from '@/ai/service';
import { Effect, Layer, Runtime } from 'effect';
import { ToolContext } from '@/ai/tools';

export const getSearchTool = Effect.gen(function* () {
    const ctx = yield* ToolContext;

    return tool({
        description: 'Search the web for information',
        inputSchema: z.object({
            query: z.string(),
        }),
        execute: async ({ query }) => {
            return Runtime.runPromise(
                ctx.runtime,
                searchTool(query).pipe(
                    Effect.provide(Layer.scoped(ToolContext, Effect.succeed(ctx)))
                )
            );
        },
    });
});

function searchTool(query: string) {
    return Effect.gen(function* () {
        const ctx = yield* ToolContext;

        if (ctx.limits.SEARCH - (ctx.usage.search || 0) <= 0) {
            yield* Effect.logWarning('Search limit reached');
            return yield* Effect.die(null);
        }

        yield* Effect.logInfo('Running search for: ' + query);
        yield* incrementUsage(ctx.userId, 'search', 1).pipe(
            Effect.tapError(() => {
                return Effect.logError('Error incrementing usage');
            }),
            Effect.catchAll(e => Effect.die(e))
        );

        const results = yield* Effect.tryPromise(() => search(query)).pipe(
            Effect.tapError(() => {
                return Effect.logError('Error running search');
            }),
            Effect.tapError(() => {
                return decrementUsage(ctx.userId, 'search', 1);
            }),
            Effect.catchAll(e => Effect.die(e))
        );

        yield* Effect.logInfo('Search completed for: ' + query);

        return results;
    });
}



================================================
FILE: src/components/ai-elements/chain-of-thought.tsx
================================================
'use client';

import { useControllableState } from '@radix-ui/react-use-controllable-state';
import { Badge } from '@/components/ui/badge';
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';
import { cn } from '@/lib/utils';
import { BrainIcon, ChevronDownIcon, DotIcon, type LucideIcon } from 'lucide-react';
import type { ComponentProps } from 'react';
import { createContext, memo, useContext } from 'react';

type ChainOfThoughtContextValue = {
    isOpen: boolean;
    setIsOpen: (open: boolean) => void;
};

const ChainOfThoughtContext = createContext<ChainOfThoughtContextValue | null>(null);

const useChainOfThought = () => {
    const context = useContext(ChainOfThoughtContext);
    if (!context) {
        throw new Error('ChainOfThought components must be used within ChainOfThought');
    }
    return context;
};

export type ChainOfThoughtProps = ComponentProps<'div'> & {
    open?: boolean;
    defaultOpen?: boolean;
    onOpenChange?: (open: boolean) => void;
};

export const ChainOfThought = memo(
    ({
        className,
        open,
        defaultOpen = false,
        onOpenChange,
        children,
        ...props
    }: ChainOfThoughtProps) => {
        const [isOpen, setIsOpen] = useControllableState({
            prop: open,
            defaultProp: defaultOpen,
            onChange: onOpenChange,
        });

        return (
            <ChainOfThoughtContext.Provider value={{ isOpen, setIsOpen }}>
                <div className={cn('not-prose max-w-prose', className)} {...props}>
                    {children}
                </div>
            </ChainOfThoughtContext.Provider>
        );
    }
);

export type ChainOfThoughtHeaderProps = ComponentProps<typeof CollapsibleTrigger> & {
    icon?: LucideIcon;
};

export const ChainOfThoughtHeader = memo(
    ({ className, children, icon: Icon = BrainIcon, ...props }: ChainOfThoughtHeaderProps) => {
        const { isOpen, setIsOpen } = useChainOfThought();

        return (
            <Collapsible onOpenChange={setIsOpen} open={isOpen}>
                <CollapsibleTrigger
                    className={cn(
                        'flex w-full items-center gap-2 text-muted-foreground text-sm transition-colors hover:text-foreground',
                        className
                    )}
                    {...props}
                >
                    <Icon className="size-4" />
                    <span className="flex-1 text-left">{children ?? 'Chain of Thought'}</span>
                </CollapsibleTrigger>
            </Collapsible>
        );
    }
);

export type ChainOfThoughtStepProps = ComponentProps<'div'> & {
    icon?: LucideIcon;
    label: string;
    description?: string;
    status?: 'complete' | 'active' | 'pending';
};

export const ChainOfThoughtStep = memo(
    ({
        className,
        icon: Icon = DotIcon,
        label,
        description,
        status = 'complete',
        children,
        ...props
    }: ChainOfThoughtStepProps) => {
        const statusStyles = {
            complete: 'text-muted-foreground',
            active: 'text-foreground',
            pending: 'text-muted-foreground/50',
        };

        return (
            <div
                className={cn(
                    'flex gap-2 text-sm',
                    statusStyles[status],
                    'fade-in-0 slide-in-from-top-2 animate-in',
                    className
                )}
                {...props}
            >
                <div className="relative mt-0.5">
                    <Icon className="size-4" />
                    <div className="-mx-px absolute top-7 bottom-0 left-1/2 w-px bg-border" />
                </div>
                <div className="flex-1 space-y-2">
                    <div>{label}</div>
                    {description && (
                        <div className="text-muted-foreground text-xs">{description}</div>
                    )}
                    {children}
                </div>
            </div>
        );
    }
);

export type ChainOfThoughtSearchResultsProps = ComponentProps<'div'>;

export const ChainOfThoughtSearchResults = memo(
    ({ className, ...props }: ChainOfThoughtSearchResultsProps) => (
        <div className={cn('flex flex-wrap items-center gap-2', className)} {...props} />
    )
);

export type ChainOfThoughtSearchResultProps = ComponentProps<typeof Badge> & {
    url?: string;
};

export const ChainOfThoughtSearchResult = memo(
    ({ className, children, url, ...props }: ChainOfThoughtSearchResultProps) => {
        return url ? (
            <a href={url} target="_blank" rel="noopener noreferrer">
                <Badge
                    className={cn('gap-1 px-2 py-0.5 font-normal text-xs', className)}
                    variant="secondary"
                    {...props}
                >
                    {children}
                </Badge>
            </a>
        ) : (
            <Badge
                className={cn('gap-1 px-2 py-0.5 font-normal text-xs', className)}
                variant="secondary"
                {...props}
            >
                {children}
            </Badge>
        );
    }
);

export type ChainOfThoughtContentProps = ComponentProps<typeof CollapsibleContent>;

export const ChainOfThoughtContent = memo(
    ({ className, children, ...props }: ChainOfThoughtContentProps) => {
        const { isOpen } = useChainOfThought();

        return (
            <Collapsible open={isOpen}>
                <CollapsibleContent
                    className={cn(
                        'mt-2 space-y-3',
                        'data-[state=closed]:fade-out-0 data-[state=closed]:slide-out-to-top-2 data-[state=open]:slide-in-from-top-2 text-popover-foreground outline-none data-[state=closed]:animate-out data-[state=open]:animate-in',
                        className
                    )}
                    {...props}
                >
                    {children}
                </CollapsibleContent>
            </Collapsible>
        );
    }
);

export type ChainOfThoughtImageProps = ComponentProps<'div'> & {
    caption?: string;
};

export const ChainOfThoughtImage = memo(
    ({ className, children, caption, ...props }: ChainOfThoughtImageProps) => (
        <div className={cn('mt-2 space-y-2', className)} {...props}>
            <div className="relative flex max-h-[22rem] items-center justify-center overflow-hidden rounded-lg bg-muted p-3">
                {children}
            </div>
            {caption && <p className="text-muted-foreground text-xs">{caption}</p>}
        </div>
    )
);

ChainOfThought.displayName = 'ChainOfThought';
ChainOfThoughtHeader.displayName = 'ChainOfThoughtHeader';
ChainOfThoughtStep.displayName = 'ChainOfThoughtStep';
ChainOfThoughtSearchResults.displayName = 'ChainOfThoughtSearchResults';
ChainOfThoughtSearchResult.displayName = 'ChainOfThoughtSearchResult';
ChainOfThoughtContent.displayName = 'ChainOfThoughtContent';
ChainOfThoughtImage.displayName = 'ChainOfThoughtImage';



================================================
FILE: src/components/ai-elements/reasoning.tsx
================================================
'use client';

import { useControllableState } from '@radix-ui/react-use-controllable-state';
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';
import { cn } from '@/lib/utils';
import { BrainIcon, ChevronDownIcon } from 'lucide-react';
import type { ComponentProps } from 'react';
import { createContext, memo, useContext, useEffect, useState } from 'react';
import { Response } from './response';

type ReasoningContextValue = {
    isStreaming: boolean;
    isOpen: boolean;
    setIsOpen: (open: boolean) => void;
    duration: number;
};

const ReasoningContext = createContext<ReasoningContextValue | null>(null);

const useReasoning = () => {
    const context = useContext(ReasoningContext);
    if (!context) {
        throw new Error('Reasoning components must be used within Reasoning');
    }
    return context;
};

export type ReasoningProps = ComponentProps<typeof Collapsible> & {
    isStreaming?: boolean;
    open?: boolean;
    defaultOpen?: boolean;
    onOpenChange?: (open: boolean) => void;
    duration?: number;
};

const AUTO_CLOSE_DELAY = 1000;
const MS_IN_S = 1000;

export const Reasoning = memo(
    ({
        className,
        isStreaming = false,
        open,
        defaultOpen = true,
        onOpenChange,
        duration: durationProp,
        children,
        ...props
    }: ReasoningProps) => {
        const [isOpen, setIsOpen] = useControllableState({
            prop: open,
            defaultProp: defaultOpen,
            onChange: onOpenChange,
        });
        const [duration, setDuration] = useControllableState({
            prop: durationProp,
            defaultProp: 0,
        });

        const [hasAutoClosed, setHasAutoClosed] = useState(false);
        const [startTime, setStartTime] = useState<number | null>(null);

        // Track duration when streaming starts and ends
        useEffect(() => {
            if (isStreaming) {
                if (startTime === null) {
                    setStartTime(Date.now());
                }
            } else if (startTime !== null) {
                setDuration(Math.ceil((Date.now() - startTime) / MS_IN_S));
                setStartTime(null);
            }
        }, [isStreaming, startTime, setDuration]);

        // Auto-open when streaming starts, auto-close when streaming ends (once only)
        useEffect(() => {
            if (defaultOpen && !isStreaming && isOpen && !hasAutoClosed) {
                // Add a small delay before closing to allow user to see the content
                const timer = setTimeout(() => {
                    setIsOpen(false);
                    setHasAutoClosed(true);
                }, AUTO_CLOSE_DELAY);

                return () => clearTimeout(timer);
            }
        }, [isStreaming, isOpen, defaultOpen, setIsOpen, hasAutoClosed]);

        const handleOpenChange = (newOpen: boolean) => {
            setIsOpen(newOpen);
        };

        return (
            <ReasoningContext.Provider value={{ isStreaming, isOpen, setIsOpen, duration }}>
                <Collapsible
                    className={cn('not-prose mb-4', className)}
                    onOpenChange={handleOpenChange}
                    open={isOpen}
                    {...props}
                >
                    {children}
                </Collapsible>
            </ReasoningContext.Provider>
        );
    }
);

export type ReasoningTriggerProps = ComponentProps<typeof CollapsibleTrigger>;

const getThinkingMessage = (isStreaming: boolean, duration?: number) => {
    if (isStreaming || duration === 0) {
        return <p>Thinking...</p>;
    }
    if (duration === undefined) {
        return <p>Thought for a few seconds</p>;
    }
    return <p>Thought for {duration} seconds</p>;
};

export const ReasoningTrigger = memo(({ className, children, ...props }: ReasoningTriggerProps) => {
    const { isStreaming, isOpen, duration } = useReasoning();

    return (
        <CollapsibleTrigger
            className={cn(
                'flex w-full items-center gap-2 text-muted-foreground text-sm transition-colors hover:text-foreground',
                className
            )}
            {...props}
        >
            {children ?? (
                <>
                    <BrainIcon className="size-4" />
                    {getThinkingMessage(isStreaming, duration)}
                    <ChevronDownIcon
                        className={cn(
                            'size-4 transition-transform',
                            isOpen ? 'rotate-180' : 'rotate-0'
                        )}
                    />
                </>
            )}
        </CollapsibleTrigger>
    );
});

export type ReasoningContentProps = ComponentProps<typeof CollapsibleContent> & {
    children: string;
};

export const ReasoningContent = memo(({ className, children, ...props }: ReasoningContentProps) => (
    <CollapsibleContent
        className={cn(
            'mt-4 text-sm',
            'data-[state=closed]:fade-out-0 data-[state=closed]:slide-out-to-top-2 data-[state=open]:slide-in-from-top-2 text-muted-foreground outline-none data-[state=closed]:animate-out data-[state=open]:animate-in',
            className
        )}
        {...props}
    >
        <Response className="grid gap-2">{children}</Response>
    </CollapsibleContent>
));

Reasoning.displayName = 'Reasoning';
ReasoningTrigger.displayName = 'ReasoningTrigger';
ReasoningContent.displayName = 'ReasoningContent';



================================================
FILE: src/components/ai-elements/response.tsx
================================================
'use client';

import { cn } from '@/lib/utils';
import { type ComponentProps, memo } from 'react';
import { Streamdown } from 'streamdown';

type ResponseProps = ComponentProps<typeof Streamdown>;

export const Response = memo(
    ({ className, ...props }: ResponseProps) => (
        <Streamdown
            className={cn('size-full [&>*:first-child]:mt-0 [&>*:last-child]:mb-0', className)}
            {...props}
        />
    ),
    (prevProps, nextProps) => prevProps.children === nextProps.children
);

Response.displayName = 'Response';



================================================
FILE: src/components/app/account-dialog.tsx
================================================
import { Button } from '@/components/ui/button';
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle,
} from '@/components/ui/dialog';
import { Link } from '@tanstack/react-router';

export function AccountDialog(props: { open: boolean; setOpen: (open: boolean) => void }) {
    return (
        <Dialog open={props.open} onOpenChange={props.setOpen}>
            <DialogContent className="p-0 overflow-hidden gap-0" showCloseButton={false}>
                <DialogHeader className="p-6 bg-background">
                    <DialogTitle>Create an account</DialogTitle>
                    <DialogDescription>
                        Create an account to gain access to additional models and reset your limits.
                    </DialogDescription>
                </DialogHeader>
                <DialogFooter className="px-6 py-4 border-t border-foreground/10 bg-sidebar">
                    <Button type="button" asChild>
                        <Link to="/login">Create account</Link>
                    </Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    );
}



================================================
FILE: src/components/app/auth.tsx
================================================
import { Button } from '@/components/ui/button';
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle,
    DialogTrigger,
} from '@/components/ui/dialog';
import { authClient } from '@/lib/auth-client';
import { useSession } from '@/hooks/use-session';
import { useNavigate } from '@tanstack/react-router';
import { useState } from 'react';

export function Anonymous({ children }: { children: React.ReactNode }) {
    const session = useSession();

    if (!session.data) {
        return null;
    }

    if (!session.data.user.isAnonymous) {
        return null;
    }

    return children;
}

export function NotAnonymous({ children }: { children: React.ReactNode }) {
    const session = useSession();

    if (!session.data) {
        return null;
    }

    if (session.data.user.isAnonymous) {
        return null;
    }

    return children;
}

export function LogoutDialog({ children }: { children: React.ReactNode }) {
    const [open, setOpen] = useState(false);
    const navigate = useNavigate();
    return (
        <Dialog open={open} onOpenChange={setOpen}>
            <DialogTrigger asChild>{children}</DialogTrigger>
            <DialogContent showCloseButton={false}>
                <DialogHeader>
                    <DialogTitle>Logout</DialogTitle>
                    <DialogDescription>Are you sure you want to logout?</DialogDescription>
                </DialogHeader>
                <DialogFooter>
                    <Button variant="outline" onClick={() => setOpen(false)}>
                        Cancel
                    </Button>
                    <Button
                        variant="destructive"
                        onClick={async () => {
                            await authClient.signOut();
                            navigate({ to: '/logged-out' });
                        }}
                    >
                        Logout
                    </Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    );
}

export function RevokeSessionDialog({
    children,
    token,
}: {
    children: React.ReactNode;
    token: string;
}) {
    const [open, setOpen] = useState(false);
    return (
        <Dialog open={open} onOpenChange={setOpen}>
            <DialogTrigger asChild>{children}</DialogTrigger>
            <DialogContent showCloseButton={false}>
                <DialogHeader>
                    <DialogTitle>Revoke Session</DialogTitle>
                    <DialogDescription>
                        Are you sure you want to revoke this session?
                    </DialogDescription>
                </DialogHeader>
                <DialogFooter>
                    <Button variant="outline" onClick={() => setOpen(false)}>
                        Cancel
                    </Button>
                    <Button
                        variant="destructive"
                        onClick={async () => {
                            await authClient.revokeSession({ token });
                            setOpen(false);
                        }}
                    >
                        Revoke
                    </Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    );
}



================================================
FILE: src/components/app/insufficient-dialog.tsx
================================================
import { Button } from '@/components/ui/button';
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle,
} from '@/components/ui/dialog';
import { Link } from '@tanstack/react-router';

export function InsufficientCreditsProDialog(props: {
    open: boolean;
    setOpen: (open: boolean) => void;
}) {
    return (
        <Dialog open={props.open} onOpenChange={props.setOpen}>
            <DialogContent className="p-0 overflow-hidden gap-0" showCloseButton={false}>
                <DialogHeader className="p-6 bg-background">
                    <DialogTitle>Insufficient credits</DialogTitle>
                    <DialogDescription>
                        You do not have enough credits to use this model. Credits are reset daily.
                    </DialogDescription>
                </DialogHeader>
                <DialogFooter className="px-6 py-4 border-t border-foreground/10 bg-sidebar">
                    <Button type="button" variant="outline" onClick={() => props.setOpen(false)}>
                        Close
                    </Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    );
}

export function InsufficientCreditsDialog(props: {
    open: boolean;
    setOpen: (open: boolean) => void;
}) {
    return (
        <Dialog open={props.open} onOpenChange={props.setOpen}>
            <DialogContent className="p-0 overflow-hidden gap-0" showCloseButton={false}>
                <DialogHeader className="p-6 bg-background">
                    <DialogTitle>Insufficient credits</DialogTitle>
                    <DialogDescription>
                        You do not have enough credits to use this model. Upgrade to PRO to get more
                        credits.
                    </DialogDescription>
                </DialogHeader>
                <DialogFooter className="px-6 py-4 border-t border-foreground/10 bg-sidebar">
                    <Button type="button" asChild>
                        <Link to="/account/subscription">Upgrade to PRO</Link>
                    </Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    );
}



================================================
FILE: src/components/app/model-selector.tsx
================================================
import { Button } from '@/components/ui/button';
import {
    Command,
    CommandEmpty,
    CommandGroup,
    CommandInput,
    CommandItem,
    CommandList,
    CommandSeparator,
} from '@/components/ui/command';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { useSettings } from '@/hooks/use-database';
import { Fragment, useEffect, useState } from 'react';

import ModelIcon, { type ModelType } from '@/components/thread/model-icon';
import { ChevronsUpDown, Pin, PinOff } from 'lucide-react';
import { useDatabase } from '@/hooks/use-database';
import { useQuery } from '@rocicorp/zero/react';
import { Model } from '@/zero/types';

import { useAccess } from '@/hooks/use-access';
import { cn } from '@/lib/utils';
import { AccountDialog } from '@/components/app/account-dialog';
import {
    InsufficientCreditsProDialog,
    InsufficientCreditsDialog,
} from '@/components/app/insufficient-dialog';
import { dialogStore } from '@/stores/dialogs';
import { CapabilityBadges } from '@/components/ui/capability-badges';

export function ModelSelector() {
    const [open, setOpen] = useState(false);
    const [showAll, setShowAll] = useState(false);
    const [hoveredModel, setHoveredModel] = useState<Model | null>(null);
    const db = useDatabase();
    const [allModels] = useQuery(db.query.model);
    const settings = useSettings();
    const pinnedModelIds = settings?.pinnedModels || [];
    const models = allModels.filter(model => pinnedModelIds.includes(model.id));
    const otherModels = allModels.filter(model => !pinnedModelIds.includes(model.id));
    const access = useAccess();
    const [accountDialogOpen, setAccountDialogOpen] = useState(false);
    const [insufficientCreditsProDialogOpen, setInsufficientCreditsProDialogOpen] = useState(false);
    const [insufficientCreditsDialogOpen, setInsufficientCreditsDialogOpen] = useState(false);
    const setProDialogOpen = dialogStore(store => store.proDialog.setOpen);

    useEffect(() => {
        if (!open) {
            setHoveredModel(null);
            setShowAll(false);
        }
    }, [open]);

    const handleSelectModel = (model: Model) => {
        setOpen(false);
        if (access.checkCanUseModel(model)) {
            if (settings) {
                db.mutate.setting.update({
                    id: settings.id,
                    modelId: model.id,
                });
            }
        } else {
            access.getCannotUseModelMatcher(model, {
                onPremiumRequired: () => {
                    setProDialogOpen(true);
                },
                onAccountRequired: () => {
                    setProDialogOpen(true);
                },
                onInsufficientCreditsPro: () => {
                    setInsufficientCreditsProDialogOpen(true);
                },
                onInsufficientCreditsNotPro: () => {
                    setInsufficientCreditsDialogOpen(true);
                },
                onInsufficientCreditsAnonymous: () => {
                    setInsufficientCreditsDialogOpen(true);
                },
            });
        }
    };

    const handleTogglePin = (modelId: string, shouldPin: boolean) => {
        if (!settings) return;
        const current = settings.pinnedModels || [];
        const activeModelCount = current.length;
        let updated: string[];
        if (shouldPin) {
            if (current.includes(modelId)) return;
            updated = [...current, modelId];
        } else {
            if (activeModelCount <= 1) {
                return; // keep at least one pinned
            }
            updated = current.filter(id => id !== modelId);
        }
        db.mutate.setting.update({ id: settings.id, pinnedModels: updated });
    };

    return (
        <Fragment>
            <Popover open={open} onOpenChange={setOpen}>
                <PopoverTrigger asChild>
                    <Button variant="ghost" aria-expanded={open}>
                        <div className="flex items-center gap-2 flex-1 ">
                            {settings?.model && (
                                <ModelIcon
                                    className="fill-primary"
                                    model={settings.model.icon as ModelType}
                                />
                            )}
                            <span className="truncate hidden md:block">
                                {settings?.model?.name}
                            </span>
                            {settings?.model?.access === 'premium_required' && (
                                <span className="text-[10px] font-medium text-primary px-2 py-0.5 rounded-full z-1 bg-primary/10">
                                    PRO
                                </span>
                            )}
                        </div>
                        <ChevronsUpDown className="opacity-50" />
                    </Button>
                </PopoverTrigger>
                <PopoverContent className={cn('p-0 relative min-w-[350px]')} align="start">
                    <Command>
                        <CommandInput placeholder="Find Model..." className="h-9" />
                        <CommandList className={cn(showAll && 'max-h-[500px]')}>
                            <CommandEmpty>No model found.</CommandEmpty>
                            {!showAll && (
                                <CommandGroup>
                                    {models?.map(model => (
                                        <CommandItem
                                            key={model.id}
                                            value={`${model.name} ${model.description}`}
                                            onMouseEnter={() => setHoveredModel(model)}
                                            onSelect={() => handleSelectModel(model)}
                                            className={cn(
                                                !access.checkCanUseModel(model) && 'opacity-50'
                                            )}
                                        >
                                            <span className="flex items-center gap-2 flex-1">
                                                {model.icon && (
                                                    <ModelIcon
                                                        className="fill-primary"
                                                        model={model.icon as ModelType}
                                                    />
                                                )}
                                                <span className="truncate">{model.name}</span>
                                                {model.access === 'premium_required' && (
                                                    <span className="text-[10px] font-medium text-primary px-2 py-0.5 rounded-full z-1 bg-primary/10">
                                                        PRO
                                                    </span>
                                                )}
                                            </span>
                                            <CapabilityBadges
                                                capabilities={model.capabilities ?? []}
                                            />
                                        </CommandItem>
                                    ))}
                                </CommandGroup>
                            )}

                            {showAll && (
                                <>
                                    <CommandGroup heading="Pinned Models">
                                        {models?.map(model => (
                                            <CommandItem
                                                key={`pinned-${model.id}`}
                                                value={`${model.name}`}
                                                onMouseEnter={() => setHoveredModel(model)}
                                                onSelect={() => handleSelectModel(model)}
                                                className={cn(
                                                    !access.checkCanUseModel(model) && 'opacity-50'
                                                )}
                                            >
                                                <span className="flex items-center gap-2 flex-1">
                                                    {model.icon && (
                                                        <ModelIcon
                                                            className="fill-primary"
                                                            model={model.icon as ModelType}
                                                        />
                                                    )}
                                                    <span className="truncate">{model.name}</span>
                                                    {model.access === 'premium_required' && (
                                                        <span className="text-[10px] font-medium text-primary px-2 py-0.5 rounded-full z-1 bg-primary/10">
                                                            PRO
                                                        </span>
                                                    )}
                                                </span>
                                                <CapabilityBadges
                                                    capabilities={model.capabilities}
                                                />
                                                <div className="flex items-center gap-2">
                                                    <Button
                                                        variant="ghost"
                                                        size="sm"
                                                        className="size-5"
                                                        onClick={e => {
                                                            e.stopPropagation();
                                                            handleTogglePin(model.id, false);
                                                        }}
                                                        aria-label="Unpin model"
                                                    >
                                                        <PinOff className="opacity-70 size-3" />
                                                    </Button>
                                                </div>
                                            </CommandItem>
                                        ))}
                                    </CommandGroup>
                                    <CommandSeparator />
                                    <CommandGroup heading="Other Models">
                                        {otherModels?.map(model => (
                                            <CommandItem
                                                key={`other-${model.id}`}
                                                value={`${model.name}`}
                                                onMouseEnter={() => setHoveredModel(model)}
                                                onSelect={() => handleSelectModel(model)}
                                                className={cn(
                                                    !access.checkCanUseModel(model) && 'opacity-50'
                                                )}
                                            >
                                                <span className="flex items-center gap-2 flex-1">
                                                    {model.icon && (
                                                        <ModelIcon
                                                            className="fill-primary"
                                                            model={model.icon as ModelType}
                                                        />
                                                    )}
                                                    <span className="truncate">{model.name}</span>
                                                    {model.access === 'premium_required' && (
                                                        <span className="text-[10px] font-medium text-primary px-2 py-0.5 rounded-full z-1 bg-primary/10">
                                                            PRO
                                                        </span>
                                                    )}
                                                </span>
                                                <CapabilityBadges
                                                    capabilities={model.capabilities}
                                                />
                                                <div className="flex items-center gap-2">
                                                    <Button
                                                        variant="ghost"
                                                        size="sm"
                                                        className="size-5"
                                                        onClick={e => {
                                                            e.stopPropagation();
                                                            handleTogglePin(model.id, true);
                                                        }}
                                                        aria-label="Pin model"
                                                    >
                                                        <Pin className="opacity-70 size-3" />
                                                    </Button>
                                                </div>
                                            </CommandItem>
                                        ))}
                                    </CommandGroup>
                                </>
                            )}
                        </CommandList>
                        <CommandSeparator />
                        <div className="flex items-center justify-between p-2">
                            <Button
                                variant="ghost"
                                size="sm"
                                className="w-full"
                                onClick={() => setShowAll(prev => !prev)}
                            >
                                {showAll ? 'Show pinned only' : 'Show all models'}
                            </Button>
                        </div>
                    </Command>
                    <div className="absolute top-0 right-0 translate-x-full pl-2 hidden md:block">
                        {hoveredModel && (
                            <div className="rounded-md flex flex-col gap-4 w-64 border border-foreground/10 overflow-hidden relative before:bg-sidebar/50 before:backdrop-blur-md before:absolute before:inset-0 before:z-[-1]">
                                <div className="flex items-center gap-2 px-2 pt-2">
                                    <ModelIcon
                                        className="size-4 fill-primary"
                                        model={hoveredModel.icon as ModelType}
                                    />
                                    <span className="text-sm">{hoveredModel.name}</span>
                                </div>
                                <div className="flex items-center gap-2 px-2">
                                    <CapabilityBadges capabilities={hoveredModel.capabilities} />
                                </div>
                                <div className="text-sm text-muted-foreground px-2">
                                    {hoveredModel.description}
                                </div>
                                <div className="flex items-center gap-2 text-sm text-muted-foreground justify-between px-2 border-t border-foreground/10 pt-4 pb-4">
                                    <div>Cost</div>
                                    <div>
                                        <span className="font-semibold">
                                            {hoveredModel.credits} credit
                                            {Number(hoveredModel.credits ?? 0) > 1 ? 's' : ''}
                                        </span>
                                        /message
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </PopoverContent>
            </Popover>
            <AccountDialog open={accountDialogOpen} setOpen={setAccountDialogOpen} />
            <InsufficientCreditsProDialog
                open={insufficientCreditsProDialogOpen}
                setOpen={setInsufficientCreditsProDialogOpen}
            />
            <InsufficientCreditsDialog
                open={insufficientCreditsDialogOpen}
                setOpen={setInsufficientCreditsDialogOpen}
            />
        </Fragment>
    );
}



================================================
FILE: src/components/app/pro-dialog.tsx
================================================
import { Anonymous, NotAnonymous } from '@/components/app/auth';
import ZeronIcon from '@/components/icons/zeron';
import ModelIcon from '@/components/thread/model-icon';
import { Button } from '@/components/ui/button';
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogHeader,
    DialogTitle,
} from '@/components/ui/dialog';
import { dialogStore } from '@/stores/dialogs';
import { Link, useLocation } from '@tanstack/react-router';
import { CheckIcon, DiamondIcon, MoveRightIcon } from 'lucide-react';
import { useEffect } from 'react';

export function ProDialog() {
    const { proDialog } = dialogStore();
    const location = useLocation();

    useEffect(() => {
        proDialog.setOpen(false);
    }, [location.pathname]);

    return (
        <Dialog open={proDialog.open} onOpenChange={proDialog.setOpen}>
            <DialogContent
                className="p-0 overflow-hidden gap-0 bg-background"
                showCloseButton={false}
            >
                <DialogHeader className="p-2">
                    <div className="relative w-full p-4 rounded-md text-white overflow-hidden">
                        <div className="absolute inset-0 bg-[url('/paywall.png')] bg-cover bg-top scale-x-[-1] rounded-sm overflow-hidden">
                            <div className="absolute inset-0 backdrop-blur-xs"></div>
                            <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,_theme(colors.yellow.300),_theme(colors.black),_theme(colors.black))] opacity-30"></div>
                        </div>
                        <div className="relative z-10 flex flex-col gap-4">
                            <DialogTitle className="flex items-center gap-2">
                                <ZeronIcon className="size-8" />
                                <span className="text-2xl font-bold">PRO</span>
                            </DialogTitle>
                            <DialogDescription asChild className="text-white/90">
                                <div>
                                    <div className="flex items-center gap-2">
                                        <span className="text-2xl font-bold">$25</span>
                                        <span className="text-sm text-white/80">/month</span>
                                    </div>
                                    <p className="text-sm text-white/70 text-left">
                                        Upgrade to PRO to unlock all features and get access to
                                        premium models and higher limits for research, search, and
                                        more.
                                    </p>
                                    <div className="flex items-center gap-2 mt-4">
                                        <ModelIcon model="openai" className="size-4" />
                                        <ModelIcon model="anthropic" className="size-4" />
                                        <ModelIcon model="gemini" className="size-4" />
                                        <ModelIcon model="grok" className="size-4" />
                                        <ModelIcon model="deepseek" className="size-4" />
                                        <span className="line-through text-white/70">$115.00</span>
                                        <MoveRightIcon className="size-3" />
                                        <span className="text-sm">$25.00</span>
                                    </div>
                                    <div className="text-xs text-white/70 mt-2 text-left">
                                        Save over 70% on chat subscriptions by using Zeron
                                    </div>
                                </div>
                            </DialogDescription>
                            <Anonymous>
                                <Button
                                    type="button"
                                    className="backdrop-blur-md bg-white/80 border border-white/10 text-black/80 hover:bg-white/90"
                                    asChild
                                >
                                    <Link to="/login" search={{ callbackUrl: '/api/checkout' }}>
                                        Get Started
                                    </Link>
                                </Button>
                            </Anonymous>
                            <NotAnonymous>
                                <Button
                                    type="button"
                                    className="backdrop-blur-md bg-white/80 border border-white/10 text-black/80 hover:bg-white/90"
                                    onClick={() => {
                                        const url = new URL(
                                            '/api/checkout',
                                            window.location.origin
                                        );
                                        url.searchParams.set(
                                            'redirectUrl',
                                            window.location.origin + '/account/subscription'
                                        );
                                        window.location.href = url.toString();
                                    }}
                                >
                                    Get Started
                                </Button>
                            </NotAnonymous>
                        </div>
                    </div>
                </DialogHeader>
                <div className="px-6 py-6 flex flex-col gap-4">
                    <div className="flex items-center gap-4">
                        <CheckIcon className="size-3" />
                        <span className="text-sm text-foreground/70">
                            Access to <span className="font-bold">PRO</span> models
                        </span>
                    </div>
                    <div className="flex items-center gap-4">
                        <CheckIcon className="size-3" />
                        <span className="text-sm text-foreground/70">Access to research tool</span>
                    </div>
                    <div className="flex items-center gap-4">
                        <CheckIcon className="size-3" />
                        <span className="text-sm text-foreground/70">Higher limits for search</span>
                    </div>
                    <div className="flex items-center gap-4">
                        <CheckIcon className="size-3" />
                        <span className="text-sm text-foreground/70">200 Credits daily</span>
                    </div>
                    <Anonymous>
                        <div className="flex gap-2 w-full items-center">
                            <div className="flex-1 border-b border-foreground/10" />
                            <p className="text-sm text-foreground/50">OR</p>
                            <div className="flex-1 border-b border-foreground/10" />
                        </div>
                        <div className="flex gap-4 text-sm text-foreground/70 items-center">
                            <DiamondIcon className="size-3" />
                            <span>
                                <Link to="/login" className="text-primary hover:underline">
                                    Create account
                                </Link>{' '}
                                to get 20 credits daily and access to more models.
                            </span>
                        </div>
                    </Anonymous>
                </div>
            </DialogContent>
        </Dialog>
    );
}



================================================
FILE: src/components/app/single-field-form.tsx
================================================
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@radix-ui/react-label';
import { FieldState, useForm } from '@tanstack/react-form';
import { Fragment } from 'react/jsx-runtime';
import z from 'zod';

const DefaultSingleFieldSchema = z.object({
    value: z.string().min(1).max(32),
});

export function SingleFieldForm(props: {
    label: string;
    description: string;
    defaultValue: string;
    footerMessage?: string;
    schema?: z.ZodSchema<{ value: string }>;
    renderInput: (props: { onChange: (value: string) => void; value: string }) => React.ReactNode;
    onSubmit: (value: string) => void | Promise<void>;
}) {
    const schema = props.schema || DefaultSingleFieldSchema;

    const form = useForm({
        defaultValues: {
            value: props.defaultValue,
        },
        validators: {
            onBlur: schema,
            onSubmit: schema,
            onMount: schema,
            onChange: schema,
        },
        onSubmit: async ({ value }) => {
            props.onSubmit(value.value);
        },
    });
    return (
        <form
            className="flex flex-col border rounded-lg overflow-hidden bg-card"
            onSubmit={e => {
                e.preventDefault();
                form.handleSubmit();
            }}
        >
            <form.Field name="value">
                {field => (
                    <Fragment>
                        <div className="flex flex-col gap-4 p-4">
                            <Label htmlFor="username" className="text-lg font-semibold">
                                {props.label}
                            </Label>
                            <p className="text-sm text-muted-foreground">{props.description}</p>
                            {props.renderInput({
                                value: field.state.value,
                                onChange: field.handleChange,
                            })}
                        </div>
                        <div className="bg-sidebar p-4 flex justify-between items-center border-t">
                            {field.state.meta.errors.length > 0 ? (
                                <p className="text-sm text-destructive">
                                    {field.state.meta.errors[0]?.message}
                                </p>
                            ) : (
                                <p className="text-sm text-muted-foreground">
                                    {props.footerMessage}
                                </p>
                            )}
                            <form.Subscribe
                                selector={state => ({
                                    isSubmitting: state.isSubmitting,
                                    isValid: state.isValid,
                                    isDirty: state.isDirty,
                                })}
                            >
                                {({ isSubmitting, isDirty, isValid }) => (
                                    <Button
                                        size="sm"
                                        type="submit"
                                        disabled={isSubmitting || !isValid || !isDirty}
                                    >
                                        <span>Save</span>
                                    </Button>
                                )}
                            </form.Subscribe>
                        </div>
                    </Fragment>
                )}
            </form.Field>
        </form>
    );
}



================================================
FILE: src/components/app/theme-selector.tsx
================================================
import { Button } from '@/components/ui/button';
import {
    Command,
    CommandEmpty,
    CommandGroup,
    CommandInput,
    CommandItem,
    CommandList,
    CommandSeparator,
} from '@/components/ui/command';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import {
    Tooltip,
    TooltipContent,
    TooltipPositioner,
    TooltipTrigger,
} from '@/components/ui/tooltip';
import { useDatabase } from '@/hooks/use-database';
import { useSettings } from '@/hooks/use-database';
import { cn } from '@/lib/utils';
import { MoonIcon, PaintBucket, SunIcon } from 'lucide-react';
import { useState } from 'react';

const themes = [
    {
        name: 'Default',
        value: 'default',
    },
    {
        name: 'T3 Chat',
        value: 't3-chat',
    },
    {
        name: 'Claymorphism',
        value: 'claymorphism',
    },
    {
        name: 'Claude',
        value: 'claude',
    },
    {
        name: 'Graphite',
        value: 'graphite',
    },
    {
        name: 'Amethyst Haze',
        value: 'amethyst-haze',
    },
    {
        name: 'Vercel',
        value: 'vercel',
    },
];

export function ThemeSelector() {
    const [open, setOpen] = useState(false);
    const settings = useSettings();
    const db = useDatabase();

    if (!settings) return null;

    const mode = settings.mode ?? 'dark';

    return (
        <Tooltip>
            <Popover open={open} onOpenChange={setOpen}>
                <TooltipTrigger
                    render={
                        <PopoverTrigger asChild>
                            <Button variant="outline" size="icon" aria-expanded={open}>
                                <PaintBucket className="size-4" />
                            </Button>
                        </PopoverTrigger>
                    }
                />
                <PopoverContent
                    className="p-0 bg-background/50 border-foreground/10 backdrop-blur-md overflow-hidden w-[250px]"
                    align="end"
                >
                    <Command>
                        <CommandInput placeholder="Search theme..." className="h-9" />
                        <CommandList>
                            <CommandEmpty>No theme found.</CommandEmpty>
                            <CommandGroup heading="Mode">
                                <CommandItem
                                    value="light"
                                    className="data-[selected=true]:bg-foreground/10 data-[selected=true]:text-foreground"
                                    onSelect={() => {
                                        db.mutate.setting.update({
                                            id: settings.id,
                                            mode: 'light',
                                        });
                                    }}
                                >
                                    <SunIcon className="size-4" />
                                    <span>Light</span>
                                    <div className="flex-1" />
                                    {settings.mode === 'light' && (
                                        <span className="text-xs text-muted-foreground">
                                            Selected
                                        </span>
                                    )}
                                </CommandItem>
                                <CommandItem
                                    value="dark"
                                    className="data-[selected=true]:bg-foreground/10 data-[selected=true]:text-foreground"
                                    onSelect={() => {
                                        db.mutate.setting.update({
                                            id: settings.id,
                                            mode: 'dark',
                                        });
                                    }}
                                >
                                    <MoonIcon className="size-4" />
                                    <span>Dark</span>
                                    <div className="flex-1" />
                                    {settings.mode === 'dark' && (
                                        <span className="text-xs text-muted-foreground">
                                            Selected
                                        </span>
                                    )}
                                </CommandItem>
                            </CommandGroup>
                            <CommandSeparator />
                            <CommandGroup heading="Theme">
                                {themes.map(themeOption => (
                                    <CommandItem
                                        key={themeOption.value}
                                        value={themeOption.name}
                                        className="data-[selected=true]:bg-foreground/10 data-[selected=true]:text-foreground"
                                        onSelect={() => {
                                            db.mutate.setting.update({
                                                id: settings.id,
                                                theme: themeOption.value,
                                            });
                                        }}
                                    >
                                        <div className="flex items-center gap-2">
                                            <div className="flex gap-1">
                                                <div
                                                    className={cn(
                                                        themeOption.value,
                                                        mode,
                                                        'size-3 rounded-[3px] bg-primary'
                                                    )}
                                                />
                                                <div
                                                    className={cn(
                                                        themeOption.value,
                                                        mode,
                                                        'size-3 rounded-[3px] bg-secondary'
                                                    )}
                                                />
                                                <div
                                                    className={cn(
                                                        themeOption.value,
                                                        mode,
                                                        'size-3 rounded-[3px] bg-accent'
                                                    )}
                                                />
                                            </div>
                                            <span>{themeOption.name}</span>
                                        </div>
                                        <div className="flex-1" />
                                        {themeOption.value === settings.theme && (
                                            <span className="text-xs text-muted-foreground">
                                                Selected
                                            </span>
                                        )}
                                    </CommandItem>
                                ))}
                            </CommandGroup>
                        </CommandList>
                    </Command>
                </PopoverContent>
            </Popover>
            <TooltipPositioner>
                <TooltipContent>
                    <p>Theme switcher</p>
                </TooltipContent>
            </TooltipPositioner>
        </Tooltip>
    );
}



================================================
FILE: src/components/app/user-menu.tsx
================================================
import { Anonymous, NotAnonymous } from '@/components/app/auth';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Button } from '@/components/ui/button';
import {
    DropdownMenu,
    DropdownMenuContent,
    DropdownMenuItem,
    DropdownMenuLabel,
    DropdownMenuSeparator,
    DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { useAccess } from '@/hooks/use-access';
import { useUser } from '@/hooks/use-database';
import { authClient } from '@/lib/auth-client';
import { getUsername } from '@/lib/usernames';
import { Link, useNavigate } from '@tanstack/react-router';
import {
    BotIcon,
    CreditCardIcon,
    LogInIcon,
    LogOutIcon,
    PaintbrushIcon,
    SettingsIcon,
    UserIcon,
} from 'lucide-react';
import { GithubIcon } from 'lucide-react';

export function UserMenu() {
    const user = useUser();
    const { isPro } = useAccess();
    const navigate = useNavigate();
    return (
        <DropdownMenu>
            <DropdownMenuTrigger className="outline-none cursor-pointer" asChild>
                <Button size="icon" variant="ghost" asChild>
                    <Avatar className="rounded-md overflow-hidden">
                        <AvatarImage className="rounded-none" src={user?.image ?? undefined} />
                        <AvatarFallback className="rounded-none">
                            {getUsername(user).charAt(0)}
                        </AvatarFallback>
                    </Avatar>
                </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent
                className="bg-background/50 border-foreground/10 w-[200px] backdrop-blur-md"
                align="end"
            >
                <DropdownMenuLabel className="flex items-center gap-2">
                    <div className="flex flex-col overflow-hidden">
                        <div className="text-sm truncate">{getUsername(user)}</div>
                        <div className="text-xs text-muted-foreground truncate">
                            {isPro ? 'Pro' : 'Free'}
                        </div>
                    </div>
                </DropdownMenuLabel>
                <DropdownMenuSeparator />
                <DropdownMenuItem asChild>
                    <Link to="/account">
                        <UserIcon className="size-4" />
                        Account
                    </Link>
                </DropdownMenuItem>
                <DropdownMenuItem asChild>
                    <Link to="/account/subscription">
                        <CreditCardIcon className="size-4" />
                        Subscription
                    </Link>
                </DropdownMenuItem>
                <DropdownMenuItem asChild>
                    <Link to="/account/preferences">
                        <SettingsIcon className="size-4" />
                        Preferences
                    </Link>
                </DropdownMenuItem>
                <DropdownMenuItem asChild>
                    <Link to="/account/models">
                        <BotIcon className="size-4" />
                        Models
                    </Link>
                </DropdownMenuItem>
                <DropdownMenuItem asChild>
                    <Link to="/account/appearance">
                        <PaintbrushIcon className="size-4" />
                        Appearance
                    </Link>
                </DropdownMenuItem>
                <DropdownMenuSeparator />
                <DropdownMenuItem asChild>
                    <a href="https://github.com/zeronsh/chat" target="_blank" rel="noreferrer">
                        <GithubIcon className="size-4" />
                        GitHub
                    </a>
                </DropdownMenuItem>
                <NotAnonymous>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem
                        onClick={async () => {
                            await authClient.signOut();
                            navigate({ to: '/logged-out' });
                        }}
                    >
                        <LogOutIcon className="size-4" />
                        Log out
                    </DropdownMenuItem>
                </NotAnonymous>
                <Anonymous>
                    <DropdownMenuSeparator />
                    <DropdownMenuItem asChild>
                        <Link to="/login">
                            <LogInIcon className="size-4" />
                            Log in
                        </Link>
                    </DropdownMenuItem>
                </Anonymous>
            </DropdownMenuContent>
        </DropdownMenu>
    );
}



================================================
FILE: src/components/icons/anthropic.tsx
================================================
import type { SVGProps } from "react";

const Icon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={245}
    height={245}
    fill="currentColor"
    viewBox="0 0 245 245"
    {...props}
  >
    <path
      fillRule="evenodd"
      d="M141.151 35.933h36.78L245 204.166h-36.781zm-74.093 0h38.455l67.069 168.233h-37.505l-13.71-35.331H51.215l-13.72 35.321H0L67.069 35.953zm42.181 101.665L86.291 78.471l-22.948 59.137h45.886z"
      clipRule="evenodd"
    />
  </svg>
);
export default Icon;



================================================
FILE: src/components/icons/claude.tsx
================================================
import type { SVGProps } from "react";

const Icon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={245}
    height={245}
    fill="currentColor"
    viewBox="0 0 245 245"
    {...props}
  >
    <path
      fillRule="evenodd"
      d="M141.151 35.933h36.78L245 204.166h-36.781zm-74.093 0h38.455l67.069 168.233h-37.505l-13.71-35.331H51.215l-13.72 35.321H0L67.069 35.953zm42.181 101.665L86.291 78.471l-22.948 59.137h45.886z"
      clipRule="evenodd"
    />
  </svg>
);
export default Icon;



================================================
FILE: src/components/icons/deepseek.tsx
================================================
import type { SVGProps } from "react";

export default function DeepSeekIcon(props: SVGProps<SVGSVGElement>) {
  return (
    <svg
      width={24}
      height={24}
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
      {...props}
    >
      <path d="M23.748 4.482c-.254-.124-.364.113-.512.234-.051.039-.094.09-.137.136-.372.397-.806.657-1.373.626-.829-.046-1.537.214-2.163.848-.133-.782-.575-1.248-1.247-1.548-.352-.156-.708-.311-.955-.65-.172-.241-.219-.51-.305-.774-.055-.16-.11-.323-.293-.35-.2-.031-.278.136-.356.276-.313.572-.434 1.202-.422 1.84.027 1.436.633 2.58 1.838 3.393.137.093.172.187.129.323-.082.28-.18.552-.266.833-.055.179-.137.217-.329.14a5.526 5.526 0 01-1.736-1.18c-.857-.828-1.631-1.742-2.597-2.458a11.365 11.365 0 00-.689-.471c-.985-.957.13-1.743.388-1.836.27-.098.093-.432-.779-.428-.872.004-1.67.295-2.687.684a3.055 3.055 0 01-.465.137 9.597 9.597 0 00-2.883-.102c-1.885.21-3.39 1.102-4.497 2.623C.082 8.606-.231 10.684.152 12.85c.403 2.284 1.569 4.175 3.36 5.653 1.858 1.533 3.997 2.284 6.438 2.14 1.482-.085 3.133-.284 4.994-1.86.47.234.962.327 1.78.397.63.059 1.236-.03 1.705-.128.735-.156.684-.837.419-.961-2.155-1.004-1.682-.595-2.113-.926 1.096-1.296 2.746-2.642 3.392-7.003.05-.347.007-.565 0-.845-.004-.17.035-.237.23-.256a4.173 4.173 0 001.545-.475c1.396-.763 1.96-2.015 2.093-3.517.02-.23-.004-.467-.247-.588zM11.581 18c-2.089-1.642-3.102-2.183-3.52-2.16-.392.024-.321.471-.235.763.09.288.207.486.371.739.114.167.192.416-.113.603-.673.416-1.842-.14-1.897-.167-1.361-.802-2.5-1.86-3.301-3.307-.774-1.393-1.224-2.887-1.298-4.482-.02-.386.093-.522.477-.592a4.696 4.696 0 011.529-.039c2.132.312 3.946 1.265 5.468 2.774.868.86 1.525 1.887 2.202 2.891.72 1.066 1.494 2.082 2.48 2.914.348.292.625.514.891.677-.802.09-2.14.11-3.054-.614zm1-6.44a.306.306 0 01.415-.287.302.302 0 01.2.288.306.306 0 01-.31.307.303.303 0 01-.304-.308zm3.11 1.596c-.2.081-.399.151-.59.16a1.245 1.245 0 01-.798-.254c-.274-.23-.47-.358-.552-.758a1.73 1.73 0 01.016-.588c.07-.327-.008-.537-.239-.727-.187-.156-.426-.199-.688-.199a.559.559 0 01-.254-.078c-.11-.054-.2-.19-.114-.358.028-.054.16-.186.192-.21.356-.202.767-.136 1.146.016.352.144.618.408 1.001.782.391.451.462.576.685.914.176.265.336.537.445.848.067.195-.019.354-.25.452z" />
    </svg>
  );
}



================================================
FILE: src/components/icons/gemini.tsx
================================================
import type { SVGProps } from "react";

const Icon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={64}
    height={64}
    viewBox="0 0 64 64"
    fill="currentColor"
    {...props}
  >
    <g clipPath="url(#gemini)">
      <path d="M32 64A38.14 38.14 0 0 0 0 32 38.14 38.14 0 0 0 32 0a38.15 38.15 0 0 0 32 32 38.15 38.15 0 0 0-32 32" />
    </g>
    <defs>
      <clipPath id="gemini">
        <path fill="#fff" d="M0 0h64v64H0z" />
      </clipPath>
    </defs>
  </svg>
);
export default Icon;



================================================
FILE: src/components/icons/google.tsx
================================================
import type { SVGProps } from "react";

const Icon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={221}
    height={221}
    fill="currentColor"
    viewBox="0 0 221 221"
    {...props}
  >
    <path d="M211.792 112.756c0-8.334-.691-14.411-2.173-20.719h-97.056v37.598h56.962c-1.141 9.337-7.339 23.407-21.124 32.864l-.193 1.253 30.682 23.297 2.118.202c19.54-17.661 30.784-43.666 30.784-74.495" />
    <path d="M112.572 211.792c27.901 0 51.327-9.006 68.445-24.54L148.401 162.5c-8.729 5.967-20.442 10.129-35.829 10.129a62.11 62.11 0 0 1-58.805-42.101l-1.215.102-31.907 24.199-.414 1.142c16.998 33.085 51.916 55.821 92.341 55.821" />
    <path d="M53.777 130.528a61.2 61.2 0 0 1-3.472-20.028c0-6.98 1.27-13.73 3.324-20.028l-.055-1.353-32.303-24.587-1.059.498A99.7 99.7 0 0 0 9.208 110.5c0 16.317 4.015 31.741 11.023 45.471z" />
    <path d="M112.572 48.372c19.411 0 32.496 8.213 39.964 15.083l29.163-27.91c-17.91-16.318-41.226-26.336-69.127-26.336-40.434 0-75.343 22.735-92.341 55.82l33.426 25.443a62.34 62.34 0 0 1 58.915-42.1" />
  </svg>
);
export default Icon;



================================================
FILE: src/components/icons/grok.tsx
================================================
import type { SVGProps } from "react";

const Icon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={64}
    height={64}
    viewBox="0 0 64 64"
    fill="currentColor"
    {...props}
  >
    <g clipPath="url(#grok)">
      <path
        fillRule="evenodd"
        d="m24.72 40.773 21.275-15.725c1.042-.773 2.533-.472 3.032.725 2.613 6.318 1.445 13.907-3.76 19.118-5.203 5.21-12.446 6.352-19.064 3.749l-7.23 3.352c10.371 7.096 22.963 5.341 30.832-2.541 6.243-6.251 8.176-14.771 6.368-22.454l.016.019c-2.621-11.285.646-15.797 7.334-25.021q.24-.327.477-.662l-8.803 8.814v-.027L24.712 40.779m-4.384 3.816c-7.445-7.12-6.16-18.136.19-24.491 4.695-4.701 12.391-6.621 19.109-3.8l7.213-3.333c-1.5-1.103-3.14-2-4.877-2.667a23.93 23.93 0 0 0-26.006 5.243c-6.754 6.762-8.88 17.162-5.232 26.037 2.726 6.632-1.741 11.323-6.24 16.059C2.888 59.323 1.288 61 0 62.776l20.32-18.173"
        clipRule="evenodd"
      />
    </g>
    <defs>
      <clipPath id="grok">
        <path fill="#fff" d="M0 0h64v64H0z" />
      </clipPath>
    </defs>
  </svg>
);
export default Icon;



================================================
FILE: src/components/icons/meta.tsx
================================================
import * as React from "react";
import type { SVGProps } from "react";

export default function MetaIcon(props: SVGProps<SVGSVGElement>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width={192}
      height={192}
      viewBox="0 0 192 192"
      fill="currentColor"
      {...props}
    >
      <g clipPath="url(#meta)">
        <path d="M55.176 32h-.192l-.248 20.92h.176c13.72 0 24.368 10.856 47.52 49.968l1.4 2.376.096.16 12.96-19.504-.096-.152a390 390 0 0 0-8.784-13.728 224 224 0 0 0-9.4-13.032C83.304 39.456 70.504 32 55.176 32" />
        <path d="M54.984 32C39.6 32.08 25.976 42.064 16.16 57.36l-.08.136 18.032 9.848.088-.136c5.744-8.664 12.88-14.192 20.544-14.28h.168L55.168 32z" />
        <path d="m16.152 57.36-.088.136C9.6 67.576 4.784 79.96 2.192 93.312l-.04.176 20.272 4.8.032-.176c2.16-11.736 6.288-22.624 11.648-30.76l.088-.136z" />
        <path d="m22.456 98.112-20.264-4.8-.04.176A119 119 0 0 0 0 115.776v.184l20.784 1.864v-.184a100.7 100.7 0 0 1 1.68-19.52z" />
        <path d="M21.416 124.296a44 44 0 0 1-.632-6.504v-.176L0 115.744v.192a71 71 0 0 0 1.168 13.216l20.28-4.68z" />
        <path d="M26.16 135.12c-2.272-2.48-3.872-6.048-4.712-10.624l-.032-.168-20.28 4.68.032.168c1.536 8.08 4.544 14.8 8.848 19.896l.112.136 16.144-13.96c-.04-.042-.072-.085-.112-.128" />
        <path d="M86.24 77.232c-12.224 18.8-19.632 30.6-19.632 30.6-16.28 25.6-21.912 31.336-30.968 31.336a12.37 12.37 0 0 1-9.488-4.064l-16.136 13.952.112.136C16.08 156.144 24.464 160 34.848 160c15.704 0 26.992-7.424 47.072-42.64l14.128-25.04a330 330 0 0 0-9.808-15.088" />
        <path d="m108.016 47.568-.128.128c-3.2 3.44-6.288 7.264-9.28 11.328 3.024 3.864 6.144 8.192 9.4 13.04 3.84-5.944 7.424-10.76 10.936-14.456l.128-.128z" />
        <path d="M167.344 45.704C158.824 37.064 148.664 32 137.8 32c-11.456 0-21.096 6.296-29.784 15.552l-.128.128 11.056 9.92.128-.136c5.72-5.976 11.264-8.96 17.408-8.96 6.608 0 12.8 3.12 18.16 8.6l.12.128 12.712-11.4z" />
        <path d="M191.984 113c-.48-27.736-10.16-52.528-24.512-67.168l-.128-.128-12.704 11.392.12.128c10.8 11.136 18.216 31.84 18.888 55.768v.184h18.336z" />
        <path d="M191.984 113.2v-.184h-18.336v.176c.032 1.12.048 2.256.048 3.392 0 6.52-.968 11.792-2.944 15.6l-.088.176 13.664 14.256.104-.16c4.96-7.68 7.568-18.344 7.568-31.28 0-.664 0-1.32-.016-1.976" />
        <path d="m170.752 132.16-.088.16c-1.712 3.216-4.152 5.36-7.336 6.296l6.224 19.696a28 28 0 0 0 3.504-1.456 28.46 28.46 0 0 0 10.928-9.744l.352-.52.096-.16z" />
        <path d="M159.36 139.144c-2.096 0-3.936-.312-5.744-1.12l-6.384 20.176c3.592 1.224 7.416 1.776 11.68 1.776 3.936 0 7.544-.584 10.816-1.72l-6.24-19.696c-1.336.4-2.72.6-4.128.584" />
        <path d="m146.584 132.272-.112-.136-14.688 15.312.128.136c5.096 5.456 9.968 8.84 15.496 10.696l6.376-20.16c-2.328-1-4.584-2.824-7.2-5.848" />
        <path d="M146.472 132.12c-4.4-5.136-9.856-13.696-18.424-27.52L116.88 85.912l-.088-.16-12.96 19.504.096.16 7.912 13.344c7.672 12.88 13.92 22.192 19.944 28.68l.128.128 14.672-15.312z" />
      </g>
      <defs>
        <clipPath id="meta">
          <path fill="#fff" d="M0 0h192v192H0z" />
        </clipPath>
      </defs>
    </svg>
  );
}



================================================
FILE: src/components/icons/mistral.tsx
================================================
import * as React from "react";
import type { SVGProps } from "react";

const Icon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={64}
    height={64}
    viewBox="0 0 64 64"
    fill="currentColor"
    {...props}
  >
    <g clipPath="url(#mistral)">
      <path d="M9.141 9.067h9.144v9.141H9.141zm36.571 0h9.147v9.141h-9.147z" />
      <path d="M9.141 18.208h18.286v9.144H9.144zm27.43 0h18.285v9.144H36.571z" />
      <path d="M9.141 27.355H54.86v9.141H9.14z" />
      <path d="M9.141 36.496h9.144v9.141H9.141zm18.288 0h9.144v9.141H27.43zm18.283 0h9.147v9.141h-9.147z" />
      <path d="M0 45.637h27.43v9.144H0zm36.57 0H64v9.144H36.57z" />
    </g>
    <defs>
      <clipPath id="mistral">
        <path fill="#fff" d="M0 0h64v64H0z" />
      </clipPath>
    </defs>
  </svg>
);
export default Icon;



================================================
FILE: src/components/icons/moonshot.tsx
================================================
export default function MoonshotIcon(props: React.SVGProps<SVGSVGElement>) {
    return (
        <svg
            fill="currentColor"
            fillRule="evenodd"
            height={24}
            viewBox="0 0 24 24"
            width={24}
            xmlns="http://www.w3.org/2000/svg"
            {...props}
        >
            <title>MoonshotAI</title>
            <path d="M1.052 16.916l9.539 2.552a21.007 21.007 0 00.06 2.033l5.956 1.593a11.997 11.997 0 01-5.586.865l-.18-.016-.044-.004-.084-.009-.094-.01a11.605 11.605 0 01-.157-.02l-.107-.014-.11-.016a11.962 11.962 0 01-.32-.051l-.042-.008-.075-.013-.107-.02-.07-.015-.093-.019-.075-.016-.095-.02-.097-.023-.094-.022-.068-.017-.088-.022-.09-.024-.095-.025-.082-.023-.109-.03-.062-.02-.084-.025-.093-.028-.105-.034-.058-.019-.08-.026-.09-.031-.066-.024a6.293 6.293 0 01-.044-.015l-.068-.025-.101-.037-.057-.022-.08-.03-.087-.035-.088-.035-.079-.032-.095-.04-.063-.028-.063-.027a5.655 5.655 0 01-.041-.018l-.066-.03-.103-.047-.052-.024-.096-.046-.062-.03-.084-.04-.086-.044-.093-.047-.052-.027-.103-.055-.057-.03-.058-.032a6.49 6.49 0 01-.046-.026l-.094-.053-.06-.034-.051-.03-.072-.041-.082-.05-.093-.056-.052-.032-.084-.053-.061-.039-.079-.05-.07-.047-.053-.035a7.785 7.785 0 01-.054-.036l-.044-.03-.044-.03a6.066 6.066 0 01-.04-.028l-.057-.04-.076-.054-.069-.05-.074-.054-.056-.042-.076-.057-.076-.059-.086-.067-.045-.035-.064-.052-.074-.06-.089-.073-.046-.039-.046-.039a7.516 7.516 0 01-.043-.037l-.045-.04-.061-.053-.07-.062-.068-.06-.062-.058-.067-.062-.053-.05-.088-.084a13.28 13.28 0 01-.099-.097l-.029-.028-.041-.042-.069-.07-.05-.051-.05-.053a6.457 6.457 0 01-.168-.179l-.08-.088-.062-.07-.071-.08-.042-.049-.053-.062-.058-.068-.046-.056a7.175 7.175 0 01-.027-.033l-.045-.055-.066-.082-.041-.052-.05-.064-.02-.025a11.99 11.99 0 01-1.44-2.402zm-1.02-5.794l11.353 3.037a20.468 20.468 0 00-.469 2.011l10.817 2.894a12.076 12.076 0 01-1.845 2.005L.657 15.923l-.016-.046-.035-.104a11.965 11.965 0 01-.05-.153l-.007-.023a11.896 11.896 0 01-.207-.741l-.03-.126-.018-.08-.021-.097-.018-.081-.018-.09-.017-.084-.018-.094c-.026-.141-.05-.283-.071-.426l-.017-.118-.011-.083-.013-.102a12.01 12.01 0 01-.019-.161l-.005-.047a12.12 12.12 0 01-.034-2.145zm1.593-5.15l11.948 3.196c-.368.605-.705 1.231-1.01 1.875l11.295 3.022c-.142.82-.368 1.612-.668 2.365l-11.55-3.09L.124 10.26l.015-.1.008-.049.01-.067.015-.087.018-.098c.026-.148.056-.295.088-.442l.028-.124.02-.085.024-.097c.022-.09.045-.18.07-.268l.028-.102.023-.083.03-.1.025-.082.03-.096.026-.082.031-.095a11.896 11.896 0 011.01-2.232zm4.442-4.4L17.352 4.59a20.77 20.77 0 00-1.688 1.721l7.823 2.093c.267.852.442 1.744.513 2.665L2.106 5.213l.045-.065.027-.04.04-.055.046-.065.055-.076.054-.072.064-.086.05-.065.057-.073.055-.07.06-.074.055-.069.065-.077.054-.066.066-.077.053-.06.072-.082.053-.06.067-.074.054-.058.073-.078.058-.06.063-.067.168-.17.1-.098.059-.056.076-.071a12.084 12.084 0 012.272-1.677zM12.017 0h.097l.082.001.069.001.054.002.068.002.046.001.076.003.047.002.06.003.054.002.087.005.105.007.144.011.088.007.044.004.077.008.082.008.047.005.102.012.05.006.108.014.081.01.042.006.065.01.207.032.07.012.065.011.14.026.092.018.11.022.046.01.075.016.041.01L14.7.3l.042.01.065.015.049.012.071.017.096.024.112.03.113.03.113.032.05.015.07.02.078.024.073.023.05.016.05.016.076.025.099.033.102.036.048.017.064.023.093.034.11.041.116.045.1.04.047.02.06.024.041.018.063.026.04.018.057.025.11.048.1.046.074.035.075.036.06.028.092.046.091.045.102.052.053.028.049.026.046.024.06.033.041.022.052.029.088.05.106.06.087.051.057.034.053.032.096.059.088.055.098.062.036.024.064.041.084.056.04.027.062.042.062.043.023.017c.054.037.108.075.161.114l.083.06.065.048.056.043.086.065.082.064.04.03.05.041.086.069.079.065.085.071c.712.6 1.353 1.283 1.909 2.031L7.222.994l.062-.027.065-.028.081-.034.086-.035c.113-.045.227-.09.341-.131l.096-.035.093-.033.084-.03.096-.031c.087-.03.176-.058.264-.085l.091-.027.086-.025.102-.03.085-.023.1-.026L9.04.37l.09-.023.091-.022.095-.022.09-.02.098-.021.091-.02.095-.018.092-.018.1-.018.091-.016.098-.017.092-.014.097-.015.092-.013.102-.013.091-.012.105-.012.09-.01.105-.01c.093-.01.186-.018.28-.024l.106-.008.09-.005.11-.006.093-.004.1-.004.097-.002.099-.002.197-.002z"></path>
        </svg>
    );
}



================================================
FILE: src/components/icons/ollama.tsx
================================================
import * as React from "react";
import type { SVGProps } from "react";

const Icon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={64}
    height={64}
    viewBox="0 0 64 64"
    fill="currentColor"
    {...props}
  >
    <path d="M32 8C18.745 8 8 18.745 8 32s10.745 24 24 24 24-10.745 24-24S45.255 8 32 8zm0 4c11.046 0 20 8.954 20 20s-8.954 20-20 20-20-8.954-20-20 8.954-20 20-20z" />
    <circle cx="32" cy="32" r="12" />
    <circle cx="32" cy="32" r="6" fill="white" />
  </svg>
);
export default Icon;



================================================
FILE: src/components/icons/openai.tsx
================================================
import * as React from "react";
import type { SVGProps } from "react";

const Icon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={64}
    height={64}
    viewBox="0 0 64 64"
    fill="currentColor"
    {...props}
  >
    <path
      fillRule="evenodd"
      d="M57.467 26.677a14.44 14.44 0 0 0-1.275-12.002C52.947 9.1 46.427 6.232 40.059 7.58a14.9 14.9 0 0 0-11.176-4.914c-6.51-.014-12.286 4.122-14.288 10.234a14.8 14.8 0 0 0-9.902 7.088 14.63 14.63 0 0 0 1.843 17.334 14.44 14.44 0 0 0 1.272 12.005c3.245 5.573 9.765 8.44 16.133 7.093a14.9 14.9 0 0 0 11.174 4.912c6.514.016 12.293-4.122 14.296-10.24A14.8 14.8 0 0 0 59.317 44a14.63 14.63 0 0 0-1.848-17.325zM35.117 57.5a11.2 11.2 0 0 1-7.133-2.544c.09-.048.248-.134.352-.198l11.84-6.746a1.89 1.89 0 0 0 .97-1.662V29.88l5.006 2.85a.18.18 0 0 1 .096.134v13.64c-.008 6.064-4.987 10.981-11.13 10.995M11.18 47.413a10.82 10.82 0 0 1-1.328-7.368c.085.054.24.147.349.208L22.04 47c.6.347 1.344.347 1.947 0l14.453-8.235v5.702a.18.18 0 0 1-.072.152L26.4 51.435c-5.33 3.029-12.139 1.226-15.219-4.027zM8.06 21.91a11.07 11.07 0 0 1 5.8-4.816l-.005.403v13.493a1.9 1.9 0 0 0 .97 1.664l14.454 8.232-5.003 2.854a.18.18 0 0 1-.168.013l-11.97-6.824c-5.32-3.04-7.144-9.755-4.08-15.013zm41.112 9.44L34.72 23.115l5.003-2.848a.18.18 0 0 1 .168-.016l11.97 6.818c5.328 3.04 7.155 9.766 4.078 15.022a11.1 11.1 0 0 1-5.798 4.818V33.013a1.89 1.89 0 0 0-.968-1.661zm4.979-7.394q-.175-.106-.352-.208L41.96 17a1.95 1.95 0 0 0-1.944 0l-14.453 8.235v-5.702a.18.18 0 0 1 .072-.152L37.6 12.568c5.333-3.032 12.147-1.227 15.219 4.035a10.87 10.87 0 0 1 1.333 7.352m-31.31 10.16-5.005-2.848a.17.17 0 0 1-.096-.136V17.49c.003-6.072 4.995-10.992 11.15-10.987 2.602 0 5.12.901 7.122 2.544a10 10 0 0 0-.349.195l-11.84 6.746a1.89 1.89 0 0 0-.973 1.662l-.008 16.461zm2.72-5.782L32 24.667l6.437 3.666v7.334L32 39.333l-6.44-3.666v-7.334z"
      clipRule="evenodd"
    />
  </svg>
);
export default Icon;



================================================
FILE: src/components/icons/openrouter.tsx
================================================
import * as React from "react";
import type { SVGProps } from "react";

const OpenRouterIcon = (props: SVGProps<SVGSVGElement>) => (
  <svg
    fill="currentColor"
    fillRule="evenodd"
    height={64}
    width={64}
    viewBox="0 0 64 64"
    xmlns="http://www.w3.org/2000/svg"
    {...props}
  >
    <path
      fillRule="evenodd"
      d="M42.01 4.893l18.05 10.263v0.218l-18.235 10.153 0.043-5.293-2.053-0.075c-2.648-0.07-4.028 0.005-5.67 0.275-2.66 0.438-5.095 1.443-7.868 3.38l-5.415 3.743c-0.71 0.488-1.238 0.84-1.7 1.138l-1.288 0.805-0.993 0.585 0.963 0.575 1.325 0.845c1.19 0.785 2.925 1.99 6.753 4.665 2.775 1.938 5.208 2.943 7.868 3.38l0.75 0.113c1.735 0.228 3.438 0.235 7.063 0.083l0.055-5.398 18.05 10.263v0.218L41.473 55l0.035-4.655-1.588 0.055c-3.465 0.105-5.343 0.005-7.845-0.405-4.235-0.7-8.15-2.315-12.203-5.148l-5.395-3.75a54.993 54.993 0 01-1.888-1.245l-1.168-0.7a139.818 139.818 0 01-1.9-1.075C7.27 36.825 1.408 35.29 0 35.29V24.72l0.35 0.01c1.41-0.018 7.275-1.555 9.523-2.81l2.54-1.45 1.095-0.685c1.07-0.7 2.68-1.815 6.715-4.633 4.053-2.833 7.965-4.45 12.203-5.148 2.88-0.475 4.935-0.533 9.535-0.345l0.05-4.768z"
      clipRule="evenodd"
    ></path>
  </svg>
);
export default OpenRouterIcon;



================================================
FILE: src/components/icons/qwen.tsx
================================================
import * as React from 'react';
import type { SVGProps } from 'react';

export default function QwenIcon(props: SVGProps<SVGSVGElement>) {
    return (
        <svg
            className="h-full w-full"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            {...props}
        >
            <title>Qwen</title>
            <path d="M12.604 1.34c.393.69.784 1.382 1.174 2.075a.18.18 0 00.157.091h5.552c.174 0 .322.11.446.327l1.454 2.57c.19.337.24.478.024.837-.26.43-.513.864-.76 1.3l-.367.658c-.106.196-.223.28-.04.512l2.652 4.637c.172.301.111.494-.043.77-.437.785-.882 1.564-1.335 2.34-.159.272-.352.375-.68.37-.777-.016-1.552-.01-2.327.016a.099.099 0 00-.081.05 575.097 575.097 0 01-2.705 4.74c-.169.293-.38.363-.725.364-.997.003-2.002.004-3.017.002a.537.537 0 01-.465-.271l-1.335-2.323a.09.09 0 00-.083-.049H4.982c-.285.03-.553-.001-.805-.092l-1.603-2.77a.543.543 0 01-.002-.54l1.207-2.12a.198.198 0 000-.197 550.951 550.951 0 01-1.875-3.272l-.79-1.395c-.16-.31-.173-.496.095-.965.465-.813.927-1.625 1.387-2.436.132-.234.304-.334.584-.335a338.3 338.3 0 012.589-.001.124.124 0 00.107-.063l2.806-4.895a.488.488 0 01.422-.246c.524-.001 1.053 0 1.583-.006L11.704 1c.341-.003.724.032.9.34zm-3.432.403a.06.06 0 00-.052.03L6.254 6.788a.157.157 0 01-.135.078H3.253c-.056 0-.07.025-.041.074l5.81 10.156c.025.042.013.062-.034.063l-2.795.015a.218.218 0 00-.2.116l-1.32 2.31c-.044.078-.021.118.068.118l5.716.008c.046 0 .08.02.104.061l1.403 2.454c.046.081.092.082.139 0l5.006-8.76.783-1.382a.055.055 0 01.096 0l1.424 2.53a.122.122 0 00.107.062l2.763-.02a.04.04 0 00.035-.02.041.041 0 000-.04l-2.9-5.086a.108.108 0 010-.113l.293-.507 1.12-1.977c.024-.041.012-.062-.035-.062H9.2c-.059 0-.073-.026-.043-.077l1.434-2.505a.107.107 0 000-.114L9.225 1.774a.06.06 0 00-.053-.031zm6.29 8.02c.046 0 .058.02.034.06l-.832 1.465-2.613 4.585a.056.056 0 01-.05.029.058.058 0 01-.05-.029L8.498 9.841c-.02-.034-.01-.052.028-.054l.216-.012 6.722-.012z"></path>
        </svg>
    );
}



================================================
FILE: src/components/icons/x.tsx
================================================
export default function XIcon(props: React.SVGProps<SVGSVGElement>) {
  return (
    <svg
      role="img"
      viewBox="0 0 24 24"
      width={24}
      height={24}
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
      {...props}
    >
      <title>X</title>
      <path
        fillRule="evenodd"
        d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"
        clipRule="evenodd"
      />
    </svg>
  );
}



================================================
FILE: src/components/icons/xai.tsx
================================================
import * as React from "react";
import type { SVGProps } from "react";

export default function XaiIcon(props: SVGProps<SVGSVGElement>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
      fillRule="evenodd"
      height={24}
      viewBox="0 0 24 24"
      width={24}
      {...props}
    >
      <title>Grok</title>
      <path d="M6.469 8.776L16.512 23h-4.464L2.005 8.776H6.47zm-.004 7.9l2.233 3.164L6.467 23H2l4.465-6.324zM22 2.582V23h-3.659V7.764L22 2.582zM22 1l-9.952 14.095-2.233-3.163L17.533 1H22z" />
    </svg>
  );
}



================================================
FILE: src/components/icons/zai.tsx
================================================
import * as React from 'react';
import type { SVGProps } from 'react';

export default function ZaiIcon(props: SVGProps<SVGSVGElement>) {
    return (
        <svg
            xmlns="http://www.w3.org/2000/svg"
            version="1.1"
            viewBox="0 0 2000 1700"
            fill="currentColor"
            className="h-full w-full"
            {...props}
        >
            <polygon points="1008.73 0 827.29 251.03 54.43 251.03 235.74 0 1008.73 0"></polygon>
            <polygon points="1937.79 1449.1 1756.47 1700 986.3 1700 1167.48 1449.1 1937.79 1449.1"></polygon>
            <polygon points="2000 0 771.98 1700 0 1700 1228.02 0 2000 0"></polygon>
        </svg>
    );
}



================================================
FILE: src/components/icons/zeron.tsx
================================================
import * as React from 'react';
import type { SVGProps } from 'react';

export default function ZeronIcon(props: SVGProps<SVGSVGElement>) {
    return (
        <svg
            viewBox="0 0 605 355"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
            {...props}
        >
            <circle cx="177.5" cy="52.5" r="52" fill="currentColor" />
            <circle cx="302.5" cy="52.5" r="52.5" fill="currentColor" />
            <circle cx="177.5" cy="177.5" r="52.5" fill="currentColor" />
            <circle cx="427.5" cy="177.5" r="52.5" fill="currentColor" />
            <circle cx="302.5" cy="302.5" r="52.5" fill="currentColor" />
            <circle cx="52.5" cy="302.5" r="52.5" fill="currentColor" />
            <circle cx="427.5" cy="302.5" r="52.5" fill="currentColor" />
            <circle cx="552.5" cy="177.5" r="52.5" fill="currentColor" />
            <circle cx="552.5" cy="302.5" r="52.5" fill="currentColor" />
            <circle cx="552.5" cy="177.5" r="52.5" fill="currentColor" />
            <circle cx="552.5" cy="302.5" r="52.5" fill="currentColor" />
            <circle cx="552.5" cy="52.5" r="52.5" fill="currentColor" />
            <circle cx="177.5" cy="52.5" r="52" fill="currentColor" />
            <circle cx="177.5" cy="177.5" r="52.5" fill="currentColor" />
            <circle cx="52.5" cy="52.5" r="52" fill="currentColor" />
            <circle cx="52.5" cy="177.5" r="52.5" fill="currentColor" />
        </svg>
    );
}



================================================
FILE: src/components/layout/app-sidebar.tsx
================================================
import { Button } from '@/components/ui/button';
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle,
} from '@/components/ui/dialog';

import {
    Sidebar,
    SidebarContent,
    SidebarGroup,
    SidebarGroupContent,
    SidebarGroupLabel,
    SidebarHeader,
    SidebarMenu,
    SidebarMenuButton,
    SidebarMenuItem,
} from '@/components/ui/sidebar';
import {
    Tooltip,
    TooltipContent,
    TooltipPositioner,
    TooltipTrigger,
} from '@/components/ui/tooltip';
import { useDatabase, useThreads } from '@/hooks/use-database';
import { useThreadsByTimeRange } from '@/hooks/use-chats-by-time-range';
import { Thread } from '@/zero/types';
import { Link, useNavigate, useParams } from '@tanstack/react-router';
import { Loader2Icon, PencilIcon, PlusIcon, TrashIcon } from 'lucide-react';
import { useCallback, useEffect, useState } from 'react';
import { Fragment } from 'react/jsx-runtime';
import { useForm } from '@tanstack/react-form';
import z from 'zod';
import { Label } from '@/components/ui/label';
import ZeronIcon from '../icons/zeron';

export function AppSidebar() {
    const [threadToEdit, setThreadToEdit] = useState<Thread | null>(null);
    const [threadToDelete, setThreadToDelete] = useState<Thread | null>(null);

    return (
        <Sidebar>
            <AppSidebarHeader />
            <SidebarContent>
                <AppSidebarActions />
                <AppSidebarThreads
                    setThreadToEdit={setThreadToEdit}
                    setThreadToDelete={setThreadToDelete}
                />
            </SidebarContent>
            <AppSidebarKeyboardShortcuts />
            <EditThreadTitleDialog thread={threadToEdit} setThreadToEdit={setThreadToEdit} />
            <DeleteThreadDialog thread={threadToDelete} setThreadToDelete={setThreadToDelete} />
        </Sidebar>
    );
}

function AppSidebarHeader() {
    return (
        <SidebarHeader className="p-3">
            <Button variant="ghost" size="icon" asChild>
                <Link to="/">
                    <ZeronIcon className="size-6" />
                </Link>
            </Button>
        </SidebarHeader>
    );
}

function AppSidebarActions() {
    return (
        <SidebarGroup>
            <SidebarGroupContent>
                <SidebarMenu>
                    <SidebarMenuItem>
                        <SidebarMenuButton asChild>
                            <Link to="/">
                                <PlusIcon />
                                <span className="flex-1">New Thread</span>
                            </Link>
                        </SidebarMenuButton>
                    </SidebarMenuItem>
                </SidebarMenu>
            </SidebarGroupContent>
        </SidebarGroup>
    );
}

function AppSidebarKeyboardShortcuts() {
    const navigate = useNavigate();
    const params = useParams({ from: '/_app/_thread/$threadId', shouldThrow: false });
    const threads = useThreads();

    const onHandleKeyDown = useCallback(
        (e: KeyboardEvent) => {
            const isMeta = navigator.platform.toLowerCase().includes('mac') ? e.metaKey : e.ctrlKey;
            if (e.shiftKey && isMeta && (e.key === 'o' || e.key === 'O')) {
                e.preventDefault();
                e.stopPropagation();
                navigate({ to: '/' });
                return;
            }
            if (e.shiftKey && (e.key === 'ArrowUp' || e.key === 'ArrowDown')) {
                e.preventDefault();
                e.stopPropagation();

                if (threads.length === 0) return;

                const currentThreadId = params?.threadId;
                const currentIndex = threads.findIndex(thread => thread.id === currentThreadId);

                let nextIndex: number;
                if (e.key === 'ArrowUp') {
                    nextIndex = currentIndex <= 0 ? threads.length - 1 : currentIndex - 1;
                } else {
                    nextIndex = currentIndex >= threads.length - 1 ? 0 : currentIndex + 1;
                }

                const nextThread = threads[nextIndex];
                if (nextThread) {
                    navigate({
                        to: '/$threadId',
                        params: { threadId: nextThread.id },
                    });
                }
            }
        },
        [threads, params?.threadId, navigate]
    );

    useEffect(() => {
        const activeEl = document.querySelector(
            '[data-thread-active="true"]'
        ) as HTMLElement | null;
        if (!activeEl) return;

        const getScrollParent = (el: HTMLElement | null): HTMLElement | null => {
            let parent = el?.parentElement;
            while (parent) {
                const style = window.getComputedStyle(parent);
                const hasScrollableContent = parent.scrollHeight > parent.clientHeight;
                const overflowY = style.overflowY;
                if (hasScrollableContent && (overflowY === 'auto' || overflowY === 'scroll')) {
                    return parent;
                }
                parent = parent.parentElement;
            }
            return (document.scrollingElement as HTMLElement) ?? null;
        };

        const container = getScrollParent(activeEl);
        if (!container) return;

        const isFullyVisible = () => {
            const elRect = activeEl.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            return elRect.top >= containerRect.top && elRect.bottom <= containerRect.bottom;
        };

        if (!isFullyVisible()) {
            activeEl.scrollIntoView({ block: 'start', inline: 'nearest', behavior: 'instant' });
        }
    }, [params?.threadId, threads]);

    useEffect(() => {
        document.addEventListener('keydown', onHandleKeyDown);
        return () => document.removeEventListener('keydown', onHandleKeyDown);
    }, [onHandleKeyDown]);

    return null;
}

function AppSidebarThreads({
    setThreadToEdit,
    setThreadToDelete,
}: {
    setThreadToEdit: (thread: Thread | null) => void;
    setThreadToDelete: (thread: Thread | null) => void;
}) {
    const threads = useThreads();
    const groups = useThreadsByTimeRange(threads);

    return (
        <Fragment>
            <ThreadGroup
                threads={groups.today}
                label="Today"
                setThreadToEdit={setThreadToEdit}
                setThreadToDelete={setThreadToDelete}
            />
            <ThreadGroup
                threads={groups.yesterday}
                label="Yesterday"
                setThreadToEdit={setThreadToEdit}
                setThreadToDelete={setThreadToDelete}
            />
            <ThreadGroup
                threads={groups.lastThirtyDays}
                label="Last 30 Days"
                setThreadToEdit={setThreadToEdit}
                setThreadToDelete={setThreadToDelete}
            />
            <ThreadGroup
                threads={groups.history}
                label="History"
                setThreadToEdit={setThreadToEdit}
                setThreadToDelete={setThreadToDelete}
            />
            <p className="text-sm text-muted-foreground/50 p-4">
                You've reached the end of your threads.
            </p>
        </Fragment>
    );
}

function ThreadGroup({
    threads,
    label,
    setThreadToEdit,
    setThreadToDelete,
}: {
    threads: Thread[];
    label: string;
    setThreadToEdit: (thread: Thread) => void;
    setThreadToDelete: (thread: Thread) => void;
}) {
    if (threads.length === 0) return null;
    return (
        <SidebarGroup>
            <SidebarGroupLabel>{label}</SidebarGroupLabel>
            <SidebarGroupContent>
                <SidebarMenu>
                    {threads.map(thread => (
                        <ThreadItem
                            key={thread.id}
                            thread={thread}
                            setThreadToEdit={setThreadToEdit}
                            setThreadToDelete={setThreadToDelete}
                        />
                    ))}
                </SidebarMenu>
            </SidebarGroupContent>
        </SidebarGroup>
    );
}

function ThreadItem({
    thread,
    setThreadToEdit,
    setThreadToDelete,
}: {
    thread: Thread;
    setThreadToEdit: (thread: Thread) => void;
    setThreadToDelete: (thread: Thread) => void;
}) {
    const navigate = useNavigate();
    return (
        <SidebarMenuItem>
            <SidebarMenuButton asChild>
                <div className="group/thread-item relative">
                    <Link
                        to="/$threadId"
                        className="w-full flex absolute inset-0 items-center px-2 rounded-md gap-2"
                        params={{ threadId: thread.id }}
                        activeOptions={{ exact: true }}
                        activeProps={{ className: 'bg-muted', 'data-thread-active': 'true' }}
                        onMouseDown={e => {
                            e.preventDefault();
                            e.stopPropagation();
                            if (e.button === 0) {
                                navigate({
                                    to: '/$threadId',
                                    params: { threadId: thread.id },
                                });
                            }
                        }}
                    >
                        <span className="truncate flex-1">{thread.title}</span>
                        {(thread.status === 'streaming' || thread.status === 'submitted') && (
                            <Loader2Icon className="size-4 animate-spin text-muted-foreground" />
                        )}
                    </Link>
                    <div className="absolute top-0 right-0 bottom-0 pointer-events-none flex justify-end gap-2 px-4 items-center group-hover/thread-item:opacity-100 opacity-0 transition-all duration-100 bg-gradient-to-l from-sidebar to-transparent w-full rounded-r-md" />
                    <div className="absolute top-0 right-0 bottom-0 flex justify-end gap-2 px-2 items-center group-hover/thread-item:opacity-100 group-hover/thread-item:translate-x-0 translate-x-full opacity-0 transition-all duration-100 rounded-r-lg pointer-events-none group-hover/thread-item:pointer-events-auto">
                        <Tooltip>
                            <TooltipTrigger
                                render={
                                    <Button
                                        variant="ghost"
                                        size="icon"
                                        className="size-6 hover:text-primary hover:bg-transparent"
                                        onClick={() => setThreadToEdit(thread)}
                                    >
                                        <PencilIcon className="size-4" />
                                    </Button>
                                }
                            />
                            <TooltipPositioner className="pointer-events-none">
                                <TooltipContent>Edit Thread Title</TooltipContent>
                            </TooltipPositioner>
                        </Tooltip>
                        <Tooltip>
                            <TooltipTrigger
                                render={
                                    <Button
                                        variant="ghost"
                                        size="icon"
                                        className="size-6 hover:text-primary"
                                        onClick={() => setThreadToDelete(thread)}
                                    >
                                        <TrashIcon className="size-4" />
                                    </Button>
                                }
                            />
                            <TooltipPositioner className="pointer-events-none">
                                <TooltipContent>Delete Thread</TooltipContent>
                            </TooltipPositioner>
                        </Tooltip>
                    </div>
                </div>
            </SidebarMenuButton>
        </SidebarMenuItem>
    );
}

const editThreadTitleSchema = z.object({
    title: z.string().min(1).max(200),
});

function EditThreadTitleDialog({
    thread,
    setThreadToEdit,
}: {
    thread: Thread | null;
    setThreadToEdit: (thread: Thread | null) => void;
}) {
    const db = useDatabase();
    const form = useForm({
        defaultValues: {
            title: thread?.title ?? '',
        },
        validators: {
            onMount: editThreadTitleSchema,
            onChange: editThreadTitleSchema,
            onSubmit: editThreadTitleSchema,
        },
        onSubmit: async ({ value }) => {
            if (!thread) return;

            await db.mutate.thread.update({
                id: thread.id,
                title: value.title,
            });
            setThreadToEdit(null);
        },
    });

    return (
        <Dialog open={!!thread} onOpenChange={() => setThreadToEdit(null)}>
            <DialogContent className="p-0 overflow-hidden gap-0" showCloseButton={false}>
                <DialogHeader className="p-6 bg-sidebar border-b border-foreground/10">
                    <DialogTitle>Edit Thread Title</DialogTitle>
                    <DialogDescription>Edit the title of the thread.</DialogDescription>
                </DialogHeader>
                <form
                    onSubmit={async e => {
                        e.preventDefault();
                        e.stopPropagation();
                        form.handleSubmit();
                    }}
                >
                    <div className="grid gap-4 px-6 py-4 bg-background">
                        <div className="grid gap-2">
                            <form.Field
                                name="title"
                                validators={{
                                    onChange: ({ value }) => {
                                        if (value.length === 0) return 'Title is required';
                                        if (value.length > 100)
                                            return 'Title must be less than 100 characters';
                                    },
                                }}
                            >
                                {field => (
                                    <>
                                        <Label>Title</Label>
                                        <input
                                            className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                                            value={field.state.value}
                                            onChange={e => field.handleChange(e.target.value)}
                                        />
                                        {field.state.meta.errors ? (
                                            <p className="text-sm text-destructive">
                                                {field.state.meta.errors.join(', ')}
                                            </p>
                                        ) : null}
                                    </>
                                )}
                            </form.Field>
                        </div>
                    </div>
                    <DialogFooter className="px-6 py-4 border-t border-foreground/10 bg-sidebar">
                        <Button
                            type="button"
                            variant="outline"
                            onClick={() => setThreadToEdit(null)}
                        >
                            Cancel
                        </Button>
                        <form.Subscribe
                            selector={state => [state.canSubmit, state.isSubmitting]}
                            children={([canSubmit, isSubmitting]) => (
                                <Button
                                    type="submit"
                                    disabled={!canSubmit || isSubmitting}
                                    onClick={() => form.handleSubmit()}
                                >
                                    {isSubmitting && (
                                        <Loader2Icon className="w-4 h-4 animate-spin" />
                                    )}
                                    <span>Save</span>
                                </Button>
                            )}
                        />
                    </DialogFooter>
                </form>
            </DialogContent>
        </Dialog>
    );
}

function DeleteThreadDialog({
    thread,
    setThreadToDelete,
}: {
    thread: Thread | null;
    setThreadToDelete: (thread: Thread | null) => void;
}) {
    const db = useDatabase();
    const params = useParams({ from: '/_app/_thread/$threadId', shouldThrow: false });

    const navigate = useNavigate();

    async function handleDelete() {
        if (!thread) return;
        await db.mutate.thread.delete({ id: thread.id });
        if (params?.threadId === thread.id) {
            navigate({ to: '/' });
        }
        setThreadToDelete(null);
    }

    return (
        <Dialog open={!!thread} onOpenChange={() => setThreadToDelete(null)}>
            <DialogContent className="p-0 overflow-hidden gap-0" showCloseButton={false}>
                <DialogHeader className="p-6 bg-background">
                    <DialogTitle>Delete Thread</DialogTitle>
                    <DialogDescription>
                        Are you sure you want to delete this thread? This action cannot be undone.
                    </DialogDescription>
                </DialogHeader>

                <DialogFooter className="px-6 py-4 border-t border-foreground/10 bg-sidebar">
                    <Button type="button" variant="outline" onClick={() => setThreadToDelete(null)}>
                        Cancel
                    </Button>
                    <Button type="button" variant="destructive" onClick={handleDelete}>
                        Delete
                    </Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    );
}



================================================
FILE: src/components/layout/header.tsx
================================================
import { UserMenu } from '@/components/app/user-menu';
import { ThemeSelector } from '@/components/app/theme-selector';
import { ModelSelector } from '@/components/app/model-selector';
import { SidebarTrigger } from '@/components/ui/sidebar';
import { cn } from '@/lib/utils';
import { useParamsThreadId } from '@/hooks/use-params-thread-id';
import { useThreadSelector } from '@/context/thread';

export function Header() {
    const threadId = useParamsThreadId();
    const toolSidebar = useThreadSelector(state => state.toolSidebar);

    return (
        <div
            className={cn(
                threadId && 'border-b',
                !toolSidebar && '2xl:border-none 2xl:bg-transparent 2xl:backdrop-blur-none',
                'bg-background/50 border-foreground/10 backdrop-blur-md absolute top-0 left-0 right-0 z-10 flex justify-between'
            )}
        >
            <div className="flex items-center gap-2 p-3">
                <SidebarTrigger />
                <ModelSelector />
            </div>
            <div className="flex items-center gap-2 p-3">
                <ThemeSelector />
                <UserMenu />
            </div>
        </div>
    );
}



================================================
FILE: src/components/layout/tool-sidebar.tsx
================================================
import { Button } from '@/components/ui/button';
import {
    Sidebar,
    SidebarContent,
    SidebarHeader,
    SidebarProvider,
    useSidebar,
} from '@/components/ui/sidebar';
import { Skeleton } from '@/components/ui/skeleton';
import { useThreadSelector } from '@/context/thread';
import { motion } from 'framer-motion';
import { Brain, CheckIcon, SearchIcon, X } from 'lucide-react';
import { useEffect, useMemo } from 'react';
import { StickToBottom } from 'use-stick-to-bottom';

export function ToolSidebar() {
    return (
        <SidebarProvider
            className="w-fit"
            defaultOpen={false}
            style={
                {
                    '--sidebar-width': '300px',
                } as React.CSSProperties
            }
        >
            <ToolSidebarBody />
        </SidebarProvider>
    );
}

function ToolSidebarBody() {
    const sidebar = useSidebar();
    const toolSidebar = useThreadSelector(state => state.toolSidebar);

    useEffect(() => {
        if (!sidebar.isMobile) {
            sidebar.setOpen(!!toolSidebar);
        } else {
            sidebar.setOpenMobile(!!toolSidebar);
        }
    }, [toolSidebar, sidebar.setOpen, sidebar.setOpenMobile, sidebar.isMobile]);

    return (
        <Sidebar side="right">
            <ToolSidebarHeader />
            <ToolSidebarContent />
        </Sidebar>
    );
}

function ToolSidebarHeader() {
    const tool = useThreadSelector(state => state.toolSidebar?.tool);
    const setToolSidebar = useThreadSelector(state => state.setToolSidebar);
    const title = useMemo(() => {
        switch (tool) {
            case 'search':
                return 'Search Results';
            case 'research':
                return 'Research Results';
            default:
                return null;
        }
    }, [tool]);

    return (
        <SidebarHeader className="absolute top-0 left-0 right-0 flex flex-row p-3 justify-between items-center border-b border-foreground/10 bg-sidebar/50 backdrop-blur-md z-10">
            <h3 className="text-lg font-semibold flex gap-2 items-center">{title}</h3>
            <Button variant="ghost" size="icon" onClick={() => setToolSidebar(undefined)}>
                <X className="size-4" />
            </Button>
        </SidebarHeader>
    );
}

function ToolSidebarContent() {
    const tool = useThreadSelector(state => state.toolSidebar?.tool);
    const messageId = useThreadSelector(state => state.toolSidebar?.messageId);
    const setToolSidebar = useThreadSelector(state => state.setToolSidebar);
    const messageExists = useThreadSelector(state => messageId && !!state.messageMap[messageId]);

    useEffect(() => {
        if (!messageExists) {
            setToolSidebar(undefined);
        }
    }, [messageExists, setToolSidebar]);

    if (!messageExists) {
        return null;
    }

    switch (tool) {
        case 'search':
            return (
                <SidebarContent className="px-2 pt-16 pb-2">
                    <SearchToolSidebarContent />
                </SidebarContent>
            );
        case 'research':
            return (
                <StickToBottom initial="instant" className="absolute inset-0">
                    <StickToBottom.Content className="px-2 pt-16 pb-2">
                        <ResearchToolSidebarContent />
                    </StickToBottom.Content>
                </StickToBottom>
            );
        default:
            return null;
    }
}

function SearchToolSidebarContent() {
    const toolSidebar = useThreadSelector(state => state.toolSidebar!);
    const toolCall = useThreadSelector(state =>
        state.messageMap[toolSidebar.messageId].parts.find(
            part => part.type === 'tool-search' && part.toolCallId === toolSidebar.toolCallId
        )
    );

    if (!toolCall || toolCall.type !== 'tool-search') {
        return null;
    }

    if (!toolCall.output) {
        return Array.from({ length: 10 }).map((_, i) => (
            <motion.div
                key={i}
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                transition={{ duration: 0.2 * (i + 1) }}
                className="flex flex-col gap-2 p-3 rounded-lg"
            >
                <Skeleton className="h-3 w-3/4" />
                <Skeleton className="h-3 w-full" />
                <Skeleton className="h-3 w-full" />
                <Skeleton className="h-3 w-full" />
                <div className="flex items-center gap-2 mt-3">
                    <Skeleton className="w-4 h-4 rounded-full" />
                    <Skeleton className="h-3 w-2/3" />
                </div>
            </motion.div>
        ));
    }

    const results = toolCall.output.results;

    return results.map((result, i) => {
        let hostname = 'example.com';
        try {
            const url = new URL(result.url);
            hostname = url.hostname || 'example.com';
        } catch {
            hostname = 'example.com';
        }
        return (
            <motion.a
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                transition={{ duration: 0.2 * (i + 1) }}
                key={result.url}
                className="flex flex-col gap-2 p-3 rounded-lg hover:bg-muted"
                href={result.url}
                target="_blank"
                rel="noopener noreferrer"
            >
                <div className="text-xs font-medium">{result.title}</div>
                <div className="text-xs text-muted-foreground">
                    {result.description.slice(0, 100)}...
                </div>
                <div className="flex items-center gap-2 text-xs text-muted-foreground mt-3">
                    <img
                        src={`https://www.google.com/s2/favicons?domain=${hostname}&sz=16`}
                        alt={result.title ?? 'favicon'}
                        className="w-4 h-4 rounded-sm"
                        onError={e => {
                            // Fallback to a generic icon if favicon fails to load
                            e.currentTarget.src =
                                "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cline x1='12' y1='8' x2='12' y2='16'/%3E%3Cline x1='8' y1='12' x2='16' y2='12'%3E%3C/svg%3E";
                        }}
                    />
                    <span className="truncate">{result.url}</span>
                </div>
            </motion.a>
        );
    });
}

function ResearchToolSidebarContent() {
    const toolSidebar = useThreadSelector(state => state.toolSidebar!);

    const researchParts = useThreadSelector(state =>
        state.messageMap[toolSidebar.messageId].parts
            .filter(
                part =>
                    part.type === 'data-research-start' ||
                    part.type === 'data-research-search' ||
                    part.type === 'data-research-read' ||
                    part.type === 'data-research-complete'
            )
            .filter(part => part.data.toolCallId === toolSidebar.toolCallId)
    );

    return researchParts.map(part => {
        switch (part.type) {
            case 'data-research-start':
                return (
                    <div className="flex flex-col gap-4 rounded-lg p-2">
                        <div className="text-xs text-muted-foreground">{part.data.thoughts}</div>
                        <div className="flex items-center gap-2 text-xs text-muted-foreground">
                            <Brain className="size-3 text-primary" />
                            <span>Created research plan</span>
                        </div>
                    </div>
                );
            case 'data-research-search':
                return (
                    <div className="flex flex-col gap-4 rounded-lg p-2">
                        <div className="text-xs text-muted-foreground">{part.data.thoughts}</div>
                        <div className="flex items-center gap-2 text-xs text-muted-foreground">
                            <SearchIcon className="size-3 flex-shrink-0 text-primary" />
                            <span className="truncate">Searched for {part.data.query}</span>
                        </div>
                    </div>
                );
            case 'data-research-read':
                let hostname = 'example.com';
                try {
                    const url = new URL(part.data.url);
                    hostname = url.hostname || 'example.com';
                } catch {
                    hostname = 'example.com';
                }

                return (
                    <div className="flex flex-col gap-4 rounded-lg p-2">
                        <div className="text-xs text-muted-foreground">{part.data.thoughts}</div>
                        <div className="flex items-center gap-2 text-xs text-muted-foreground">
                            <img
                                src={`https://www.google.com/s2/favicons?domain=${hostname}&sz=16`}
                                alt={hostname}
                                className="w-3 h-3 rounded-sm"
                                onError={e => {
                                    e.currentTarget.src =
                                        "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M9 12h6'/%3E%3Cpath d='M12 9v6'/%3E%3C/svg%3E";
                                }}
                            />
                            <span className="truncate">
                                Read{' '}
                                <a
                                    href={part.data.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="underline text-primary"
                                >
                                    {part.data.url}
                                </a>
                            </span>
                        </div>
                    </div>
                );
            case 'data-research-complete':
                return (
                    <div className="flex flex-col gap-4 rounded-lg p-2">
                        <div className="flex items-center gap-2 text-xs text-muted-foreground">
                            <CheckIcon className="size-3 text-primary" />
                            <span>Completed research</span>
                        </div>
                    </div>
                );
            default:
                return null;
        }
    });
}



================================================
FILE: src/components/meta/title.tsx
================================================
export function Title({ title }: { title?: string | null }) {
    return <title>{title ?? 'Zeron'}</title>;
}



================================================
FILE: src/components/thread/file-attachment.tsx
================================================
import { useState } from 'react';
import { cn } from '@/lib/utils';
import { FileText, LoaderIcon, X } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { createPortal } from 'react-dom';

interface FileAttachmentProps {
    url: string;
    name?: string;
    mediaType: string;
    onRemove?: () => void;
    className?: string;
}

export function FileAttachment({ url, name, mediaType, onRemove, className }: FileAttachmentProps) {
    const [isLoading, setIsLoading] = useState(true);
    const [hasError, setHasError] = useState(false);
    const [imageLoaded, setImageLoaded] = useState(false);
    const [isFullScreen, setIsFullScreen] = useState(false);

    const isImage = mediaType.startsWith('image/');
    const isPdf = mediaType === 'application/pdf';

    const handleImageLoad = () => {
        setIsLoading(false);
        setImageLoaded(true);
    };

    const handleImageError = () => {
        setIsLoading(false);
        setHasError(true);
    };

    if (hasError) {
        return (
            <div
                className={cn(
                    'relative h-24 w-24 bg-destructive/10 border border-destructive/20 rounded-2xl flex items-center justify-center',
                    className
                )}
            >
                <div className="flex flex-col items-center gap-1 text-center p-2 w-full">
                    <FileText className="size-6 text-destructive" />
                    <p className="text-destructive text-xs truncate w-full max-w-full text-center">
                        {name}
                    </p>
                </div>
                {onRemove && (
                    <Button
                        variant="ghost"
                        size="icon"
                        className="absolute -top-2 -right-2 h-6 w-6 rounded-full bg-background border shadow-sm hover:bg-destructive hover:text-destructive-foreground"
                        onClick={onRemove}
                    >
                        <X className="size-3" />
                    </Button>
                )}
            </div>
        );
    }

    if (isImage) {
        return (
            <>
                <div
                    className={cn(
                        'relative h-24 w-24 rounded-2xl bg-muted/50 cursor-pointer',
                        className
                    )}
                    onClick={() => setIsFullScreen(true)}
                >
                    {isLoading && (
                        <div className="absolute inset-0 flex items-center justify-center bg-muted/50">
                            <LoaderIcon className="size-6 animate-spin" />
                        </div>
                    )}
                    <img
                        src={url}
                        alt={name}
                        className={cn(
                            'h-full w-full object-cover transition-opacity duration-200 rounded-2xl',
                            imageLoaded ? 'opacity-100' : 'opacity-0'
                        )}
                        onLoad={handleImageLoad}
                        onError={handleImageError}
                    />
                    {onRemove && (
                        <Button
                            variant="ghost"
                            size="icon"
                            className="absolute -top-2 -right-2 h-6 w-6 rounded-full bg-background border shadow-sm hover:bg-destructive hover:text-destructive-foreground z-0"
                            onClick={e => {
                                e.stopPropagation();
                                onRemove();
                            }}
                        >
                            <X className="size-3" />
                        </Button>
                    )}
                </div>

                {isFullScreen &&
                    createPortal(
                        <div
                            className="fixed inset-0 z-[9999] bg-background/50 backdrop-blur-sm"
                            onClick={() => setIsFullScreen(false)}
                        >
                            <div className="absolute inset-0 flex items-center justify-center p-4">
                                <img
                                    src={url}
                                    alt={name}
                                    className="max-h-full max-w-full object-contain rounded-lg"
                                />
                            </div>

                            <Button
                                variant="ghost"
                                size="icon"
                                className="absolute top-4 right-4 h-10 w-10 rounded-full bg-black/50 text-white hover:bg-black/70"
                                onClick={() => setIsFullScreen(false)}
                            >
                                <X className="size-6" />
                            </Button>
                        </div>,
                        document.body
                    )}
            </>
        );
    }

    if (isPdf) {
        return (
            <div
                className={cn(
                    'relative h-24 w-24 bg-muted/50 border rounded-2xl flex items-center justify-center',
                    className
                )}
            >
                <div className="flex flex-col items-center gap-3 text-center p-2 w-full">
                    <FileText className="size-6 text-muted-foreground" />
                    <p className="text-muted-foreground text-xs truncate w-full max-w-full text-center">
                        {name}
                    </p>
                </div>
                {onRemove && (
                    <Button
                        variant="outline"
                        size="icon"
                        className="absolute -top-2 -right-2 h-6 w-6 rounded-full bg-background border shadow-sm hover:bg-destructive hover:text-destructive-foreground"
                        onClick={onRemove}
                    >
                        <X className="size-3" />
                    </Button>
                )}
            </div>
        );
    }

    // Default file type
    return (
        <div
            className={cn(
                'relative h-24 w-24 bg-muted/50 border rounded-2xl flex items-center justify-center',
                className
            )}
        >
            <div className="flex flex-col items-center gap-1 text-center p-2 w-full">
                <FileText className="size-6 text-muted-foreground" />
                <p className="text-muted-foreground text-xs truncate w-full max-w-full text-center">
                    {name}
                </p>
            </div>
            {onRemove && (
                <Button
                    variant="ghost"
                    size="icon"
                    className="absolute -top-2 -right-2 h-6 w-6 rounded-full bg-background border shadow-sm hover:bg-destructive hover:text-destructive-foreground"
                    onClick={onRemove}
                >
                    <X className="size-3" />
                </Button>
            )}
        </div>
    );
}



================================================
FILE: src/components/thread/file-drop-area.tsx
================================================
import { cn } from '@/lib/utils';
import { useState } from 'react';
import { FileWithPath, useDropzone } from 'react-dropzone';
import { useAccess } from '@/hooks/use-access';

type FileDropAreaProps = {
    className?: string;
    onUpload: (files: FileList) => Promise<void>;
    children: React.ReactNode;
    overlayText?: string;
};

export function FileDropArea({
    onUpload,
    children,
    overlayText = 'Drop files here',
    className,
}: FileDropAreaProps) {
    const [isDragActive, setIsDragActive] = useState(false);

    const { canModelViewFiles } = useAccess();

    const onDrop = async (accepted: FileWithPath[]) => {
        setIsDragActive(false);
        const dataTransfer = new DataTransfer();
        accepted.forEach(file => dataTransfer.items.add(file));
        await onUpload(dataTransfer.files);
    };

    const { getRootProps, getInputProps } = useDropzone({
        onDrop,
        accept: {
            'image/*': [],
            'application/pdf': [],
            'text/plain': [],
        },
        onDragEnter: () => setIsDragActive(true),
        onDragLeave: () => setIsDragActive(false),
        noClick: true,
        noKeyboard: true,
        disabled: !canModelViewFiles,
    });

    return (
        <div {...getRootProps()} className={cn('relative flex flex-col flex-1', className)}>
            <input {...getInputProps()} />

            {children}

            {isDragActive && (
                <div className="absolute inset-0 flex size-full items-center justify-center border-none bg-background/50 p-0 backdrop-blur transition-opacity duration-200 ease-out z-10 rounded-3xl">
                    <p className="font-medium text-sm">{overlayText}</p>
                </div>
            )}
        </div>
    );
}



================================================
FILE: src/components/thread/model-icon.tsx
================================================
import AnthropicIcon from '@/components/icons/anthropic';
import ClaudeIcon from '@/components/icons/claude';
import DeepseekIcon from '@/components/icons/deepseek';
import GeminiIcon from '@/components/icons/gemini';
import GoogleIcon from '@/components/icons/google';
import GrokIcon from '@/components/icons/grok';
import MetaIcon from '@/components/icons/meta';
import MistralIcon from '@/components/icons/mistral';
import OllamaIcon from '@/components/icons/ollama';
import OpenAIIcon from '@/components/icons/openai';
import OpenRouterIcon from '@/components/icons/openrouter';
import XIcon from '@/components/icons/x';
import XAIIcon from '@/components/icons/xai';
import MoonshotIcon from '@/components/icons/moonshot';
import ZaiIcon from '@/components/icons/zai';
import QwenIcon from '@/components/icons/qwen';
import type { SVGProps } from 'react';

export type ModelType =
    | 'anthropic'
    | 'claude'
    | 'deepseek'
    | 'gemini'
    | 'google'
    | 'grok'
    | 'meta'
    | 'mistral'
    | 'ollama'
    | 'openai'
    | 'openrouter'
    | 'x'
    | 'xai'
    | 'zai'
    | 'moonshot'
    | 'qwen'
    | string;

interface ModelIconProps extends SVGProps<SVGSVGElement> {
    model: ModelType;
}

const ModelIcon = ({ model, ...props }: ModelIconProps) => {
    const icons: Record<ModelType, React.ComponentType<SVGProps<SVGSVGElement>>> = {
        anthropic: AnthropicIcon,
        claude: ClaudeIcon,
        deepseek: DeepseekIcon,
        gemini: GeminiIcon,
        google: GoogleIcon,
        grok: GrokIcon,
        meta: MetaIcon,
        mistral: MistralIcon,
        ollama: OllamaIcon,
        openai: OpenAIIcon,
        openrouter: OpenRouterIcon,
        x: XIcon,
        xai: XAIIcon,
        zai: ZaiIcon,
        moonshot: MoonshotIcon,
        qwen: QwenIcon,
    };

    const Icon = icons[model];

    if (!Icon) {
        return null;
    }

    return <Icon {...props} />;
};

export default ModelIcon;



================================================
FILE: src/components/thread/multi-modal-input.tsx
================================================
import { Button } from '@/components/ui/button';
import {
    PromptInput,
    PromptInputTextarea,
    PromptInputActions,
    PromptInputAction,
} from '@/components/ui/prompt-input';
import {
    SquareIcon,
    ArrowUpIcon,
    GlobeIcon,
    Paperclip,
    LoaderIcon,
    TelescopeIcon,
    EditIcon,
    XIcon,
    AlertTriangleIcon,
    MessageCircleIcon,
} from 'lucide-react';
import { motion } from 'framer-motion';
import { useNavigate } from '@tanstack/react-router';
import { useParamsThreadId } from '@/hooks/use-params-thread-id';
import { cn } from '@/lib/utils';
import { useUploadThing } from '@/lib/uploadthing';
import { useEffect, useMemo, useRef } from 'react';
import { FileAttachment } from './file-attachment';
import { toast } from 'sonner';
import { useThreadContext, useThreadSelector } from '@/context/thread';
import type { FileAttachment as FileAttachmentType } from '@/thread/store';
import { useAccess } from '@/hooks/use-access';
import { match, P } from 'ts-pattern';
import { ScrollToBottomButton } from '@/components/thread/scroll-to-bottom-button';
import { dialogStore } from '@/stores/dialogs';
import { useUser } from '@/hooks/use-database';
import { getUsername } from '@/lib/usernames';

export function MultiModalInput() {
    const id = useThreadSelector(state => state.id!);
    const status = useThreadSelector(state => state.status);
    const input = useThreadSelector(state => state.input);
    const tool = useThreadSelector(state => state.tool);
    const attachments = useThreadSelector(state => state.attachments);
    const pendingFileCount = useThreadSelector(state => state.pendingFileCount);
    const setPendingFileCount = useThreadSelector(state => state.setPendingFileCount);
    const setAttachments = useThreadSelector(state => state.setAttachments);
    const setInput = useThreadSelector(state => state.setInput);
    const setTool = useThreadSelector(state => state.setTool);
    const setEditingMessageId = useThreadSelector(state => state.setEditingMessageId);
    const editingMessageId = useThreadSelector(state => state.editingMessageId);
    const setMessages = useThreadSelector(state => state.setMessages);
    const setProDialogOpen = dialogStore(store => store.proDialog.setOpen);
    const user = useUser();
    const { sendMessage } = useThreadContext();

    const { startUpload } = useUploadThing('fileUploader', {
        onBeforeUploadBegin: file => {
            setPendingFileCount(prev => prev + 1);
            return file;
        },
        onClientUploadComplete: files => {
            setPendingFileCount(prev => prev - files.length);
            const newAttachments: FileAttachmentType[] = files.map(file => ({
                type: 'file' as const,
                url: file.ufsUrl,
                filename: file.name,
                mediaType: file.type,
            }));
            setAttachments([...attachments, ...newAttachments]);
        },
        onUploadError: error => {
            toast.error(error.message);
            setPendingFileCount(prev => prev - 1);
        },
    });

    const fileInputRef = useRef<HTMLInputElement>(null);
    const threadId = useParamsThreadId();
    const navigate = useNavigate();

    const handleFileUpload = async (files: FileList | null) => {
        if (!files || files.length === 0) return;
        await startUpload(Array.from(files));
    };

    const handlePaperclipClick = () => {
        fileInputRef.current?.click();
    };

    const handleSubmit = async () => {
        if (!input?.trim()) return;

        await navigate({
            to: '/$threadId',
            params: {
                threadId: id,
            },
            replace: Boolean(threadId),
        });

        if (editingMessageId) {
            setMessages(prev =>
                prev.slice(
                    0,
                    prev.findIndex(message => message.id === editingMessageId)
                )
            );
        }

        sendMessage(
            {
                id: editingMessageId,
                role: 'user',
                parts: [
                    ...attachments,
                    {
                        type: 'text',
                        text: input,
                    },
                ],
            },
            {
                body: {
                    tool: tool || undefined,
                },
            }
        );

        // Reset form state
        setInput('');
        setAttachments([]);
        setTool('');
        setEditingMessageId(undefined);
    };

    const {
        isPro,
        isExpiring,
        remainingCredits,
        remainingSearches,
        remainingResearches,
        canSearch,
        canResearch,
        canUseModel,
        cannotUseModelReason,
        canModelUseTools,
        canModelViewFiles,
    } = useAccess();

    const matcher = useMemo(() => {
        return match({
            isPro,
            isExpiring,
            remainingCredits,
            remainingSearches,
            remainingResearches,
            canSearch,
            canResearch,
            status,
            attachments,
            tool,
            input,
            pendingFileCount,
            canUseModel,
            canModelUseTools,
            canModelViewFiles,
        });
    }, [
        isPro,
        isExpiring,
        remainingCredits,
        remainingSearches,
        remainingResearches,
        canSearch,
        canResearch,
        status,
        attachments,
        tool,
        input,
        pendingFileCount,
        canUseModel,
        canModelUseTools,
        canModelViewFiles,
    ]);

    useEffect(() => {
        if (!canModelUseTools) {
            setTool('');
        }
    }, [canModelUseTools]);

    return (
        <motion.form
            layoutId="multi-modal-input"
            transition={{ type: 'spring', stiffness: 1000, damping: 40 }}
            className={cn({
                'absolute px-4 pt-4 flex flex-col gap-4': true,
                'bottom-0 left-0 right-0': true,
                'top-[25vh]': !threadId,
            })}
            onSubmit={async e => {
                e.preventDefault();
                if (status === 'streaming' || status === 'submitted') {
                    await fetch(`/api/thread/${id}/stop`, {
                        method: 'POST',
                        credentials: 'include',
                    });
                } else {
                    await handleSubmit();
                }
            }}
        >
            {!threadId && (
                <motion.div
                    className="max-w-3xl mx-auto font-serif"
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ duration: 0.5 }}
                >
                    <h2 className="text-2xl">Hello, {getUsername(user)}</h2>
                </motion.div>
            )}
            <ScrollToBottomButton variant="default" />
            <PromptInput
                className="max-w-3xl mx-auto p-0 bg-muted/50 backdrop-blur-md w-full border-foreground/10 overflow-hidden"
                value={input}
                onValueChange={setInput}
                onSubmit={handleSubmit}
            >
                {match({ editingMessageId, remainingCredits, isPro })
                    .with(
                        {
                            remainingCredits: P.number.lte(0),
                            isPro: false,
                            editingMessageId: P.nullish,
                        },
                        () => (
                            <div className="flex justify-between items-center px-3 py-3 bg-sidebar/30 backdrop-blur-md text-xs text-muted-foreground border-b border-foreground/10">
                                <div className="flex items-center gap-2">
                                    <AlertTriangleIcon className="size-4 " />
                                    <p>You have no credits remaining.</p>
                                </div>
                                <Button
                                    variant="link"
                                    className="h-6 underline font-normal cursor-pointer px-0 text-xs"
                                    onClick={() => setProDialogOpen(true)}
                                >
                                    Subscribe now to increase your limits
                                </Button>
                            </div>
                        )
                    )
                    .with(
                        {
                            remainingCredits: P.number.lt(10),
                            isPro: false,
                            editingMessageId: P.nullish,
                        },
                        () => (
                            <div className="flex justify-between items-center px-3 py-3 bg-sidebar/30 backdrop-blur-md text-xs text-muted-foreground border-b border-foreground/10">
                                <div className="flex items-center gap-2">
                                    <AlertTriangleIcon className="size-4 " />
                                    <p>
                                        You only have {remainingCredits} credit
                                        {remainingCredits === 1 ? '' : 's'} remaining.
                                    </p>
                                </div>
                                <Button
                                    variant="link"
                                    className="h-6 underline font-normal cursor-pointer px-0 text-xs"
                                    onClick={() => setProDialogOpen(true)}
                                >
                                    Subscribe now to increase your limits
                                </Button>
                            </div>
                        )
                    )
                    .with(
                        {
                            remainingCredits: P.number.lte(0),
                            isPro: true,
                            editingMessageId: P.nullish,
                        },
                        () => (
                            <div className="flex justify-between items-center px-3 py-3 bg-sidebar/30 backdrop-blur-md text-xs text-muted-foreground border-b border-foreground/10">
                                <div className="flex items-center gap-2">
                                    <AlertTriangleIcon className="size-4 " />
                                    <p>You have no credits remaining.</p>
                                </div>
                                <p className="text-xs text-primary">Resets daily</p>
                            </div>
                        )
                    )
                    .with(
                        {
                            remainingCredits: P.number.lt(10),
                            isPro: true,
                            editingMessageId: P.nullish,
                        },
                        () => (
                            <div className="flex justify-between items-center px-3 py-3 bg-sidebar/30 backdrop-blur-md text-xs text-muted-foreground border-b border-foreground/10">
                                <div className="flex items-center gap-2">
                                    <AlertTriangleIcon className="size-4 " />
                                    <p>
                                        You only have {remainingCredits} credit
                                        {remainingCredits === 1 ? '' : 's'} remaining.
                                    </p>
                                </div>
                                <p className="text-xs text-primary">Resets daily</p>
                            </div>
                        )
                    )
                    .with({ editingMessageId: P.string }, () => (
                        <div className="flex justify-between items-center px-3 py-3 bg-sidebar/30 backdrop-blur-md text-xs text-muted-foreground border-b border-foreground/10">
                            <div className="flex items-center gap-2">
                                <EditIcon className="size-4" />
                                <p>Editing message</p>
                            </div>
                            <Button
                                variant="ghost"
                                size="icon"
                                className="size-6"
                                onClick={() => {
                                    setEditingMessageId(undefined);
                                    setInput('');
                                    setAttachments([]);
                                    setTool('');
                                }}
                            >
                                <XIcon className="size-4" />
                            </Button>
                        </div>
                    ))
                    .otherwise(() => null)}
                <div className="flex gap-2 px-3 pt-3">
                    {attachments.map(attachment => (
                        <FileAttachment
                            key={attachment.url}
                            url={attachment.url}
                            name={attachment.filename}
                            mediaType={attachment.mediaType}
                            onRemove={() => {
                                setAttachments(attachments.filter(a => a.url !== attachment.url));
                            }}
                        />
                    ))}
                    {Array.from({ length: pendingFileCount }).map((_, index) => (
                        <div
                            key={index}
                            className="h-24 w-24 bg-muted/50 rounded-2xl animate-pulse border relative"
                        >
                            <div className="absolute inset-0 flex items-center justify-center bg-muted/50">
                                <LoaderIcon className="size-6 animate-spin" />
                            </div>
                        </div>
                    ))}
                </div>
                <PromptInputTextarea className="px-6" placeholder="Ask me anything..." />
                <PromptInputActions className="flex items-center px-3 pb-3">
                    {/* Switch-like tool selector */}
                    <div className="flex items-center bg-primary/5 rounded-full p-1 relative h-10">
                        {/* Chat icon - default tab */}
                        <PromptInputAction tooltip="Chat">
                            <Button
                                variant="ghost"
                                size="icon"
                                type="button"
                                className={cn(
                                    'h-8 w-8 rounded-full relative z-10 hover:text-primary',
                                    tool === '' && 'text-primary'
                                )}
                                onClick={() => setTool('')}
                            >
                                <MessageCircleIcon className="size-4 z-1" />
                                {tool === '' && (
                                    <motion.div
                                        className="absolute inset-0 h-8 w-full rounded-full bg-background z-0"
                                        layoutId="toolThumb"
                                        transition={{ type: 'spring', stiffness: 500, damping: 30 }}
                                    />
                                )}
                            </Button>
                        </PromptInputAction>

                        {/* Search icon */}
                        <PromptInputAction
                            tooltip={matcher
                                .with(
                                    { canSearch: true, canModelUseTools: true },
                                    () => 'Search the web'
                                )
                                .with(
                                    { canModelUseTools: false },
                                    () => 'This model cannot use tools'
                                )
                                .with(
                                    {
                                        remainingSearches: P.number.lte(0),
                                    },
                                    () => 'You have reached your search limit'
                                )
                                .otherwise(() => 'Search is not available')}
                        >
                            <Button
                                variant="ghost"
                                size="icon"
                                type="button"
                                className={cn(
                                    'h-8 w-8 rounded-full relative z-10 hover:text-primary',
                                    tool === 'search' && 'text-primary',
                                    matcher
                                        .with({ canSearch: false }, () => 'opacity-50')
                                        .with({ canModelUseTools: false }, () => 'opacity-50')
                                        .otherwise(() => null)
                                )}
                                onClick={() => {
                                    matcher
                                        .with({ canSearch: true, canModelUseTools: true }, () => {
                                            setTool('search');
                                        })
                                        .with({ canModelUseTools: false }, () => {
                                            toast('This model cannot use tools');
                                        })
                                        .with(
                                            {
                                                remainingSearches: P.number.lte(0),
                                            },
                                            () => {
                                                toast('You have reached your search limit');
                                            }
                                        )
                                        .otherwise(() => {
                                            toast('Search is not available');
                                        });
                                }}
                            >
                                <GlobeIcon className="size-4 z-1" />
                                {tool === 'search' && (
                                    <motion.div
                                        className="absolute inset-0 h-8 w-full rounded-full bg-background z-0"
                                        layoutId="toolThumb"
                                        transition={{ type: 'spring', stiffness: 500, damping: 30 }}
                                    />
                                )}
                            </Button>
                        </PromptInputAction>

                        {/* Research icon */}
                        <PromptInputAction
                            tooltip={matcher
                                .with(
                                    { canResearch: true, canModelUseTools: true },
                                    () => 'Deep research'
                                )
                                .with(
                                    {
                                        isPro: true,
                                        remainingResearches: P.number.lte(0),
                                    },
                                    () => 'You have reached your research limit'
                                )
                                .with(
                                    { isPro: false },
                                    () => 'Research is only available for Pro users'
                                )
                                .with(
                                    { canModelUseTools: false },
                                    () => 'This model cannot use tools'
                                )
                                .otherwise(() => 'Deep research is not available')}
                        >
                            <Button
                                variant="ghost"
                                size="icon"
                                type="button"
                                className={cn(
                                    'h-8 w-16 rounded-full relative z-10 hover:text-primary',
                                    tool === 'deepSearch' && 'text-primary',
                                    matcher
                                        .with({ canResearch: false }, () => 'opacity-50')
                                        .with({ canModelUseTools: false }, () => 'opacity-50')
                                        .otherwise(() => null)
                                )}
                                onClick={() => {
                                    matcher
                                        .with({ canResearch: true, canModelUseTools: true }, () => {
                                            setTool('deepSearch');
                                        })
                                        .with(
                                            {
                                                isPro: true,
                                                remainingResearches: P.number.lte(0),
                                            },
                                            () => {
                                                toast('You have reached your research limit');
                                            }
                                        )
                                        .with({ canModelUseTools: false }, () => {
                                            toast('This model cannot use tools');
                                        })
                                        .with({ isPro: false }, () => {
                                            setProDialogOpen(true);
                                        })
                                        .otherwise(() => null);
                                }}
                            >
                                <div className="flex items-center gap-1">
                                    <TelescopeIcon className="size-4 z-1" />
                                    <span className="text-[8px] font-medium text-primary px-1 py-0.5 rounded-full z-1 bg-primary/10">
                                        BETA
                                    </span>
                                </div>
                                {tool === 'deepSearch' && (
                                    <motion.div
                                        className="absolute inset-0 h-8 w-full rounded-full bg-background z-0"
                                        layoutId="toolThumb"
                                        transition={{ type: 'spring', stiffness: 500, damping: 30 }}
                                    />
                                )}
                            </Button>
                        </PromptInputAction>
                    </div>
                    <div className="flex-1" />
                    <PromptInputAction
                        tooltip={matcher
                            .with({ canModelViewFiles: true }, () => 'Attach files')
                            .with(
                                { canModelViewFiles: false },
                                () => 'This model does not support file uploads'
                            )
                            .otherwise(() => 'Attach files')}
                    >
                        <Button
                            variant="outline"
                            size="icon"
                            className="h-8 w-8 rounded-full"
                            type="button"
                            onClick={handlePaperclipClick}
                            disabled={matcher
                                .with({ canModelViewFiles: false }, () => true)
                                .otherwise(() => false)}
                        >
                            <Paperclip className="size-5" />
                            <input
                                ref={fileInputRef}
                                type="file"
                                accept="image/*,application/pdf"
                                multiple={true}
                                className="hidden"
                                onChange={e => handleFileUpload(e.target.files)}
                            />
                        </Button>
                    </PromptInputAction>
                    <PromptInputAction
                        tooltip={matcher
                            .with(
                                {
                                    input: P.string.maxLength(0),
                                    remainingCredits: P.number.gt(0),
                                    status: 'ready',
                                    canUseModel: true,
                                },
                                () => 'Message cannot be empty'
                            )
                            .with(
                                {
                                    remainingCredits: 0,
                                    status: 'ready',
                                },
                                () => 'You have reached your message limit.'
                            )
                            .with(
                                {
                                    pendingFileCount: P.number.gt(0),
                                    status: 'ready',
                                },
                                () => 'Waiting for files to upload'
                            )
                            .with(
                                {
                                    attachments: P.when(a => a.length > 0),
                                    canModelViewFiles: false,
                                    status: 'ready',
                                },
                                () => 'This model does not support file uploads'
                            )
                            .with(
                                { canUseModel: false, status: 'ready' },
                                () => cannotUseModelReason
                            )
                            .with(
                                { status: P.union('streaming', 'submitted') },
                                () => 'Stop generation'
                            )
                            .otherwise(() => 'Send message')}
                    >
                        <Button
                            type="submit"
                            variant="default"
                            size="icon"
                            className="h-8 w-8 rounded-full"
                            disabled={matcher
                                .with(
                                    {
                                        input: P.string.maxLength(0),
                                        remainingCredits: P.number.gt(0),
                                        status: 'ready',
                                    },
                                    () => true
                                )
                                .with(
                                    {
                                        remainingCredits: 0,
                                    },
                                    () => true
                                )
                                .with(
                                    {
                                        pendingFileCount: P.number.gt(0),
                                    },
                                    () => true
                                )
                                .with(
                                    {
                                        attachments: P.when(a => a.length > 0),
                                        canModelViewFiles: false,
                                        status: 'ready',
                                    },
                                    () => true
                                )
                                .with({ canUseModel: false, status: 'ready' }, () => true)
                                .with({ status: P.union('streaming', 'submitted') }, () => false)
                                .otherwise(() => false)}
                        >
                            {status === 'streaming' || status === 'submitted' ? (
                                <SquareIcon className="size-5 fill-current" />
                            ) : (
                                <ArrowUpIcon className="size-5" />
                            )}
                        </Button>
                    </PromptInputAction>
                </PromptInputActions>
            </PromptInput>
        </motion.form>
    );
}



================================================
FILE: src/components/thread/scroll-to-bottom-button.tsx
================================================
'use client';

import { Button, buttonVariants } from '@/components/ui/button';
import { cn } from '@/lib/utils';
import { type VariantProps } from 'class-variance-authority';
import { ChevronDown } from 'lucide-react';
import { useStickToBottomContext } from 'use-stick-to-bottom';

export type ScrollToBottomButtonProps = {
    className?: string;
    variant?: VariantProps<typeof buttonVariants>['variant'];
    size?: VariantProps<typeof buttonVariants>['size'];
} & React.ButtonHTMLAttributes<HTMLButtonElement>;

function ScrollToBottomButton({
    className,
    variant = 'outline',
    size = 'sm',
    ...props
}: ScrollToBottomButtonProps) {
    const { isAtBottom, scrollToBottom } = useStickToBottomContext();

    return (
        <Button
            type="button"
            variant={variant}
            size={size}
            className={cn(
                'absolute -top-6 left-[50%] -translate-x-1/2 transition-all duration-150 ease-out',
                !isAtBottom
                    ? 'translate-y-0 scale-100 opacity-100'
                    : 'pointer-events-none translate-y-4 scale-95 opacity-0',
                className
            )}
            onClick={() => scrollToBottom()}
            {...props}
        >
            {props.children || <ChevronDown className="h-5 w-5" />}
        </Button>
    );
}

export { ScrollToBottomButton };



================================================
FILE: src/components/thread/thread-container.tsx
================================================
import { FileDropArea } from '@/components/thread/file-drop-area';
import { useUploadThing } from '@/lib/uploadthing';
import { toast } from 'sonner';
import { useThreadSelector } from '@/context/thread';
import { FileAttachment } from '@/thread/store';

export function ThreadContainer({ children }: { children: React.ReactNode }) {
    const attachments = useThreadSelector(state => state.attachments);
    const setPendingFileCount = useThreadSelector(state => state.setPendingFileCount);
    const setAttachments = useThreadSelector(state => state.setAttachments);

    const { startUpload } = useUploadThing('fileUploader', {
        onBeforeUploadBegin: file => {
            setPendingFileCount(prev => prev + 1);
            return file;
        },

        onClientUploadComplete: files => {
            setPendingFileCount(prev => prev - files.length);
            const newAttachments: FileAttachment[] = files.map(file => ({
                type: 'file' as const,
                url: file.ufsUrl,
                filename: file.name,
                mediaType: file.type,
            }));
            setAttachments([...attachments, ...newAttachments]);
        },
        onUploadError: error => {
            toast.error(error.message);
            setPendingFileCount(prev => prev - 1);
        },
    });

    const handleFileUpload = async (files: FileList | null) => {
        if (!files || files.length === 0) return;
        await startUpload(Array.from(files));
    };

    return <FileDropArea onUpload={handleFileUpload}>{children}</FileDropArea>;
}



================================================
FILE: src/components/thread/message/assistant-message.tsx
================================================
import { MessageContainer } from '@/components/thread/message/message-container';
import { PendingMessage } from '@/components/thread/message/pending-message';
import { UIMessage } from '@/components/thread/message/ui-message';
import { UrlResultButton } from '@/components/thread/message/url-result-button';
import ModelIcon from '@/components/thread/model-icon';
import { Button } from '@/components/ui/button';
import { Message, MessageActions, MessageAction } from '@/components/ui/message';
import { useThreadContext, useThreadSelector } from '@/context/thread';
import { cn } from '@/lib/utils';
import { toast } from 'sonner';
import { CopyIcon, RefreshCcwIcon } from 'lucide-react';
import { Fragment, memo } from 'react';

export const AssistantMessage = memo(function PureAssistantMessage({
    id,
    hasNextMessage,
    hasPreviousMessage,
}: {
    id: string;
    hasPreviousMessage: boolean;
    hasNextMessage: boolean;
}) {
    const status = useThreadSelector(state => state.status);
    const length = useThreadSelector(state => state.messageMap[id].parts.length);

    if (length === 0) {
        return (
            <MessageContainer
                className="justify-start"
                hasPreviousMessage={true}
                hasNextMessage={false}
            >
                <PendingMessage />
            </MessageContainer>
        );
    }

    return (
        <MessageContainer
            className="justify-start"
            hasPreviousMessage={hasPreviousMessage}
            hasNextMessage={hasNextMessage}
        >
            <Message className="flex flex-col items-start w-full">
                <UIMessage id={id} />
                {(status !== 'streaming' && status !== 'submitted') || hasNextMessage ? (
                    <Fragment>
                        <ToolResultPills id={id} />
                        <Actions id={id} />
                    </Fragment>
                ) : (
                    <MessageActions
                        className={cn('gap-1 transition-opacity duration-200 opacity-100')}
                    >
                        <Button variant="ghost" size="icon" className="size-8"></Button>
                    </MessageActions>
                )}
            </Message>
        </MessageContainer>
    );
});

const ToolResultPills = memo(function PureToolResultPills({ id }: { id: string }) {
    const toolSidebar = useThreadSelector(state => state.toolSidebar);
    const setToolSidebar = useThreadSelector(state => state.setToolSidebar);
    const searchResults = useThreadSelector(state =>
        state.messageMap[id].parts
            .filter(part => part.type === 'tool-search')
            .map(part => ({
                toolCallId: part.toolCallId,
                urls: part.output?.results.map(result => result.url) ?? [],
            }))
    );

    const researchResults = useThreadSelector(state =>
        state.messageMap[id].parts
            .filter(part => part.type === 'tool-research')
            .map(part => ({
                toolCallId: part.toolCallId,
                urls: state.messageMap[id].parts
                    .filter(p => p.type === 'data-research-read')
                    .filter(p => p.data.toolCallId === part.toolCallId)
                    .map(p => p.data.url),
            }))
    );

    if (searchResults.length === 0 && researchResults.length === 0) {
        return null;
    }

    return (
        <MessageActions>
            {researchResults.map(result => (
                <UrlResultButton
                    key={result.toolCallId}
                    urls={result.urls}
                    count={result.urls.length}
                    label="Sources Read"
                    onClick={() => {
                        if (
                            toolSidebar?.tool === 'research' &&
                            toolSidebar.toolCallId === result.toolCallId
                        ) {
                            setToolSidebar(undefined);
                        } else {
                            setToolSidebar({
                                tool: 'research',
                                toolCallId: result.toolCallId,
                                messageId: id,
                            });
                        }
                    }}
                />
            ))}
            {searchResults.map(result => (
                <UrlResultButton
                    key={result.toolCallId}
                    urls={result.urls}
                    count={result.urls.length}
                    label="Search Results"
                    onClick={() => {
                        if (
                            toolSidebar?.tool === 'search' &&
                            toolSidebar.toolCallId === result.toolCallId
                        ) {
                            setToolSidebar(undefined);
                        } else {
                            setToolSidebar({
                                tool: 'search',
                                toolCallId: result.toolCallId,
                                messageId: id,
                            });
                        }
                    }}
                />
            ))}
        </MessageActions>
    );
});

const Actions = memo(function PureActions({ id }: { id: string }) {
    const thread = useThreadContext();
    const metadata = useThreadSelector(
        state => state.messageMap[id].metadata,
        (a, b) => a?.model?.id === b?.model?.id
    );
    const status = useThreadSelector(state => state.status);
    return (
        <MessageActions className={cn('gap-1 transition-opacity duration-200 opacity-100')}>
            <MessageAction tooltip="Copy" side="bottom">
                <Button
                    variant="ghost"
                    size="icon"
                    className="size-8"
                    onClick={async () => {
                        await navigator.clipboard.writeText(
                            thread.store
                                .getState()
                                .messageMap[id].parts.filter(part => part.type === 'text')
                                .map(part => part.text)
                                .join('\n')
                        );
                        toast.success('Copied to clipboard');
                    }}
                >
                    <CopyIcon className="size-3" />
                </Button>
            </MessageAction>
            <MessageAction tooltip="Regenerate" side="bottom">
                <Button
                    variant="ghost"
                    size="icon"
                    className="size-8"
                    disabled={status === 'streaming' || status === 'submitted'}
                    onClick={() => {
                        thread.regenerate({ messageId: id });
                    }}
                >
                    <RefreshCcwIcon className="size-3" />
                </Button>
            </MessageAction>
            {metadata && metadata.model && (
                <Button variant="ghost" className="hover:bg-transparent! cursor-default" asChild>
                    <div>
                        <ModelIcon className="fill-primary" model={metadata.model.icon} />
                        <span className="text-xs text-muted-foreground font-normal">
                            {metadata.model.name}
                        </span>
                    </div>
                </Button>
            )}
        </MessageActions>
    );
});



================================================
FILE: src/components/thread/message/message-container.tsx
================================================
import { useThreadSelector } from '@/context/thread';
import { useAccess } from '@/hooks/use-access';
import { cn } from '@/lib/utils';
import { match, P } from 'ts-pattern';

export function MessageContainer({
    children,
    hasPreviousMessage,
    hasNextMessage,
    className,
}: {
    children: React.ReactNode;
    hasPreviousMessage: boolean;
    hasNextMessage: boolean;
    className?: string;
}) {
    const editingMessageId = useThreadSelector(state => state.editingMessageId);
    const { isPro, remainingCredits } = useAccess();

    return (
        <div
            className={cn(
                'flex w-full max-w-3xl mx-auto px-4',
                className,
                !hasPreviousMessage && 'pt-40',
                !hasNextMessage &&
                    match({ editingMessageId, remainingCredits, isPro })
                        .with(
                            {
                                remainingCredits: P.number.lte(0),
                                isPro: false,
                                editingMessageId: P.nullish,
                            },
                            () => 'pb-48'
                        )
                        .with(
                            {
                                remainingCredits: P.number.lt(10),
                                isPro: false,
                                editingMessageId: P.nullish,
                            },
                            () => 'pb-48'
                        )
                        .with(
                            {
                                remainingCredits: P.number.lte(0),
                                isPro: true,
                                editingMessageId: P.nullish,
                            },
                            () => 'pb-48'
                        )
                        .with(
                            {
                                remainingCredits: P.number.lt(10),
                                isPro: true,
                                editingMessageId: P.nullish,
                            },
                            () => 'pb-48'
                        )
                        .with({ editingMessageId: P.string }, () => 'pb-40')
                        .otherwise(() => 'pb-40')
            )}
        >
            {children}
        </div>
    );
}



================================================
FILE: src/components/thread/message/message-item.tsx
================================================
import { AssistantMessage } from '@/components/thread/message/assistant-message';
import { UserMessage } from '@/components/thread/message/user-message';
import { useThreadSelector } from '@/context/thread';
import { memo } from 'react';

export const MessageItem = memo(
    function PureMessageItem({ id }: { id: string }) {
        const role = useThreadSelector(state => state.messageMap[id].role);
        const hasNextMessage = useThreadSelector(
            state => state.messageIds[state.messageIds.indexOf(id) + 1] !== undefined
        );
        const hasPreviousMessage = useThreadSelector(
            state => state.messageIds[state.messageIds.indexOf(id) - 1] !== undefined
        );

        if (role === 'assistant') {
            return (
                <AssistantMessage
                    id={id}
                    hasPreviousMessage={hasPreviousMessage}
                    hasNextMessage={hasNextMessage}
                />
            );
        }

        return (
            <UserMessage
                id={id}
                hasPreviousMessage={hasPreviousMessage}
                hasNextMessage={hasNextMessage}
            />
        );
    },
    (prev, next) => prev.id === next.id
);



================================================
FILE: src/components/thread/message/message-list.tsx
================================================
import { MessageItem } from '@/components/thread/message/message-item';
import { MultiModalInput } from '@/components/thread/multi-modal-input';
import { MessageContext, useThreadSelector } from '@/context/thread';
import { useAutoResume } from '@/hooks/use-auto-resume';
import { StickToBottom, useStickToBottom } from 'use-stick-to-bottom';
import { Virtualizer, VirtualizerHandle } from 'virtua';
import { useEffect, useRef } from 'react';

export function MessageList() {
    const mounted = useRef(false);
    const ref = useRef<VirtualizerHandle>(null);
    const messageIds = useThreadSelector(state => state.messageIds);
    const isStreaming = useThreadSelector(state => state.status === 'streaming');
    const instance = useStickToBottom({
        initial: 'instant',
        resize: isStreaming ? 'smooth' : 'instant',
    });

    useAutoResume();

    useEffect(() => {
        if (mounted.current) {
            return;
        }

        ref.current?.scrollToIndex(messageIds.length - 1, {
            align: 'end',
        });

        const timer = setTimeout(() => {
            mounted.current = true;
        }, 100);

        return () => clearTimeout(timer);
    }, [messageIds.length]);

    return (
        <StickToBottom className="absolute top-0 left-0 right-0 bottom-4" instance={instance}>
            <Virtualizer
                as={StickToBottom.Content}
                ref={ref}
                scrollRef={instance.scrollRef}
                ssrCount={5}
                overscan={1}
            >
                {messageIds.map(id => (
                    <MessageContext key={id} value={id}>
                        <MessageItem id={id} />
                    </MessageContext>
                ))}
            </Virtualizer>
            <MultiModalInput />
        </StickToBottom>
    );
}



================================================
FILE: src/components/thread/message/pending-message.tsx
================================================
import { Button } from '@/components/ui/button';
import { Message, MessageActions } from '@/components/ui/message';
import { CopyIcon } from 'lucide-react';
import { Loader } from '@/components/ui/loader';

export function PendingMessage() {
    return (
        <Message className="flex-col w-full mx-auto py-4">
            <Loader variant="typing" />
            <MessageActions className="opacity-0">
                <Button variant="ghost" size="icon">
                    <CopyIcon className="size-3" />
                </Button>
            </MessageActions>
        </Message>
    );
}



================================================
FILE: src/components/thread/message/ui-message.tsx
================================================
import { Part } from '@/components/thread/message/part';
import { memo } from 'react';
import { usePartSelector } from '@/context/thread';

export const UIMessage = memo(function PureUIMessage({ id }: { id: string }) {
    const partsLength = usePartSelector(parts => parts.length);
    return Array.from({ length: partsLength }).map((_, i) => <Part key={i} id={id} index={i} />);
});



================================================
FILE: src/components/thread/message/url-result-button.tsx
================================================
import { cn } from '@/lib/utils';
import { memo } from 'react';

export const UrlResultButton = memo(function PureUrlResultButton({
    urls,
    count,
    label,
    onClick,
    className,
}: {
    urls: string[];
    count: number;
    label: string;
    onClick?: () => void;
    className?: string;
}) {
    return (
        <button
            type="button"
            className={cn(
                'flex p-2 bg-sidebar rounded-3xl gap-3 items-center cursor-pointer',
                className
            )}
            onClick={onClick}
        >
            <div className="flex -space-x-2">
                {urls.slice(0, 5).map((url, index) => {
                    let hostname = 'example.com';
                    try {
                        const urlObj = new URL(url);
                        hostname = urlObj.hostname || 'example.com';
                    } catch {
                        hostname = 'example.com';
                    }

                    return (
                        <img
                            key={`${url}-${index}`}
                            src={`https://www.google.com/s2/favicons?domain=${hostname}&sz=32`}
                            alt={`${hostname} favicon`}
                            className="w-5 h-5 rounded-full"
                            onError={e => {
                                // Fallback to a generic icon if favicon fails to load
                                e.currentTarget.src =
                                    "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cline x1='12' y1='8' x2='12' y2='16'/%3E%3Cline x1='8' y1='12' x2='16' y2='12'/%3E%3C/svg%3E";
                            }}
                        />
                    );
                })}
            </div>
            <span className="text-xs text-muted-foreground pr-2 group-hover:text-foreground transition-colors duration-200">
                {count} {label}
            </span>
        </button>
    );
});



================================================
FILE: src/components/thread/message/user-message.tsx
================================================
import { FileAttachment } from '@/components/thread/file-attachment';
import { MessageContainer } from '@/components/thread/message/message-container';
import { PendingMessage } from '@/components/thread/message/pending-message';
import { UIMessage } from '@/components/thread/message/ui-message';
import { Button } from '@/components/ui/button';
import { Message, MessageActions, MessageAction } from '@/components/ui/message';
import { useThreadSelector } from '@/context/thread';
import { CopyIcon, EditIcon } from 'lucide-react';
import { Fragment, memo, useMemo } from 'react';
import { toast } from 'sonner';
import { useCopyToClipboard } from 'usehooks-ts';

export const UserMessage = memo(function PureUserMessage({
    id,
    hasPreviousMessage,
    hasNextMessage,
}: {
    id: string;
    hasPreviousMessage: boolean;
    hasNextMessage: boolean;
}) {
    const [_, copy] = useCopyToClipboard();
    const message = useThreadSelector(state => state.messageMap[id]);
    const setEditingMessageId = useThreadSelector(state => state.setEditingMessageId);
    const setInput = useThreadSelector(state => state.setInput);
    const setAttachments = useThreadSelector(state => state.setAttachments);

    async function handleCopyClick() {
        const text = message.parts
            .filter(part => part.type === 'text')
            .map(part => part.text)
            .join('\n')
            ?.trim();

        if (!text) {
            return;
        }

        await copy(text);
        toast.success('Copied to clipboard');
    }

    const fileParts = useMemo(() => {
        return message.parts.filter(part => part.type === 'file');
    }, [message.parts]);

    function handleEditClick() {
        setEditingMessageId(id);
        setInput(
            message.parts
                .filter(part => part.type === 'text')
                .map(part => part.text)
                .join('\n')
        );
        setAttachments(
            fileParts.map(part => ({
                type: 'file',
                url: part.url,
                filename: part.filename || 'untitled',
                mediaType: part.mediaType,
            }))
        );
    }

    return (
        <Fragment>
            <MessageContainer hasPreviousMessage={hasPreviousMessage} hasNextMessage={true}>
                <Message className="flex flex-col items-end group/user-message w-full">
                    {fileParts.length > 0 && (
                        <div className="flex items-end gap-2">
                            {fileParts.map((part, index) => (
                                <FileAttachment
                                    key={index}
                                    url={part.url}
                                    name={part.filename}
                                    mediaType={part.mediaType}
                                />
                            ))}
                        </div>
                    )}
                    <div className="bg-muted py-3 px-4 rounded-l-3xl rounded-tr-3xl rounded-br-lg max-w-[80%] border border-foreground/10 relative flex flex-col items-start gap-3">
                        <UIMessage id={message.id} />
                    </div>
                    <MessageActions className="group-hover/user-message:opacity-100 md:opacity-0 transition-opacity duration-200 gap-1">
                        <MessageAction tooltip="Copy" side="bottom">
                            <Button
                                variant="ghost"
                                size="icon"
                                className="size-8"
                                onClick={handleCopyClick}
                            >
                                <CopyIcon className="size-3" />
                            </Button>
                        </MessageAction>
                        <MessageAction tooltip="Edit" side="bottom">
                            <Button
                                variant="ghost"
                                size="icon"
                                className="size-8"
                                onClick={handleEditClick}
                            >
                                <EditIcon className="size-3" />
                            </Button>
                        </MessageAction>
                    </MessageActions>
                </Message>
            </MessageContainer>
            {!hasNextMessage && (
                <MessageContainer
                    className="justify-end"
                    hasPreviousMessage={true}
                    hasNextMessage={false}
                >
                    <PendingMessage />
                </MessageContainer>
            )}
        </Fragment>
    );
});



================================================
FILE: src/components/thread/message/part/deep-search-part.tsx
================================================
import { usePart, useThreadSelector } from '@/context/thread';
import {
    BinocularsIcon,
    SearchIcon,
    FileTextIcon,
    CheckCircleIcon,
    NotebookPenIcon,
} from 'lucide-react';
import { memo, useState, useEffect, useMemo } from 'react';
import {
    ChainOfThought,
    ChainOfThoughtContent,
    ChainOfThoughtHeader,
    ChainOfThoughtSearchResult,
    ChainOfThoughtSearchResults,
    ChainOfThoughtStep,
} from '@/components/ai-elements/chain-of-thought';
import { DeepSearchPart as DeepSearchPartType } from '@/ai/tools/deep-search-tool';
import { useDebounce } from '@uidotdev/usehooks';

export const DeepSearchPart = memo(({ id, index }: { id: string; index: number }) => {
    const { done, toolCallId } = usePart({
        id,
        index,
        type: 'tool-deepSearch',
        selector: part => ({
            done: part.output !== undefined,
            toolCallId: part.toolCallId,
        }),
    });

    const [_isOpen, setIsOpen] = useState<boolean | undefined>(undefined);
    const debouncedDone = useDebounce(done, 1000);

    const dataParts = useThreadSelector(state => {
        return state.messageMap[id].parts
            .filter(part => part.type === 'data-deep-search')
            .filter(part => part.data.toolCallId === toolCallId)
            .map(part => part.data);
    });

    const isOpen =
        typeof _isOpen === 'boolean'
            ? _isOpen && dataParts.length > 0
            : !debouncedDone && dataParts.length > 0;

    const [currentTime, setCurrentTime] = useState(Date.now());

    useEffect(() => {
        if (!done) {
            const interval = setInterval(() => {
                setCurrentTime(Date.now());
            }, 1000);
            return () => clearInterval(interval);
        }
    }, [done]);

    const timeElapsed = useMemo(() => {
        const start = dataParts.find(part => part.type === 'start');
        const completed = dataParts.find(part => part.type === 'completed');

        if (!start) return 0;

        const startTime = start.timestamp;
        const endTime = completed ? completed.timestamp : currentTime;

        return Math.max(0, Math.round((endTime - startTime) / 1000));
    }, [dataParts, currentTime]);

    const renderStep = (part: DeepSearchPartType, stepIndex: number) => {
        const isLast = stepIndex === dataParts.length - 1;
        const status =
            part.type === 'completed' ? 'complete' : isLast && !done ? 'active' : 'complete';

        switch (part.type) {
            case 'start':
                return (
                    <ChainOfThoughtStep
                        key={`${part.type}-${stepIndex}`}
                        icon={NotebookPenIcon}
                        label="Planning"
                        description={part.thoughts}
                        status={status}
                    />
                );
            case 'search':
                return (
                    <ChainOfThoughtStep
                        key={`${part.type}-${stepIndex}`}
                        icon={SearchIcon}
                        label="Searching"
                        description={part.thoughts}
                        status={status}
                    />
                );

            case 'search-results':
                return (
                    <ChainOfThoughtStep
                        key={`${part.type}-${stepIndex}`}
                        icon={SearchIcon}
                        label={`Found ${part.results.length} search results`}
                        status={status}
                    >
                        <ChainOfThoughtSearchResults>
                            {part.results.map((result: any, resultIndex: number) => {
                                let hostname = 'example.com';
                                try {
                                    const urlObj = new URL(result.url);
                                    hostname = urlObj.hostname || 'example.com';
                                } catch {
                                    hostname = 'example.com';
                                }

                                return (
                                    <ChainOfThoughtSearchResult
                                        key={`result-${resultIndex}`}
                                        url={result.url}
                                    >
                                        <img
                                            src={`https://www.google.com/s2/favicons?domain=${hostname}&sz=16`}
                                            alt={`${hostname} favicon`}
                                            className="w-3 h-3 rounded-sm"
                                            onError={e => {
                                                e.currentTarget.src =
                                                    "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3C/svg%3E";
                                            }}
                                        />
                                        {result.title.slice(0, 50) || hostname}
                                    </ChainOfThoughtSearchResult>
                                );
                            })}
                        </ChainOfThoughtSearchResults>
                    </ChainOfThoughtStep>
                );

            case 'read-site':
                return (
                    <ChainOfThoughtStep
                        key={`${part.type}-${stepIndex}`}
                        icon={FileTextIcon}
                        label="Reading webpage"
                        description={part.thoughts}
                        status={status}
                    >
                        <ChainOfThoughtSearchResults>
                            {(() => {
                                let hostname = 'example.com';
                                try {
                                    const urlObj = new URL(part.url);
                                    hostname = urlObj.hostname || 'example.com';
                                } catch {
                                    hostname = 'example.com';
                                }

                                return (
                                    <ChainOfThoughtSearchResult url={part.url}>
                                        <img
                                            src={`https://www.google.com/s2/favicons?domain=${hostname}&sz=16`}
                                            alt={`${hostname} favicon`}
                                            className="w-3 h-3 rounded-sm"
                                            onError={e => {
                                                e.currentTarget.src =
                                                    "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3C/svg%3E";
                                            }}
                                        />
                                        {hostname}
                                    </ChainOfThoughtSearchResult>
                                );
                            })()}
                        </ChainOfThoughtSearchResults>
                    </ChainOfThoughtStep>
                );

            case 'read-site-results':
                return (
                    <ChainOfThoughtStep
                        key={`${part.type}-${stepIndex}`}
                        icon={FileTextIcon}
                        label="Completed reading webpage"
                        description={`Read ${part.content.length} characters`}
                        status={status}
                    />
                );

            case 'completed':
                return (
                    <ChainOfThoughtStep
                        key={`${part.type}-${stepIndex}`}
                        icon={CheckCircleIcon}
                        label="Deep search completed"
                        status="complete"
                    />
                );

            default:
                return null;
        }
    };

    return (
        <ChainOfThought open={isOpen} onOpenChange={setIsOpen}>
            <ChainOfThoughtHeader icon={BinocularsIcon}>
                {done ? `Research completed in ${timeElapsed}s` : `Researching for ${timeElapsed}s`}
            </ChainOfThoughtHeader>
            <ChainOfThoughtContent>
                {dataParts.map((part, index) => renderStep(part, index))}
            </ChainOfThoughtContent>
        </ChainOfThought>
    );
});



================================================
FILE: src/components/thread/message/part/error-part.tsx
================================================
import { usePart } from '@/context/thread';
import { Alert, AlertTitle } from '@/components/ui/alert';
import { InfoIcon } from 'lucide-react';
import { memo } from 'react';

export const ErrorPart = memo(function PureErrorPart({ id, index }: { id: string; index: number }) {
    const part = usePart({ id, index, type: 'data-error', selector: part => part });
    return (
        <Alert variant="destructive">
            <InfoIcon />
            <AlertTitle>{part.data}</AlertTitle>
        </Alert>
    );
});



================================================
FILE: src/components/thread/message/part/index.tsx
================================================
import { usePartSelector, useThreadSelector } from '@/context/thread';
import { ReasoningPart } from '@/components/thread/message/part/reasoning-part';
import { ErrorPart } from '@/components/thread/message/part/error-part';
import { TextPart } from '@/components/thread/message/part/text-part';
import { SearchPart } from '@/components/thread/message/part/search-part';
import { ResearchPart } from '@/components/thread/message/part/research-part';
import { DeepSearchPart } from '@/components/thread/message/part/deep-search-part';

export function Part({ id, index }: { id: string; index: number }) {
    const type = usePartSelector(parts => {
        return parts[index].type;
    });

    switch (type) {
        case 'reasoning':
            return <ReasoningPart id={id} index={index} />;
        case 'text':
            return <TextPart id={id} index={index} />;
        case 'tool-search':
            return <SearchPart id={id} index={index} />;
        case 'tool-research':
            return <ResearchPart id={id} index={index} />;
        case 'tool-deepSearch':
            return <DeepSearchPart id={id} index={index} />;
        case 'data-error':
            return <ErrorPart id={id} index={index} />;
        default:
            return null;
    }
}



================================================
FILE: src/components/thread/message/part/reasoning-part.tsx
================================================
import { ReasoningTimePart } from '@/ai/types';
import { MessageContent } from '@/components/ui/message';
import { usePart, useThreadSelector } from '@/context/thread';
import { lexer } from '@/lib/utils';
import { useDebounce } from '@uidotdev/usehooks';
import { AnimatePresence, motion } from 'framer-motion';
import { BrainIcon } from 'lucide-react';
import { memo, useState, useCallback, useEffect, useMemo } from 'react';

export const ReasoningBlock = memo(
    function PureReasoningBlock({
        id,
        index,
        blockIndex,
    }: {
        id: string;
        index: number;
        blockIndex: number;
    }) {
        const content = usePart({
            id,
            index,
            type: 'reasoning',
            selector: part => lexer(part?.text ?? '')[blockIndex],
            equalityFn: (a, b) => a === b,
        });

        const shouldAnimate = useThreadSelector(state => {
            const nextMessageIndex = state.messages.findIndex(msg => msg.id === id) + 1;
            const nextMessage = state.messages[nextMessageIndex];

            return nextMessage === undefined && state.status === 'streaming';
        });

        const debouncedAnimated = useDebounce(shouldAnimate, 1000);

        if (content === undefined || content === null) {
            return null;
        }

        return (
            <MessageContent
                className="text-sm text-muted-foreground"
                markdown
                animated={debouncedAnimated}
            >
                {content}
            </MessageContent>
        );
    },
    function propsAreEqual(prevProps, nextProps) {
        return (
            prevProps.id === nextProps.id &&
            prevProps.index === nextProps.index &&
            prevProps.blockIndex === nextProps.blockIndex
        );
    }
);

export const ReasoningText = memo(
    function PureReasoningText({ id, index }: { id: string; index: number }) {
        return Array.from({ length: 100 }, (_, i) => i).map(i => (
            <ReasoningBlock key={`${id}-${index}-${i}`} id={id} index={index} blockIndex={i} />
        ));
    },
    function propsAreEqual() {
        return true;
    }
);

export const ReasoningPart = memo(function PureReasoningPart({
    id,
    index,
}: {
    id: string;
    index: number;
}) {
    const { done, hasText } = usePart({
        id,
        index,
        type: 'reasoning',
        selector: part => ({
            done: part?.state ? part?.state === 'done' : null,
            hasText: part?.text ? part?.text?.length > 0 : false,
        }),
    });

    if (done === null) {
        return null;
    }

    const [_isOpen, setIsOpen] = useState<boolean | undefined>(undefined);
    const debouncedDone = useDebounce(done, 1000);
    const isOpen = typeof _isOpen === 'boolean' ? _isOpen && hasText : !debouncedDone && hasText;

    const toggle = useCallback(() => {
        setIsOpen(!isOpen);
    }, [isOpen]);

    return (
        <div className="w-full">
            <button
                type="button"
                onClick={toggle}
                className="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors cursor-pointer"
            >
                <BrainIcon className="size-4" />
                <span>
                    {done ? 'Reasoned ' : 'Reasoning '}
                    <ReasoningTime id={id} index={index} />
                </span>
            </button>

            <AnimatePresence initial={false}>
                {isOpen && (
                    <motion.div
                        initial={{ height: 0, opacity: 0 }}
                        animate={{ height: 'auto', opacity: 1 }}
                        exit={{ height: 0, opacity: 0 }}
                        transition={{ duration: 0.2, ease: 'easeInOut' }}
                        className="flex flex-col overflow-hidden p-3 bg-sidebar rounded-lg mt-3 border border-foreground/10 gap-2"
                    >
                        <ReasoningText id={id} index={index} />
                    </motion.div>
                )}
            </AnimatePresence>
        </div>
    );
});

export const ReasoningTime = memo(function PureReasoningTime({
    id,
    index,
}: {
    id: string;
    index: number;
}) {
    const { done, startTime, endTime } = usePart({
        id,
        index,
        type: 'reasoning',
        selector: part => ({
            done: part?.state ? part?.state === 'done' : null,
            startTime: part?.startTime,
            endTime: part?.endTime,
        }),
    });

    const [currentTime, setCurrentTime] = useState(Date.now());

    useEffect(() => {
        if (!done) {
            const interval = setInterval(() => {
                setCurrentTime(Date.now());
            }, 1000);
            return () => clearInterval(interval);
        }
    }, [done]);

    const timeElapsed = useMemo(() => {
        if (!startTime) return null;

        return Math.max(0, Math.ceil(((endTime ?? currentTime) - startTime) / 1000));
    }, [startTime, endTime, currentTime]);

    if (timeElapsed === null) {
        return null;
    }

    return `for ${timeElapsed}s`;
});



================================================
FILE: src/components/thread/message/part/research-part.tsx
================================================
import { usePart, useThreadSelector } from '@/context/thread';
import { cn } from '@/lib/utils';
import { Loader2Icon, TelescopeIcon } from 'lucide-react';
import { memo } from 'react';

export const ResearchPart = memo(function PureResearchPart({
    id,
    index,
}: {
    id: string;
    index: number;
}) {
    const toolSidebar = useThreadSelector(state => state.toolSidebar);
    const setToolSidebar = useThreadSelector(state => state.setToolSidebar);
    const part = usePart({ id, index, type: 'tool-research', selector: part => part });
    const done = part.output !== undefined;

    return (
        <div className={cn('w-full', !done && 'animate-pulse')}>
            <button
                type="button"
                onClick={() => {
                    if (toolSidebar?.toolCallId === part.toolCallId) {
                        setToolSidebar(undefined);
                    } else {
                        setToolSidebar({
                            messageId: id,
                            tool: 'research',
                            toolCallId: part.toolCallId,
                        });
                    }
                }}
                className="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors cursor-pointer"
            >
                <TelescopeIcon className="size-3" />
                <span>{done ? 'Researched' : 'Researching'}</span>
                {!done && <Loader2Icon className="size-3 animate-spin" />}
            </button>
        </div>
    );
});



================================================
FILE: src/components/thread/message/part/search-part.tsx
================================================
import { usePart, useThreadSelector } from '@/context/thread';
import { SearchIcon } from 'lucide-react';
import { memo } from 'react';

export const SearchPart = memo(function PureSearchPart({
    id,
    index,
}: {
    id: string;
    index: number;
}) {
    const toolSidebar = useThreadSelector(state => state.toolSidebar);
    const setToolSidebar = useThreadSelector(state => state.setToolSidebar);
    const part = usePart({ id, index, type: 'tool-search', selector: part => part });
    const done = part.output !== undefined;

    return (
        <div className="w-full">
            <button
                type="button"
                onClick={() => {
                    if (toolSidebar?.toolCallId === part.toolCallId) {
                        setToolSidebar(undefined);
                    } else {
                        setToolSidebar({
                            messageId: id,
                            tool: 'search',
                            toolCallId: part.toolCallId,
                        });
                    }
                }}
                className="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors cursor-pointer"
            >
                <SearchIcon className="size-4" />
                <span>{done ? 'Searched' : 'Searching'}</span>
            </button>
        </div>
    );
});



================================================
FILE: src/components/thread/message/part/text-part.tsx
================================================
import { MessageContent } from '@/components/ui/message';
import { usePart, useThreadSelector } from '@/context/thread';
import { lexer } from '@/lib/utils';
import { useDebounce } from '@uidotdev/usehooks';
import { memo } from 'react';

export const MarkdownBlock = memo(
    function PureMarkdownBlock({
        id,
        index,
        blockIndex,
    }: {
        id: string;
        index: number;
        blockIndex: number;
    }) {
        const content = usePart({
            id,
            index,
            type: 'text',
            selector: part => lexer(part.text)[blockIndex],
            equalityFn: (a, b) => a === b,
        });
        const shouldAnimate = useThreadSelector(state => {
            const nextMessageIndex = state.messages.findIndex(msg => msg.id === id) + 1;
            const nextMessage = state.messages[nextMessageIndex];

            return nextMessage === undefined && state.status === 'streaming';
        });

        const debouncedAnimated = useDebounce(shouldAnimate, 1000);

        if (content === undefined || content === '') {
            return null;
        }

        return (
            <MessageContent markdown animated={debouncedAnimated}>
                {content}
            </MessageContent>
        );
    },
    function propsAreEqual(prevProps, nextProps) {
        return (
            prevProps.id === nextProps.id &&
            prevProps.index === nextProps.index &&
            prevProps.blockIndex === nextProps.blockIndex
        );
    }
);

export const TextPart = memo(
    function PureTextPart({ id, index }: { id: string; index: number }) {
        return Array.from({ length: 100 }, (_, i) => i).map(i => (
            <MarkdownBlock key={`${id}-${index}-${i}`} id={id} index={index} blockIndex={i} />
        ));
    },
    function propsAreEqual() {
        return true;
    }
);



================================================
FILE: src/components/ui/alert.tsx
================================================
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className
      )}
      {...props}
    />
  )
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className
      )}
      {...props}
    />
  )
}

export { Alert, AlertTitle, AlertDescription }



================================================
FILE: src/components/ui/avatar.tsx
================================================
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        "relative flex size-8 shrink-0 overflow-hidden rounded-full",
        className
      )}
      {...props}
    />
  )
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  )
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className
      )}
      {...props}
    />
  )
}

export { Avatar, AvatarImage, AvatarFallback }



================================================
FILE: src/components/ui/badge.tsx
================================================
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }



================================================
FILE: src/components/ui/button.tsx
================================================
import { Slot } from '@radix-ui/react-slot';
import { type VariantProps, cva } from 'class-variance-authority';

import { cn } from '@/lib/utils';

const buttonVariants = cva(
    "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all cursor-pointer disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
    {
        variants: {
            variant: {
                default: 'bg-primary text-primary-foreground shadow-xs hover:bg-primary/90',
                destructive:
                    'bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',
                outline:
                    'border border-foreground/10 shadow-xs hover:bg-muted hover:text-muted-foreground dark:hover:bg-input/50',
                secondary: 'bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80',
                ghost: 'hover:bg-muted hover:text-muted-foreground dark:hover:bg-muted/50',
                link: 'text-primary underline-offset-4 hover:underline',
            },
            size: {
                default: 'h-9 px-4 py-2 has-[>svg]:px-3',
                sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',
                lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',
                icon: 'size-9',
            },
        },
        defaultVariants: {
            variant: 'default',
            size: 'default',
        },
    }
);

function Button({
    className,
    variant,
    size,
    asChild = false,
    ...props
}: React.ComponentProps<'button'> &
    VariantProps<typeof buttonVariants> & {
        asChild?: boolean;
    }) {
    const Comp = asChild ? Slot : 'button';

    return (
        <Comp
            data-slot="button"
            className={cn(buttonVariants({ variant, size, className }))}
            {...props}
        />
    );
}

export { Button, buttonVariants };



================================================
FILE: src/components/ui/capability-badges.tsx
================================================
import { Badge } from '@/components/ui/badge';
import {
    Tooltip,
    TooltipContent,
    TooltipPositioner,
    TooltipTrigger,
} from '@/components/ui/tooltip';
import { BrainIcon, EyeIcon, FileIcon, WrenchIcon } from 'lucide-react';
import { match } from 'ts-pattern';
import { cn } from '@/lib/utils';
import { Model } from '@/zero/types';

export interface CapabilityBadgesProps {
    capabilities?: Model['capabilities'];
    className?: string;
}

export function CapabilityBadges({ capabilities, className }: CapabilityBadgesProps) {
    if (!capabilities || capabilities.length === 0) {
        return null;
    }

    const sortedCapabilities = [...capabilities].sort((a, b) => a.localeCompare(b));

    return (
        <div className={cn('flex items-center gap-1', className)}>
            {sortedCapabilities.map(capability => (
                <Tooltip key={capability}>
                    <TooltipTrigger>
                        <div
                            className={cn(
                                'text-[10px] font-medium text-primary p-1 rounded-lg z-1',
                                match(capability)
                                    .with('reasoning', () => 'bg-pink-400/10')
                                    .with('vision', () => 'bg-blue-400/10')
                                    .with('documents', () => 'bg-yellow-400/10')
                                    .with('tools', () => 'bg-green-400/10')
                                    .exhaustive()
                            )}
                        >
                            {match(capability)
                                .with('reasoning', () => (
                                    <BrainIcon className="size-3.5 text-pink-400" />
                                ))
                                .with('vision', () => (
                                    <EyeIcon className="size-3.5 text-blue-400" />
                                ))
                                .with('documents', () => (
                                    <FileIcon className="size-3.5 text-yellow-400" />
                                ))
                                .with('tools', () => (
                                    <WrenchIcon className="size-3.5 text-green-400" />
                                ))
                                .exhaustive()}
                        </div>
                    </TooltipTrigger>
                    <TooltipPositioner>
                        <TooltipContent>
                            {capability.charAt(0).toUpperCase() + capability.slice(1)}
                        </TooltipContent>
                    </TooltipPositioner>
                </Tooltip>
            ))}
        </div>
    );
}



================================================
FILE: src/components/ui/checkbox.tsx
================================================
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { CheckIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }



================================================
FILE: src/components/ui/code-block.tsx
================================================
import { Button } from '@/components/ui/button';
import { useCodeHighlighter } from '@/hooks/use-code-highlighter';
import { cn } from '@/lib/utils';
import { Check, Copy } from 'lucide-react';
import { useMemo, useState } from 'react';

export type CodeBlockProps = {
    children?: React.ReactNode;
    className?: string;
} & React.HTMLProps<HTMLDivElement>;

function CodeBlock({ children, className, ...props }: CodeBlockProps) {
    return (
        <div
            className={cn(
                'not-prose flex min-w-full w-0 flex-col overflow-clip border',
                'border-border bg-card text-card-foreground rounded-xl',
                className
            )}
            {...props}
        >
            {children}
        </div>
    );
}

export type CodeBlockCodeProps = {
    code: string;
    language?: string;
    theme?: string;
    className?: string;
} & React.HTMLProps<HTMLDivElement>;

function CodeBlockCode({
    code,
    language = 'tsx',
    theme = 'css-variables',
    className,
    ...props
}: CodeBlockCodeProps) {
    const [isCopied, setIsCopied] = useState(false);

    const { highlightedCode } = useCodeHighlighter({
        codeString: code,
        language,
        shouldHighlight: true,
    });

    function handleCopy() {
        if (isCopied) return;
        navigator.clipboard.writeText(code).then(() => {
            setIsCopied(true);
            setTimeout(() => setIsCopied(false), 2000);
        });
    }

    const classNames = cn('w-full overflow-x-auto', className);

    const content = useMemo(() => {
        if (!code?.trim()) {
            return <pre className="px-4" />;
        }

        if (!highlightedCode) {
            return (
                <pre className="px-4 py-0! font-mono">
                    <code>{code}</code>
                </pre>
            );
        }

        return <div className="px-4" dangerouslySetInnerHTML={{ __html: highlightedCode }} />;
    }, [highlightedCode, code]);

    return (
        <div className="relative w-full">
            <div className="flex gap-2 items-center border-b justify-between p-2">
                <div className="text-sm text-muted-foreground">{language}</div>
                <Button
                    variant="ghost"
                    size="sm"
                    onClick={handleCopy}
                    className="rounded-lg h-6 w-6 hover:bg-sidebar/50"
                >
                    {isCopied ? <Check className="size-3" /> : <Copy className="size-3" />}
                </Button>
            </div>

            <div className={classNames} {...props}>
                <div className="py-4 text-[13px] [&>pre]:px-4 [&>pre]:py-4">{content}</div>
            </div>
        </div>
    );
}

export { CodeBlockCode, CodeBlock };



================================================
FILE: src/components/ui/collapsible.tsx
================================================
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  )
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  )
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent }



================================================
FILE: src/components/ui/command.tsx
================================================
'use client';

import { Command as CommandPrimitive } from 'cmdk';
import { SearchIcon } from 'lucide-react';
import * as React from 'react';

import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogHeader,
    DialogTitle,
} from '@/components/ui/dialog';
import { cn } from '@/lib/utils';

function Command({ className, ...props }: React.ComponentProps<typeof CommandPrimitive>) {
    return (
        <CommandPrimitive
            data-slot="command"
            className={cn('flex h-full w-full flex-col overflow-hidden rounded-md', className)}
            {...props}
        />
    );
}

function CommandDialog({
    title = 'Command Palette',
    description = 'Search for a command to run...',
    children,
    className,
    showCloseButton = true,
    ...props
}: React.ComponentProps<typeof Dialog> & {
    title?: string;
    description?: string;
    className?: string;
    showCloseButton?: boolean;
}) {
    return (
        <Dialog {...props}>
            <DialogHeader className="sr-only">
                <DialogTitle>{title}</DialogTitle>
                <DialogDescription>{description}</DialogDescription>
            </DialogHeader>
            <DialogContent
                className={cn('overflow-hidden p-0', className)}
                showCloseButton={showCloseButton}
            >
                {children}
            </DialogContent>
        </Dialog>
    );
}

function CommandInput({
    className,
    ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
    return (
        <div
            data-slot="command-input-wrapper"
            className="flex h-12 items-center gap-2 border-b border-foreground/10 px-3"
        >
            <SearchIcon className="size-4 shrink-0 opacity-50" />
            <CommandPrimitive.Input
                data-slot="command-input"
                className={cn(
                    'placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50 text-md placeholder:text-sm',
                    className
                )}
                {...props}
            />
        </div>
    );
}

function CommandList({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.List>) {
    return (
        <CommandPrimitive.List
            data-slot="command-list"
            className={cn('max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto', className)}
            {...props}
        />
    );
}

function CommandEmpty({ ...props }: React.ComponentProps<typeof CommandPrimitive.Empty>) {
    return (
        <CommandPrimitive.Empty
            data-slot="command-empty"
            className="py-6 text-center text-sm"
            {...props}
        />
    );
}

function CommandGroup({
    className,
    ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
    return (
        <CommandPrimitive.Group
            data-slot="command-group"
            className={cn(
                'text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium',
                className
            )}
            {...props}
        />
    );
}

function CommandSeparator({
    className,
    ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
    return (
        <CommandPrimitive.Separator
            data-slot="command-separator"
            className={cn('bg-foreground/10 -mx-1 h-px', className)}
            {...props}
        />
    );
}

function CommandItem({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Item>) {
    return (
        <CommandPrimitive.Item
            data-slot="command-item"
            className={cn(
                "data-[selected=true]:bg-foreground/5 data-[selected=true]:text-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-md px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
                className
            )}
            {...props}
        />
    );
}

function CommandShortcut({ className, ...props }: React.ComponentProps<'span'>) {
    return (
        <span
            data-slot="command-shortcut"
            className={cn('text-muted-foreground ml-auto text-xs tracking-widest', className)}
            {...props}
        />
    );
}

export {
    Command,
    CommandDialog,
    CommandInput,
    CommandList,
    CommandEmpty,
    CommandGroup,
    CommandItem,
    CommandShortcut,
    CommandSeparator,
};



================================================
FILE: src/components/ui/dialog.tsx
================================================
import * as DialogPrimitive from '@radix-ui/react-dialog';
import { XIcon } from 'lucide-react';
import * as React from 'react';

import { cn } from '@/lib/utils';

function Dialog({ ...props }: React.ComponentProps<typeof DialogPrimitive.Root>) {
    return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
    return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: React.ComponentProps<typeof DialogPrimitive.Portal>) {
    return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: React.ComponentProps<typeof DialogPrimitive.Close>) {
    return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({
    className,
    ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
    return (
        <DialogPrimitive.Overlay
            data-slot="dialog-overlay"
            className={cn(
                'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',
                className
            )}
            {...props}
        />
    );
}

function DialogContent({
    className,
    children,
    showCloseButton = true,
    ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
    showCloseButton?: boolean;
}) {
    return (
        <DialogPortal data-slot="dialog-portal">
            <DialogOverlay />
            <DialogPrimitive.Content
                data-slot="dialog-content"
                className={cn(
                    'bg-background/90 dark:bg-background/50 backdrop-blur-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border border-foreground/10 p-6 shadow-lg duration-200 sm:max-w-lg',
                    className
                )}
                {...props}
            >
                {children}
                {showCloseButton && (
                    <DialogPrimitive.Close
                        data-slot="dialog-close"
                        className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
                    >
                        <XIcon />
                        <span className="sr-only">Close</span>
                    </DialogPrimitive.Close>
                )}
            </DialogPrimitive.Content>
        </DialogPortal>
    );
}

function DialogHeader({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="dialog-header"
            className={cn('flex flex-col gap-2 text-center sm:text-left', className)}
            {...props}
        />
    );
}

function DialogFooter({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="dialog-footer"
            className={cn('flex flex-col-reverse gap-2 sm:flex-row sm:justify-end', className)}
            {...props}
        />
    );
}

function DialogTitle({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Title>) {
    return (
        <DialogPrimitive.Title
            data-slot="dialog-title"
            className={cn('text-lg leading-none font-semibold', className)}
            {...props}
        />
    );
}

function DialogDescription({
    className,
    ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
    return (
        <DialogPrimitive.Description
            data-slot="dialog-description"
            className={cn('text-muted-foreground text-sm', className)}
            {...props}
        />
    );
}

export {
    Dialog,
    DialogClose,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogOverlay,
    DialogPortal,
    DialogTitle,
    DialogTrigger,
};



================================================
FILE: src/components/ui/dropdown-menu.tsx
================================================
import * as DropdownMenuPrimitive from '@radix-ui/react-dropdown-menu';
import { CheckIcon, ChevronRightIcon, CircleIcon } from 'lucide-react';
import * as React from 'react';

import { cn } from '@/lib/utils';

function DropdownMenu({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
    return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />;
}

function DropdownMenuPortal({
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
    return <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />;
}

function DropdownMenuTrigger({
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
    return <DropdownMenuPrimitive.Trigger data-slot="dropdown-menu-trigger" {...props} />;
}

function DropdownMenuContent({
    className,
    sideOffset = 4,
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
    return (
        <DropdownMenuPrimitive.Portal>
            <DropdownMenuPrimitive.Content
                data-slot="dropdown-menu-content"
                sideOffset={sideOffset}
                className={cn(
                    'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md',
                    className
                )}
                {...props}
            />
        </DropdownMenuPrimitive.Portal>
    );
}

function DropdownMenuGroup({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
    return <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />;
}

function DropdownMenuItem({
    className,
    inset,
    variant = 'default',
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean;
    variant?: 'default' | 'destructive';
}) {
    return (
        <DropdownMenuPrimitive.Item
            data-slot="dropdown-menu-item"
            data-inset={inset}
            data-variant={variant}
            className={cn(
                "focus:bg-foreground/10 focus:text-muted-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
                className
            )}
            {...props}
        />
    );
}

function DropdownMenuCheckboxItem({
    className,
    children,
    checked,
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
    return (
        <DropdownMenuPrimitive.CheckboxItem
            data-slot="dropdown-menu-checkbox-item"
            className={cn(
                "focus:bg-muted focus:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
                className
            )}
            checked={checked}
            {...props}
        >
            <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
                <DropdownMenuPrimitive.ItemIndicator>
                    <CheckIcon className="size-4" />
                </DropdownMenuPrimitive.ItemIndicator>
            </span>
            {children}
        </DropdownMenuPrimitive.CheckboxItem>
    );
}

function DropdownMenuRadioGroup({
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
    return <DropdownMenuPrimitive.RadioGroup data-slot="dropdown-menu-radio-group" {...props} />;
}

function DropdownMenuRadioItem({
    className,
    children,
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
    return (
        <DropdownMenuPrimitive.RadioItem
            data-slot="dropdown-menu-radio-item"
            className={cn(
                "cursor-pointer focus:bg-muted focus:text-muted-foreground relative flex items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
                className
            )}
            {...props}
        >
            <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
                <DropdownMenuPrimitive.ItemIndicator>
                    <CircleIcon className="size-2 fill-current" />
                </DropdownMenuPrimitive.ItemIndicator>
            </span>
            {children}
        </DropdownMenuPrimitive.RadioItem>
    );
}

function DropdownMenuLabel({
    className,
    inset,
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean;
}) {
    return (
        <DropdownMenuPrimitive.Label
            data-slot="dropdown-menu-label"
            data-inset={inset}
            className={cn('px-2 py-1.5 text-sm font-medium data-[inset]:pl-8', className)}
            {...props}
        />
    );
}

function DropdownMenuSeparator({
    className,
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
    return (
        <DropdownMenuPrimitive.Separator
            data-slot="dropdown-menu-separator"
            className={cn('bg-foreground/10 -mx-1 my-1 h-px', className)}
            {...props}
        />
    );
}

function DropdownMenuShortcut({ className, ...props }: React.ComponentProps<'span'>) {
    return (
        <span
            data-slot="dropdown-menu-shortcut"
            className={cn('text-muted-foreground ml-auto text-xs tracking-widest', className)}
            {...props}
        />
    );
}

function DropdownMenuSub({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
    return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />;
}

function DropdownMenuSubTrigger({
    className,
    inset,
    children,
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean;
}) {
    return (
        <DropdownMenuPrimitive.SubTrigger
            data-slot="dropdown-menu-sub-trigger"
            data-inset={inset}
            className={cn(
                'focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8',
                className
            )}
            {...props}
        >
            {children}
            <ChevronRightIcon className="ml-auto size-4" />
        </DropdownMenuPrimitive.SubTrigger>
    );
}

function DropdownMenuSubContent({
    className,
    ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
    return (
        <DropdownMenuPrimitive.SubContent
            data-slot="dropdown-menu-sub-content"
            className={cn(
                'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg',
                className
            )}
            {...props}
        />
    );
}

export {
    DropdownMenu,
    DropdownMenuPortal,
    DropdownMenuTrigger,
    DropdownMenuContent,
    DropdownMenuGroup,
    DropdownMenuLabel,
    DropdownMenuItem,
    DropdownMenuCheckboxItem,
    DropdownMenuRadioGroup,
    DropdownMenuRadioItem,
    DropdownMenuSeparator,
    DropdownMenuShortcut,
    DropdownMenuSub,
    DropdownMenuSubTrigger,
    DropdownMenuSubContent,
};



================================================
FILE: src/components/ui/input.tsx
================================================
import * as React from 'react';

import { cn } from '@/lib/utils';

function Input({ className, type, ...props }: React.ComponentProps<'input'>) {
    return (
        <input
            type={type}
            data-slot="input"
            className={cn(
                'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
                'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',
                'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',
                className
            )}
            {...props}
        />
    );
}

export { Input };



================================================
FILE: src/components/ui/label.tsx
================================================
import * as React from 'react';
import * as LabelPrimitive from '@radix-ui/react-label';

import { cn } from '@/lib/utils';

function Label({ className, ...props }: React.ComponentProps<typeof LabelPrimitive.Root>) {
    return (
        <LabelPrimitive.Root
            data-slot="label"
            className={cn(
                'flex items-center gap-2 text-sm text-muted-foreground leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50',
                className
            )}
            {...props}
        />
    );
}

export { Label };



================================================
FILE: src/components/ui/loader.tsx
================================================
import { cn } from "@/lib/utils"
import React from "react"

export interface LoaderProps {
  variant?:
    | "circular"
    | "classic"
    | "pulse"
    | "pulse-dot"
    | "dots"
    | "typing"
    | "wave"
    | "bars"
    | "terminal"
    | "text-blink"
    | "text-shimmer"
    | "loading-dots"
  size?: "sm" | "md" | "lg"
  text?: string
  className?: string
}

export function CircularLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const sizeClasses = {
    sm: "size-4",
    md: "size-5",
    lg: "size-6",
  }

  return (
    <div
      className={cn(
        "border-primary animate-spin rounded-full border-2 border-t-transparent",
        sizeClasses[size],
        className
      )}
    >
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function ClassicLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const sizeClasses = {
    sm: "size-4",
    md: "size-5",
    lg: "size-6",
  }

  const barSizes = {
    sm: { height: "6px", width: "1.5px" },
    md: { height: "8px", width: "2px" },
    lg: { height: "10px", width: "2.5px" },
  }

  return (
    <div className={cn("relative", sizeClasses[size], className)}>
      <div className="absolute h-full w-full">
        {[...Array(12)].map((_, i) => (
          <div
            key={i}
            className="bg-primary absolute animate-[spinner-fade_1.2s_linear_infinite] rounded-full"
            style={{
              top: "0",
              left: "50%",
              marginLeft:
                size === "sm" ? "-0.75px" : size === "lg" ? "-1.25px" : "-1px",
              transformOrigin: `${size === "sm" ? "0.75px" : size === "lg" ? "1.25px" : "1px"} ${size === "sm" ? "10px" : size === "lg" ? "14px" : "12px"}`,
              transform: `rotate(${i * 30}deg)`,
              opacity: 0,
              animationDelay: `${i * 0.1}s`,
              height: barSizes[size].height,
              width: barSizes[size].width,
            }}
          />
        ))}
      </div>
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function PulseLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const sizeClasses = {
    sm: "size-4",
    md: "size-5",
    lg: "size-6",
  }

  return (
    <div className={cn("relative", sizeClasses[size], className)}>
      <div className="border-primary absolute inset-0 animate-[thin-pulse_1.5s_ease-in-out_infinite] rounded-full border-2" />
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function PulseDotLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const sizeClasses = {
    sm: "size-1",
    md: "size-2",
    lg: "size-3",
  }

  return (
    <div
      className={cn(
        "bg-primary animate-[pulse-dot_1.2s_ease-in-out_infinite] rounded-full",
        sizeClasses[size],
        className
      )}
    >
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function DotsLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const dotSizes = {
    sm: "h-1.5 w-1.5",
    md: "h-2 w-2",
    lg: "h-2.5 w-2.5",
  }

  const containerSizes = {
    sm: "h-4",
    md: "h-5",
    lg: "h-6",
  }

  return (
    <div
      className={cn(
        "flex items-center space-x-1",
        containerSizes[size],
        className
      )}
    >
      {[...Array(3)].map((_, i) => (
        <div
          key={i}
          className={cn(
            "bg-primary animate-[bounce-dots_1.4s_ease-in-out_infinite] rounded-full",
            dotSizes[size]
          )}
          style={{
            animationDelay: `${i * 160}ms`,
          }}
        />
      ))}
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function TypingLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const dotSizes = {
    sm: "h-1 w-1",
    md: "h-1.5 w-1.5",
    lg: "h-2 w-2",
  }

  const containerSizes = {
    sm: "h-4",
    md: "h-5",
    lg: "h-6",
  }

  return (
    <div
      className={cn(
        "flex items-center space-x-1",
        containerSizes[size],
        className
      )}
    >
      {[...Array(3)].map((_, i) => (
        <div
          key={i}
          className={cn(
            "bg-primary animate-[typing_1s_infinite] rounded-full",
            dotSizes[size]
          )}
          style={{
            animationDelay: `${i * 250}ms`,
          }}
        />
      ))}
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function WaveLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const barWidths = {
    sm: "w-0.5",
    md: "w-0.5",
    lg: "w-1",
  }

  const containerSizes = {
    sm: "h-4",
    md: "h-5",
    lg: "h-6",
  }

  const heights = {
    sm: ["6px", "9px", "12px", "9px", "6px"],
    md: ["8px", "12px", "16px", "12px", "8px"],
    lg: ["10px", "15px", "20px", "15px", "10px"],
  }

  return (
    <div
      className={cn(
        "flex items-center gap-0.5",
        containerSizes[size],
        className
      )}
    >
      {[...Array(5)].map((_, i) => (
        <div
          key={i}
          className={cn(
            "bg-primary animate-[wave_1s_ease-in-out_infinite] rounded-full",
            barWidths[size]
          )}
          style={{
            animationDelay: `${i * 100}ms`,
            height: heights[size][i],
          }}
        />
      ))}
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function BarsLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const barWidths = {
    sm: "w-1",
    md: "w-1.5",
    lg: "w-2",
  }

  const containerSizes = {
    sm: "h-4 gap-1",
    md: "h-5 gap-1.5",
    lg: "h-6 gap-2",
  }

  return (
    <div className={cn("flex", containerSizes[size], className)}>
      {[...Array(3)].map((_, i) => (
        <div
          key={i}
          className={cn(
            "bg-primary h-full animate-[wave-bars_1.2s_ease-in-out_infinite]",
            barWidths[size]
          )}
          style={{
            animationDelay: `${i * 0.2}s`,
          }}
        />
      ))}
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function TerminalLoader({
  className,
  size = "md",
}: {
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const cursorSizes = {
    sm: "h-3 w-1.5",
    md: "h-4 w-2",
    lg: "h-5 w-2.5",
  }

  const textSizes = {
    sm: "text-xs",
    md: "text-sm",
    lg: "text-base",
  }

  const containerSizes = {
    sm: "h-4",
    md: "h-5",
    lg: "h-6",
  }

  return (
    <div
      className={cn(
        "flex items-center space-x-1",
        containerSizes[size],
        className
      )}
    >
      <span className={cn("text-primary font-mono", textSizes[size])}>
        {">"}
      </span>
      <div
        className={cn(
          "bg-primary animate-[blink_1s_step-end_infinite]",
          cursorSizes[size]
        )}
      />
      <span className="sr-only">Loading</span>
    </div>
  )
}

export function TextBlinkLoader({
  text = "Thinking",
  className,
  size = "md",
}: {
  text?: string
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const textSizes = {
    sm: "text-xs",
    md: "text-sm",
    lg: "text-base",
  }

  return (
    <div
      className={cn(
        "animate-[text-blink_2s_ease-in-out_infinite] font-medium",
        textSizes[size],
        className
      )}
    >
      {text}
    </div>
  )
}

export function TextShimmerLoader({
  text = "Thinking",
  className,
  size = "md",
}: {
  text?: string
  className?: string
  size?: "sm" | "md" | "lg"
}) {
  const textSizes = {
    sm: "text-xs",
    md: "text-sm",
    lg: "text-base",
  }

  return (
    <div
      className={cn(
        "bg-[linear-gradient(to_right,var(--muted-foreground)_40%,var(--foreground)_60%,var(--muted-foreground)_80%)]",
        "bg-size-[200%_auto] bg-clip-text font-medium text-transparent",
        "animate-[shimmer_4s_infinite_linear]",
        textSizes[size],
        className
      )}
    >
      {text}
    </div>
  )
}

export function TextDotsLoader({
  className,
  text = "Thinking",
  size = "md",
}: {
  className?: string
  text?: string
  size?: "sm" | "md" | "lg"
}) {
  const textSizes = {
    sm: "text-xs",
    md: "text-sm",
    lg: "text-base",
  }

  return (
    <div
      className={cn("inline-flex items-center", className)}
    >
      <span className={cn("text-primary font-medium", textSizes[size])}>
        {text}
      </span>
      <span className="inline-flex">
        <span className="text-primary animate-[loading-dots_1.4s_infinite_0.2s]">
          .
        </span>
        <span className="text-primary animate-[loading-dots_1.4s_infinite_0.4s]">
          .
        </span>
        <span className="text-primary animate-[loading-dots_1.4s_infinite_0.6s]">
          .
        </span>
      </span>
    </div>
  )
}

function Loader({
  variant = "circular",
  size = "md",
  text,
  className,
}: LoaderProps) {
  switch (variant) {
    case "circular":
      return <CircularLoader size={size} className={className} />
    case "classic":
      return <ClassicLoader size={size} className={className} />
    case "pulse":
      return <PulseLoader size={size} className={className} />
    case "pulse-dot":
      return <PulseDotLoader size={size} className={className} />
    case "dots":
      return <DotsLoader size={size} className={className} />
    case "typing":
      return <TypingLoader size={size} className={className} />
    case "wave":
      return <WaveLoader size={size} className={className} />
    case "bars":
      return <BarsLoader size={size} className={className} />
    case "terminal":
      return <TerminalLoader size={size} className={className} />
    case "text-blink":
      return <TextBlinkLoader text={text} size={size} className={className} />
    case "text-shimmer":
      return <TextShimmerLoader text={text} size={size} className={className} />
    case "loading-dots":
      return <TextDotsLoader text={text} size={size} className={className} />
    default:
      return <CircularLoader size={size} className={className} />
  }
}

export { Loader }



================================================
FILE: src/components/ui/markdown.tsx
================================================
import { Response } from '@/components/ai-elements/response';
import { CodeBlock, CodeBlockCode } from '@/components/ui/code-block';
import {
    Tooltip,
    TooltipContent,
    TooltipPositioner,
    TooltipTrigger,
} from '@/components/ui/tooltip';
import { cn } from '@/lib/utils';
import { createContext, memo, useContext, useId, useMemo } from 'react';
import { type Components } from 'react-markdown';

const generateKey = () => {
    return (
        Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15)
    );
};

export type MarkdownProps = {
    children: string;
    id?: string;
    className?: string;
    components?: Partial<Components>;
    animated?: boolean;
};

interface CitationSourceConfig {
    name: string;
    pattern: RegExp;
    urlGenerator: (title: string, source: string) => string | null;
}

const citationSources: CitationSourceConfig[] = [
    {
        name: 'Wikipedia',
        pattern: /Wikipedia/i,
        urlGenerator: (title: string, source: string) => {
            const searchTerm = `${title} ${source.replace(/\s+[-–—]\s+Wikipedia/i, '')}`.trim();
            return `https://en.wikipedia.org/wiki/${encodeURIComponent(
                searchTerm.replace(/\s+/g, '_')
            )}`;
        },
    },
    {
        name: 'arXiv',
        pattern: /arXiv:(\d+\.\d+)/i,
        urlGenerator: (_: string, source: string) => {
            const match = source.match(/arXiv:(\d+\.\d+)/i);
            return match ? `https://arxiv.org/abs/${match[1]}` : null;
        },
    },
    {
        name: 'GitHub',
        pattern: /github\.com\/[^\/]+\/[^\/\s]+/i,
        urlGenerator: (_: string, source: string) => {
            const match = source.match(/(https?:\/\/github\.com\/[^\/]+\/[^\/\s]+)/i);
            return match ? match[1] : null;
        },
    },
    {
        name: 'DOI',
        pattern: /doi:(\S+)/i,
        urlGenerator: (_: string, source: string) => {
            const match = source.match(/doi:(\S+)/i);
            return match ? `https://doi.org/${match[1]}` : null;
        },
    },
];

const processCitation = (title: string, source: string): { text: string; url: string } | null => {
    for (const citationSource of citationSources) {
        if (citationSource.pattern.test(source)) {
            const url = citationSource.urlGenerator(title, source);
            if (url) {
                return {
                    text: `${title} - ${source}`,
                    url,
                };
            }
        }
    }
    return null;
};

function extractDomain(url: string | undefined): string {
    if (!url) return '';
    try {
        const urlObj = new URL(url);
        return urlObj.hostname.replace(/^www\./, '');
    } catch {
        // If URL parsing fails, try to extract domain manually
        const match = url.match(/^(?:https?:\/\/)?(?:www\.)?([^\/\s]+)/);
        return match ? match[1] : url;
    }
}

function extractLanguage(className?: string): string {
    if (!className) return 'plaintext';

    const match = className.match(/language-(\w+)/);

    return match ? match[1] : 'plaintext';
}

const INITIAL_COMPONENTS: Partial<Components> = {
    p: function TextComponent({ children, className }) {
        const id = useId();
        const { animated } = useMarkdownContext();

        if (typeof children === 'string' && animated) {
            const words = children.split(/\s+/);
            const segments = words.reduce<string[]>((acc, cur, idx) => {
                if (idx % 10 === 0) {
                    const segment = words.slice(idx, idx + 10).join(' ');
                    // Add trailing space except for the last segment
                    acc.push(idx + 10 >= words.length ? segment : segment + ' ');
                }
                return acc;
            }, []);
            return (
                <p className={cn(className, 'w-full')}>
                    {segments.map((segment, idx) => {
                        return (
                            <span
                                key={`${id}-${idx}`}
                                className="fade-segment"
                                style={{
                                    animationDelay: `${idx * 1.5}ms`,
                                }}
                            >
                                {segment}
                            </span>
                        );
                    })}
                </p>
            );
        }
        return <p className={cn(className, 'w-full')}>{children}</p>;
    },
    code: function CodeComponent(props) {
        const isInline =
            !props.node?.position?.start.line ||
            props.node?.position?.start.line === props.node?.position?.end.line;

        if (isInline) {
            return (
                <span className={cn('bg-muted rounded-sm px-1 font-mono text-sm')}>
                    {props.children}
                </span>
            );
        }

        const language = extractLanguage(props.className);

        return (
            <CodeBlock>
                <CodeBlockCode
                    code={(props.children as string)?.replace('\n```*', '')}
                    language={language?.trim() || 'plaintext'}
                />
            </CodeBlock>
        );
    },
    pre: function PreComponent(props) {
        return props.children;
    },
    a: function LinkComponent({ href, children }) {
        const { citations } = useMarkdownContext();
        const citationIndex = citations.findIndex(citation => citation.link === href);

        if (citationIndex !== -1) {
            const domain = extractDomain(href);
            return (
                <Tooltip>
                    <TooltipTrigger>
                        <a
                            href={href}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="text-xs bg-muted rounded-xl px-1 flex items-center no-underline"
                        >
                            {domain || citationIndex + 1}
                        </a>
                    </TooltipTrigger>
                    <TooltipPositioner>
                        <TooltipContent>{citations[citationIndex].text}</TooltipContent>
                    </TooltipPositioner>
                </Tooltip>
            );
        }
        return (
            <a href={href} target="_blank" rel="noopener noreferrer">
                {children}
            </a>
        );
    },
};

type MarkdownContextType = {
    citations: { text: string; link: string }[];
    animated: boolean;
};

const MarkdownContext = createContext<MarkdownContextType | null>(null);

const useMarkdownContext = () => {
    const context = useContext(MarkdownContext);
    if (!context) {
        throw new Error('useMarkdownContext must be used within a MarkdownProvider');
    }
    return context;
};

function MarkdownComponent({
    children,
    className,
    components = INITIAL_COMPONENTS,
    animated = false,
}: MarkdownProps) {
    const citations = useMemo(() => {
        const citations: { text: string; link: string }[] = [];

        const stdLinkRegex = /\[([^\]]+)\]\(((?:\([^()]*\)|[^()])*)\)/g;
        children = children.replace(stdLinkRegex, (_, text, url) => {
            citations.push({ text, link: url });
            return `[${text}](${url})`;
        });

        const refWithUrlRegex =
            /(?:\[(?:(?:\[?(PDF|DOC|HTML)\]?\s+)?([^\]]+))\]|\b([^.!?\n]+?(?:\s+[-–—]\s+\w+|\s+\([^)]+\)))\b)(?:\s*(?:\(|\[\s*|\s+))(https?:\/\/[^\s)]+)(?:\s*[)\]]|\s|$)/g;
        children = children.replace(refWithUrlRegex, (_, docType, bracketText, plainText, url) => {
            const text = bracketText || plainText;
            const fullText = (docType ? `[${docType}] ` : '') + text;
            const cleanUrl = url.replace(/[.,;:]+$/, '');

            citations.push({ text: fullText.trim(), link: cleanUrl });
            return `[${fullText.trim()}](${cleanUrl})`;
        });

        const quotedTitleRegex =
            /"([^"]+)"(?:\s+([^.!?\n]+?)(?:\s+[-–—]\s+(?:[A-Z][a-z]+(?:\.[a-z]+)?|\w+:\S+)))/g;
        children = children.replace(quotedTitleRegex, (match, title, source) => {
            const citation = processCitation(title, source);
            if (citation) {
                citations.push({ text: citation.text.trim(), link: citation.url });
                return `[${citation.text.trim()}](${citation.url})`;
            }
            return match;
        });

        const rawUrlRegex = /(https?:\/\/[^\s]+\.(?:pdf|doc|docx|ppt|pptx|xls|xlsx))\b/gi;
        children = children.replace(rawUrlRegex, (match, url) => {
            const filename = url.split('/').pop() || url;
            const alreadyLinked = citations.some(citation => citation.link === url);
            if (!alreadyLinked) {
                citations.push({ text: filename, link: url });
            }
            return match;
        });

        return citations.filter(citation => citation.link !== citation.text);
    }, [children]);

    return (
        <MarkdownContext.Provider value={{ citations, animated }}>
            <Response className={className} components={components}>
                {children}
            </Response>
        </MarkdownContext.Provider>
    );
}

const Markdown = memo(MarkdownComponent);
Markdown.displayName = 'Markdown';

export { Markdown };



================================================
FILE: src/components/ui/message.tsx
================================================
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import {
    Tooltip,
    TooltipContent,
    TooltipPositioner,
    TooltipProvider,
    TooltipTrigger,
} from '@/components/ui/tooltip';
import { cn } from '@/lib/utils';
import { lazy, useState, useEffect } from 'react';

const getPreloadedMarkdown = () => {
    if (import.meta.env.SSR) return null;
    return (window as any).__preload_markdown?.default || null;
};

const LazyMarkdown = import.meta.env.SSR
    ? (_: { children: string }) => null
    : lazy(async () => {
          return import('@/components/ui/markdown').then(m => ({ default: m.Markdown }));
      });

const Markdown = import.meta.env.SSR
    ? (_: { children: string }) => null
    : (props: any) => {
          const [preloadedComponent, setPreloadedComponent] = useState(getPreloadedMarkdown);

          useEffect(() => {
              const preloaded = getPreloadedMarkdown();
              if (preloaded && !preloadedComponent) {
                  setPreloadedComponent(() => preloaded);
              }
          }, [preloadedComponent]);

          if (preloadedComponent) {
              const PreloadedMarkdown = preloadedComponent;
              return <PreloadedMarkdown {...props} />;
          }

          return <LazyMarkdown {...props} />;
      };

export type MessageProps = {
    children: React.ReactNode;
    className?: string;
} & React.HTMLProps<HTMLDivElement>;

const Message = ({ children, className, ...props }: MessageProps) => (
    <div className={cn('flex gap-3', className)} {...props}>
        {children}
    </div>
);

export type MessageAvatarProps = {
    src: string;
    alt: string;
    fallback?: string;
    delayMs?: number;
    className?: string;
};

const MessageAvatar = ({ src, alt, fallback, delayMs, className }: MessageAvatarProps) => {
    return (
        <Avatar className={cn('h-8 w-8 shrink-0', className)}>
            <AvatarImage src={src} alt={alt} />
            {fallback && <AvatarFallback delayMs={delayMs}>{fallback}</AvatarFallback>}
        </Avatar>
    );
};

export type MessageContentProps = {
    children: React.ReactNode;
    markdown?: boolean;
    className?: string;
    animated?: boolean;
} & React.ComponentProps<typeof Markdown> &
    React.HTMLProps<HTMLDivElement>;

const MessageContent = ({
    children,
    markdown = false,
    animated = false,
    className,
    ...props
}: MessageContentProps) => {
    const classNames = cn('rounded-lg min-w-full break-words whitespace-normal', className);

    return markdown ? (
        <Markdown className={classNames} {...props} animated={animated}>
            {children as string}
        </Markdown>
    ) : (
        <div className={classNames} {...props}>
            {children}
        </div>
    );
};

export type MessageActionsProps = {
    children: React.ReactNode;
    className?: string;
} & React.HTMLProps<HTMLDivElement>;

const MessageActions = ({ children, className, ...props }: MessageActionsProps) => (
    <div className={cn('text-muted-foreground flex items-center gap-2', className)} {...props}>
        {children}
    </div>
);

export type MessageActionProps = {
    className?: string;
    tooltip: React.ReactNode;
    children: React.ReactNode;
    side?: 'top' | 'bottom' | 'left' | 'right';
} & React.ComponentProps<typeof Tooltip>;

const MessageAction = ({
    tooltip,
    children,
    className,
    side = 'top',
    ...props
}: MessageActionProps) => {
    return (
        <TooltipProvider>
            <Tooltip {...props}>
                <TooltipTrigger render={<div>{children}</div>} />
                <TooltipPositioner side={side}>
                    <TooltipContent className={className}>{tooltip}</TooltipContent>
                </TooltipPositioner>
            </Tooltip>
        </TooltipProvider>
    );
};

export { Message, MessageAvatar, MessageContent, MessageActions, MessageAction };



================================================
FILE: src/components/ui/popover.tsx
================================================
import * as PopoverPrimitive from '@radix-ui/react-popover';
import * as React from 'react';

import { cn } from '@/lib/utils';

function Popover({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Root>) {
    return <PopoverPrimitive.Root data-slot="popover" {...props} />;
}

function PopoverTrigger({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
    return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />;
}

function PopoverContent({
    className,
    align = 'center',
    sideOffset = 4,
    ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
    return (
        <PopoverPrimitive.Portal>
            <PopoverPrimitive.Content
                data-slot="popover-content"
                align={align}
                sideOffset={sideOffset}
                className={cn(
                    'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden before:bg-sidebar/50 before:backdrop-blur-md before:absolute before:inset-0 before:z-[-1] before:rounded-md border-foreground/10',
                    className
                )}
                {...props}
            />
        </PopoverPrimitive.Portal>
    );
}

function PopoverAnchor({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
    return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />;
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };



================================================
FILE: src/components/ui/prompt-input.tsx
================================================
import { Textarea } from '@/components/ui/textarea';
import {
    Tooltip,
    TooltipContent,
    TooltipPositioner,
    TooltipProvider,
    TooltipTrigger,
} from '@/components/ui/tooltip';
import { useParamsThreadId } from '@/hooks/use-params-thread-id';
import { cn } from '@/lib/utils';
import React, { createContext, useContext, useEffect, useRef, useState } from 'react';

type PromptInputContextType = {
    isLoading: boolean;
    value: string;
    setValue: (value: string) => void;
    maxHeight: number | string;
    onSubmit?: () => void;
    disabled?: boolean;
};

const PromptInputContext = createContext<PromptInputContextType>({
    isLoading: false,
    value: '',
    setValue: () => {},
    maxHeight: 240,
    onSubmit: undefined,
    disabled: false,
});

function usePromptInput() {
    const context = useContext(PromptInputContext);
    if (!context) {
        throw new Error('usePromptInput must be used within a PromptInput');
    }
    return context;
}

type PromptInputProps = {
    isLoading?: boolean;
    value?: string;
    onValueChange?: (value: string) => void;
    maxHeight?: number | string;
    onSubmit?: () => void;
    children: React.ReactNode;
    className?: string;
};

function PromptInput({
    className,
    isLoading = false,
    maxHeight = 240,
    value,
    onValueChange,
    onSubmit,
    children,
}: PromptInputProps) {
    const [internalValue, setInternalValue] = useState(value || '');

    const handleChange = (newValue: string) => {
        setInternalValue(newValue);
        onValueChange?.(newValue);
    };

    return (
        <TooltipProvider>
            <PromptInputContext.Provider
                value={{
                    isLoading,
                    value: value ?? internalValue,
                    setValue: onValueChange ?? handleChange,
                    maxHeight,
                    onSubmit,
                }}
            >
                <div
                    className={cn(
                        'border-input bg-background rounded-3xl border p-2 shadow-xs',
                        className
                    )}
                >
                    {children}
                </div>
            </PromptInputContext.Provider>
        </TooltipProvider>
    );
}

export type PromptInputTextareaProps = {
    disableAutosize?: boolean;
} & React.ComponentProps<typeof Textarea>;

function PromptInputTextarea({
    className,
    onKeyDown,
    disableAutosize = false,
    ...props
}: PromptInputTextareaProps) {
    const { value, setValue, maxHeight, onSubmit, disabled } = usePromptInput();
    const textareaRef = useRef<HTMLTextAreaElement>(null);
    const threadId = useParamsThreadId();
    useEffect(() => {
        if (disableAutosize) return;

        if (!textareaRef.current) return;
        textareaRef.current.style.height = 'auto';
        textareaRef.current.style.height =
            typeof maxHeight === 'number'
                ? `${Math.min(textareaRef.current.scrollHeight, maxHeight)}px`
                : `min(${textareaRef.current.scrollHeight}px, ${maxHeight})`;
    }, [value, maxHeight, disableAutosize]);

    const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            onSubmit?.();
        }
        onKeyDown?.(e);
    };

    useEffect(() => {
        if (textareaRef.current) {
            textareaRef.current.focus();
        }
    }, [threadId]);

    return (
        <Textarea
            ref={textareaRef}
            value={value}
            onChange={e => setValue(e.target.value)}
            onKeyDown={handleKeyDown}
            className={cn(
                'text-primary min-h-[64px] w-full resize-none border-none bg-transparent shadow-none outline-none focus-visible:ring-0 focus-visible:ring-offset-0',
                className
            )}
            rows={1}
            disabled={disabled}
            {...props}
        />
    );
}

type PromptInputActionsProps = React.HTMLAttributes<HTMLDivElement>;

function PromptInputActions({ children, className, ...props }: PromptInputActionsProps) {
    return (
        <div className={cn('flex items-center gap-2', className)} {...props}>
            {children}
        </div>
    );
}

type PromptInputActionProps = {
    className?: string;
    tooltip: React.ReactNode;
    children: React.ReactNode;
    side?: 'top' | 'bottom' | 'left' | 'right';
} & React.ComponentProps<typeof Tooltip>;

function PromptInputAction({
    tooltip,
    children,
    className,
    side = 'top',
    ...props
}: PromptInputActionProps) {
    const { disabled } = usePromptInput();

    return (
        <Tooltip {...props}>
            <TooltipTrigger disabled={disabled} render={<div>{children}</div>} />
            <TooltipPositioner side={side}>
                <TooltipContent className={className}>{tooltip}</TooltipContent>
            </TooltipPositioner>
        </Tooltip>
    );
}

export { PromptInput, PromptInputTextarea, PromptInputActions, PromptInputAction };



================================================
FILE: src/components/ui/section.tsx
================================================
import { cn } from '@/lib/utils';

export function Section(props: {
    className?: string;
    title: string;
    description: string;
    children: React.ReactNode;
}) {
    return (
        <div className={cn('grid grid-cols-1 md:grid-cols-3 gap-6', props.className)}>
            <div className="flex flex-col gap-2">
                <div className="font-bold">{props.title}</div>
                <div className="text-muted-foreground text-sm">{props.description}</div>
            </div>
            <div className="col-span-2 flex flex-col gap-6">{props.children}</div>
        </div>
    );
}



================================================
FILE: src/components/ui/select.tsx
================================================
import * as React from 'react';
import * as SelectPrimitive from '@radix-ui/react-select';
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from 'lucide-react';

import { cn } from '@/lib/utils';

function Select({ ...props }: React.ComponentProps<typeof SelectPrimitive.Root>) {
    return <SelectPrimitive.Root data-slot="select" {...props} />;
}

function SelectGroup({ ...props }: React.ComponentProps<typeof SelectPrimitive.Group>) {
    return <SelectPrimitive.Group data-slot="select-group" {...props} />;
}

function SelectValue({ ...props }: React.ComponentProps<typeof SelectPrimitive.Value>) {
    return <SelectPrimitive.Value data-slot="select-value" {...props} />;
}

function SelectTrigger({
    className,
    size = 'default',
    children,
    ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
    size?: 'sm' | 'default';
}) {
    return (
        <SelectPrimitive.Trigger
            data-slot="select-trigger"
            data-size={size}
            className={cn(
                "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
                className
            )}
            {...props}
        >
            {children}
            <SelectPrimitive.Icon asChild>
                <ChevronDownIcon className="size-4 opacity-50" />
            </SelectPrimitive.Icon>
        </SelectPrimitive.Trigger>
    );
}

function SelectContent({
    className,
    children,
    position = 'popper',
    ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
    return (
        <SelectPrimitive.Portal>
            <SelectPrimitive.Content
                data-slot="select-content"
                className={cn(
                    'bg-sidebar text-sidebar-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md',
                    position === 'popper' &&
                        'data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1',
                    className
                )}
                position={position}
                {...props}
            >
                <SelectScrollUpButton />
                <SelectPrimitive.Viewport
                    className={cn(
                        'p-1',
                        position === 'popper' &&
                            'h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1'
                    )}
                >
                    {children}
                </SelectPrimitive.Viewport>
                <SelectScrollDownButton />
            </SelectPrimitive.Content>
        </SelectPrimitive.Portal>
    );
}

function SelectLabel({ className, ...props }: React.ComponentProps<typeof SelectPrimitive.Label>) {
    return (
        <SelectPrimitive.Label
            data-slot="select-label"
            className={cn('text-muted-foreground px-2 py-1.5 text-xs', className)}
            {...props}
        />
    );
}

function SelectItem({
    className,
    children,
    ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
    return (
        <SelectPrimitive.Item
            data-slot="select-item"
            className={cn(
                "focus:bg-background focus:text-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
                className
            )}
            {...props}
        >
            <span className="absolute right-2 flex size-3.5 items-center justify-center">
                <SelectPrimitive.ItemIndicator>
                    <CheckIcon className="size-4" />
                </SelectPrimitive.ItemIndicator>
            </span>
            <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
        </SelectPrimitive.Item>
    );
}

function SelectSeparator({
    className,
    ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
    return (
        <SelectPrimitive.Separator
            data-slot="select-separator"
            className={cn('bg-border pointer-events-none -mx-1 my-1 h-px', className)}
            {...props}
        />
    );
}

function SelectScrollUpButton({
    className,
    ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
    return (
        <SelectPrimitive.ScrollUpButton
            data-slot="select-scroll-up-button"
            className={cn('flex cursor-default items-center justify-center py-1', className)}
            {...props}
        >
            <ChevronUpIcon className="size-4" />
        </SelectPrimitive.ScrollUpButton>
    );
}

function SelectScrollDownButton({
    className,
    ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
    return (
        <SelectPrimitive.ScrollDownButton
            data-slot="select-scroll-down-button"
            className={cn('flex cursor-default items-center justify-center py-1', className)}
            {...props}
        >
            <ChevronDownIcon className="size-4" />
        </SelectPrimitive.ScrollDownButton>
    );
}

export {
    Select,
    SelectContent,
    SelectGroup,
    SelectItem,
    SelectLabel,
    SelectScrollDownButton,
    SelectScrollUpButton,
    SelectSeparator,
    SelectTrigger,
    SelectValue,
};



================================================
FILE: src/components/ui/separator.tsx
================================================
'use client';

import * as React from 'react';
import * as SeparatorPrimitive from '@radix-ui/react-separator';

import { cn } from '@/lib/utils';

function Separator({
    className,
    orientation = 'horizontal',
    decorative = true,
    ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
    return (
        <SeparatorPrimitive.Root
            data-slot="separator"
            decorative={decorative}
            orientation={orientation}
            className={cn(
                'bg-foreground/10 shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px',
                className
            )}
            {...props}
        />
    );
}

export { Separator };



================================================
FILE: src/components/ui/sheet.tsx
================================================
import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left"
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  )
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  )
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  )
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}



================================================
FILE: src/components/ui/sidebar.tsx
================================================
import * as React from 'react';
import { Slot } from '@radix-ui/react-slot';
import { cva, VariantProps } from 'class-variance-authority';
import { PanelLeftIcon } from 'lucide-react';

import { useIsMobile } from '@/hooks/use-mobile';
import { cn } from '@/lib/utils';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Separator } from '@/components/ui/separator';
import {
    Sheet,
    SheetContent,
    SheetDescription,
    SheetHeader,
    SheetTitle,
} from '@/components/ui/sheet';
import { Skeleton } from '@/components/ui/skeleton';
import {
    Tooltip,
    TooltipContent,
    TooltipPositioner,
    TooltipProvider,
    TooltipTrigger,
} from '@/components/ui/tooltip';

const SIDEBAR_COOKIE_NAME = 'sidebar_state';
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = '16rem';
const SIDEBAR_WIDTH_MOBILE = '18rem';
const SIDEBAR_WIDTH_ICON = '3rem';
const SIDEBAR_KEYBOARD_SHORTCUT = 'b';

type SidebarContextProps = {
    state: 'expanded' | 'collapsed';
    open: boolean;
    setOpen: (open: boolean) => void;
    openMobile: boolean;
    setOpenMobile: (open: boolean) => void;
    isMobile: boolean;
    toggleSidebar: () => void;
};

const SidebarContext = React.createContext<SidebarContextProps | null>(null);

function useSidebar() {
    const context = React.useContext(SidebarContext);
    if (!context) {
        throw new Error('useSidebar must be used within a SidebarProvider.');
    }

    return context;
}

function SidebarProvider({
    defaultOpen = true,
    open: openProp,
    onOpenChange: setOpenProp,
    className,
    style,
    children,
    ...props
}: React.ComponentProps<'div'> & {
    defaultOpen?: boolean;
    open?: boolean;
    onOpenChange?: (open: boolean) => void;
}) {
    const isMobile = useIsMobile();
    const [openMobile, setOpenMobile] = React.useState(false);

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen);
    const open = openProp ?? _open;
    const setOpen = React.useCallback(
        (value: boolean | ((value: boolean) => boolean)) => {
            const openState = typeof value === 'function' ? value(open) : value;
            if (setOpenProp) {
                setOpenProp(openState);
            } else {
                _setOpen(openState);
            }

            // This sets the cookie to keep the sidebar state.
            document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
        },
        [setOpenProp, open]
    );

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
        return isMobile ? setOpenMobile(open => !open) : setOpen(open => !open);
    }, [isMobile, setOpen, setOpenMobile]);

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
        const handleKeyDown = (event: KeyboardEvent) => {
            if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {
                event.preventDefault();
                toggleSidebar();
            }
        };

        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
    }, [toggleSidebar]);

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? 'expanded' : 'collapsed';

    const contextValue = React.useMemo<SidebarContextProps>(
        () => ({
            state,
            open,
            setOpen,
            isMobile,
            openMobile,
            setOpenMobile,
            toggleSidebar,
        }),
        [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    );

    return (
        <SidebarContext.Provider value={contextValue}>
            <TooltipProvider delay={0}>
                <div
                    data-slot="sidebar-wrapper"
                    style={
                        {
                            '--sidebar-width': SIDEBAR_WIDTH,
                            '--sidebar-width-icon': SIDEBAR_WIDTH_ICON,
                            ...style,
                        } as React.CSSProperties
                    }
                    className={cn(
                        'group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full',
                        className
                    )}
                    {...props}
                >
                    {children}
                </div>
            </TooltipProvider>
        </SidebarContext.Provider>
    );
}

function Sidebar({
    side = 'left',
    variant = 'sidebar',
    collapsible = 'offcanvas',
    className,
    children,
    ...props
}: React.ComponentProps<'div'> & {
    side?: 'left' | 'right';
    variant?: 'sidebar' | 'floating' | 'inset';
    collapsible?: 'offcanvas' | 'icon' | 'none';
}) {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

    if (collapsible === 'none') {
        return (
            <div
                data-slot="sidebar"
                className={cn(
                    'bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col',
                    className
                )}
                {...props}
            >
                {children}
            </div>
        );
    }

    if (isMobile) {
        return (
            <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
                <SheetContent
                    data-sidebar="sidebar"
                    data-slot="sidebar"
                    data-mobile="true"
                    className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
                    style={
                        {
                            '--sidebar-width': SIDEBAR_WIDTH_MOBILE,
                        } as React.CSSProperties
                    }
                    side={side}
                >
                    <SheetHeader className="sr-only">
                        <SheetTitle>Sidebar</SheetTitle>
                        <SheetDescription>Displays the mobile sidebar.</SheetDescription>
                    </SheetHeader>
                    <div className="flex h-full w-full flex-col">{children}</div>
                </SheetContent>
            </Sheet>
        );
    }

    return (
        <div
            className="group peer text-sidebar-foreground hidden md:block"
            data-state={state}
            data-collapsible={state === 'collapsed' ? collapsible : ''}
            data-variant={variant}
            data-side={side}
            data-slot="sidebar"
        >
            {/* This is what handles the sidebar gap on desktop */}
            <div
                data-slot="sidebar-gap"
                className={cn(
                    'relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear',
                    'group-data-[collapsible=offcanvas]:w-0',
                    'group-data-[side=right]:rotate-180',
                    variant === 'floating' || variant === 'inset'
                        ? 'group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]'
                        : 'group-data-[collapsible=icon]:w-(--sidebar-width-icon)'
                )}
            />
            <div
                data-slot="sidebar-container"
                className={cn(
                    'fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex',
                    side === 'left'
                        ? 'left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]'
                        : 'right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]',
                    // Adjust the padding for floating and inset variants.
                    variant === 'floating' || variant === 'inset'
                        ? 'p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]'
                        : 'group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l border-foreground/10',
                    className
                )}
                {...props}
            >
                <div
                    data-sidebar="sidebar"
                    data-slot="sidebar-inner"
                    className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
                >
                    {children}
                </div>
            </div>
        </div>
    );
}

function SidebarTrigger({ className, onClick, ...props }: React.ComponentProps<typeof Button>) {
    const { toggleSidebar } = useSidebar();

    return (
        <Button
            data-sidebar="trigger"
            data-slot="sidebar-trigger"
            variant="ghost"
            size="icon"
            className={cn(className)}
            onClick={event => {
                onClick?.(event);
                toggleSidebar();
            }}
            {...props}
        >
            <PanelLeftIcon />
            <span className="sr-only">Toggle Sidebar</span>
        </Button>
    );
}

function SidebarRail({ className, ...props }: React.ComponentProps<'button'>) {
    const { toggleSidebar } = useSidebar();

    return (
        <button
            data-sidebar="rail"
            data-slot="sidebar-rail"
            aria-label="Toggle Sidebar"
            tabIndex={-1}
            onClick={toggleSidebar}
            title="Toggle Sidebar"
            className={cn(
                'hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex',
                'in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize',
                '[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize',
                'hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full',
                '[[data-side=left][data-collapsible=offcanvas]_&]:-right-2',
                '[[data-side=right][data-collapsible=offcanvas]_&]:-left-2',
                className
            )}
            {...props}
        />
    );
}

function SidebarInset({ className, ...props }: React.ComponentProps<'main'>) {
    return (
        <main
            data-slot="sidebar-inset"
            className={cn(
                'bg-background relative flex w-full flex-1 flex-col',
                'md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2',
                className
            )}
            {...props}
        />
    );
}

function SidebarInput({ className, ...props }: React.ComponentProps<typeof Input>) {
    return (
        <Input
            data-slot="sidebar-input"
            data-sidebar="input"
            className={cn('bg-background h-8 w-full shadow-none', className)}
            {...props}
        />
    );
}

function SidebarHeader({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="sidebar-header"
            data-sidebar="header"
            className={cn('flex flex-col gap-2 p-2', className)}
            {...props}
        />
    );
}

function SidebarFooter({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="sidebar-footer"
            data-sidebar="footer"
            className={cn('flex flex-col gap-2 p-2', className)}
            {...props}
        />
    );
}

function SidebarSeparator({ className, ...props }: React.ComponentProps<typeof Separator>) {
    return (
        <Separator
            data-slot="sidebar-separator"
            data-sidebar="separator"
            className={cn('bg-sidebar-border mx-2 w-auto', className)}
            {...props}
        />
    );
}

function SidebarContent({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="sidebar-content"
            data-sidebar="content"
            className={cn(
                'flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden',
                className
            )}
            {...props}
        />
    );
}

function SidebarGroup({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="sidebar-group"
            data-sidebar="group"
            className={cn('relative flex w-full min-w-0 flex-col p-2', className)}
            {...props}
        />
    );
}

function SidebarGroupLabel({
    className,
    asChild = false,
    ...props
}: React.ComponentProps<'div'> & { asChild?: boolean }) {
    const Comp = asChild ? Slot : 'div';

    return (
        <Comp
            data-slot="sidebar-group-label"
            data-sidebar="group-label"
            className={cn(
                'text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
                'group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0',
                className
            )}
            {...props}
        />
    );
}

function SidebarGroupAction({
    className,
    asChild = false,
    ...props
}: React.ComponentProps<'button'> & { asChild?: boolean }) {
    const Comp = asChild ? Slot : 'button';

    return (
        <Comp
            data-slot="sidebar-group-action"
            data-sidebar="group-action"
            className={cn(
                'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
                // Increases the hit area of the button on mobile.
                'after:absolute after:-inset-2 md:after:hidden',
                'group-data-[collapsible=icon]:hidden',
                className
            )}
            {...props}
        />
    );
}

function SidebarGroupContent({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="sidebar-group-content"
            data-sidebar="group-content"
            className={cn('w-full text-sm', className)}
            {...props}
        />
    );
}

function SidebarMenu({ className, ...props }: React.ComponentProps<'ul'>) {
    return (
        <ul
            data-slot="sidebar-menu"
            data-sidebar="menu"
            className={cn('flex w-full min-w-0 flex-col gap-1', className)}
            {...props}
        />
    );
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<'li'>) {
    return (
        <li
            data-slot="sidebar-menu-item"
            data-sidebar="menu-item"
            className={cn('group/menu-item relative', className)}
            {...props}
        />
    );
}

const sidebarMenuButtonVariants = cva(
    'peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',
    {
        variants: {
            variant: {
                default: 'hover:bg-sidebar-accent hover:text-sidebar-accent-foreground',
                outline:
                    'bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]',
            },
            size: {
                default: 'h-8 text-sm',
                sm: 'h-7 text-xs',
                lg: 'h-12 text-sm group-data-[collapsible=icon]:p-0!',
            },
        },
        defaultVariants: {
            variant: 'default',
            size: 'default',
        },
    }
);

function SidebarMenuButton({
    asChild = false,
    isActive = false,
    variant = 'default',
    size = 'default',
    tooltip,
    className,
    ...props
}: React.ComponentProps<'button'> & {
    asChild?: boolean;
    isActive?: boolean;
    tooltip?: string | React.ComponentProps<typeof TooltipContent>;
} & VariantProps<typeof sidebarMenuButtonVariants>) {
    const Comp = asChild ? Slot : 'button';
    const { isMobile, state } = useSidebar();

    const button = (
        <Comp
            data-slot="sidebar-menu-button"
            data-sidebar="menu-button"
            data-size={size}
            data-active={isActive}
            className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
            {...props}
        />
    );

    if (!tooltip) {
        return button;
    }

    if (typeof tooltip === 'string') {
        tooltip = {
            children: tooltip,
        };
    }

    return (
        <Tooltip>
            <TooltipTrigger>{button}</TooltipTrigger>
            <TooltipPositioner
                side="right"
                align="center"
                hidden={state !== 'collapsed' || isMobile}
            >
                <TooltipContent {...tooltip} />
            </TooltipPositioner>
        </Tooltip>
    );
}

function SidebarMenuAction({
    className,
    asChild = false,
    showOnHover = false,
    ...props
}: React.ComponentProps<'button'> & {
    asChild?: boolean;
    showOnHover?: boolean;
}) {
    const Comp = asChild ? Slot : 'button';

    return (
        <Comp
            data-slot="sidebar-menu-action"
            data-sidebar="menu-action"
            className={cn(
                'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
                // Increases the hit area of the button on mobile.
                'after:absolute after:-inset-2 md:after:hidden',
                'peer-data-[size=sm]/menu-button:top-1',
                'peer-data-[size=default]/menu-button:top-1.5',
                'peer-data-[size=lg]/menu-button:top-2.5',
                'group-data-[collapsible=icon]:hidden',
                showOnHover &&
                    'peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0',
                className
            )}
            {...props}
        />
    );
}

function SidebarMenuBadge({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="sidebar-menu-badge"
            data-sidebar="menu-badge"
            className={cn(
                'text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none',
                'peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground',
                'peer-data-[size=sm]/menu-button:top-1',
                'peer-data-[size=default]/menu-button:top-1.5',
                'peer-data-[size=lg]/menu-button:top-2.5',
                'group-data-[collapsible=icon]:hidden',
                className
            )}
            {...props}
        />
    );
}

function SidebarMenuSkeleton({
    className,
    showIcon = false,
    ...props
}: React.ComponentProps<'div'> & {
    showIcon?: boolean;
}) {
    // Random width between 50 to 90%.
    const width = React.useMemo(() => {
        return `${Math.floor(Math.random() * 40) + 50}%`;
    }, []);

    return (
        <div
            data-slot="sidebar-menu-skeleton"
            data-sidebar="menu-skeleton"
            className={cn('flex h-8 items-center gap-2 rounded-md px-2', className)}
            {...props}
        >
            {showIcon && (
                <Skeleton className="size-4 rounded-md" data-sidebar="menu-skeleton-icon" />
            )}
            <Skeleton
                className="h-4 max-w-(--skeleton-width) flex-1"
                data-sidebar="menu-skeleton-text"
                style={
                    {
                        '--skeleton-width': width,
                    } as React.CSSProperties
                }
            />
        </div>
    );
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<'ul'>) {
    return (
        <ul
            data-slot="sidebar-menu-sub"
            data-sidebar="menu-sub"
            className={cn(
                'border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5',
                'group-data-[collapsible=icon]:hidden',
                className
            )}
            {...props}
        />
    );
}

function SidebarMenuSubItem({ className, ...props }: React.ComponentProps<'li'>) {
    return (
        <li
            data-slot="sidebar-menu-sub-item"
            data-sidebar="menu-sub-item"
            className={cn('group/menu-sub-item relative', className)}
            {...props}
        />
    );
}

function SidebarMenuSubButton({
    asChild = false,
    size = 'md',
    isActive = false,
    className,
    ...props
}: React.ComponentProps<'a'> & {
    asChild?: boolean;
    size?: 'sm' | 'md';
    isActive?: boolean;
}) {
    const Comp = asChild ? Slot : 'a';

    return (
        <Comp
            data-slot="sidebar-menu-sub-button"
            data-sidebar="menu-sub-button"
            data-size={size}
            data-active={isActive}
            className={cn(
                'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',
                'data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground',
                size === 'sm' && 'text-xs',
                size === 'md' && 'text-sm',
                'group-data-[collapsible=icon]:hidden',
                className
            )}
            {...props}
        />
    );
}

export {
    Sidebar,
    SidebarContent,
    SidebarFooter,
    SidebarGroup,
    SidebarGroupAction,
    SidebarGroupContent,
    SidebarGroupLabel,
    SidebarHeader,
    SidebarInput,
    SidebarInset,
    SidebarMenu,
    SidebarMenuAction,
    SidebarMenuBadge,
    SidebarMenuButton,
    SidebarMenuItem,
    SidebarMenuSkeleton,
    SidebarMenuSub,
    SidebarMenuSubButton,
    SidebarMenuSubItem,
    SidebarProvider,
    SidebarRail,
    SidebarSeparator,
    SidebarTrigger,
    useSidebar,
};



================================================
FILE: src/components/ui/skeleton.tsx
================================================
import { cn } from '@/lib/utils';

function Skeleton({ className, ...props }: React.ComponentProps<'div'>) {
    return (
        <div
            data-slot="skeleton"
            className={cn('bg-foreground/10 animate-pulse rounded-md', className)}
            {...props}
        />
    );
}

export { Skeleton };



================================================
FILE: src/components/ui/sonner.tsx
================================================
import { useTheme } from 'next-themes';
import { Toaster as Sonner, ToasterProps } from 'sonner';

const Toaster = ({ ...props }: ToasterProps) => {
    const { theme = 'system' } = useTheme();

    return (
        <Sonner
            theme={theme as ToasterProps['theme']}
            className="toaster group"
            style={
                {
                    '--normal-bg': 'var(--sidebar)',
                    '--normal-text': 'var(--sidebar-foreground)',
                    '--normal-border': 'var(--border)',
                } as React.CSSProperties
            }
            {...props}
        />
    );
};

export { Toaster };



================================================
FILE: src/components/ui/stars.tsx
================================================
import { motion } from "framer-motion";
import { useEffect, useState } from "react";

interface Star {
	id: number;
	x: number;
	y: number;
	size: number;
	delay: number;
	duration: number;
}

export function Stars() {
	const [stars, setStars] = useState<Star[]>([]);

	useEffect(() => {
		// Generate random stars
		const generateStars = () => {
			const newStars: Star[] = [];
			const starCount = 50; // Number of stars

			for (let i = 0; i < starCount; i++) {
				newStars.push({
					id: i,
					x: Math.random() * 100, // Random x position (0-100%)
					y: Math.random() * 100, // Random y position (0-100%)
					size: Math.random() * 2 + 1, // Random size (1-3px)
					delay: Math.random() * 2, // Random delay (0-2s)
					duration: Math.random() * 3 + 2, // Random duration (2-5s)
				});
			}
			setStars(newStars);
		};

		generateStars();
	}, []);

	return (
		<div className="absolute inset-0 overflow-hidden pointer-events-none">
			{stars.map((star) => (
				<motion.div
					key={star.id}
					className="absolute bg-white rounded-full"
					style={{
						left: `${star.x}%`,
						top: `${star.y}%`,
						width: `${star.size}px`,
						height: `${star.size}px`,
					}}
					initial={{ opacity: 0, scale: 0 }}
					animate={{
						opacity: [0, 1, 0],
						scale: [0, 1, 0],
					}}
					transition={{
						duration: star.duration,
						delay: star.delay,
						repeat: Number.POSITIVE_INFINITY,
						ease: "easeInOut",
					}}
				/>
			))}
		</div>
	);
}



================================================
FILE: src/components/ui/switch.tsx
================================================
import * as React from "react"
import * as SwitchPrimitive from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0"
        )}
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }



================================================
FILE: src/components/ui/table.tsx
================================================
import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}



================================================
FILE: src/components/ui/textarea.tsx
================================================
import * as React from 'react';

import { cn } from '@/lib/utils';

function Textarea({ className, ...props }: React.ComponentProps<'textarea'>) {
    return (
        <textarea
            data-slot="textarea"
            className={cn(
                'border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
                className
            )}
            {...props}
        />
    );
}

export { Textarea };



================================================
FILE: src/components/ui/tooltip.tsx
================================================
import * as React from "react";
import { Tooltip as TooltipPrimitive } from "@base-ui-components/react/tooltip";

import { cn } from "@/lib/utils";

function TooltipProvider({
  delay = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delay={delay}
      {...props}
    />
  );
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  );
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />;
}

function TooltipPositioner({
  className,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Positioner>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Positioner
        data-slot="tooltip-positioner"
        sideOffset={8}
        className={cn("z-50", className)}
        {...props}
      />
    </TooltipPrimitive.Portal>
  );
}

function TooltipContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Popup>) {
  return (
    <TooltipPrimitive.Popup
      data-slot="tooltip-content"
      className={cn(
        "bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[closed]:animate-out data-[closed]:fade-out-0 data-[closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
        className
      )}
      {...props}
    >
      {children}
      <TooltipArrow />
    </TooltipPrimitive.Popup>
  );
}

function TooltipArrow({
  className,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Arrow>) {
  return (
    <TooltipPrimitive.Arrow
      data-slot="tooltip-arrow"
      className={cn(
        "bg-primary fill-primary z-50 size-2.5 rotate-45 rounded-[2px]",
        "data-[side=bottom]:-translate-y-1/2 data-[side=bottom]:top-px",
        "data-[side=top]:translate-y-1/2 data-[side=top]:bottom-px",
        "data-[side=left]:translate-x-1/2 data-[side=left]:right-px",
        "data-[side=right]:-translate-x-1/2 data-[side=right]:left-px",
        className
      )}
      {...props}
    />
  );
}

export {
  Tooltip,
  TooltipTrigger,
  TooltipContent,
  TooltipProvider,
  TooltipPositioner,
};



================================================
FILE: src/context/database.tsx
================================================
import { authClient } from '@/lib/auth-client';
import { env } from '@/lib/env';
import { useSession } from '@/hooks/use-session';
import { Route } from '@/routes/__root';
import { schema, Schema } from '@/zero/schema';
import { Zero } from '@rocicorp/zero';
import { ZeroProvider } from '@rocicorp/zero/react';
import { createContext, useEffect, useMemo } from 'react';

export const DatabaseContext = createContext<Zero<Schema> | undefined>(undefined);

export function DatabaseProvider({ children }: { children: React.ReactNode }) {
    const loaderData = Route.useLoaderData();

    const clientSession = useSession();

    const { session, isPending } = useMemo(() => {
        return {
            session: clientSession.data,
            isPending: clientSession.isPending,
        };
    }, [clientSession, loaderData.session]);

    const zero = useMemo(() => {
        if (typeof window === 'undefined' || !session || !session.user) {
            return undefined;
        }

        return new Zero({
            userID: session.user.id,
            server: env.VITE_PUBLIC_ZERO_URL,
            auth: async () => {
                if (session) {
                    const response = await fetch(`${env.VITE_PUBLIC_API_URL}/api/auth/token`, {
                        credentials: 'include',
                    });
                    const data = await response.json();
                    return data.token;
                }
            },
            schema,
            kvStore: 'idb',
        });
    }, [session]);

    useEffect(() => {
        if (!session && !isPending) {
            // If the user is not signed in, sign them in as an anonymous user
            authClient.signIn.anonymous();
        }
    }, [session, isPending]);

    useEffect(() => {
        if (zero) {
            zero.query.model.preload();
            zero.query.setting.where('userId', '=', zero.userID).preload();
            zero.query.thread
                .where('userId', '=', zero.userID)
                .related('messages', q => q.orderBy('createdAt', 'asc'))
                .orderBy('updatedAt', 'desc')
                .preload();
        }
    }, [zero]);

    if (isPending || !session || !zero) {
        return null;
    }

    return (
        <DatabaseContext.Provider value={zero}>
            <ZeroProvider zero={zero}>{children}</ZeroProvider>
        </DatabaseContext.Provider>
    );
}



================================================
FILE: src/context/thread.tsx
================================================
import { createContext, useContext, useEffect, useMemo } from 'react';
import { Thread } from '@/thread';
import { ThreadMessage, TransformedMessagePart } from '@/ai/types';
import { ChatInit } from 'ai';
import { nanoid } from '@/lib/utils';
import { ThreadStoreImpl } from '@/thread/store';

const ThreadContext = createContext<Thread<ThreadMessage> | null>(null);

const threads = new Map<string, Thread<ThreadMessage>>();

export function ThreadProvider({
    children,
    ...init
}: {
    children: React.ReactNode;
} & ChatInit<ThreadMessage>) {
    const generateId = init.generateId ?? nanoid;

    const id = useMemo(() => {
        if (init.id) {
            return init.id;
        }

        return generateId();
    }, [init.id, generateId]);

    const thread = useMemo(() => {
        if (threads.has(id)) {
            return threads.get(id)!;
        }

        const thread = new Thread<ThreadMessage>({ ...init, id });

        threads.set(id, thread);

        return thread;
    }, [id]);

    useEffect(() => {
        if (
            init.messages &&
            init.messages.length > 0 &&
            init.messages.length >= thread.store.getState().messages.length
        ) {
            thread.store.getState().setMessages(init.messages);
        }
    }, [init.messages, id]);

    return <ThreadContext.Provider value={thread}>{children}</ThreadContext.Provider>;
}

export function useThreadContext() {
    const thread = useContext(ThreadContext);
    if (!thread) {
        throw new Error('useThreadContext must be used within a ThreadProvider');
    }
    return thread;
}

export function useThreadSelector<T>(
    selector: (state: ThreadStoreImpl<ThreadMessage>) => T,
    equalityFn?: (a: T, b: T) => boolean
) {
    return useThreadContext().store(selector, equalityFn);
}

type PartType = ThreadMessage['parts'][number]['type'];

export function usePart<Return, SelectReturn>(options: {
    id: string;
    index: number;
    type: 'reasoning';
    selector: (part: Extract<TransformedMessagePart, { type: 'reasoning' }> | null) => SelectReturn;
    equalityFn?: (a: Return | null, b: Return | null) => boolean;
}): SelectReturn;

export function usePart<T extends Exclude<PartType, 'reasoning'>, Return, SelectReturn>(options: {
    id: string;
    index: number;
    type: T;
    selector: (part: Extract<TransformedMessagePart, { type: T }>) => SelectReturn;
    equalityFn?: (a: Return, b: Return) => boolean;
}): SelectReturn;

export function usePart(options: any): any {
    const part = usePartSelector<any>(parts => {
        const part = Object.assign({}, parts[options.index]);
        if (part.type !== options.type) {
            throw new Error('Part type mismatch');
        }

        return options.selector(part as any);
    });

    return part as any;
}

export const MessageContext = createContext<string | undefined>(undefined);

const useMessageContext = () => {
    const message = useContext(MessageContext);
    if (!message) {
        throw new Error('useMessageContext must be used within a MessageContext');
    }
    return message;
};

export function usePartSelector<T>(selector: (parts: TransformedMessagePart[]) => T) {
    const id = useMessageContext();

    return useThreadSelector(state => {
        const parts = [...state.messageMap[id].parts];
        const partsWithTimestamp = parts
            .map((part, i) => {
                if (part.type === 'reasoning') {
                    // Search backwards from current position to find start timing part
                    let startPart = null;
                    for (let j = i - 1; j >= 0; j--) {
                        const candidatePart = parts[j];
                        if (
                            candidatePart?.type === 'data-reasoning-time' &&
                            'data' in candidatePart &&
                            candidatePart.data.type === 'start'
                        ) {
                            startPart = candidatePart;
                            break;
                        }
                    }

                    if (!startPart) {
                        return {
                            ...part,
                            startTime: null,
                            endTime: null,
                        };
                    }

                    // Search forwards from current position to find end timing part
                    let endPart = null;
                    for (let j = i + 1; j < parts.length; j++) {
                        const candidatePart = parts[j];
                        if (
                            candidatePart?.type === 'data-reasoning-time' &&
                            'data' in candidatePart &&
                            candidatePart.data.type === 'end'
                        ) {
                            endPart = candidatePart;
                            break;
                        }
                    }

                    if (!endPart) {
                        return {
                            ...part,
                            startTime: startPart.data.timestamp,
                            endTime: null,
                        };
                    }

                    return {
                        ...part,
                        startTime: startPart.data.timestamp,
                        endTime: endPart.data.timestamp,
                    };
                }

                return part;
            })
            .filter(part => part.type !== 'data-reasoning-time')
            .reduce((acc, part, i) => {
                const previousPart = acc.at(-1);
                if (previousPart?.type === 'reasoning' && part.type === 'reasoning') {
                    previousPart.text = `${previousPart.text}\n\n${part.text}`;
                    previousPart.state = part.state;
                    previousPart.endTime = part.endTime;
                    return acc;
                }
                acc.push(part);
                return acc;
            }, [] as TransformedMessagePart[]);

        return selector(partsWithTimestamp);
    });
}



================================================
FILE: src/database/app-schema.ts
================================================
import { relations } from 'drizzle-orm';
import { index, integer, jsonb, pgEnum, pgTable, text, timestamp } from 'drizzle-orm/pg-core';
import type { Capability, ThreadMessage } from '@/ai/types';
import { member, organization, user } from '@/database/auth-schema';
import { SubscriptionData } from '@/database/types';

export const message = pgTable(
    'message',
    {
        id: text('id').primaryKey(),
        message: jsonb('message').$type<ThreadMessage>().notNull(),
        createdAt: timestamp('created_at').notNull().defaultNow(),
        updatedAt: timestamp('updated_at').notNull().defaultNow(),
        threadId: text('thread_id')
            .notNull()
            .references(() => thread.id, { onDelete: 'cascade' }),
        userId: text('user_id')
            .notNull()
            .references(() => user.id, { onDelete: 'cascade' }),
    },
    table => [
        index('message_thread_id_index').on(table.threadId),
        index('message_user_id_index').on(table.userId),
    ]
);

export const statusEnum = pgEnum('status', ['ready', 'streaming', 'submitted']);

export const thread = pgTable(
    'thread',
    {
        id: text('id').primaryKey(),
        title: text('title'),
        status: statusEnum('status').notNull().default('ready'),
        streamId: text('stream_id'),
        createdAt: timestamp('created_at').notNull().defaultNow(),
        updatedAt: timestamp('updated_at').notNull().defaultNow(),
        userId: text('user_id')
            .notNull()
            .references(() => user.id, { onDelete: 'cascade' }),
    },
    table => [
        index('stream_id_index').on(table.streamId),
        index('thread_user_id_index').on(table.userId),
    ]
);

export const modelAccessEnum = pgEnum('access', ['public', 'account_required', 'premium_required']);

export const modelIconEnum = pgEnum('icon', [
    'anthropic',
    'claude',
    'deepseek',
    'gemini',
    'google',
    'grok',
    'meta',
    'mistral',
    'ollama',
    'openai',
    'openrouter',
    'x',
    'xai',
    'moonshot',
    'zai',
    'qwen',
]);

export const model = pgTable('model', {
    id: text('id').primaryKey(),
    name: text('name').notNull(),
    model: text('model').notNull(),
    description: text('description').notNull(),
    capabilities: jsonb('capabilities').$type<Capability[]>().notNull().default([]),
    icon: modelIconEnum('icon').notNull(),
    credits: integer('credits').notNull().default(0),
    access: modelAccessEnum('access').notNull().default('public'),
    createdAt: timestamp('created_at').notNull().defaultNow(),
    updatedAt: timestamp('updated_at').notNull().defaultNow(),
});

export const modeEnum = pgEnum('mode', ['light', 'dark']);

export const setting = pgTable(
    'setting',
    {
        id: text('id').primaryKey(),
        mode: modeEnum('mode').notNull().default('dark'),
        theme: text('theme'),
        userId: text('user_id')
            .notNull()
            .references(() => user.id, { onDelete: 'cascade' }),
        nickname: text('nickname'),
        biography: text('biography'),
        instructions: text('instructions'),
        modelId: text('model_id').notNull().default('gpt-4o-mini'),
        pinnedModels: jsonb('pinned_models')
            .$type<string[]>()
            .notNull()
            .default([
                'claude-4-sonnet',
                'gpt-4o',
                'gpt-4o-mini',
                'gemini-2.5-flash',
                'gemini-2.5-pro',
                'gemini-2.0-flash',
                'kimi-k2',
            ]),
    },
    table => [index('setting_user_id_index').on(table.userId)]
);

export const usage = pgTable(
    'usage',
    {
        id: text('id').primaryKey(),
        userId: text('user_id')
            .notNull()
            .references(() => user.id, { onDelete: 'cascade' }),
        credits: integer('credits').notNull().default(0),
        search: integer('search').notNull().default(0),
        research: integer('research').notNull().default(0),
    },
    table => [index('usage_user_id_index').on(table.userId)]
);

export const userCustomer = pgTable(
    'user_customer',
    {
        id: text('id').primaryKey().unique(),
        userId: text('user_id')
            .notNull()
            .references(() => user.id, { onDelete: 'cascade' })
            .unique(),
        subscription: jsonb('subscription').$type<SubscriptionData>(),
    },
    table => [index('user_customer_user_id_index').on(table.userId)]
);

export const organizationCustomer = pgTable('organization_customer', {
    id: text('id').primaryKey().unique(),
    organizationId: text('organization_id')
        .notNull()
        .references(() => organization.id, { onDelete: 'cascade' })
        .unique(),
    subscription: jsonb('subscription').$type<SubscriptionData>(),
});

export const userCustomerRelations = relations(userCustomer, ({ one }) => ({
    user: one(user, {
        fields: [userCustomer.userId],
        references: [user.id],
    }),
}));

export const organizationCustomerRelations = relations(organizationCustomer, ({ one }) => ({
    organization: one(organization, {
        fields: [organizationCustomer.organizationId],
        references: [organization.id],
    }),
}));

export const threadRelations = relations(thread, ({ many, one }) => ({
    user: one(user, {
        fields: [thread.userId],
        references: [user.id],
    }),
    messages: many(message),
}));

export const userRelations = relations(user, ({ many, one }) => ({
    threads: many(thread),
    messages: many(message),
    settings: one(setting, {
        fields: [user.id],
        references: [setting.userId],
    }),
    customer: one(userCustomer, {
        fields: [user.id],
        references: [userCustomer.userId],
    }),
}));

export const memberRelations = relations(member, ({ one }) => ({
    organization: one(organization, {
        fields: [member.organizationId],
        references: [organization.id],
    }),
}));

export const organizationRelations = relations(organization, ({ one, many }) => ({
    customer: one(organizationCustomer, {
        fields: [organization.id],
        references: [organizationCustomer.organizationId],
    }),
    members: many(member),
}));

export const settingRelations = relations(setting, ({ one }) => ({
    user: one(user, {
        fields: [setting.userId],
        references: [user.id],
    }),
    model: one(model, {
        fields: [setting.modelId],
        references: [model.id],
    }),
}));

export const messageRelations = relations(message, ({ one }) => ({
    thread: one(thread, {
        fields: [message.threadId],
        references: [thread.id],
    }),
    user: one(user, {
        fields: [message.userId],
        references: [user.id],
    }),
}));



================================================
FILE: src/database/auth-schema.ts
================================================
import {
  pgTable,
  text,
  timestamp,
  boolean,
  integer,
} from "drizzle-orm/pg-core";

export const user = pgTable("user", {
  id: text("id").primaryKey(),
  name: text("name").notNull(),
  email: text("email").notNull().unique(),
  emailVerified: boolean("email_verified")
    .$defaultFn(() => false)
    .notNull(),
  image: text("image"),
  createdAt: timestamp("created_at")
    .$defaultFn(() => /* @__PURE__ */ new Date())
    .notNull(),
  updatedAt: timestamp("updated_at")
    .$defaultFn(() => /* @__PURE__ */ new Date())
    .notNull(),
  isAnonymous: boolean("is_anonymous"),
});

export const session = pgTable("session", {
  id: text("id").primaryKey(),
  expiresAt: timestamp("expires_at").notNull(),
  token: text("token").notNull().unique(),
  createdAt: timestamp("created_at").notNull(),
  updatedAt: timestamp("updated_at").notNull(),
  ipAddress: text("ip_address"),
  userAgent: text("user_agent"),
  userId: text("user_id")
    .notNull()
    .references(() => user.id, { onDelete: "cascade" }),
  activeOrganizationId: text("active_organization_id"),
});

export const account = pgTable("account", {
  id: text("id").primaryKey(),
  accountId: text("account_id").notNull(),
  providerId: text("provider_id").notNull(),
  userId: text("user_id")
    .notNull()
    .references(() => user.id, { onDelete: "cascade" }),
  accessToken: text("access_token"),
  refreshToken: text("refresh_token"),
  idToken: text("id_token"),
  accessTokenExpiresAt: timestamp("access_token_expires_at"),
  refreshTokenExpiresAt: timestamp("refresh_token_expires_at"),
  scope: text("scope"),
  password: text("password"),
  createdAt: timestamp("created_at").notNull(),
  updatedAt: timestamp("updated_at").notNull(),
});

export const verification = pgTable("verification", {
  id: text("id").primaryKey(),
  identifier: text("identifier").notNull(),
  value: text("value").notNull(),
  expiresAt: timestamp("expires_at").notNull(),
  createdAt: timestamp("created_at").$defaultFn(
    () => /* @__PURE__ */ new Date(),
  ),
  updatedAt: timestamp("updated_at").$defaultFn(
    () => /* @__PURE__ */ new Date(),
  ),
});

export const organization = pgTable("organization", {
  id: text("id").primaryKey(),
  name: text("name").notNull(),
  slug: text("slug").unique(),
  logo: text("logo"),
  createdAt: timestamp("created_at").notNull(),
  metadata: text("metadata"),
});

export const member = pgTable("member", {
  id: text("id").primaryKey(),
  organizationId: text("organization_id")
    .notNull()
    .references(() => organization.id, { onDelete: "cascade" }),
  userId: text("user_id")
    .notNull()
    .references(() => user.id, { onDelete: "cascade" }),
  role: text("role").default("member").notNull(),
  createdAt: timestamp("created_at").notNull(),
});

export const invitation = pgTable("invitation", {
  id: text("id").primaryKey(),
  organizationId: text("organization_id")
    .notNull()
    .references(() => organization.id, { onDelete: "cascade" }),
  email: text("email").notNull(),
  role: text("role"),
  status: text("status").default("pending").notNull(),
  expiresAt: timestamp("expires_at").notNull(),
  inviterId: text("inviter_id")
    .notNull()
    .references(() => user.id, { onDelete: "cascade" }),
});

export const jwks = pgTable("jwks", {
  id: text("id").primaryKey(),
  publicKey: text("public_key").notNull(),
  privateKey: text("private_key").notNull(),
  createdAt: timestamp("created_at").notNull(),
});



================================================
FILE: src/database/effect.ts
================================================
import { db as instance, Transaction, type Database as DatabaseImpl } from '@/database';
import { Effect, Layer, Runtime } from 'effect';

export class Database extends Effect.Tag('Database')<
    Database,
    {
        readonly instance: DatabaseImpl;
    }
>() {
    static transaction = <TReturn, TError, TService>(
        effect: Effect.Effect<TReturn, TError, Database | TService>
    ) => {
        return Effect.gen(function* () {
            const db = yield* Database.instance;
            const runtime = yield* Effect.runtime<TService>();

            function tranction(instance: Transaction) {
                return Runtime.runPromise(
                    runtime,
                    effect.pipe(
                        Effect.provide(Layer.scoped(Database, Effect.succeed({ instance })))
                    )
                );
            }

            function callback() {
                return db.transaction(tranction);
            }

            return yield* Effect.tryPromise(callback);
        });
    };
}

export const DatabaseLive = Layer.scoped(Database, Effect.succeed({ instance }));



================================================
FILE: src/database/index.ts
================================================
import { schema } from '@/database/schema';
import { env } from '@/lib/env';
import { drizzle } from 'drizzle-orm/node-postgres';

export const db = drizzle(env.ZERO_UPSTREAM_DB, { schema });

export { schema };

export type Transaction = Parameters<Parameters<typeof db.transaction>[0]>[0];
export type Database = typeof db | Transaction;



================================================
FILE: src/database/queries.ts
================================================
import { ThreadMessage } from '@/ai/types';
import { Database } from '@/database/effect';
import { schema } from '@/database/schema';
import { CustomerId, OrganizationId, SubscriptionData, UserId } from '@/database/types';
import { Effect } from 'effect';
import { and, eq, gt, not, sql } from 'drizzle-orm';
import { UnknownException } from 'effect/Cause';

export function getThreadById(threadId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.thread.findFirst({
                where: (thread, { eq }) => eq(thread.id, threadId),
            })
        );
    });
}

export function getMessageById(messageId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.message.findFirst({
                where: (message, { eq }) => eq(message.id, messageId),
            })
        );
    });
}

export function getUserById(userId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.user.findFirst({
                where: (user, { eq }) => eq(user.id, userId),
            })
        );
    });
}

export function getModelById(modelId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.model.findFirst({
                where: (model, { eq }) => eq(model.id, modelId),
            })
        );
    });
}

export function createThread(values: { id: string; userId: string }) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .insert(schema.thread)
                .values({
                    id: values.id,
                    userId: values.userId,
                    status: 'submitted',
                })
                .returning()
        );
    });
}

export function createMessage(values: {
    threadId: string;
    userId: string;
    message: ThreadMessage;
}) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .insert(schema.message)
                .values({
                    id: values.message.id,
                    threadId: values.threadId,
                    userId: values.userId,
                    message: values.message,
                    createdAt: new Date(),
                    updatedAt: new Date(),
                })
                .returning()
        );
    });
}

export function updateMessage(values: {
    messageId: string;
    message: ThreadMessage;
    updatedAt?: Date;
}) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .update(schema.message)
                .set({
                    message: values.message,
                    updatedAt: values.updatedAt,
                })
                .where(eq(schema.message.id, values.messageId))
                .returning()
        );
    });
}

export function deleteTrailingMessages(values: {
    threadId: string;
    messageId: string;
    messageCreatedAt: Date;
}) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .delete(schema.message)
                .where(
                    and(
                        eq(schema.message.threadId, values.threadId),
                        gt(schema.message.createdAt, values.messageCreatedAt),
                        not(eq(schema.message.id, values.messageId))
                    )
                )
        );
    });
}

export function getThreadMessageHistory(threadId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        const messages = yield* Effect.tryPromise(() =>
            db.query.message.findMany({
                where: (message, { eq }) => eq(message.threadId, threadId),
                orderBy: (message, { asc }) => asc(message.createdAt),
            })
        );
        return messages.map(message => message.message);
    });
}

export function updateThread(values: {
    threadId: string;
    status: 'ready' | 'streaming' | 'submitted';
    streamId?: string | null;
    updatedAt?: Date;
}) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .update(schema.thread)
                .set({
                    status: values.status,
                    streamId: values.streamId,
                    updatedAt: values.updatedAt,
                })
                .where(eq(schema.thread.id, values.threadId))
        );
    });
}

export function updateThreadTitle(values: { threadId: string; title: string }) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .update(schema.thread)
                .set({ title: values.title, updatedAt: new Date() })
                .where(eq(schema.thread.id, values.threadId))
        );
    });
}

export function getThreadByStreamId(streamId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.thread.findFirst({
                where: (thread, { eq }) => eq(thread.streamId, streamId),
            })
        );
    });
}

export function getSettingsByUserId(userId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.setting.findFirst({
                where: (setting, { eq }) => eq(setting.userId, userId),
                with: {
                    model: true,
                },
            })
        );
    });
}

export function getUserCustomerByUserId(userId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.userCustomer.findFirst({
                where: (userCustomer, { eq }) => eq(userCustomer.userId, userId),
            })
        );
    });
}

export function createUserCustomer(values: { userId: string; customerId: CustomerId }) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .insert(schema.userCustomer)
                .values({
                    id: values.customerId,
                    userId: values.userId,
                })
                .returning()
        );
    });
}

export function updateUserCustomerSubscription(values: {
    customerId: CustomerId;
    subscription: SubscriptionData;
}) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .update(schema.userCustomer)
                .set({ subscription: values.subscription })
                .where(eq(schema.userCustomer.id, values.customerId))
        );
    });
}

export function getOrganizationCustomerByOrganizationId(organizationId: OrganizationId) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.organizationCustomer.findFirst({
                where: (organizationCustomer, { eq }) =>
                    eq(organizationCustomer.organizationId, organizationId),
            })
        );
    });
}

export function createOrganizationCustomer(values: {
    organizationId: OrganizationId;
    customerId: CustomerId;
}) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .insert(schema.organizationCustomer)
                .values({
                    id: values.customerId,
                    organizationId: values.organizationId,
                })
                .returning()
        );
    });
}

export function updateOrganizationCustomerSubscription(values: {
    customerId: CustomerId;
    subscription: SubscriptionData;
}) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .update(schema.organizationCustomer)
                .set({ subscription: values.subscription })
                .where(eq(schema.organizationCustomer.id, values.customerId))
        );
    });
}

export function getUsageByUserId(userId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.usage.findFirst({
                where: (usage, { eq }) => eq(usage.userId, userId),
            })
        );
    });
}

export function incrementUsage(
    values: { userId: string; type: 'search' | 'research' | 'credits' },
    amount: number
) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .update(schema.usage)
                .set({
                    [values.type]: sql`${schema.usage[values.type]} + ${amount}`,
                })
                .where(eq(schema.usage.userId, values.userId))
        );
    });
}

export function decrementUsage(
    values: { userId: string; type: 'search' | 'research' | 'credits' },
    amount: number
) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .update(schema.usage)
                .set({
                    [values.type]: sql`${schema.usage[values.type]} - ${amount}`,
                })
                .where(eq(schema.usage.userId, values.userId))
        );
    });
}

export function resetUsage() {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db
                .update(schema.usage)
                .set({
                    credits: 0,
                    research: 0,
                    search: 0,
                })
                .execute()
        );
    });
}

export function getThreadByIdAndUserId(
    threadId: string,
    userId: string
): Effect.Effect<any, UnknownException, Database> {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.thread.findFirst({
                where: (thread, { eq, and }) =>
                    and(eq(thread.id, threadId), eq(thread.userId, userId)),
                with: {
                    messages: {
                        orderBy: (message, { asc }) => asc(message.createdAt),
                    },
                },
            })
        );
    });
}

export function getThreadsByUserId(userId: string) {
    return Effect.gen(function* () {
        const db = yield* Database.instance;
        return yield* Effect.tryPromise(() =>
            db.query.thread.findMany({
                where: (thread, { eq }) => eq(thread.userId, userId),
                with: {
                    messages: {
                        orderBy: (message, { asc }) => asc(message.createdAt),
                    },
                },
                limit: 20,
                orderBy: (thread, { desc }) => desc(thread.updatedAt),
            })
        );
    });
}

export function getSSRData(id: string) {
    return Database.transaction(
        Effect.Do.pipe(
            Effect.bind('results', () =>
                Effect.all(
                    [
                        getSettingsByUserId(id),
                        getUserCustomerByUserId(id),
                        getUsageByUserId(id),
                        getUserById(id),
                        getThreadsByUserId(id),
                    ],
                    {
                        concurrency: 'unbounded',
                    }
                )
            )
        )
    );
}



================================================
FILE: src/database/schema.ts
================================================
import * as appSchema from '@/database/app-schema';
import * as authSchema from '@/database/auth-schema';

export const schema = {
    ...authSchema,
    ...appSchema,
};

export * from '@/database/auth-schema';
export * from '@/database/app-schema';



================================================
FILE: src/database/types.ts
================================================
import { Brand } from 'effect';

export type CustomerId = string & Brand.Brand<'CustomerId'>;
export const CustomerId = Brand.nominal<CustomerId>();

export type UserId = string & Brand.Brand<'UserId'>;
export const UserId = Brand.nominal<UserId>();

export type OrganizationId = string & Brand.Brand<'OrganizationId'>;
export const OrganizationId = Brand.nominal<OrganizationId>();

export type SubscriptionData = {
    priceId: string;
    subscriptionId: string;
    currentPeriodStart: number;
    currentPeriodEnd: number;
    cancelAtPeriodEnd: boolean;
    seats: number;
};



================================================
FILE: src/emails/magic-link.tsx
================================================
import { Body, Container, Head, Heading, Html, Link, Preview, Text } from '@react-email/components';

interface MagicLinkEmailProps {
    url?: string;
}

export const MagicLinkEmail = ({ url }: MagicLinkEmailProps) => (
    <Html>
        <Head />
        <Body style={main}>
            <Preview>Log in with this magic link</Preview>
            <Container style={container}>
                <Heading style={h1}>Login</Heading>
                <Link
                    href={url}
                    target="_blank"
                    style={{
                        ...link,
                        display: 'block',
                        marginBottom: '16px',
                    }}
                >
                    Click here to log in with this magic link
                </Link>
                <Text
                    style={{
                        ...text,
                        color: '#ababab',
                        marginTop: '14px',
                        marginBottom: '16px',
                    }}
                >
                    If you didn&apos;t try to login, you can safely ignore this email.
                </Text>
            </Container>
        </Body>
    </Html>
);

MagicLinkEmail.PreviewProps = {
    url: 'https://zeron.sh',
} as MagicLinkEmailProps;

export default MagicLinkEmail;

const main = {
    backgroundColor: '#ffffff',
};

const container = {
    paddingLeft: '12px',
    paddingRight: '12px',
    margin: '0 auto',
};

const h1 = {
    color: '#333',
    fontFamily:
        "-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif",
    fontSize: '24px',
    fontWeight: 'bold',
    margin: '40px 0',
    padding: '0',
};

const link = {
    color: '#2754C5',
    fontFamily:
        "-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif",
    fontSize: '14px',
    textDecoration: 'underline',
};

const text = {
    color: '#333',
    fontFamily:
        "-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif",
    fontSize: '14px',
    margin: '24px 0',
};



================================================
FILE: src/hooks/use-access.ts
================================================
import { useCustomer, useUsage, useSettings, useUser } from '@/hooks/use-database';
import { AnonymousLimits, FreeLimits, ProLimits } from '@/lib/constants';
import { useCallback, useMemo } from 'react';
import { Model } from '@/zero/types';
import { match, P } from 'ts-pattern';

export function useAccess() {
    const customer = useCustomer();
    const user = useUser();
    const settings = useSettings();
    const usage = useUsage();

    const isPro = useMemo(() => {
        if (!customer) return false;
        if (!customer.subscription) return false;
        return customer.subscription.currentPeriodEnd > Date.now() / 1000;
    }, [customer]);

    const limits = useMemo(() => {
        if (user?.isAnonymous) return AnonymousLimits;
        if (!customer) return FreeLimits;
        if (!isPro) return FreeLimits;
        return ProLimits;
    }, [customer, user?.isAnonymous, isPro]);

    const isExpiring = useMemo(() => {
        if (!customer) return false;
        if (!customer.subscription) return false;
        return customer.subscription.cancelAtPeriodEnd;
    }, [customer]);

    const remainingCredits = useMemo(() => {
        if (!usage) return 0;

        return limits.CREDITS - (usage.credits ?? 0);
    }, [usage, limits]);

    const remainingSearches = useMemo(() => {
        if (!usage) return 0;
        return limits.SEARCH - (usage.search ?? 0);
    }, [usage, limits]);

    const remainingResearches = useMemo(() => {
        if (!usage) return 0;
        return limits.RESEARCH - (usage.research ?? 0);
    }, [usage, limits]);

    const canSearch = useMemo(() => {
        return remainingSearches > 0;
    }, [remainingSearches, limits]);

    const canResearch = useMemo(() => {
        return remainingResearches > 0;
    }, [remainingResearches, limits]);

    const canUseModel = useMemo(() => {
        if (!settings?.model) return false;
        if (settings.model.access === 'premium_required' && !isPro) return false;
        if (settings.model.access === 'account_required' && user?.isAnonymous) return false;
        const cost = Number(settings.model.credits ?? 0);
        if (cost > remainingCredits) return false;
        return true;
    }, [settings?.model, remainingCredits, user?.isAnonymous, isPro]);

    const cannotUseModelReason = useMemo(() => {
        if (!settings?.model) return 'No model selected';
        if (settings.model.access === 'premium_required' && !isPro)
            return 'Premium required for this model';
        if (settings.model.access === 'account_required' && user?.isAnonymous)
            return 'Account required for this model';
        const cost = Number(settings.model.credits ?? 0);
        if (cost > remainingCredits) return 'Insufficient credits';
    }, [settings?.model, remainingCredits, user?.isAnonymous, isPro]);

    const checkCanUseModel = useCallback(
        (model: Model) => {
            if (model.access === 'premium_required' && !isPro) return false;
            if (model.access === 'account_required' && user?.isAnonymous) return false;
            const cost = Number(model.credits ?? 0);
            if (cost > remainingCredits) return false;
            return true;
        },
        [remainingCredits, user?.isAnonymous, isPro]
    );

    const canModelUseTools = useMemo(() => {
        if (!settings?.model) return false;
        if (settings.model?.capabilities?.includes('tools')) return true;
        return false;
    }, [settings?.model]);

    const canModelViewFiles = useMemo(() => {
        if (!settings?.model) return false;
        if (
            settings.model?.capabilities?.includes('vision') ||
            settings.model?.capabilities?.includes('documents')
        )
            return true;
        return false;
    }, [settings?.model]);

    const getCannotUseModelMatcher = useCallback(
        <T>(
            model: Model,
            callbacks: {
                onPremiumRequired?: () => T;
                onAccountRequired?: () => T;
                onInsufficientCreditsAnonymous?: () => T;
                onInsufficientCreditsPro?: () => T;
                onInsufficientCreditsNotPro?: () => T;
            }
        ) => {
            return match({
                remainingCredits,
                canAffordModel: Number(model.credits ?? 0) <= remainingCredits,
                isAnonymous: user?.isAnonymous,
                isPro,
                modelAccess: model.access,
            })
                .with(
                    {
                        remainingCredits: P.number.gt(0),
                        modelAccess: 'premium_required',
                        isPro: false,
                    },
                    () => callbacks.onPremiumRequired?.()
                )
                .with(
                    {
                        remainingCredits: P.number.gt(0),
                        modelAccess: 'account_required',
                        isAnonymous: true,
                    },
                    () => callbacks.onAccountRequired?.()
                )
                .with(
                    {
                        canAffordModel: false,
                        isAnonymous: false,
                        isPro: false,
                    },
                    () => callbacks.onInsufficientCreditsNotPro?.()
                )
                .with(
                    {
                        canAffordModel: false,
                        isAnonymous: false,
                        isPro: true,
                    },
                    () => callbacks.onInsufficientCreditsPro?.()
                )
                .with(
                    {
                        canAffordModel: false,
                        isAnonymous: true,
                        isPro: false,
                    },
                    () => callbacks.onInsufficientCreditsAnonymous?.()
                )
                .otherwise(() => null);
        },
        [remainingCredits, user?.isAnonymous, isPro]
    );

    return {
        isPro,
        limits,
        isExpiring,
        remainingCredits,
        remainingSearches,
        remainingResearches,
        canSearch,
        canResearch,
        canUseModel,
        cannotUseModelReason,
        checkCanUseModel,
        getCannotUseModelMatcher,
        canModelUseTools,
        canModelViewFiles,
    };
}



================================================
FILE: src/hooks/use-auto-resume.ts
================================================
import { useDatabase } from '@/hooks/use-database';
import { useThreadContext, useThreadSelector } from '@/context/thread';
import { useQuery } from '@rocicorp/zero/react';
import { useEffect } from 'react';

export function useAutoResume() {
    const { resumeStream, store } = useThreadContext();
    const id = useThreadSelector(state => state.id);
    const status = useThreadSelector(state => state.status);
    const db = useDatabase();
    const [thread] = useQuery(
        db.query.thread
            .where('id', '=', id ?? '')
            .related('messages', q => q.orderBy('createdAt', 'asc'))
            .one()
    );

    useEffect(() => {
        if (
            thread?.streamId &&
            // Remote status is streaming or submitted
            (thread?.status === 'streaming' || thread?.status === 'submitted') &&
            // Local status is ready
            status === 'ready'
        ) {
            store.getState().setMessages(thread.messages.map(m => m.message) ?? []);
            resumeStream();
        }
    }, [thread?.streamId, thread?.status]);
}



================================================
FILE: src/hooks/use-chats-by-time-range.ts
================================================
import { Thread } from '@/zero/types';

export function useThreadsByTimeRange<T extends Thread>(threads: T[]) {
    const MS_PER_DAY = 24 * 60 * 60 * 1000;
    const DAYS_30 = 30;

    const now = Date.now();

    const timeBoundaries = {
        oneDayAgo: now - MS_PER_DAY,
        twoDaysAgo: now - 2 * MS_PER_DAY,
        thirtyDaysAgo: now - DAYS_30 * MS_PER_DAY,
    };

    const filterThreadsByTimeRange = (startTime: number, endTime?: number) =>
        threads.filter(chat => {
            const chatTime = chat.updatedAt ?? 0;
            return endTime ? chatTime >= startTime && chatTime < endTime : chatTime >= startTime;
        });

    const groups = {
        today: filterThreadsByTimeRange(timeBoundaries.oneDayAgo),
        yesterday: filterThreadsByTimeRange(timeBoundaries.twoDaysAgo, timeBoundaries.oneDayAgo),
        lastThirtyDays: filterThreadsByTimeRange(
            timeBoundaries.thirtyDaysAgo,
            timeBoundaries.twoDaysAgo
        ),
        history: filterThreadsByTimeRange(0, timeBoundaries.thirtyDaysAgo),
    };

    return groups;
}



================================================
FILE: src/hooks/use-code-highlighter.ts
================================================
import { useEffect, useState } from 'react';
import { type Highlighter, createCssVariablesTheme, createHighlighter } from 'shiki';

let highlighterInstance: Highlighter | null = null;
let highlighterPromise: Promise<Highlighter> | null = null;

const myTheme = createCssVariablesTheme({
    name: 'css-variables',
    variablePrefix: '--shiki-',
    variableDefaults: {},
    fontStyle: true,
});

const getHighlighter = async (): Promise<Highlighter> => {
    if (highlighterInstance) {
        return highlighterInstance;
    }

    if (highlighterPromise) {
        return highlighterPromise;
    }

    highlighterPromise = createHighlighter({
        themes: [myTheme],
        langs: [
            'javascript',
            'typescript',
            'jsx',
            'tsx',
            'python',
            'java',
            'c',
            'cpp',
            'csharp',
            'php',
            'ruby',
            'go',
            'rust',
            'swift',
            'kotlin',
            'scala',
            'html',
            'css',
            'scss',
            'sass',
            'json',
            'xml',
            'yaml',
            'markdown',
            'bash',
            'shell',
            'sql',
            'dockerfile',
            'nginx',
            'apache',
            'plaintext',
        ],
    });

    highlighterInstance = await highlighterPromise;
    return highlighterInstance;
};

interface UseCodeHighlighterOptions {
    codeString: string;
    language: string;
    inline?: boolean;
    shouldHighlight?: boolean;
}

export const useCodeHighlighter = ({
    codeString,
    language,
    shouldHighlight = true,
}: UseCodeHighlighterOptions) => {
    const [highlightedCode, setHighlightedCode] = useState<string>('');
    const [isHighlighting, setIsHighlighting] = useState(true);

    useEffect(() => {
        if (!shouldHighlight) {
            setIsHighlighting(false);
            return;
        }
        setIsHighlighting(true);

        const timer = requestAnimationFrame(async () => {
            try {
                const highlighter = await getHighlighter();
                const supportedLangs = highlighter.getLoadedLanguages();
                const langToUse = supportedLangs.includes(language) ? language : 'plaintext';
                const highlighted = highlighter.codeToHtml(codeString, {
                    lang: langToUse,
                    theme: 'css-variables',
                });
                setHighlightedCode(highlighted);
            } catch (error) {
                console.error('Error highlighting code:', error);
                // Fallback to plain text if highlighting fails
                setHighlightedCode(`<pre><code>${codeString}</code></pre>`);
            } finally {
                setIsHighlighting(false);
            }
        });
        return () => cancelAnimationFrame(timer);
    }, [codeString, language, shouldHighlight]);

    return {
        highlightedCode,
        isHighlighting,
    };
};



================================================
FILE: src/hooks/use-database.ts
================================================
import { DatabaseContext } from '@/context/database';
import { useContext } from 'react';
import { Route } from '@/routes/__root';
import { useQuery } from '@rocicorp/zero/react';
import { Message, Thread } from '@/zero/types';
import { UserId } from '@/database/types';
import { useParamsThreadId } from '@/hooks/use-params-thread-id';

export function useDatabase() {
    const database = useContext(DatabaseContext);

    if (!database) {
        throw new Error('useZero must be used within a ZeroProvider');
    }

    return database;
}

export function useSettings() {
    const db = useDatabase();
    const loaderData = Route.useLoaderData();
    const [settings] = useQuery(
        db.query.setting.where('userId', '=', db.userID).related('model').one()
    );

    return settings ?? loaderData.settings;
}

export function useThreads() {
    const db = useDatabase();
    const loaderData = Route.useLoaderData();
    const [threads, result] = useQuery(
        db.query.thread
            .where('userId', '=', db.userID)
            .related('messages', q => q.orderBy('createdAt', 'desc'))
            .orderBy('updatedAt', 'desc'),
        {
            ttl: 60 * 60 * 24,
        }
    );

    return threads.length > 0 || result.type === 'complete'
        ? threads
        : ((
              loaderData.threads?.map(thread => ({
                  ...thread,
                  createdAt: thread.createdAt.getTime(),
                  updatedAt: thread.updatedAt.getTime(),
              })) as Thread[]
          )?.filter(thread => thread.userId === db.userID) ?? []);
}

export function useCustomer() {
    const db = useDatabase();
    const loaderData = Route.useLoaderData();
    const [customer] = useQuery(
        db.query.userCustomer.where('userId', '=', UserId(db.userID)).one()
    );

    return customer ?? loaderData.customer;
}

export function useUsage() {
    const db = useDatabase();
    const loaderData = Route.useLoaderData();
    const [usage] = useQuery(db.query.usage.where('userId', '=', UserId(db.userID)).one());

    return usage ?? loaderData.usage;
}

export function useThreadFromParams() {
    const threadId = useParamsThreadId();
    const db = useDatabase();
    const loaderData = Route.useLoaderData();

    const [thread] = useQuery(
        db.query.thread
            .where('id', '=', threadId ?? '')
            .related('messages', q => q.orderBy('createdAt', 'asc'))
            .one(),
        {
            ttl: 60 * 60 * 24,
        }
    );

    return (
        thread ??
        (loaderData.thread && loaderData.thread.id === threadId
            ? (loaderData.thread as unknown as Thread & {
                  messages: Message[];
              })
            : undefined)
    );
}

export function useUser() {
    const db = useDatabase();
    const loaderData = Route.useLoaderData();
    const [user] = useQuery(db.query.user.where('id', '=', UserId(db.userID)).one());

    return user ?? loaderData.user;
}



================================================
FILE: src/hooks/use-mobile.ts
================================================
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}



================================================
FILE: src/hooks/use-params-thread-id.ts
================================================
import { useParams } from '@tanstack/react-router';

export function useParamsThreadId() {
    const params = useParams({ from: '/_app/_thread/$threadId', shouldThrow: false });

    const { threadId } = params ?? { threadId: undefined };

    return threadId;
}



================================================
FILE: src/hooks/use-session.ts
================================================
import { authClient } from '@/lib/auth-client';

export function useSession() {
    return authClient.useSession();
}



================================================
FILE: src/lib/auth-client.ts
================================================
import { env } from '@/lib/env';
import {
    anonymousClient,
    emailOTPClient,
    magicLinkClient,
    organizationClient,
} from 'better-auth/client/plugins';
import { createAuthClient } from 'better-auth/react';

export const authClient = createAuthClient({
    baseURL: env.VITE_PUBLIC_API_URL,
    plugins: [magicLinkClient(), anonymousClient(), organizationClient(), emailOTPClient()],
});



================================================
FILE: src/lib/auth.ts
================================================
import { db, schema } from '@/database';
import { UserId } from '@/database/types';
import { env } from '@/lib/env';
import MagicLinkEmail from '@/emails/magic-link';
import { resend } from '@/lib/resend';
import { betterAuth } from 'better-auth';
import { drizzleAdapter } from 'better-auth/adapters/drizzle';
import { anonymous, emailOTP, jwt, magicLink, organization } from 'better-auth/plugins';
import { eq } from 'drizzle-orm';
import { nanoid } from 'nanoid';
import { Effect, Layer } from 'effect';
import { APIError } from '@/lib/error';
import { reactStartCookies } from 'better-auth/react-start';
import { setHeaders } from '@tanstack/react-start/server';

export const auth = betterAuth({
    database: drizzleAdapter(db, {
        provider: 'pg',
        schema,
    }),
    trustedOrigins: ['https://zeron.sh', 'https://www.zeron.sh', 'http://localhost:5173'],
    session: {
        expiresIn: 60 * 60 * 24 * 365,
        updateAge: 60 * 60 * 24,
    },
    socialProviders: {
        google: {
            clientId: env.GOOGLE_CLIENT_ID,
            clientSecret: env.GOOGLE_CLIENT_SECRET,
        },
        github: {
            clientId: env.GITHUB_CLIENT_ID,
            clientSecret: env.GITHUB_CLIENT_SECRET,
        },
    },
    databaseHooks: {
        user: {
            create: {
                after: async user => {
                    await db.transaction(async tx => {
                        await tx.insert(schema.setting).values({
                            id: nanoid(),
                            userId: UserId(user.id),
                            mode: 'dark',
                            theme: 'default',
                            modelId: 'kimi-k2',
                        });
                        await tx.insert(schema.usage).values({
                            id: nanoid(),
                            userId: UserId(user.id),
                            credits: 0,
                            search: 0,
                            research: 0,
                        });
                    });
                },
            },
        },
    },
    plugins: [
        reactStartCookies(),
        organization(),
        jwt(),
        magicLink({
            sendMagicLink: async ({ email, token, url }) => {
                console.log({
                    email,
                    token,
                    url,
                });

                await resend.emails.send({
                    from: 'Zeron <no-reply@zeron.sh>',
                    to: email,
                    subject: 'Your magic link',
                    react: MagicLinkEmail({ url }),
                });
            },
        }),
        emailOTP({
            sendVerificationOTP: async ({ email, otp, type }) => {
                console.log({
                    email,
                    otp,
                    type,
                });
            },
        }),
        anonymous({
            onLinkAccount: async ({ anonymousUser, newUser }) => {
                await db
                    .update(schema.thread)
                    .set({ userId: UserId(newUser.user.id) })
                    .where(eq(schema.thread.userId, UserId(anonymousUser.user.id)));

                await db
                    .update(schema.message)
                    .set({ userId: UserId(newUser.user.id) })
                    .where(eq(schema.message.userId, UserId(anonymousUser.user.id)));
            },
        }),
    ],
});

const getSession = Effect.fn('getSession')(function* (request: Request) {
    let session = yield* Effect.tryPromise(() =>
        auth.api.getSession({
            headers: request.headers,
        })
    );

    if (!session) {
        const newUser = yield* Effect.tryPromise(() => {
            return auth.api.signInAnonymous({
                headers: request.headers,
                returnHeaders: true,
            });
        });

        const setCookieHeader = newUser.headers.get('set-cookie');

        if (setCookieHeader) {
            setHeaders({
                'set-cookie': setCookieHeader,
            });
        }

        const requestHeaders = new Headers(request.headers);

        if (setCookieHeader) {
            const cookies = setCookieHeader.split(',').map(cookie => cookie.trim());
            const cookieValues: string[] = [];

            const existingCookies = requestHeaders.get('Cookie');
            if (existingCookies) {
                cookieValues.push(existingCookies);
            }

            for (const cookie of cookies) {
                const [nameValue] = cookie.split(';');
                if (nameValue) {
                    cookieValues.push(nameValue.trim());
                }
            }

            requestHeaders.set('Cookie', cookieValues.join('; '));
        }

        session = yield* Effect.tryPromise(() => {
            return auth.api.getSession({
                headers: requestHeaders,
            });
        });
    }

    if (!session) {
        return yield* new APIError({
            status: 401,
            message: 'Unauthorized',
        });
    }

    return session;
});

type Shape = NonNullable<Awaited<ReturnType<typeof auth.api.getSession>>>;

export class Session extends Effect.Tag('Session')<Session, Shape>() {}

export const SessionLive = (request: Request) =>
    Layer.scoped(
        Session,
        Effect.gen(function* () {
            return yield* getSession(request);
        })
    );



================================================
FILE: src/lib/constants.ts
================================================
export type Limits = {
    SEARCH: number;
    RESEARCH: number;
    CREDITS: number;
};

export const AnonymousLimits: Limits = {
    SEARCH: 5,
    RESEARCH: 0,
    CREDITS: 10,
};

export const FreeLimits: Limits = {
    SEARCH: 5,
    RESEARCH: 0,
    CREDITS: 20,
};

export const ProLimits: Limits = {
    SEARCH: 50,
    RESEARCH: 15,
    CREDITS: 200,
};



================================================
FILE: src/lib/env.ts
================================================
import { createEnv } from '@t3-oss/env-core';
import { z } from 'zod';

export const env = createEnv({
    server: {
        ZERO_UPSTREAM_DB: z.string().url(),
        AI_GATEWAY_API_KEY: z.string().min(1),
        EXA_API_KEY: z.string().min(1),
        STRIPE_SECRET_KEY: z.string().min(1),
        STRIPE_WEBHOOK_SECRET: z.string().min(1),
        PRO_MONTHLY_PRICE_ID: z.string().min(1),
        CRON_SECRET: z.string().min(1),
        GOOGLE_CLIENT_ID: z.string().min(1),
        GOOGLE_CLIENT_SECRET: z.string().min(1),
        GITHUB_CLIENT_ID: z.string().min(1),
        GITHUB_CLIENT_SECRET: z.string().min(1),
        RESEND_API_KEY: z.string().min(1),
        REDIS_URL: z.string().url(),
    },
    clientPrefix: 'VITE_PUBLIC_',
    client: {
        VITE_PUBLIC_API_URL: z.string().url(),
        VITE_PUBLIC_ZERO_URL: z.string().url(),
    },
    runtimeEnv: Object.assign({}, import.meta.env, process.env),
    emptyStringAsUndefined: true,
});



================================================
FILE: src/lib/error.ts
================================================
import { Data, Effect } from 'effect';

export class APIError extends Data.TaggedError('APIError')<{
    status: number;
    message?: string;
    metadata?: Record<string, unknown>;
    cause?: unknown;
}> {
    public static map({
        status,
        message,
        metadata,
    }: {
        status: number;
        message?: string;
        metadata?: Record<string, unknown>;
    }) {
        return Effect.mapError(cause => {
            if (cause instanceof APIError) {
                return cause;
            }

            return new APIError({
                status,
                message,
                metadata,
                cause,
            });
        });
    }

    private log = Effect.logError('API Error', {
        message: this.message,
        metadata: this.metadata,
        cause: this.cause,
    });

    get response() {
        const response = Response.json(
            {
                message: this.message,
                metadata: this.metadata,
            },
            { status: this.status }
        );

        const thisError = this;

        return Effect.gen(function* () {
            yield* thisError.log;

            return response;
        });
    }
}



================================================
FILE: src/lib/exa.ts
================================================
import { Exa } from 'exa-js';
import { env } from '@/lib/env';

export const exa = new Exa(env.EXA_API_KEY);

export type SearchResults = {
    query: string;
    results: {
        title: string | null;
        url: string;
        description: string;
        image: string | undefined;
    }[];
};

export async function search(query: string): Promise<SearchResults> {
    try {
        const response = await exa.searchAndContents(query, {
            summary: true,
        });

        return {
            query,
            results: response.results.map(result => ({
                title: result.title,
                url: result.url,
                description: result.summary,
                image: result.image,
            })),
        };
    } catch (error) {
        return {
            query,
            results: [],
        };
    }
}

export async function readSite(url: string) {
    try {
        const response = await exa.getContents(url);
        const result = response.results[0];

        if (!result) {
            return {
                url,
                text: '',
            };
        }
        return {
            url,
            text: result.text,
        };
    } catch (error) {
        return {
            url,
            text: '',
        };
    }
}



================================================
FILE: src/lib/redis.ts
================================================
import { env } from '@/lib/env';
import { Layer } from 'effect';
import { RedisConnectionOptionsLive, RedisPubSubLive } from 'effect-redis';

const conn = RedisConnectionOptionsLive({
    url: env.REDIS_URL,
});

export const RedisLive = RedisPubSubLive.pipe(Layer.provide(conn));



================================================
FILE: src/lib/resend.ts
================================================
import { Resend } from 'resend';
import { env } from '@/lib/env';

export const resend = new Resend(env.RESEND_API_KEY);



================================================
FILE: src/lib/stripe.ts
================================================
import { CustomerId, SubscriptionData } from '@/database/types';
import { env } from '@/lib/env';
import * as queries from '@/database/queries';
import Stripe from 'stripe';
import { Effect } from 'effect';
import { APIError } from '@/lib/error';

export const stripe = new Stripe(env.STRIPE_SECRET_KEY, {
    apiVersion: '2025-06-30.basil',
});

export const syncStripeDataToDatabase = (customerId: CustomerId) =>
    Effect.gen(function* () {
        const stripeCustomer = yield* Effect.tryPromise({
            try: () => stripe.customers.retrieve(customerId),
            catch: error =>
                new APIError({
                    status: 500,
                    message: 'Failed to retrieve customer from Stripe',
                    cause: error,
                }),
        });

        if (!('metadata' in stripeCustomer)) {
            return yield* Effect.void;
        }

        const subscriptions = yield* Effect.tryPromise({
            try: () =>
                stripe.subscriptions.list({
                    customer: customerId,
                    limit: 1,
                    status: 'all',
                }),
            catch: error =>
                new APIError({
                    status: 500,
                    message: 'Failed to retrieve subscriptions from Stripe',
                    cause: error,
                }),
        });

        const subscription = subscriptions.data[0];
        if (!subscription) {
            return yield* Effect.void;
        }

        const item = subscription.items.data[0];
        if (!item) {
            return yield* Effect.void;
        }

        const subscriptionData: SubscriptionData = {
            priceId: item.price.id,
            subscriptionId: subscription.id,
            currentPeriodStart: item.current_period_start,
            currentPeriodEnd: item.current_period_end,
            cancelAtPeriodEnd: subscription.cancel_at_period_end,
            seats: item.quantity ?? 1,
        };

        if (stripeCustomer.metadata.userId) {
            yield* queries.updateUserCustomerSubscription({
                customerId,
                subscription: subscriptionData,
            });
        }

        if (stripeCustomer.metadata.organizationId) {
            yield* queries.updateOrganizationCustomerSubscription({
                customerId,
                subscription: subscriptionData,
            });
        }
    });

export const createStripeCustomer = (email: string, userId: string) =>
    Effect.gen(function* () {
        return yield* Effect.tryPromise({
            try: () =>
                stripe.customers.create({
                    email,
                    metadata: {
                        userId,
                    },
                }),
            catch: error =>
                new APIError({
                    status: 500,
                    message: 'Failed to create customer in Stripe',
                    cause: error,
                }),
        });
    });

export const createStripeCheckoutSession = (
    customerId: string,
    successUrl: string,
    cancelUrl: string,
    priceId: string
) =>
    Effect.gen(function* () {
        return yield* Effect.tryPromise({
            try: () =>
                stripe.checkout.sessions.create({
                    customer: customerId,
                    mode: 'subscription',
                    line_items: [
                        {
                            price: priceId,
                            quantity: 1,
                        },
                    ],
                    success_url: successUrl,
                    cancel_url: cancelUrl,
                }),
            catch: error =>
                new APIError({
                    status: 500,
                    message: 'Failed to create checkout session in Stripe',
                    cause: error,
                }),
        });
    });

export const createStripeBillingPortalSession = (customerId: string, returnUrl: string) =>
    Effect.gen(function* () {
        return yield* Effect.tryPromise({
            try: () =>
                stripe.billingPortal.sessions.create({
                    customer: customerId,
                    return_url: returnUrl,
                }),
            catch: error =>
                new APIError({
                    status: 500,
                    message: 'Failed to create billing portal session in Stripe',
                    cause: error,
                }),
        });
    });



================================================
FILE: src/lib/uploadthing.ts
================================================
import { UploadRouter } from '@/routes/api.uploadthing';
import {
    generateReactHelpers,
    generateUploadButton,
    generateUploadDropzone,
} from '@uploadthing/react';

export const UploadButton = generateUploadButton<UploadRouter>();
export const UploadDropzone = generateUploadDropzone<UploadRouter>();
export const { useUploadThing } = generateReactHelpers<UploadRouter>();



================================================
FILE: src/lib/usernames.ts
================================================
import { seededRandom } from '@/lib/utils';
import { nanoid } from 'nanoid';

export function getUsername(user: { name?: string; id: string } = { id: nanoid() }): string {
    if (user.name) {
        return user.name;
    }

    const seed = user.id;

    let numericSeed = 0;
    for (let i = 0; i < seed.length; i++) {
        numericSeed += seed.charCodeAt(i) * (i + 1);
    }
    const rng = seededRandom(numericSeed);

    // Define some word lists for username generation
    const adjectives = [
        'Agile',
        'Brave',
        'Calm',
        'Clever',
        'Daring',
        'Elegant',
        'Fierce',
        'Gentle',
        'Happy',
        'Jolly',
        'Kind',
        'Lively',
        'Mighty',
        'Noble',
        'Quick',
        'Quiet',
        'Rapid',
        'Shy',
        'Smart',
        'Strong',
        'Swift',
        'Witty',
        'Bold',
        'Bright',
        'Cheerful',
        'Cool',
        'Dashing',
        'Dynamic',
        'Energetic',
        'Fearless',
        'Friendly',
        'Generous',
        'Graceful',
        'Humble',
        'Joyful',
        'Lucky',
        'Playful',
        'Powerful',
        'Radiant',
        'Reliable',
        'Resilient',
        'Sharp',
        'Sincere',
        'Skillful',
        'Spirited',
        'Steady',
        'Thoughtful',
        'Vibrant',
        'Wise',
        'Zesty',
        'Adventurous',
        'Ambitious',
        'Artistic',
        'Athletic',
        'Blissful',
        'Bubbly',
        'Caring',
        'Charismatic',
        'Charming',
        'Confident',
        'Creative',
        'Determined',
        'Devoted',
        'Eager',
        'Enthusiastic',
        'Excited',
        'Fabulous',
        'Fantastic',
        'Flawless',
        'Focused',
        'Forgiving',
        'Glorious',
        'Gracious',
        'Heroic',
        'Honest',
        'Hopeful',
        'Humorous',
        'Imaginative',
        'Independent',
        'Inspiring',
        'Intelligent',
        'Inventive',
        'Jovial',
        'Kindhearted',
        'Knowledgeable',
        'Loyal',
        'Magnificent',
        'Optimistic',
        'Passionate',
        'Peaceful',
        'Persistent',
        'Polite',
        'Resilient',
        'Trustworthy',
    ];

    const nouns = [
        'Tiger',
        'Eagle',
        'Fox',
        'Bear',
        'Wolf',
        'Hawk',
        'Lion',
        'Shark',
        'Panda',
        'Otter',
        'Falcon',
        'Dolphin',
        'Rabbit',
        'Turtle',
        'Owl',
        'Cheetah',
        'Leopard',
        'Panther',
        'Cobra',
        'Dragon',
        'Phoenix',
        'Unicorn',
        'Griffin',
        'Pegasus',
        'Whale',
        'Penguin',
        'Kangaroo',
        'Zebra',
        'Giraffe',
        'Elephant',
        'Rhino',
        'Hippo',
        'Crocodile',
        'Alligator',
        'Lizard',
        'Frog',
        'Snake',
        'Spider',
        'Scorpion',
        'Antelope',
        'Buffalo',
        'Camel',
        'Chameleon',
        'Deer',
        'Flamingo',
        'Gazelle',
        'Hedgehog',
        'Koala',
        'Lemur',
        'Lynx',
        'Meerkat',
        'Moose',
        'Narwhal',
        'Octopus',
        'Parrot',
        'Platypus',
        'Porcupine',
        'Raccoon',
        'Salamander',
        'Seahorse',
        'Sloth',
        'Squirrel',
        'Starfish',
        'Stingray',
        'Swan',
        'Tapir',
        'Toucan',
        'Walrus',
        'Wombat',
        'Yak',
        'Beetle',
        'Butterfly',
        'Caterpillar',
        'Centipede',
        'Cricket',
        'Firefly',
        'Grasshopper',
        'Honeybee',
        'Ladybug',
        'Mantis',
        'Moth',
        'Termite',
        'Wasp',
        'Jellyfish',
        'Lobster',
        'Crab',
        'Clam',
        'Oyster',
        'Coral',
        'Anemone',
        'Barnacle',
        'Shrimp',
        'Squid',
        'Snail',
        'Worm',
        'Gecko',
        'Salamander',
    ];

    const adjectiveIndex = Math.floor(rng() * adjectives.length);
    const nounIndex = Math.floor(rng() * nouns.length);
    const number = Math.floor(rng() * 1000);

    return `${adjectives[adjectiveIndex]}${nouns[nounIndex]}${number}`;
}



================================================
FILE: src/lib/utils.ts
================================================
import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';
import { customAlphabet } from 'nanoid';
import { marked } from 'marked';

export function cn(...inputs: ClassValue[]) {
    return twMerge(clsx(inputs));
}

export const nanoid = customAlphabet(
    '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',
    21
);

export function seededRandom(seed: number): () => number {
    let state = seed;
    return (): number => {
        // Constants for the LCG (these values are commonly used)
        const a = 1664525; // Multiplier
        const c = 1013904223; // Increment
        const m = 2 ** 32; // Modulus (2^32)
        state = (a * state + c) % m;
        return state / m; // Normalize to [0, 1)
    };
}

export const lexer = (() => {
    let lastText = '';
    let lastResult: string[] = [];
    return (markdown: string): string[] => {
        if (markdown === lastText) {
            return lastResult;
        }
        lastText = markdown;
        const tokens = marked.lexer(markdown);
        lastResult = tokens.map(token => token.raw);
        return lastResult;
    };
})();



================================================
FILE: src/routes/__root.tsx
================================================
import '@/global.css';
import { HeadContent, Outlet, Scripts, createRootRoute } from '@tanstack/react-router';
import { DatabaseProvider } from '@/context/database';
import { cn } from '@/lib/utils';
import { Toaster } from '@/components/ui/sonner';
import { createServerFn } from '@tanstack/react-start';
import { Session, SessionLive } from '@/lib/auth';
import { getWebRequest } from '@tanstack/react-start/server';
import { Clock, Effect } from 'effect';
import * as queries from '@/database/queries';
import { DatabaseLive } from '@/database/effect';
import { useEffect, useRef } from 'react';
import { useSettings } from '@/hooks/use-database';
import { z } from 'zod';
import { ProDialog } from '@/components/app/pro-dialog';

const GetContextSchema = z.object({
    threadId: z.string().optional(),
});

const getContext = createServerFn({ method: 'GET' })
    .validator((obj: unknown) => {
        return GetContextSchema.parse(obj);
    })
    .handler(async ({ data }) => {
        const program = Effect.Do.pipe(
            Effect.let('request', () => getWebRequest()),
            Effect.flatMap(({ request }) => {
                return Effect.Do.pipe(
                    Effect.bind('now', () => Clock.currentTimeMillis),
                    Effect.bind('session', () => Session),
                    Effect.bind('context', ({ session }) => queries.getSSRData(session.user.id)),
                    Effect.bind('thread', ({ session }) => {
                        if (data.threadId) {
                            return queries.getThreadByIdAndUserId(data.threadId, session.user.id);
                        }
                        return Effect.succeed(null);
                    }),
                    Effect.bind('end', () => Clock.currentTimeMillis),
                    Effect.tap(({ now, end }) => Effect.log(`SSR Duration: ${end - now}ms`)),
                    Effect.provide(SessionLive(request))
                );
            }),
            Effect.map(({ context, session, thread }) => ({
                session,
                thread,
                settings: context.results[0],
                customer: context.results[1],
                usage: context.results[2],
                user: context.results[3],
                threads: context.results[4],
            })),
            Effect.provide(DatabaseLive),
            Effect.catchAll(_ => Effect.succeed(undefined))
        );

        return Effect.runPromise(program);
    });

export const Route = createRootRoute({
    shouldReload: false,
    loader: async ({ params }) => {
        const context = await getContext({
            data: params,
        });

        return {
            settings: context?.settings,
            session: context?.session,
            threads: context?.threads,
            customer: context?.customer,
            usage: context?.usage,
            user: context?.user,
            thread: context?.thread,
        };
    },
    head: ctx => ({
        meta: [
            {
                charSet: 'utf-8',
            },
            {
                name: 'viewport',
                content: 'width=device-width, initial-scale=1',
            },
            {
                title: ctx?.loaderData?.thread?.title ?? 'Zeron',
            },
            {
                name: 'description',
                content: 'Chat with models from OpenAI, Anthropic, and more.',
            },
        ],
        links: [
            {
                rel: 'preconnect',
                href: 'https://fonts.googleapis.com',
            },
            {
                rel: 'preconnect',
                href: 'https://fonts.gstatic.com',
                crossOrigin: 'anonymous',
            },
            {
                rel: 'stylesheet',
                href: 'https://fonts.googleapis.com/css2?family=Geist+Mono:wght@400;500;600;700&family=Geist:wght@400;500;600;700&family=IBM+Plex+Serif:wght@400;500;600;700&display=swap',
            },
        ],
    }),
    notFoundComponent: () => <div>Not found</div>,
    component: () => <RootDocument />,
});

function RootComponent({ htmlRef }: { htmlRef: React.RefObject<HTMLHtmlElement | null> }) {
    const settings = useSettings();
    const mountedRef = useRef(false);

    useEffect(() => {
        if (htmlRef.current) {
            htmlRef.current.className = cn(settings?.mode ?? 'dark', settings?.theme ?? 'default');
        }
    }, [settings?.mode, settings?.theme]);

    useEffect(() => {
        if (!mountedRef.current) {
            import('@/components/ui/markdown').then(module => {
                console.log('Markdown loaded');

                (window as any).__preload_markdown = {
                    default: module.Markdown,
                };
            });
        }
        mountedRef.current = true;
    }, []);

    return (
        <div className="fixed inset-0 flex text-foreground">
            <Outlet />
            <Toaster position="top-center" />
            <ProDialog />
        </div>
    );
}

function RootDocument() {
    const ref = useRef<HTMLHtmlElement>(null);
    const loaderData = Route.useLoaderData();

    return (
        <html
            lang="en"
            ref={ref}
            className={cn(
                loaderData?.settings?.mode ?? 'dark',
                loaderData?.settings?.theme ?? 'default'
            )}
        >
            <head>
                <HeadContent />
            </head>
            <body className="fixed inset-0">
                <DatabaseProvider>
                    <RootComponent htmlRef={ref} />
                </DatabaseProvider>
                <Scripts />
            </body>
        </html>
    );
}



================================================
FILE: src/routes/_account.account.appearance.tsx
================================================
import { Section } from '@/components/ui/section';

import { Separator } from '@/components/ui/separator';
import { useDatabase } from '@/hooks/use-database';
import { useSettings } from '@/hooks/use-database';
import { cn } from '@/lib/utils';
import { createFileRoute } from '@tanstack/react-router';
import { MoonIcon, SunIcon } from 'lucide-react';

const themes = [
    {
        name: 'Default',
        value: 'default',
        description: 'Clean and minimal design',
    },
    {
        name: 'T3 Chat',
        value: 't3-chat',
        description: 'Modern chat interface style',
    },
    {
        name: 'Claymorphism',
        value: 'claymorphism',
        description: 'Soft, clay-like appearance',
    },
    {
        name: 'Claude',
        value: 'claude',
        description: "Anthropic's Claude-inspired theme",
    },
    {
        name: 'Graphite',
        value: 'graphite',
        description: 'Dark and sophisticated',
    },
    {
        name: 'Amethyst Haze',
        value: 'amethyst-haze',
        description: 'Purple-tinted aesthetic',
    },
    {
        name: 'Vercel',
        value: 'vercel',
        description: 'Vercel-inspired design',
    },
];

export const Route = createFileRoute('/_account/account/appearance')({
    component: RouteComponent,
});

function RouteComponent() {
    const settings = useSettings();
    const db = useDatabase();

    if (!settings) return null;

    const mode = settings.mode ?? 'dark';

    const handleThemeChange = (themeValue: string) => {
        db.mutate.setting.update({
            id: settings.id,
            theme: themeValue,
        });
    };

    const handleModeChange = (newMode: 'light' | 'dark') => {
        db.mutate.setting.update({
            id: settings.id,
            mode: newMode,
        });
    };

    return (
        <div className="flex flex-col gap-8 w-full">
            <title>Appearance | Zeron</title>
            <Section title="Mode" description="Choose between light and dark mode">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button
                        type="button"
                        className={cn(
                            'relative p-4 rounded-lg border cursor-pointer transition-all hover:border-foreground/20 text-left w-full bg-muted/50 backdrop-blur-md border-foreground/15',
                            settings.mode === 'light'
                                ? 'border-primary/50 bg-primary/5'
                                : 'border-foreground/10 hover:bg-muted/50'
                        )}
                        onClick={() => handleModeChange('light')}
                    >
                        <div className="flex items-center gap-3">
                            <div className="flex items-center justify-center w-8 h-8 rounded-md bg-muted">
                                <SunIcon className="size-4" />
                            </div>
                            <div className="flex-1">
                                <div className="font-medium">Light Mode</div>
                                <div className="text-sm text-muted-foreground">
                                    Bright interface for daytime use
                                </div>
                            </div>
                        </div>
                        {settings.mode === 'light' && (
                            <div className="absolute top-2 right-2">
                                <div className="size-2 bg-primary rounded-full" />
                            </div>
                        )}
                    </button>

                    <button
                        type="button"
                        className={cn(
                            'relative p-4 rounded-lg border cursor-pointer transition-all hover:border-foreground/20 text-left w-full bg-muted/50 backdrop-blur-md border-foreground/15',
                            settings.mode === 'dark'
                                ? 'border-primary/50 bg-primary/5'
                                : 'border-foreground/10 hover:bg-muted/50'
                        )}
                        onClick={() => handleModeChange('dark')}
                    >
                        <div className="flex items-center gap-3">
                            <div className="flex items-center justify-center w-8 h-8 rounded-md bg-muted">
                                <MoonIcon className="size-4" />
                            </div>
                            <div className="flex-1">
                                <div className="font-medium">Dark Mode</div>
                                <div className="text-sm text-muted-foreground">
                                    Dark interface for nighttime use
                                </div>
                            </div>
                        </div>
                        {settings.mode === 'dark' && (
                            <div className="absolute top-2 right-2">
                                <div className="size-2 bg-primary rounded-full" />
                            </div>
                        )}
                    </button>
                </div>
            </Section>
            <Separator />
            <Section title="Theme" description="Choose your preferred visual theme">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {themes.map(themeOption => (
                        <button
                            key={themeOption.value}
                            type="button"
                            className={cn(
                                'relative p-4 rounded-lg border cursor-pointer transition-all hover:border-foreground/20 text-left w-full bg-background/10 backdrop-blur-md overflow-hidden',
                                themeOption.value === settings.theme
                                    ? 'border-primary/50 bg-primary/5'
                                    : 'border-foreground/10 hover:bg-muted/50'
                            )}
                            onClick={() => handleThemeChange(themeOption.value)}
                        >
                            <div className="flex items-center gap-3 mb-3">
                                <div className="flex-1">
                                    <div className="font-medium text-sm">{themeOption.name}</div>
                                    <div className="text-xs text-muted-foreground">
                                        {themeOption.description}
                                    </div>
                                </div>
                            </div>
                            {themeOption.value === settings.theme && (
                                <div className="absolute top-2 right-2">
                                    <div className="size-2 bg-primary rounded-full" />
                                </div>
                            )}
                            <div className="flex absolute left-0 right-0 bottom-0">
                                <div
                                    className={cn(
                                        themeOption.value,
                                        mode,
                                        'size-4 bg-primary flex-1'
                                    )}
                                />
                                <div
                                    className={cn(
                                        themeOption.value,
                                        mode,
                                        'size-4 bg-secondary flex-1'
                                    )}
                                />
                                <div
                                    className={cn(
                                        themeOption.value,
                                        mode,
                                        'size-4 bg-accent flex-1'
                                    )}
                                />
                            </div>
                        </button>
                    ))}
                </div>
            </Section>
        </div>
    );
}



================================================
FILE: src/routes/_account.account.index.tsx
================================================
import { useDatabase } from '@/hooks/use-database';
import { Section } from '@/components/ui/section';
import { LogoutDialog, NotAnonymous, RevokeSessionDialog } from '@/components/app/auth';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Separator } from '@/components/ui/separator';
import { authClient } from '@/lib/auth-client';
import { getUsername } from '@/lib/usernames';
import { createFileRoute } from '@tanstack/react-router';
import { Clock, Globe, Laptop, MapPin, Monitor, Smartphone, Tablet } from 'lucide-react';
import { UAParser } from 'ua-parser-js';
import { useQuery } from '@rocicorp/zero/react';

import { toast } from 'sonner';
import { SingleFieldForm } from '@/components/app/single-field-form';
import { useSession } from '@/hooks/use-session';

export const Route = createFileRoute('/_account/account/')({
    component: RouteComponent,
});

function RouteComponent() {
    const db = useDatabase();
    const { data: session } = useSession();

    const [activeSessions] = useQuery(
        db.query.session
            .where('userId', '=', db.userID)
            .where('expiresAt', '>', new Date().getTime())
    );

    const getDeviceIcon = (userAgent: string) => {
        const parser = new UAParser(userAgent);
        const device = parser.getDevice();
        const os = parser.getOS();

        if (device.type === 'mobile') return <Smartphone className="size-4" />;
        if (device.type === 'tablet') return <Tablet className="size-4" />;
        if (os.name === 'Mac OS') return <Laptop className="size-4" />;
        if (os.name === 'Windows') return <Monitor className="size-4" />;
        if (os.name === 'Linux') return <Monitor className="size-4" />;
        return <Globe className="size-4" />;
    };

    const getDeviceInfo = (userAgent: string) => {
        const parser = new UAParser(userAgent);
        const browser = parser.getBrowser();
        const os = parser.getOS();
        const device = parser.getDevice();

        const parts = [];
        if (browser.name) parts.push(browser.name);
        if (os.name) parts.push(os.name);
        if (device.model) parts.push(device.model);

        return parts.join(' • ') || 'Unknown device';
    };

    const formatDate = (date: Date) => {
        const now = new Date();
        const diff = now.getTime() - date.getTime();
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor(diff / (1000 * 60));

        if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
        if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
        if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
        return 'Just now';
    };

    return (
        <div className="flex flex-col gap-8 w-full">
            <title>Account | Zeron</title>
            <Section title="Profile" description="Update your account details">
                <SingleFieldForm
                    label="Username"
                    description="What do you want to be called?"
                    footerMessage="Please use 32 characters or less."
                    defaultValue={getUsername(session?.user)}
                    renderInput={({ onChange, value }) => (
                        <Input value={value} onChange={e => onChange(e.target.value)} />
                    )}
                    onSubmit={async value => {
                        if (!session?.user) return;
                        await authClient.updateUser({
                            name: value,
                        });
                        toast.success('Username updated');
                    }}
                />
            </Section>
            <Separator />
            <Section title="Sessions" description="Manage your sessions">
                <div className="flex flex-col gap-4">
                    {activeSessions?.map(sessionItem => {
                        const isCurrentSession = sessionItem.id === session?.session.id;
                        const deviceInfo = sessionItem.userAgent
                            ? getDeviceInfo(sessionItem.userAgent)
                            : 'Unknown device';
                        const deviceIcon = sessionItem.userAgent ? (
                            getDeviceIcon(sessionItem.userAgent)
                        ) : (
                            <Globe className="size-4" />
                        );

                        return (
                            <div
                                key={sessionItem.id}
                                className={`flex items-center justify-between p-4 rounded-lg border transition-colors ${
                                    isCurrentSession
                                        ? 'bg-primary/10 border-primary/20'
                                        : 'bg-muted/50 border-foreground/10 hover:bg-muted/80'
                                }`}
                            >
                                <div className="flex items-center gap-3 flex-1 min-w-0">
                                    <div
                                        className={`flex items-center justify-center w-8 h-8 rounded-md ${
                                            isCurrentSession
                                                ? 'bg-primary/20 text-primary'
                                                : 'bg-muted text-muted-foreground'
                                        }`}
                                    >
                                        {deviceIcon}
                                    </div>
                                    <div className="flex flex-col min-w-0 flex-1">
                                        <div className="flex items-center gap-2">
                                            <span className="text-sm font-medium truncate">
                                                {deviceInfo}
                                            </span>
                                            {isCurrentSession && (
                                                <span className="text-xs bg-primary/20 text-primary px-2 py-0.5 rounded-full">
                                                    Current
                                                </span>
                                            )}
                                        </div>
                                        <div className="flex items-center gap-4 text-xs text-muted-foreground">
                                            {sessionItem.ipAddress && (
                                                <div className="flex items-center gap-1">
                                                    <MapPin className="size-3" />
                                                    <span>{sessionItem.ipAddress}</span>
                                                </div>
                                            )}
                                            <div className="flex items-center gap-1">
                                                <Clock className="size-3" />
                                                <span>
                                                    {formatDate(new Date(sessionItem.createdAt))}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {!isCurrentSession && (
                                    <RevokeSessionDialog token={sessionItem.token}>
                                        <Button
                                            variant="ghost"
                                            size="sm"
                                            className="text-muted-foreground hover:text-destructive"
                                        >
                                            <span>Revoke</span>
                                        </Button>
                                    </RevokeSessionDialog>
                                )}

                                <NotAnonymous>
                                    {isCurrentSession && (
                                        <LogoutDialog>
                                            <Button
                                                variant="ghost"
                                                size="sm"
                                                className="text-muted-foreground hover:text-destructive"
                                            >
                                                <span>Logout</span>
                                            </Button>
                                        </LogoutDialog>
                                    )}
                                </NotAnonymous>
                            </div>
                        );
                    })}
                </div>
            </Section>
        </div>
    );
}



================================================
FILE: src/routes/_account.account.models.tsx
================================================
import { Section } from '@/components/ui/section';
import { Switch } from '@/components/ui/switch';
import { useDatabase } from '@/hooks/use-database';
import { useSettings } from '@/hooks/use-database';
import { createFileRoute } from '@tanstack/react-router';
import { useQuery } from '@rocicorp/zero/react';
import ModelIcon from '@/components/thread/model-icon';
import { Badge } from '@/components/ui/badge';
import { CapabilityBadges } from '@/components/ui/capability-badges';

export const Route = createFileRoute('/_account/account/models')({
    component: RouteComponent,
});

function RouteComponent() {
    const settings = useSettings();
    const db = useDatabase();
    const [allModels] = useQuery(db.query.model);

    if (!settings) return null;

    const currentPinned = settings.pinnedModels || [];
    const activeModelCount = currentPinned.length;

    const handleModelToggle = (modelId: string, isEnabled: boolean) => {
        let updatedPinned: string[];
        if (isEnabled) {
            updatedPinned = [...currentPinned, modelId];
        } else {
            if (activeModelCount <= 1) {
                return;
            }
            updatedPinned = currentPinned.filter(id => id !== modelId);
        }

        db.mutate.setting.update({
            id: settings.id,
            pinnedModels: updatedPinned,
        });
    };

    return (
        <div className="flex flex-col gap-8 w-full">
            <title>Models | Zeron</title>
            <Section
                title="Available Models"
                description="Toggle which models appear in your model selector"
            >
                <div className="space-y-3">
                    {allModels?.map(model => {
                        const isPinned = settings.pinnedModels?.includes(model.id) || false;

                        return (
                            <div
                                key={model.id}
                                className="flex flex-col rounded-lg border bg-card backdrop-blur-md overflow-hidden"
                            >
                                <div className="flex gap-4 flex-1 p-4 border-b">
                                    <div>
                                        <ModelIcon
                                            className="size-6 fill-primary"
                                            model={model.icon}
                                        />
                                    </div>
                                    <div className="flex gap-1 flex-1">
                                        <div className="flex flex-col gap-2">
                                            <div className="flex items-center gap-2">
                                                <span className="font-medium">{model.name}</span>
                                                {model.access === 'premium_required' && (
                                                    <Badge variant="outline" className="text-xs">
                                                        PRO
                                                    </Badge>
                                                )}
                                            </div>
                                            <p className="text-sm text-muted-foreground">
                                                {model.description}
                                            </p>
                                        </div>
                                        <Switch
                                            checked={isPinned}
                                            disabled={isPinned && activeModelCount <= 1}
                                            onCheckedChange={checked =>
                                                handleModelToggle(model.id, checked)
                                            }
                                        />
                                    </div>
                                </div>

                                <div className="flex items-center gap-3 p-4 bg-sidebar justify-between">
                                    <div>
                                        {model.capabilities && model.capabilities.length > 0 && (
                                            <div className="flex items-center gap-1">
                                                <CapabilityBadges
                                                    capabilities={model.capabilities}
                                                />
                                            </div>
                                        )}
                                    </div>

                                    <div className="text-xs text-muted-foreground">
                                        {model.credits} credit
                                        {Number(model.credits ?? 0) > 1 ? 's' : ''}/message
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            </Section>
        </div>
    );
}



================================================
FILE: src/routes/_account.account.preferences.tsx
================================================
import { Section } from '@/components/ui/section';
import { Input } from '@/components/ui/input';
import { Separator } from '@/components/ui/separator';
import { Textarea } from '@/components/ui/textarea';
import { useSettings } from '@/hooks/use-database';
import { createFileRoute } from '@tanstack/react-router';
import { toast } from 'sonner';
import z from 'zod';
import { useDatabase } from '@/hooks/use-database';
import { SingleFieldForm } from '@/components/app/single-field-form';

export const Route = createFileRoute('/_account/account/preferences')({
    component: RouteComponent,
});

const nicknameSchema = z.object({
    value: z.string().min(0).max(50),
});

const biographySchema = z.object({
    value: z.string().min(0).max(500),
});

const instructionsSchema = z.object({
    value: z.string().min(0).max(1000),
});

function RouteComponent() {
    const settings = useSettings();
    const db = useDatabase();

    const updateSetting = async (field: string, value: string) => {
        if (!settings) return;

        await db.mutate.setting.update({
            id: settings.id,
            [field]: value,
        });

        const fieldName = field.charAt(0).toUpperCase() + field.slice(1);
        toast.success(`${fieldName} saved`);
    };

    return (
        <div className="flex flex-col gap-8">
            <title>Preferences | Zeron</title>
            <Section title="Preferences" description="Customize your preferences here.">
                <SingleFieldForm
                    label="Nickname"
                    description="What do you want Zeron Chat to call you?"
                    footerMessage="Please use 50 characters or less."
                    defaultValue={settings?.nickname ?? ''}
                    schema={nicknameSchema}
                    renderInput={({ onChange, value }) => (
                        <Input
                            placeholder="Enter your nickname"
                            value={value}
                            className="bg-muted/50 backdrop-blur-md border border-foreground/15"
                            onChange={e => onChange(e.target.value)}
                        />
                    )}
                    onSubmit={value => updateSetting('nickname', value)}
                />

                <SingleFieldForm
                    label="Biography"
                    description="What should Zeron Chat know about you?"
                    footerMessage="Please use 500 characters or less."
                    defaultValue={settings?.biography ?? ''}
                    schema={biographySchema}
                    renderInput={({ onChange, value }) => (
                        <Textarea
                            className="resize-none bg-muted/50 backdrop-blur-md border border-foreground/15"
                            placeholder="Enter your biography"
                            rows={5}
                            value={value}
                            onChange={e => onChange(e.target.value)}
                        />
                    )}
                    onSubmit={value => updateSetting('biography', value)}
                />
            </Section>

            <Separator />

            <Section title="System" description="Customize your system prompt here.">
                <SingleFieldForm
                    label="Instructions"
                    description="How do you want Zeron Chat to behave?"
                    footerMessage="Please use 1000 characters or less."
                    defaultValue={settings?.instructions ?? ''}
                    schema={instructionsSchema}
                    renderInput={({ onChange, value }) => (
                        <Textarea
                            className="resize-none bg-muted/50 backdrop-blur-md border border-foreground/15"
                            placeholder="Enter your instructions"
                            rows={5}
                            value={value}
                            onChange={e => onChange(e.target.value)}
                        />
                    )}
                    onSubmit={value => updateSetting('instructions', value)}
                />
            </Section>
        </div>
    );
}



================================================
FILE: src/routes/_account.account.subscription.tsx
================================================
import { Section } from '@/components/ui/section';
import { Button } from '@/components/ui/button';
import { useAccess } from '@/hooks/use-access';
import { createFileRoute, Link } from '@tanstack/react-router';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { useSession } from '@/hooks/use-session';
import { Anonymous, NotAnonymous } from '@/components/app/auth';

export const Route = createFileRoute('/_account/account/subscription')({
    component: RouteComponent,
});

function RouteComponent() {
    const { data: session } = useSession();
    const { isPro, isExpiring, limits, remainingSearches, remainingResearches, remainingCredits } =
        useAccess();

    return (
        <div className="flex flex-col gap-8 w-full">
            <title>Subscription | Zeron</title>

            <Section title="Subscription" description="Manage your subscription.">
                <div className="space-y-4">
                    <div className="flex flex-col gap-4 bg-card p-4 rounded-lg border">
                        <h3 className="text-sm font-medium">Free</h3>
                        <div className="flex gap-2 items-center">
                            <p className="text-sm font-medium">$0</p>
                            <p className="text-sm text-muted-foreground">/month</p>
                        </div>
                        <p className="text-sm text-muted-foreground">
                            The essential features of Zeron.
                        </p>
                    </div>

                    {/* Pro Plan */}
                    <div className="flex flex-col gap-4 bg-card p-4 rounded-lg border-primary/50 border">
                        <div className="flex gap-2 items-center justify-between">
                            <h3 className="text-sm font-medium">Pro</h3>
                            <Badge variant="secondary">Recommended</Badge>
                        </div>
                        <p className="text-sm text-muted-foreground">
                            Gain access to premium models and advanced features.
                        </p>
                        <div className="flex gap-2 items-center">
                            <p className="text-sm font-medium">$25</p>
                            <p className="text-sm text-muted-foreground">/month</p>
                        </div>

                        {!isPro && (
                            <div>
                                <NotAnonymous>
                                    <Button
                                        variant="outline"
                                        onClick={() => {
                                            const url = new URL(
                                                '/api/checkout',
                                                window.location.origin
                                            );
                                            url.searchParams.set(
                                                'redirectUrl',
                                                window.location.origin + '/account/subscription'
                                            );
                                            window.location.href = url.toString();
                                        }}
                                    >
                                        Upgrade to Pro
                                    </Button>
                                </NotAnonymous>
                                <Anonymous>
                                    <Button variant="outline" asChild>
                                        <Link to="/login" search={{ callbackUrl: '/api/checkout' }}>
                                            Upgrade to Pro
                                        </Link>
                                    </Button>
                                </Anonymous>
                            </div>
                        )}

                        {isPro && (
                            <div>
                                <Button
                                    variant="outline"
                                    onClick={() => {
                                        const url = new URL(
                                            '/api/customer-portal',
                                            window.location.origin
                                        );
                                        url.searchParams.set(
                                            'redirectUrl',
                                            window.location.origin + '/account/subscription'
                                        );
                                        window.location.href = url.toString();
                                    }}
                                >
                                    Manage Subscription
                                </Button>
                            </div>
                        )}
                    </div>
                </div>
                {isPro && isExpiring && (
                    <div className="border rounded-lg p-4 bg-card">
                        <div className="flex">
                            <div className="flex-shrink-0">
                                <svg
                                    className="h-5 w-5 text-yellow-400"
                                    viewBox="0 0 20 20"
                                    fill="currentColor"
                                >
                                    <path
                                        fillRule="evenodd"
                                        d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                        clipRule="evenodd"
                                    />
                                </svg>
                            </div>
                            <div className="ml-3">
                                <h3 className="text-sm font-medium text-muted-foreground">
                                    Subscription Ending
                                </h3>
                                <div className="mt-2 text-sm text-muted-foreground">
                                    <p>
                                        Your Pro subscription has been canceled and will end at the
                                        end of your current billing period. You'll continue to have
                                        access to Pro features until then.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                )}
            </Section>
            <Separator />
            <Section title="Usage" description="Track your current usage and limits.">
                <div className="space-y-4">
                    {/* AI Credits Usage */}
                    <div className="flex flex-col gap-4 bg-card p-4 rounded-lg border">
                        <div className="flex justify-between items-center">
                            <h3 className="text-sm font-medium">Message Credits</h3>
                            <span className="text-xs text-muted-foreground">
                                {limits?.CREDITS ? limits.CREDITS - remainingCredits : 0} /{' '}
                                {limits?.CREDITS || 0}
                            </span>
                        </div>
                        <div className="w-full bg-secondary rounded-full h-2">
                            <div
                                className="bg-primary rounded-full h-2 transition-all duration-300"
                                style={{
                                    width: limits?.CREDITS
                                        ? `${Math.min(
                                              100,
                                              ((limits.CREDITS - remainingCredits) /
                                                  limits.CREDITS) *
                                                  100
                                          )}%`
                                        : '0%',
                                }}
                            ></div>
                        </div>
                        <p className="text-xs text-muted-foreground">Resets daily</p>
                    </div>
                    {/* Search Usage */}
                    <div className="flex flex-col gap-4 bg-card p-4 rounded-lg border">
                        <div className="flex justify-between items-center">
                            <h3 className="text-sm font-medium">Search Queries</h3>
                            <span className="text-xs text-muted-foreground">
                                {limits?.SEARCH ? limits.SEARCH - remainingSearches : 0} /{' '}
                                {limits?.SEARCH || 0}
                            </span>
                        </div>
                        <div className="w-full bg-secondary rounded-full h-2">
                            <div
                                className="bg-primary rounded-full h-2 transition-all duration-300"
                                style={{
                                    width: limits?.SEARCH
                                        ? `${Math.min(
                                              100,
                                              ((limits.SEARCH - remainingSearches) /
                                                  limits.SEARCH) *
                                                  100
                                          )}%`
                                        : '0%',
                                }}
                            ></div>
                        </div>
                        <p className="text-xs text-muted-foreground">Resets daily</p>
                    </div>

                    {/* Research Tools Usage */}
                    <div className="flex flex-col gap-4 bg-card p-4 rounded-lg border">
                        <div className="flex justify-between items-center">
                            <h3 className="text-sm font-medium">Research Queries</h3>
                            <span className="text-xs text-muted-foreground">
                                {limits?.RESEARCH ? limits.RESEARCH - remainingResearches : 0} /{' '}
                                {limits?.RESEARCH || 0}
                            </span>
                        </div>
                        <div className="w-full bg-secondary rounded-full h-2">
                            <div
                                className="bg-primary rounded-full h-2 transition-all duration-300"
                                style={{
                                    width: limits?.RESEARCH
                                        ? `${Math.min(
                                              100,
                                              ((limits.RESEARCH - remainingResearches) /
                                                  limits.RESEARCH) *
                                                  100
                                          )}%`
                                        : '0%',
                                }}
                            ></div>
                        </div>
                        <p className="text-xs text-muted-foreground">Resets daily</p>
                    </div>
                </div>
            </Section>
        </div>
    );
}



================================================
FILE: src/routes/_account.account.tsx
================================================
import { Anonymous } from '@/components/app/auth';
import { Button } from '@/components/ui/button';
import { Section } from '@/components/ui/section';
import { Separator } from '@/components/ui/separator';
import { Link, Outlet, createFileRoute } from '@tanstack/react-router';
import { BotIcon, CreditCardIcon, PaintbrushIcon, SettingsIcon, UserIcon } from 'lucide-react';

export const Route = createFileRoute('/_account/account')({
    component: RouteComponent,
});

const pages = [
    {
        title: 'Account',
        url: '/account',
        icon: <UserIcon />,
    },
    {
        title: 'Subscription',
        url: '/account/subscription',
        icon: <CreditCardIcon />,
    },
    {
        title: 'Preferences',
        url: '/account/preferences',
        icon: <SettingsIcon />,
    },
    {
        title: 'Models',
        url: '/account/models',
        icon: <BotIcon />,
    },
    {
        title: 'Appearance',
        url: '/account/appearance',
        icon: <PaintbrushIcon />,
    },
];

function RouteComponent() {
    return (
        <div className="flex flex-1 py-24">
            <div className="flex flex-col gap-8 w-full max-w-5xl mx-auto">
                <div>
                    <h1 className="text-2xl font-bold">Settings</h1>
                    <p className="text-muted-foreground">
                        Manage your account preferences and configuration.
                    </p>
                </div>
                <div className="overflow-x-auto min-w-full w-0">
                    <div className="flex flex-row gap-2">
                        {pages.map(page => (
                            <Button asChild key={page.url} variant="ghost">
                                <Link
                                    to={page.url}
                                    className="flex items-center justify-start gap-2"
                                    activeOptions={{
                                        exact: true,
                                    }}
                                    activeProps={{
                                        className: 'bg-muted/50 border border-foreground/10',
                                    }}
                                >
                                    {page.icon}
                                    {page.title}
                                </Link>
                            </Button>
                        ))}
                    </div>
                </div>
                <div className="flex-1">
                    <Anonymous>
                        <Section
                            title="Anonymous"
                            description="As an anonymous user, your data may be deleted or lost at any time. Login to keep your data safe."
                        >
                            <div className="border backdrop-blur-md mb-8 p-0 rounded-lg bg-card overflow-hidden text-sm text-muted-foreground flex flex-col">
                                <div className="p-4 flex flex-col gap-2">
                                    <h3>Not logged in</h3>
                                    <p>
                                        You are currently an anonymous user. Your chats, messages
                                        and preferences may be deleted in the future. To save your
                                        data, create an account or login.
                                    </p>
                                </div>
                                <div className="flex px-4 py-3 bg-sidebar w-full justify-end border-t">
                                    <Button variant="default" size="sm" asChild>
                                        <Link to="/login">Login</Link>
                                    </Button>
                                </div>
                            </div>
                        </Section>
                        <Separator className="mb-8" />
                    </Anonymous>
                    <Outlet />
                </div>
            </div>
        </div>
    );
}



================================================
FILE: src/routes/_account.logged-out.tsx
================================================
import { Button } from '@/components/ui/button';
import { Link, createFileRoute } from '@tanstack/react-router';
import { ArrowLeftIcon, CheckCircleIcon } from 'lucide-react';

export const Route = createFileRoute('/_account/logged-out')({
    component: RouteComponent,
});

function RouteComponent() {
    return (
        <div className="flex flex-1 items-center justify-center relative w-full h-full p-4">
            <div className="flex flex-col p-8 gap-6 items-center max-w-md col-span-1 justify-center row-span-3">
                <div className="flex flex-col items-center gap-2">
                    <div className="flex items-center justify-center w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/20 mb-2">
                        <CheckCircleIcon className="size-6 text-green-600 dark:text-green-400" />
                    </div>
                    <span className="text-xl font-semibold text-foreground">
                        Logged Out Successfully
                    </span>
                    <span className="text-muted-foreground text-sm text-center">
                        You have been successfully logged out of your account. Thank you for using
                        Zeron.
                    </span>
                </div>

                <div className="flex flex-col gap-2 w-full">
                    <div className="w-full">
                        <Button asChild className="w-full">
                            <Link to="/">
                                <ArrowLeftIcon className="size-4" />
                                <span className="text-primary-foreground">Back to Home</span>
                            </Link>
                        </Button>
                    </div>

                    <div className="w-full">
                        <Button asChild variant="outline" className="w-full">
                            <Link to="/login">
                                <span className="text-sm">Log In Again</span>
                            </Link>
                        </Button>
                    </div>
                </div>
            </div>
        </div>
    );
}



================================================
FILE: src/routes/_account.login.index.tsx
================================================
import { Anonymous, NotAnonymous } from '@/components/app/auth';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Separator } from '@/components/ui/separator';
import { authClient } from '@/lib/auth-client';
import { useForm } from '@tanstack/react-form';
import { Navigate, createFileRoute, useNavigate } from '@tanstack/react-router';
import { ArrowRightIcon, GithubIcon, Loader2 } from 'lucide-react';
import { FcGoogle } from 'react-icons/fc';
import { zodValidator } from '@tanstack/zod-adapter';
import z from 'zod';

const schema = z.object({
    email: z.string().email(),
});

export const Route = createFileRoute('/_account/login/')({
    component: RouteComponent,
    validateSearch: zodValidator(
        z.object({
            callbackUrl: z.string().optional().catch('/'),
        })
    ),
});

function RouteComponent() {
    const navigate = useNavigate();
    const search = Route.useSearch();
    const form = useForm({
        defaultValues: {
            email: '',
        },
        onSubmit: async ({ value }) => {
            await authClient.signIn.magicLink({
                email: value.email,
                callbackURL: search.callbackUrl,
            });
            navigate({ to: '/magic-link' });
        },
        validators: {
            onMount: schema,
            onChange: schema,
            onSubmit: schema,
        },
    });

    return (
        <form
            className="flex flex-1 items-center justify-center relative w-full h-full p-4"
            onSubmit={e => {
                e.preventDefault();
                form.handleSubmit();
            }}
        >
            <Anonymous>
                <div className="flex flex-col gap-6 items-center max-w-md col-span-1 justify-center row-span-3 rounded-2x">
                    <div className="flex flex-col items-center gap-2 min-w-[280px] md:min-w-[350px]">
                        <span className="text-xl font-semibold text-foreground">
                            Login to Zeron
                        </span>
                        <span className="text-muted-foreground text-sm">
                            Enter your email to login to your account
                        </span>
                    </div>
                    <div className="w-full">
                        <form.Field name="email">
                            {field => (
                                <div className="flex flex-col gap-2 w-full">
                                    <span className="text-sm">Email</span>
                                    <Input
                                        placeholder="m@example.com"
                                        value={field.state.value}
                                        onChange={e => field.handleChange(e.target.value)}
                                    />
                                </div>
                            )}
                        </form.Field>
                    </div>
                    <div className="w-full">
                        <form.Subscribe
                            selector={state => ({
                                isSubmitting: state.isSubmitting,
                                canSubmit: state.canSubmit,
                            })}
                        >
                            {({ isSubmitting, canSubmit }) => (
                                <Button
                                    type="submit"
                                    className="w-full"
                                    disabled={!canSubmit || isSubmitting}
                                >
                                    <span className="text-primary-foreground">Continue</span>
                                    {!isSubmitting ? (
                                        <ArrowRightIcon
                                            className="text-primary-foreground"
                                            size={10}
                                        />
                                    ) : (
                                        <Loader2
                                            className="text-primary-foreground animate-spin"
                                            size={10}
                                        />
                                    )}
                                </Button>
                            )}
                        </form.Subscribe>
                    </div>
                    <div className="flex flex-row items-center gap-4 w-full">
                        <Separator className="flex-1" />
                        <span className="text-muted-foreground text-sm">Or</span>
                        <Separator className="flex-1" />
                    </div>
                    <div className="flex flex-col gap-2 w-full">
                        <Button
                            variant="outline"
                            onClick={async () => {
                                await authClient.signIn.social({
                                    provider: 'google',
                                    callbackURL: search.callbackUrl,
                                });
                            }}
                        >
                            <FcGoogle size={16} />
                            <span className="text-sm">Continue with Google</span>
                        </Button>
                        <Button
                            variant="outline"
                            onClick={async () => {
                                await authClient.signIn.social({
                                    provider: 'github',
                                    callbackURL: search.callbackUrl,
                                });
                            }}
                        >
                            <GithubIcon className="text-foreground" size={16} />
                            <span className="text-sm">Continue with GitHub</span>
                        </Button>
                    </div>
                </div>
            </Anonymous>
            <NotAnonymous>
                <Navigate to="/" />
            </NotAnonymous>
        </form>
    );
}



================================================
FILE: src/routes/_account.magic-link.tsx
================================================
import { Button } from '@/components/ui/button';
import { Link, createFileRoute } from '@tanstack/react-router';
import { ArrowLeftIcon, MailIcon } from 'lucide-react';

export const Route = createFileRoute('/_account/magic-link')({
    component: RouteComponent,
});

function RouteComponent() {
    return (
        <div className="flex flex-1 items-center justify-center relative w-full h-full p-4">
            <div className="flex flex-col p-8 gap-6 items-center max-w-md col-span-1 justify-center row-span-3">
                <div className="flex flex-col items-center gap-2">
                    <div className="flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/20 mb-2">
                        <MailIcon className="size-6 text-blue-600 dark:text-blue-400" />
                    </div>
                    <span className="text-xl font-semibold text-foreground">Magic Link Sent</span>
                    <span className="text-muted-foreground text-sm text-center">
                        We've sent a magic link to your email address. Check your inbox and click
                        the link to sign in to your account.
                    </span>
                </div>

                <div className="flex flex-col gap-2 w-full">
                    <div className="w-full">
                        <Button asChild className="w-full">
                            <Link to="/">
                                <ArrowLeftIcon className="size-4" />
                                <span className="text-primary-foreground">Back to Home</span>
                            </Link>
                        </Button>
                    </div>

                    <div className="w-full">
                        <Button asChild variant="outline" className="w-full">
                            <Link to="/login">
                                <span className="text-sm">Try Another Email</span>
                            </Link>
                        </Button>
                    </div>
                </div>
            </div>
        </div>
    );
}



================================================
FILE: src/routes/_account.tsx
================================================
import { Button } from '@/components/ui/button';
import { Stars } from '@/components/ui/stars';
import { Link, Outlet, createFileRoute } from '@tanstack/react-router';
import { motion } from 'framer-motion';
import { ArrowLeftIcon } from 'lucide-react';

export const Route = createFileRoute('/_account')({
    component: RouteComponent,
});

function RouteComponent() {
    return (
        <div className="flex flex-1 relative">
            <div className="flex flex-1 z-1 overflow-auto relative">
                <motion.div
                    className="absolute top-0 left-0 z-10 p-4"
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ duration: 0.5, delay: 0.1 }}
                >
                    <div>
                        <Link to="/">
                            <Button variant="ghost">
                                <ArrowLeftIcon className="size-4" />
                                <span>Back</span>
                            </Button>
                        </Link>
                    </div>
                </motion.div>
                <div className="p-4 w-full">
                    <Outlet />
                </div>
            </div>
        </div>
    );
}



================================================
FILE: src/routes/_app._thread.$threadId.tsx
================================================
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/_app/_thread/$threadId')({
    component: RouteComponent,
});

function RouteComponent() {
    return null;
}



================================================
FILE: src/routes/_app._thread.index.tsx
================================================
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/_app/_thread/')({
    component: Index,
});

function Index() {
    return null;
}



================================================
FILE: src/routes/_app._thread.tsx
================================================
import { createFileRoute } from '@tanstack/react-router';
import { DefaultChatTransport } from 'ai';
import { useParamsThreadId } from '@/hooks/use-params-thread-id';
import { useDatabase, useThreadFromParams } from '@/hooks/use-database';
import { Fragment, useMemo } from 'react';
import { Header } from '@/components/layout/header';
import { Title } from '@/components/meta/title';
import { ThreadProvider } from '@/context/thread';
import { MessageList } from '@/components/thread/message/message-list';
import { ToolSidebar } from '@/components/layout/tool-sidebar';
import { ThreadContainer } from '@/components/thread/thread-container';

export const Route = createFileRoute('/_app/_thread')({
    component: RouteComponent,
});

function RouteComponent() {
    const db = useDatabase();
    const threadId = useParamsThreadId();
    const thread = useThreadFromParams();

    const messages = useMemo(() => {
        return thread?.messages.map(message => message.message);
    }, [thread]);

    return (
        <Fragment>
            <Title title={thread?.title} />
            <ThreadProvider
                id={threadId}
                messages={messages}
                transport={
                    new DefaultChatTransport({
                        api: '/api/thread',
                        prepareSendMessagesRequest: async ({ id, messages, body }) => {
                            const settings = db.query.setting
                                .where('userId', '=', db.userID)
                                .one()
                                .materialize();

                            return {
                                body: {
                                    id,
                                    message: messages.at(-1),
                                    modelId: settings.data?.modelId,
                                    ...body,
                                },
                            };
                        },
                    })
                }
            >
                <ThreadContainer>
                    <Header />
                    <MessageList />
                </ThreadContainer>
                <ToolSidebar />
            </ThreadProvider>
        </Fragment>
    );
}



================================================
FILE: src/routes/_app.tsx
================================================
import { AppSidebar } from '@/components/layout/app-sidebar';
import { SidebarProvider } from '@/components/ui/sidebar';
import { createFileRoute, Outlet } from '@tanstack/react-router';

export const Route = createFileRoute('/_app')({
    component: RouteComponent,
});

function RouteComponent() {
    return (
        <SidebarProvider>
            <AppSidebar />
            <Outlet />
        </SidebarProvider>
    );
}



================================================
FILE: src/routes/_team.tsx
================================================
import { Button } from '@/components/ui/button';
import { Stars } from '@/components/ui/stars';
import { Link, Outlet, createFileRoute } from '@tanstack/react-router';
import { motion } from 'framer-motion';
import { ArrowLeftIcon } from 'lucide-react';

export const Route = createFileRoute('/_team')({
    component: RouteComponent,
});

function RouteComponent() {
    return (
        <div className="flex flex-1 relative">
            <div className="flex flex-1 z-1 overflow-auto relative">
                <motion.div
                    className="absolute top-0 left-0 z-10 p-4"
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ duration: 0.5, delay: 0.1 }}
                >
                    <div>
                        <Link to="/">
                            <Button variant="ghost">
                                <ArrowLeftIcon className="size-4" />
                                <span>Back</span>
                            </Button>
                        </Link>
                    </div>
                </motion.div>
                <div className="p-4 w-full">
                    <Outlet />
                </div>
            </div>
        </div>
    );
}



================================================
FILE: src/routes/api.auth.$.ts
================================================
import { auth } from '@/lib/auth';
import { createServerFileRoute } from '@tanstack/react-start/server';

export const ServerRoute = createServerFileRoute('/api/auth/$').methods({
    GET: ({ request }) => {
        return auth.handler(request);
    },
    POST: ({ request }) => {
        return auth.handler(request);
    },
});



================================================
FILE: src/routes/api.checkout.success.ts
================================================
import { createServerFileRoute } from '@tanstack/react-start/server';
import { env } from '@/lib/env';
import { Effect, Layer } from 'effect';
import { APIError } from '@/lib/error';
import { SessionLive, Session } from '@/lib/auth';
import { DatabaseLive } from '@/database/effect';
import * as queries from '@/database/queries';
import { UserId } from '@/database/types';
import { syncStripeDataToDatabase } from '@/lib/stripe';
import { nanoid } from '@/lib/utils';

export const ServerRoute = createServerFileRoute('/api/checkout/success').methods({
    GET: async ({ request }) => {
        return checkoutSuccessApi.pipe(
            Effect.scoped,
            APIError.map({
                status: 500,
                message: 'Uncaught error',
            }),
            Effect.catchAll(e => e.response),
            Effect.provide(SessionLive(request)),
            Effect.provide(CheckoutSuccessRequestLive(request)),
            Effect.provide(DatabaseLive),
            Effect.annotateLogs('requestId', nanoid()),
            Effect.runPromise
        );
    },
});

const checkoutSuccessApi = Effect.gen(function* () {
    const session = yield* Session;
    const checkoutSuccessRequest = yield* CheckoutSuccessRequest;

    const customer = yield* queries.getUserCustomerByUserId(UserId(session.user.id));

    if (!customer) {
        return Response.redirect(checkoutSuccessRequest.redirectUrl ?? '/', 303);
    }

    yield* syncStripeDataToDatabase(customer.id);

    return Response.redirect(checkoutSuccessRequest.redirectUrl ?? env.VITE_PUBLIC_API_URL, 303);
});

interface CheckoutSuccessRequestShape {
    redirectUrl: string | null;
}

export class CheckoutSuccessRequest extends Effect.Tag('CheckoutSuccessRequest')<
    CheckoutSuccessRequest,
    CheckoutSuccessRequestShape
>() {}

export const CheckoutSuccessRequestLive = (request: Request) =>
    Layer.scoped(
        CheckoutSuccessRequest,
        Effect.succeed({
            redirectUrl: new URL(request.url).searchParams.get('redirectUrl'),
        })
    );



================================================
FILE: src/routes/api.checkout.ts
================================================
import { createServerFileRoute } from '@tanstack/react-start/server';
import { env } from '@/lib/env';
import { Effect, Layer } from 'effect';
import { APIError } from '@/lib/error';
import { SessionLive, Session } from '@/lib/auth';
import * as queries from '@/database/queries';
import { UserId, CustomerId } from '@/database/types';
import { createStripeCustomer, createStripeCheckoutSession } from '@/lib/stripe';
import { nanoid } from '@/lib/utils';
import { DatabaseLive } from '@/database/effect';

export const ServerRoute = createServerFileRoute('/api/checkout').methods({
    GET: async ({ request }) => {
        return checkoutApi.pipe(
            Effect.scoped,
            APIError.map({
                status: 500,
                message: 'Uncaught error',
            }),
            Effect.catchAll(e => e.response),
            Effect.provide(SessionLive(request)),
            Effect.provide(CheckoutRequestLive(request)),
            Effect.provide(DatabaseLive),
            Effect.annotateLogs('requestId', nanoid()),
            Effect.runPromise
        );
    },
});

const checkoutApi = Effect.gen(function* () {
    const session = yield* Session;
    const checkoutRequest = yield* CheckoutRequest;

    if (session.user.isAnonymous) {
        return yield* new APIError({
            status: 400,
            message: 'anonymous user cannot checkout',
        });
    }

    let customer = yield* queries.getUserCustomerByUserId(UserId(session.user.id));

    if (!customer) {
        const stripeCustomer = yield* createStripeCustomer(session.user.email, session.user.id);

        const [newCustomer] = yield* queries.createUserCustomer({
            userId: UserId(session.user.id),
            customerId: CustomerId(stripeCustomer.id),
        });

        customer = newCustomer;
    }

    const successUrl = new URL(`${env.VITE_PUBLIC_API_URL}/api/checkout/success`);
    if (checkoutRequest.redirectUrl) {
        successUrl.searchParams.set('redirectUrl', checkoutRequest.redirectUrl);
    }
    const cancelUrl = checkoutRequest.redirectUrl
        ? new URL(checkoutRequest.redirectUrl)
        : new URL(env.VITE_PUBLIC_API_URL);

    const checkoutSession = yield* createStripeCheckoutSession(
        customer.id,
        successUrl.toString(),
        cancelUrl.toString(),
        env.PRO_MONTHLY_PRICE_ID
    );

    if (!checkoutSession.url) {
        return yield* new APIError({
            status: 500,
            message: 'checkout session failed',
        });
    }

    return Response.redirect(checkoutSession.url, 303);
});

interface CheckoutRequestShape {
    redirectUrl: string | null;
}

class CheckoutRequest extends Effect.Tag('CheckoutRequest')<
    CheckoutRequest,
    CheckoutRequestShape
>() {}

export const CheckoutRequestLive = (request: Request) =>
    Layer.scoped(
        CheckoutRequest,
        Effect.succeed({
            redirectUrl: new URL(request.url).searchParams.get('redirectUrl'),
        })
    );



================================================
FILE: src/routes/api.customer-portal.ts
================================================
import { createServerFileRoute } from '@tanstack/react-start/server';
import { env } from '@/lib/env';
import { Effect, Layer } from 'effect';
import { APIError } from '@/lib/error';
import { SessionLive, Session } from '@/lib/auth';
import { DatabaseLive } from '@/database/effect';
import * as queries from '@/database/queries';
import { UserId, CustomerId } from '@/database/types';
import { createStripeCustomer, createStripeBillingPortalSession } from '@/lib/stripe';
import { nanoid } from '@/lib/utils';

export const ServerRoute = createServerFileRoute('/api/customer-portal').methods({
    GET: async ({ request }) => {
        return customerPortalApi.pipe(
            Effect.scoped,
            APIError.map({
                status: 500,
                message: 'Uncaught error',
            }),
            Effect.catchAll(e => e.response),
            Effect.provide(SessionLive(request)),
            Effect.provide(CustomerPortalRequestLive(request)),
            Effect.provide(DatabaseLive),
            Effect.annotateLogs('requestId', nanoid()),
            Effect.runPromise
        );
    },
});

const customerPortalApi = Effect.gen(function* () {
    const session = yield* Session;
    const customerPortalRequest = yield* CustomerPortalRequest;

    if (session.user.isAnonymous) {
        return yield* new APIError({
            status: 400,
            message: 'anonymous user cannot access billing portal',
        });
    }

    let customer = yield* queries.getUserCustomerByUserId(UserId(session.user.id));

    if (!customer) {
        const stripeCustomer = yield* createStripeCustomer(session.user.email, session.user.id);

        const [newCustomer] = yield* queries.createUserCustomer({
            userId: UserId(session.user.id),
            customerId: CustomerId(stripeCustomer.id),
        });

        customer = newCustomer;
    }

    const successUrl = new URL(`${env.VITE_PUBLIC_API_URL}/api/checkout/success`);

    if (customerPortalRequest.redirectUrl) {
        successUrl.searchParams.set('redirectUrl', customerPortalRequest.redirectUrl);
    }

    const billingPortal = yield* createStripeBillingPortalSession(
        customer.id,
        successUrl.toString()
    );

    if (!billingPortal.url) {
        return yield* new APIError({
            status: 500,
            message: 'billing portal creation failed',
        });
    }

    return Response.redirect(billingPortal.url, 303);
});

interface CustomerPortalRequestShape {
    redirectUrl: string | null;
}

export class CustomerPortalRequest extends Effect.Tag('CustomerPortalRequest')<
    CustomerPortalRequest,
    CustomerPortalRequestShape
>() {}

export const CustomerPortalRequestLive = (request: Request) =>
    Layer.scoped(
        CustomerPortalRequest,
        Effect.succeed({
            redirectUrl: new URL(request.url).searchParams.get('redirectUrl'),
        })
    );



================================================
FILE: src/routes/api.reset.ts
================================================
import { env } from '@/lib/env';
import { createServerFileRoute } from '@tanstack/react-start/server';
import { Effect, Layer } from 'effect';
import { APIError } from '@/lib/error';
import { DatabaseLive } from '@/database/effect';
import * as queries from '@/database/queries';
import { nanoid } from '@/lib/utils';

export const ServerRoute = createServerFileRoute('/api/reset').methods({
    GET: async ({ request }) => {
        return resetApi.pipe(
            Effect.scoped,
            APIError.map({
                status: 500,
                message: 'Uncaught error',
            }),
            Effect.catchAll(e => e.response),
            Effect.provide(ResetRequestLive(request)),
            Effect.provide(DatabaseLive),
            Effect.annotateLogs('requestId', nanoid()),
            Effect.runPromise
        );
    },
});

const resetApi = Effect.gen(function* () {
    const resetRequest = yield* ResetRequest;

    if (!resetRequest.isAuthorized) {
        return yield* new APIError({
            status: 401,
            message: 'Unauthorized',
        });
    }

    yield* queries.resetUsage();

    return new Response('OK', { status: 200 });
});

export class ResetRequest extends Effect.Tag('ResetRequest')<
    ResetRequest,
    {
        readonly isAuthorized: boolean;
    }
>() {}

export const ResetRequestLive = (request: Request) =>
    Layer.scoped(
        ResetRequest,
        Effect.succeed({
            isAuthorized: request.headers.get('Authorization') === `Bearer ${env.CRON_SECRET}`,
        })
    );



================================================
FILE: src/routes/api.thread.$threadId.stop.ts
================================================
import { createServerFileRoute } from '@tanstack/react-start/server';
import { Effect, Layer } from 'effect';
import { SessionLive, Session } from '@/lib/auth';
import { DatabaseLive } from '@/database/effect';
import { APIError } from '@/lib/error';
import { z } from 'zod';
import { nanoid } from 'nanoid';
import { RedisLive } from '@/lib/redis';
import * as queries from '@/database/queries';
import { RedisPubSub } from 'effect-redis';

export const ServerRoute = createServerFileRoute('/api/thread/$threadId/stop').methods({
    async POST({ request, params }) {
        return threadStopPostApi.pipe(
            Effect.scoped,
            APIError.map({
                status: 500,
                message: 'Uncaught error',
            }),
            Effect.catchAll(e => e.response),
            Effect.provide(SessionLive(request)),
            Effect.provide(ThreadStopPostParamsLive({ id: params.threadId })),
            Effect.provide(DatabaseLive),
            Effect.provide(RedisLive),
            Effect.runPromise
        );
    },
});

const threadStopPostApi = Effect.gen(function* () {
    const session = yield* Session;
    const params = yield* ThreadStopPostParams;

    return yield* threadStopPostApiHandler.pipe(
        Effect.annotateLogs('requestId', nanoid()),
        Effect.annotateLogs('userId', session.user.id),
        Effect.annotateLogs('threadId', params.id)
    );
});

const threadStopPostApiHandler = Effect.gen(function* () {
    const session = yield* Session;
    const params = yield* ThreadStopPostParams;

    const thread = yield* queries.getThreadById(params.id);

    if (!thread) {
        console.log('thread not found');
        return yield* new APIError({
            status: 404,
            message: 'Thread not found',
        });
    }

    if (thread.userId !== session.user.id) {
        return yield* new APIError({
            status: 403,
            message: 'You are not allowed to modify this thread',
        });
    }

    const pubsub = yield* RedisPubSub;

    yield* pubsub.publish(`abort:${params.id}`, 'abort');

    yield* queries.updateThread({
        threadId: params.id,
        status: 'ready',
    });

    return new Response(null, { status: 200 });
});

const ThreadStopPostApiSchema = z.object({
    id: z.string(),
});

class ThreadStopPostParams extends Effect.Tag('ThreadStopPostParams')<
    ThreadStopPostParams,
    z.infer<typeof ThreadStopPostApiSchema>
>() {}

const ThreadStopPostParamsLive = (params: z.infer<typeof ThreadStopPostApiSchema>) =>
    Layer.scoped(
        ThreadStopPostParams,
        Effect.gen(function* () {
            return yield* Effect.try({
                try: () => ThreadStopPostApiSchema.parse(params),
                catch: error => {
                    return new APIError({
                        status: 400,
                        message: 'Invalid request params',
                        cause: error,
                    });
                },
            });
        })
    );



================================================
FILE: src/routes/api.thread.$threadId.stream.ts
================================================
import { createServerFileRoute } from '@tanstack/react-start/server';
import { getResumableStream, prepareResumeThreadContext } from '@/ai/service';
import { Effect, Layer } from 'effect';
import { Session, SessionLive } from '@/lib/auth';
import z from 'zod';
import { APIError } from '@/lib/error';
import { nanoid } from '@/lib/utils';
import { DatabaseLive } from '@/database/effect';

export const ServerRoute = createServerFileRoute('/api/thread/$threadId/stream').methods({
    async GET({ request, params: { threadId } }) {
        return threadResumeStreamApi.pipe(
            Effect.scoped,
            APIError.map({
                status: 500,
                message: 'Uncaught error',
            }),
            Effect.catchAll(e => e.response),
            Effect.provide(SessionLive(request)),
            Effect.provide(ThreadResumeStreamParamsLive({ id: threadId })),
            Effect.provide(DatabaseLive),
            Effect.runPromise
        );
    },
});

const threadResumeStreamApi = Effect.gen(function* () {
    const session = yield* Session;
    const params = yield* ThreadResumeStreamParams;

    return yield* threadResumeStreamApiHandler.pipe(
        Effect.annotateLogs('requestId', nanoid()),
        Effect.annotateLogs('userId', session.user.id),
        Effect.annotateLogs('threadId', params.id)
    );
});

const threadResumeStreamApiHandler = Effect.gen(function* () {
    const session = yield* Session;
    const params = yield* ThreadResumeStreamParams;

    const streamId = yield* prepareResumeThreadContext({
        threadId: params.id,
        userId: session.user.id,
    });

    const stream = yield* getResumableStream(streamId);

    if (!stream) {
        return yield* new APIError({
            status: 404,
            message: 'Stream not found',
        });
    }

    return new Response(stream);
});

const ThreadResumeStreamApiSchema = z.object({
    id: z.string(),
});

class ThreadResumeStreamParams extends Effect.Tag('ThreadResumeStreamParams')<
    ThreadResumeStreamParams,
    z.infer<typeof ThreadResumeStreamApiSchema>
>() {}

const ThreadResumeStreamParamsLive = (params: z.infer<typeof ThreadResumeStreamApiSchema>) =>
    Layer.scoped(
        ThreadResumeStreamParams,
        Effect.gen(function* () {
            return yield* Effect.try({
                try: () => ThreadResumeStreamApiSchema.parse(params),
                catch: error => {
                    return new APIError({
                        status: 400,
                        message: 'Invalid request params',
                        cause: error,
                    });
                },
            });
        })
    );



================================================
FILE: src/routes/api.thread.ts
================================================
import { createServerFileRoute } from '@tanstack/react-start/server';
import { Effect, Layer, Deferred } from 'effect';
import { SessionLive, Session } from '@/lib/auth';
import { DatabaseLive } from '@/database/effect';
import { APIError } from '@/lib/error';
import { z } from 'zod';
import { UserId } from '@/database/types';
import { nanoid } from 'nanoid';
import { extractReasoningMiddleware, smoothStream, stepCountIs, wrapLanguageModel } from 'ai';
import { getTools, ToolContext } from '@/ai/tools';
import { getSystemPrompt } from '@/ai/prompt';
import {
    convertUIMessagesToModelMessages,
    createResumableStream,
    generateThreadTitle,
    incrementUsage,
    prepareThreadContext,
    saveMessageAndResetThreadStatus,
} from '@/ai/service';
import { Stream } from '@/ai/stream';
import { RedisLive } from '@/lib/redis';
import { Database } from '@/database/effect';
import type { OpenAIResponsesProviderOptions } from '@ai-sdk/openai';
import type { GoogleGenerativeAIProviderOptions } from '@ai-sdk/google';
import type { AnthropicProviderOptions } from '@ai-sdk/anthropic';
import { gateway } from '@ai-sdk/gateway';
import { RedisPubSub } from 'effect-redis';

export const ServerRoute = createServerFileRoute('/api/thread').methods({
    async POST({ request }) {
        return threadPostApi.pipe(
            Effect.scoped,
            APIError.map({
                status: 500,
                message: 'Uncaught error',
            }),
            Effect.catchAll(e => e.response),
            Effect.provide(SessionLive(request)),
            Effect.provide(ThreadPostBodyLive(request)),
            Effect.provide(DatabaseLive),
            Effect.runPromise
        );
    },
});

const threadPostApi = Effect.gen(function* () {
    const session = yield* Session;
    const body = yield* ThreadPostBody;

    return yield* threadPostApiHandler.pipe(
        Effect.annotateLogs('requestId', nanoid()),
        Effect.annotateLogs('userId', session.user.id),
        Effect.annotateLogs('threadId', body.id)
    );
});

const threadPostApiHandler = Effect.gen(function* () {
    const runtime = yield* Effect.runtime<Database>();
    const latch = yield* Effect.makeLatch();

    yield* latch.open;

    const session = yield* Session;
    const body = yield* ThreadPostBody;

    const streamId = nanoid();

    const controller = new AbortController();

    const context = yield* prepareThreadContext({
        isAnonymous: session.user.isAnonymous ?? false,
        userId: UserId(session.user.id),
        threadId: body.id,
        streamId,
        modelId: body.modelId,
        message: body.message,
    });

    const { history, model, settings, usage, limits, thread } = context;

    const messages = yield* convertUIMessagesToModelMessages(history, {
        supportsImages: model.capabilities.includes('vision'),
        supportsDocuments: model.capabilities.includes('documents'),
    });

    const activeTools = [body.tool].filter(tool => tool !== undefined);

    const MODEL_REQUIRES_MIDDLEWARE = [
        'zai/glm-4.5-air',
        'zai/glm-4.5',
        'deepseek/deepseek-r1-distill-llama-70b',
        'deepseek/deepseek-r1',
    ];

    const actualModel = MODEL_REQUIRES_MIDDLEWARE.includes(model.model)
        ? wrapLanguageModel({
              model: gateway(model.model),
              middleware: extractReasoningMiddleware({
                  tagName: 'think',
              }),
          })
        : model.model;

    const OPENAI_MODELS_WITH_REASONING = ['openai/gpt-5', 'openai/gpt-5-mini', 'openai/gpt-5-nano'];

    const openai: OpenAIResponsesProviderOptions = {
        parallelToolCalls: false,
    };

    if (OPENAI_MODELS_WITH_REASONING.includes(model.model)) {
        openai.include = ['reasoning.encrypted_content'];
        openai.reasoningSummary = 'auto';
    }

    const GOOGLE_MODELS_WITH_REASONING = ['google/gemini-2.5-flash', 'google/gemini-2.5-pro'];

    const google: GoogleGenerativeAIProviderOptions = {};

    if (GOOGLE_MODELS_WITH_REASONING.includes(model.model)) {
        google.thinkingConfig = {
            includeThoughts: true,
        };
    }

    const anthropic: AnthropicProviderOptions = {
        sendReasoning: true,
        thinking: {
            type: 'enabled',
            budgetTokens: 3000,
        },
        disableParallelToolUse: true,
    };

    yield* Effect.logInfo('Creating stream');

    const stream = yield* Stream.create.pipe(
        Stream.options({
            model: actualModel,
            messages,
            temperature: 0.8,
            stopWhen: stepCountIs(3),
            system: getSystemPrompt(settings, activeTools),
            experimental_transform: smoothStream({
                chunking: 'word',
                delayInMs: 3,
            }),
            abortSignal: controller.signal,
            providerOptions: {
                openai,
                google,
                anthropic,
                gateway: {
                    order: ['groq', 'cerebras'],
                },
            },
        }),
        Stream.getTools(({ writer }) => {
            return getTools.pipe(
                Effect.provide(
                    Layer.scoped(
                        ToolContext,
                        Effect.succeed({
                            writer,
                            usage,
                            userId: UserId(session.user.id),
                            limits,
                            runtime,
                            tools: activeTools,
                            signal: controller.signal,
                        })
                    )
                )
            );
        }),
        Stream.onFinish(({ responseMessage }) => {
            return Effect.gen(function* () {
                yield* saveMessageAndResetThreadStatus({
                    threadId: body.id,
                    userId: UserId(session.user.id),
                    message: responseMessage,
                }).pipe(
                    Effect.tapError(error =>
                        Effect.logError('Error saving message and resetting thread status', error)
                    ),
                    Effect.catchAll(() => Effect.succeed(null)),
                    latch.whenOpen
                );

                // Signal that streaming is complete so Redis can close
                yield* Deferred.succeed(streamCompletionDeferred, undefined);
            });
        }),
        Stream.onMessageMetadata(({ part, writer }) => {
            return Effect.gen(function* () {
                if (part.type === 'reasoning-start') {
                    writer.write({
                        type: 'data-reasoning-time',
                        data: {
                            id: part.id,
                            type: 'start',
                            timestamp: new Date().getTime(),
                        },
                    });
                }
                if (part.type === 'reasoning-end') {
                    writer.write({
                        type: 'data-reasoning-time',
                        data: {
                            id: part.id,
                            type: 'end',
                            timestamp: new Date().getTime(),
                        },
                    });
                }
                if (part.type === 'start') {
                    return {
                        model: {
                            id: model.id,
                            name: model.name,
                            icon: model.icon,
                        },
                    };
                }
            });
        }),
        Stream.onError(({ error, writer }) => {
            return Effect.gen(function* () {
                yield* Effect.logError('Error in stream', error);
                writer.write({
                    type: 'data-error',
                    data: 'Error generating response',
                });

                // Signal completion even on error so Redis can close
                yield* Deferred.succeed(streamCompletionDeferred, undefined);
            });
        }),
        Stream.build
    );

    yield* Effect.logInfo('Creating resumable stream');

    const resumableStream = yield* createResumableStream(streamId, stream);

    const streamCompletionDeferred = yield* Deferred.make<void>();

    yield* Effect.logInfo('Creating daemon for listening to abort command');

    yield* Effect.gen(function* () {
        const pubsub = yield* RedisPubSub;

        yield* pubsub.subscribe(`abort:${body.id}`, _ => {
            controller.abort();
        });

        yield* Effect.race(
            Effect.async<void>(resume => {
                controller.signal.addEventListener('abort', () => {
                    resume(Effect.succeed(undefined));
                });
            }),
            Deferred.await(streamCompletionDeferred)
        );
    }).pipe(
        Effect.tapError(error => Effect.logError('Error in daemon subscribing to abort', error)),
        Effect.catchAll(() => Effect.succeed(null)),
        Effect.provide(RedisLive),
        Effect.forkDaemon
    );

    if (!thread.title) {
        yield* generateThreadTitle(body.id, body.message, latch).pipe(Effect.forkDaemon);
    }

    yield* incrementUsage(UserId(session.user.id), 'credits', model.credits).pipe(
        Effect.forkDaemon
    );

    return new Response(resumableStream);
});

const ThreadPostApiSchema = z.object({
    id: z.string(),
    modelId: z.string(),
    message: z.any(),
    tool: z.string().optional(),
});

export class ThreadPostBody extends Effect.Tag('ThreadPostBody')<
    ThreadPostBody,
    z.infer<typeof ThreadPostApiSchema>
>() {}

export const ThreadPostBodyLive = (request: Request) =>
    Layer.scoped(
        ThreadPostBody,
        Effect.gen(function* () {
            const json = yield* Effect.tryPromise({
                try: () => request.json(),
                catch: error => {
                    return new APIError({
                        status: 400,
                        message: 'Invalid request body',
                        cause: error,
                    });
                },
            });

            return yield* Effect.try({
                try: () => ThreadPostApiSchema.parse(json),
                catch: error => {
                    return new APIError({
                        status: 400,
                        message: 'Invalid request body',
                        cause: error,
                    });
                },
            });
        })
    );



================================================
FILE: src/routes/api.uploadthing.ts
================================================
import { createServerFileRoute } from '@tanstack/react-start/server';
import { createUploadthing, UploadThingError, createRouteHandler } from 'uploadthing/server';
import type { FileRouter } from 'uploadthing/server';

export const ServerRoute = createServerFileRoute('/api/uploadthing').methods({
    GET: ({ request }) => {
        return handlers(request);
    },
    POST: ({ request }) => {
        return handlers(request);
    },
});

const f = createUploadthing();

const router = {
    fileUploader: f({
        image: {
            maxFileSize: '8MB',
            maxFileCount: 5,
        },
        pdf: {
            maxFileSize: '32MB',
            maxFileCount: 5,
        },
        text: {
            maxFileSize: '8MB',
            maxFileCount: 5,
        },
    }).onUploadComplete(({ metadata, file }) => {
        return {};
    }),
} satisfies FileRouter;

const handlers = createRouteHandler({ router });

export type UploadRouter = typeof router;



================================================
FILE: src/routes/api.webhook.stripe.ts
================================================
import { CustomerId } from '@/database/types';
import { env } from '@/lib/env';
import { stripe, syncStripeDataToDatabase } from '@/lib/stripe';
import { createServerFileRoute } from '@tanstack/react-start/server';
import Stripe from 'stripe';
import { Effect, Layer } from 'effect';
import { APIError } from '@/lib/error';
import { nanoid } from '@/lib/utils';
import { DatabaseLive } from '@/database/effect';

export const ServerRoute = createServerFileRoute('/api/webhook/stripe').methods({
    POST: async ({ request }) => {
        return stripeWebhookApi.pipe(
            Effect.scoped,
            APIError.map({
                status: 500,
                message: 'Uncaught error',
            }),
            Effect.catchAll(e => e.response),
            Effect.provide(StripeWebhookRequestLive(request)),
            Effect.provide(DatabaseLive),
            Effect.annotateLogs('requestId', nanoid()),
            Effect.runPromise
        );
    },
});

const stripeWebhookApi = Effect.gen(function* () {
    const request = yield* StripeWebhookRequest;
    const body = request.body;
    const signature = request.signature;

    if (!signature) {
        return yield* new APIError({
            status: 400,
            message: 'stripe signature missing',
        });
    }

    const event = yield* Effect.try({
        try: () => stripe.webhooks.constructEvent(body, signature, env.STRIPE_WEBHOOK_SECRET),
        catch: error =>
            new APIError({
                status: 400,
                message: 'Invalid webhook signature',
                cause: error,
            }),
    });

    if (ALLOWED_EVENTS.includes(event.type)) {
        const data = event.data.object as {
            customer?: string;
        };

        if (!data.customer) {
            yield* Effect.logError('stripe customer is not a string');
            return yield* Effect.void;
        }

        yield* syncStripeDataToDatabase(CustomerId(data.customer));
    }

    return Response.json({ message: 'received' }, { status: 200 });
});

type StripeWebhookRequestShape = {
    body: string;
    signature: string | null;
};

class StripeWebhookRequest extends Effect.Tag('StripeWebhookRequest')<
    StripeWebhookRequest,
    StripeWebhookRequestShape
>() {}

const StripeWebhookRequestLive = (request: Request) =>
    Layer.scoped(
        StripeWebhookRequest,
        Effect.gen(function* () {
            const body = yield* Effect.tryPromise({
                try: () => request.text(),
                catch: error =>
                    new APIError({
                        status: 400,
                        message: 'Invalid request body',
                        cause: error,
                    }),
            });

            return {
                body,
                signature: request.headers.get('stripe-signature'),
            };
        })
    );

const ALLOWED_EVENTS: Stripe.Event.Type[] = [
    'checkout.session.completed',
    'customer.subscription.created',
    'customer.subscription.updated',
    'customer.subscription.deleted',
    'customer.subscription.paused',
    'customer.subscription.resumed',
    'customer.subscription.pending_update_applied',
    'customer.subscription.pending_update_expired',
    'customer.subscription.trial_will_end',
    'invoice.paid',
    'invoice.payment_failed',
    'invoice.payment_action_required',
    'invoice.upcoming',
    'invoice.marked_uncollectible',
    'invoice.payment_succeeded',
    'payment_intent.succeeded',
    'payment_intent.payment_failed',
    'payment_intent.canceled',
];



================================================
FILE: src/stores/dialogs.ts
================================================
import { createWithEqualityFn as create } from 'zustand/traditional';
import { devtools, subscribeWithSelector } from 'zustand/middleware';

export type DialogStore = {
    proDialog: {
        open: boolean;
        setOpen: (open: boolean) => void;
    };
};

export const dialogStore = create<DialogStore>()(
    devtools(
        subscribeWithSelector(set => ({
            proDialog: {
                open: false,
                setOpen: (open: boolean) => {
                    set(state => ({ ...state, proDialog: { ...state.proDialog, open } }));
                },
            },
        }))
    )
);



================================================
FILE: src/thread/index.ts
================================================
import { AbstractChat, ChatInit, UIMessage } from 'ai';
import { ThreadState } from '@/thread/state';
import { createThreadStore, type ThreadStore } from '@/thread/store';

export class Thread<UI_MESSAGE extends UIMessage> extends AbstractChat<UI_MESSAGE> {
    protected state: ThreadState<UI_MESSAGE>;
    public store: ThreadStore<UI_MESSAGE>;

    constructor(init: ChatInit<UI_MESSAGE>) {
        const store = createThreadStore<UI_MESSAGE>({
            id: init.id,
            messages: init.messages ?? [],
        });
        const state = new ThreadState<UI_MESSAGE>(store);

        super({ ...init, state });

        this.state = state;
        this.store = store;
    }
}



================================================
FILE: src/thread/state.ts
================================================
import type { UIMessage, ChatState, ChatStatus } from 'ai';
import type { ThreadStore } from '@/thread/store';

export class ThreadState<UI_MESSAGE extends UIMessage> implements ChatState<UI_MESSAGE> {
    private store: ThreadStore<UI_MESSAGE>;

    constructor(store: ThreadStore<UI_MESSAGE>) {
        this.store = store;
    }

    get messages(): UI_MESSAGE[] {
        return this.store.getState().messages;
    }

    set messages(newMessages: UI_MESSAGE[]) {
        this.store.getState().setMessages(newMessages);
    }

    get status(): ChatStatus {
        return this.store.getState().status;
    }

    set status(newStatus: ChatStatus) {
        this.store.getState().setStatus(newStatus);
    }

    get error(): Error | undefined {
        return this.store.getState().error;
    }

    set error(newError: Error | undefined) {
        this.store.getState().setError(newError);
    }

    pushMessage = (message: UI_MESSAGE) => {
        this.store.getState().pushMessage(message);
    };

    popMessage = () => {
        this.store.getState().popMessage();
    };

    replaceMessage = (index: number, message: UI_MESSAGE) => {
        this.store.getState().replaceMessage(index, message);
    };

    snapshot = <T>(snapshot: T) => {
        return structuredClone(snapshot);
    };
}



================================================
FILE: src/thread/store.ts
================================================
import { type ChatStatus, type UIMessage } from 'ai';
import { createWithEqualityFn as create } from 'zustand/traditional';
import { devtools, subscribeWithSelector } from 'zustand/middleware';
import { ToolKeys } from '@/ai/types';
import throttle from 'throttleit';

export type ToolSidebar = {
    messageId: string;
    tool: ToolKeys;
    toolCallId: string;
};

export type FileAttachment = {
    type: 'file';
    url: string;
    filename: string;
    mediaType: string;
};

export interface ThreadStoreImpl<UI_MESSAGE extends UIMessage> {
    id?: string;
    messageMap: Record<string, UI_MESSAGE>;
    messageIds: string[];
    messages: UI_MESSAGE[];
    status: ChatStatus;
    error: Error | undefined;

    toolSidebar: ToolSidebar | undefined;
    setToolSidebar: (toolSidebar: ToolSidebar | undefined) => void;
    editingMessageId: string | undefined;
    setEditingMessageId: (editingMessageId: string | undefined) => void;
    tool: ToolKeys | '';
    setTool: (tool: ToolKeys | '') => void;
    input: string;
    setInput: (input: string) => void;
    pendingFileCount: number;
    setPendingFileCount: (pendingFileCount: number | ((prev: number) => number)) => void;
    attachments: FileAttachment[];
    setAttachments: (attachments: FileAttachment[]) => void;

    setMessages: (messages: UI_MESSAGE[] | ((prev: UI_MESSAGE[]) => UI_MESSAGE[])) => void;
    setStatus: (status: ChatStatus) => void;
    setError: (error: Error | undefined) => void;
    pushMessage: (message: UI_MESSAGE) => void;
    popMessage: () => void;
    replaceMessage: (index: number, message: UI_MESSAGE) => void;
}

export function createThreadStore<UI_MESSAGE extends UIMessage>(init: {
    id?: string;
    messages: UI_MESSAGE[];
}) {
    return create<ThreadStoreImpl<UI_MESSAGE>>()(
        devtools(
            subscribeWithSelector((set, get) => {
                const setMessages = (
                    messagesOrUpdater: UI_MESSAGE[] | ((prev: UI_MESSAGE[]) => UI_MESSAGE[])
                ) => {
                    const { messageIds: oldMessageIds } = get();

                    const messages =
                        typeof messagesOrUpdater === 'function'
                            ? messagesOrUpdater(get().messages)
                            : messagesOrUpdater;

                    const lastMessageId = messages[messages.length - 1]?.id;
                    const lastOldMessageId = oldMessageIds[oldMessageIds.length - 1];
                    const hasMessagesChanged = lastMessageId !== lastOldMessageId;
                    const messageIds = hasMessagesChanged ? messages.map(m => m.id) : oldMessageIds;

                    const update = {
                        messages,
                        messageIds,
                        messageMap: Object.fromEntries(messages.map(m => [m.id, m])),
                    };

                    set(update, false, 'thread/setMessages');
                };

                const throttledSetMessages = throttle(setMessages, 100);

                return {
                    id: init.id,
                    messageMap: Object.fromEntries(init.messages.map(m => [m.id, m])),
                    messageIds: init.messages.map(m => m.id),
                    messages: init.messages,
                    status: 'ready',
                    error: undefined,
                    toolSidebar: undefined,
                    input: '',
                    tool: '',
                    pendingFileCount: 0,
                    editingMessageId: undefined,
                    setEditingMessageId: (editingMessageId: string | undefined) =>
                        set({ editingMessageId }, false, 'thread/setEditingMessageId'),
                    setTool: (tool: ToolKeys | '') => set({ tool }, false, 'thread/setTool'),
                    setInput: (input: string) => set({ input }, false, 'thread/setInput'),
                    setPendingFileCount: (
                        pendingFileCount: number | ((prev: number) => number)
                    ) => {
                        set(
                            {
                                pendingFileCount:
                                    typeof pendingFileCount === 'function'
                                        ? pendingFileCount(get().pendingFileCount)
                                        : pendingFileCount,
                            },
                            false,
                            'thread/setPendingFileCount'
                        );
                    },

                    attachments: [],
                    setAttachments: (attachments: FileAttachment[]) =>
                        set({ attachments }, false, 'thread/setAttachments'),
                    setToolSidebar: (toolSidebar: ToolSidebar | undefined) =>
                        set({ toolSidebar }, false, 'thread/setToolSidebar'),
                    setStatus: (status: ChatStatus) => set({ status }, false, 'thread/setStatus'),
                    setError: (error: Error | undefined) =>
                        set({ error }, false, 'thread/setError'),
                    pushMessage: (message: UI_MESSAGE) => {
                        get().setMessages([...get().messages, message]);
                    },
                    popMessage: () => {
                        get().setMessages(get().messages.slice(0, -1));
                    },
                    replaceMessage: (index: number, message: UI_MESSAGE) => {
                        get().setMessages([
                            ...get().messages.slice(0, index),
                            structuredClone(message),
                            ...get().messages.slice(index + 1),
                        ]);
                    },
                    setMessages: (
                        messagesOrUpdater: UI_MESSAGE[] | ((prev: UI_MESSAGE[]) => UI_MESSAGE[])
                    ) => {
                        if (get().status === 'streaming') {
                            throttledSetMessages(messagesOrUpdater);
                            return;
                        }
                        setMessages(messagesOrUpdater);
                    },
                };
            })
        )
    );
}

export type ThreadStore<UI_MESSAGE extends UIMessage> = ReturnType<
    typeof createThreadStore<UI_MESSAGE>
>;



================================================
FILE: src/zero/index.ts
================================================
export { permissions } from '@/zero/permissions';
export { schema } from '@/zero/schema';



================================================
FILE: src/zero/permissions.ts
================================================
import type { UserId } from '@/database/types';
import { type Schema, schema } from '@/zero/schema';
import type { AuthData, TableName } from '@/zero/types';
import { definePermissions, ExpressionBuilder, PermissionsConfig } from '@rocicorp/zero';

export const permissions = definePermissions<AuthData, Schema>(schema, () => {
    const allowIfUser = (authData: AuthData, builder: ExpressionBuilder<Schema, TableName>) =>
        builder.and(allowIfSignedIn(authData, builder), builder.cmp('id', '=', authData.sub));

    const allowIfOwnSession = (authData: AuthData, builder: ExpressionBuilder<Schema, 'session'>) =>
        builder.and(allowIfSignedIn(authData, builder), builder.cmp('userId', '=', authData.sub));

    const allowIfOwnSetting = (authData: AuthData, builder: ExpressionBuilder<Schema, 'setting'>) =>
        builder.and(allowIfSignedIn(authData, builder), builder.cmp('userId', '=', authData.sub));

    const allowIfOwnUsage = (authData: AuthData, builder: ExpressionBuilder<Schema, 'usage'>) =>
        builder.and(
            allowIfSignedIn(authData, builder),
            builder.cmp('userId', '=', authData.sub as UserId)
        );

    const allowIfSignedIn = (authData: AuthData, builder: ExpressionBuilder<Schema, TableName>) =>
        builder.cmpLit(authData.sub, 'IS NOT', null);

    const canReadMessage = (authData: AuthData, builder: ExpressionBuilder<Schema, 'message'>) =>
        builder.exists('thread', thread =>
            thread.where(builder => builder.cmp('userId', '=', authData.sub))
        );

    const allowIfThreadCreator = (
        authData: AuthData,
        builder: ExpressionBuilder<Schema, 'thread'>
    ) => builder.and(allowIfSignedIn(authData, builder), builder.cmp('userId', '=', authData.sub));

    const allowIfMessageCreator = (
        authData: AuthData,
        builder: ExpressionBuilder<Schema, 'message'>
    ) => builder.and(allowIfSignedIn(authData, builder), builder.cmp('userId', '=', authData.sub));

    const allowIfInOrganization = (
        authData: AuthData,
        builder: ExpressionBuilder<Schema, 'organization'>
    ) =>
        builder.and(
            allowIfSignedIn(authData, builder),
            builder.exists('members', members => members.where('userId', '=', authData.sub))
        );

    const allowSelectMembersIfInOrganization = (
        authData: AuthData,
        builder: ExpressionBuilder<Schema, 'member'>
    ) =>
        builder.and(
            allowIfSignedIn(authData, builder),
            builder.exists('organization', organization =>
                organization.whereExists('members', members =>
                    members.where('userId', '=', authData.sub)
                )
            )
        );

    const allowReadIfCustomerBelongsToUser = (
        authData: AuthData,
        builder: ExpressionBuilder<Schema, 'userCustomer'>
    ) =>
        builder.and(
            allowIfSignedIn(authData, builder),
            builder.cmp('userId', '=', authData.sub as UserId)
        );

    const allowReadIfCustomerBelongsToOrganization = (
        authData: AuthData,
        builder: ExpressionBuilder<Schema, 'organizationCustomer'>
    ) =>
        builder.and(
            allowIfSignedIn(authData, builder),
            builder.exists('organization', organization =>
                organization.whereExists('members', members =>
                    members.where('userId', '=', authData.sub)
                )
            )
        );

    return {
        user: {
            row: {
                select: [allowIfUser],
            },
        },
        userCustomer: {
            row: {
                select: [allowReadIfCustomerBelongsToUser],
            },
        },
        organizationCustomer: {
            row: {
                select: [allowReadIfCustomerBelongsToOrganization],
            },
        },
        organization: {
            row: {
                select: [allowIfInOrganization],
            },
        },
        member: {
            row: {
                select: [allowSelectMembersIfInOrganization],
            },
        },
        usage: {
            row: {
                select: [allowIfOwnUsage],
            },
        },
        setting: {
            row: {
                select: [allowIfOwnSetting],
                insert: [allowIfOwnSetting],
                update: {
                    preMutation: [allowIfOwnSetting],
                    postMutation: [allowIfOwnSetting],
                },
            },
        },
        model: {
            row: {
                select: [allowIfSignedIn],
            },
        },
        message: {
            row: {
                select: [canReadMessage],
                insert: [allowIfMessageCreator],
                delete: [allowIfMessageCreator],
                update: {
                    preMutation: [allowIfMessageCreator],
                    postMutation: [allowIfMessageCreator],
                },
            },
        },
        thread: {
            row: {
                select: [allowIfThreadCreator],
                insert: [allowIfThreadCreator],
                delete: [allowIfThreadCreator],
                update: {
                    preMutation: [allowIfThreadCreator],
                    postMutation: [allowIfThreadCreator],
                },
            },
        },
        session: {
            row: {
                select: [allowIfOwnSession],
                delete: [allowIfOwnSession],
            },
        },
    } satisfies PermissionsConfig<AuthData, Schema>;
});



================================================
FILE: src/zero/schema.ts
================================================
/* eslint-disable */
/* tslint:disable */
// noinspection JSUnusedGlobalSymbols
// biome-ignore-all
/*
 * ------------------------------------------------------------
 * ## This file was automatically generated by drizzle-zero. ##
 * ## Any changes you make to this file will be overwritten. ##
 * ##                                                        ##
 * ## Additionally, you should also exclude this file from   ##
 * ## your linter and/or formatter to prevent it from being  ##
 * ## checked or modified.                                   ##
 * ##                                                        ##
 * ## SOURCE: https://github.com/0xcadams/drizzle-zero        ##
 * ------------------------------------------------------------
 */

import type { ZeroCustomType } from "drizzle-zero";
import type { default as zeroSchema } from "../../drizzle-zero.config";

/**
 * The Zero schema object.
 * This type is auto-generated from your Drizzle schema definition.
 */
export const schema = {
  tables: {
    member: {
      name: "member",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "member",
            "id"
          >,
        },
        organizationId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "member",
            "organizationId"
          >,
          serverName: "organization_id",
        },
        userId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "member",
            "userId"
          >,
          serverName: "user_id",
        },
        role: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "member",
            "role"
          >,
        },
        createdAt: {
          type: "number",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "member",
            "createdAt"
          >,
          serverName: "created_at",
        },
      },
      primaryKey: ["id"],
    },
    organization: {
      name: "organization",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organization",
            "id"
          >,
        },
        name: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organization",
            "name"
          >,
        },
        slug: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organization",
            "slug"
          >,
        },
        logo: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organization",
            "logo"
          >,
        },
        createdAt: {
          type: "number",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organization",
            "createdAt"
          >,
          serverName: "created_at",
        },
        metadata: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organization",
            "metadata"
          >,
        },
      },
      primaryKey: ["id"],
    },
    session: {
      name: "session",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "id"
          >,
        },
        expiresAt: {
          type: "number",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "expiresAt"
          >,
          serverName: "expires_at",
        },
        token: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "token"
          >,
        },
        createdAt: {
          type: "number",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "createdAt"
          >,
          serverName: "created_at",
        },
        updatedAt: {
          type: "number",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "updatedAt"
          >,
          serverName: "updated_at",
        },
        ipAddress: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "ipAddress"
          >,
          serverName: "ip_address",
        },
        userAgent: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "userAgent"
          >,
          serverName: "user_agent",
        },
        userId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "userId"
          >,
          serverName: "user_id",
        },
        activeOrganizationId: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "session",
            "activeOrganizationId"
          >,
          serverName: "active_organization_id",
        },
      },
      primaryKey: ["id"],
    },
    user: {
      name: "user",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "user",
            "id"
          >,
        },
        name: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "user",
            "name"
          >,
        },
        email: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "user",
            "email"
          >,
        },
        emailVerified: {
          type: "boolean",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "user",
            "emailVerified"
          >,
          serverName: "email_verified",
        },
        image: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "user",
            "image"
          >,
        },
        createdAt: {
          type: "number",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "user",
            "createdAt"
          >,
          serverName: "created_at",
        },
        updatedAt: {
          type: "number",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "user",
            "updatedAt"
          >,
          serverName: "updated_at",
        },
        isAnonymous: {
          type: "boolean",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "user",
            "isAnonymous"
          >,
          serverName: "is_anonymous",
        },
      },
      primaryKey: ["id"],
    },
    message: {
      name: "message",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "message",
            "id"
          >,
        },
        message: {
          type: "json",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "message",
            "message"
          >,
        },
        createdAt: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "message",
            "createdAt"
          >,
          serverName: "created_at",
        },
        updatedAt: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "message",
            "updatedAt"
          >,
          serverName: "updated_at",
        },
        threadId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "message",
            "threadId"
          >,
          serverName: "thread_id",
        },
        userId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "message",
            "userId"
          >,
          serverName: "user_id",
        },
      },
      primaryKey: ["id"],
    },
    model: {
      name: "model",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "id"
          >,
        },
        name: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "name"
          >,
        },
        model: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "model"
          >,
        },
        description: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "description"
          >,
        },
        capabilities: {
          type: "json",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "capabilities"
          >,
        },
        icon: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "icon"
          >,
        },
        credits: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "credits"
          >,
        },
        access: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "access"
          >,
        },
        createdAt: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "createdAt"
          >,
          serverName: "created_at",
        },
        updatedAt: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "model",
            "updatedAt"
          >,
          serverName: "updated_at",
        },
      },
      primaryKey: ["id"],
    },
    organizationCustomer: {
      name: "organizationCustomer",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organizationCustomer",
            "id"
          >,
        },
        organizationId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organizationCustomer",
            "organizationId"
          >,
          serverName: "organization_id",
        },
        subscription: {
          type: "json",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "organizationCustomer",
            "subscription"
          >,
        },
      },
      primaryKey: ["id"],
      serverName: "organization_customer",
    },
    setting: {
      name: "setting",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "id"
          >,
        },
        mode: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "mode"
          >,
        },
        theme: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "theme"
          >,
        },
        userId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "userId"
          >,
          serverName: "user_id",
        },
        nickname: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "nickname"
          >,
        },
        biography: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "biography"
          >,
        },
        instructions: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "instructions"
          >,
        },
        modelId: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "modelId"
          >,
          serverName: "model_id",
        },
        pinnedModels: {
          type: "json",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "setting",
            "pinnedModels"
          >,
          serverName: "pinned_models",
        },
      },
      primaryKey: ["id"],
    },
    thread: {
      name: "thread",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "thread",
            "id"
          >,
        },
        title: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "thread",
            "title"
          >,
        },
        status: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "thread",
            "status"
          >,
        },
        streamId: {
          type: "string",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "thread",
            "streamId"
          >,
          serverName: "stream_id",
        },
        createdAt: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "thread",
            "createdAt"
          >,
          serverName: "created_at",
        },
        updatedAt: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "thread",
            "updatedAt"
          >,
          serverName: "updated_at",
        },
        userId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "thread",
            "userId"
          >,
          serverName: "user_id",
        },
      },
      primaryKey: ["id"],
    },
    usage: {
      name: "usage",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "usage",
            "id"
          >,
        },
        userId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "usage",
            "userId"
          >,
          serverName: "user_id",
        },
        credits: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "usage",
            "credits"
          >,
        },
        search: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "usage",
            "search"
          >,
        },
        research: {
          type: "number",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "usage",
            "research"
          >,
        },
      },
      primaryKey: ["id"],
    },
    userCustomer: {
      name: "userCustomer",
      columns: {
        id: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "userCustomer",
            "id"
          >,
        },
        userId: {
          type: "string",
          optional: false,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "userCustomer",
            "userId"
          >,
          serverName: "user_id",
        },
        subscription: {
          type: "json",
          optional: true,
          customType: null as unknown as ZeroCustomType<
            typeof zeroSchema,
            "userCustomer",
            "subscription"
          >,
        },
      },
      primaryKey: ["id"],
      serverName: "user_customer",
    },
  },
  relationships: {
    member: {
      organization: [
        {
          sourceField: ["organizationId"],
          destField: ["id"],
          destSchema: "organization",
          cardinality: "one",
        },
      ],
    },
    message: {
      thread: [
        {
          sourceField: ["threadId"],
          destField: ["id"],
          destSchema: "thread",
          cardinality: "one",
        },
      ],
      user: [
        {
          sourceField: ["userId"],
          destField: ["id"],
          destSchema: "user",
          cardinality: "one",
        },
      ],
    },
    organizationCustomer: {
      organization: [
        {
          sourceField: ["organizationId"],
          destField: ["id"],
          destSchema: "organization",
          cardinality: "one",
        },
      ],
    },
    organization: {
      customer: [
        {
          sourceField: ["id"],
          destField: ["organizationId"],
          destSchema: "organizationCustomer",
          cardinality: "one",
        },
      ],
      members: [
        {
          sourceField: ["id"],
          destField: ["organizationId"],
          destSchema: "member",
          cardinality: "many",
        },
      ],
    },
    setting: {
      user: [
        {
          sourceField: ["userId"],
          destField: ["id"],
          destSchema: "user",
          cardinality: "one",
        },
      ],
      model: [
        {
          sourceField: ["modelId"],
          destField: ["id"],
          destSchema: "model",
          cardinality: "one",
        },
      ],
    },
    thread: {
      user: [
        {
          sourceField: ["userId"],
          destField: ["id"],
          destSchema: "user",
          cardinality: "one",
        },
      ],
      messages: [
        {
          sourceField: ["id"],
          destField: ["threadId"],
          destSchema: "message",
          cardinality: "many",
        },
      ],
    },
    userCustomer: {
      user: [
        {
          sourceField: ["userId"],
          destField: ["id"],
          destSchema: "user",
          cardinality: "one",
        },
      ],
    },
    user: {
      threads: [
        {
          sourceField: ["id"],
          destField: ["userId"],
          destSchema: "thread",
          cardinality: "many",
        },
      ],
      messages: [
        {
          sourceField: ["id"],
          destField: ["userId"],
          destSchema: "message",
          cardinality: "many",
        },
      ],
      settings: [
        {
          sourceField: ["id"],
          destField: ["userId"],
          destSchema: "setting",
          cardinality: "one",
        },
      ],
      customer: [
        {
          sourceField: ["id"],
          destField: ["userId"],
          destSchema: "userCustomer",
          cardinality: "one",
        },
      ],
    },
  },
} as const;

/**
 * Represents the Zero schema type.
 * This type is auto-generated from your Drizzle schema definition.
 */
export type Schema = typeof schema;



================================================
FILE: src/zero/types.ts
================================================
import { type Schema } from '@/zero/schema';
import { Row } from '@rocicorp/zero';

export type User = Row<Schema['tables']['user']>;
export type Thread = Row<Schema['tables']['thread']>;
export type Message = Row<Schema['tables']['message']>;
export type Session = Row<Schema['tables']['session']>;
export type Organization = Row<Schema['tables']['organization']>;
export type Member = Row<Schema['tables']['member']>;
export type OrganizationCustomer = Row<Schema['tables']['organizationCustomer']>;
export type UserCustomer = Row<Schema['tables']['userCustomer']>;
export type Model = Row<Schema['tables']['model']>;

export type TableName = keyof Schema['tables'];

export type AuthData = {
    sub: string;
};



================================================
FILE: .claude/settings.local.json
================================================
{
  "permissions": {
    "allow": [
      "Bash(npx shadcn@latest add:*)"
    ],
    "deny": []
  }
}

